<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LymphoInvader: Attending Level Challenge</title>
    <style>
        :root {
            /* Consistent Color Palette - Medical/Scientific Theme */
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: rgba(17, 24, 39, 0.95);
            --accent-primary: #06b6d4; /* Cyan - main accent */
            --accent-secondary: #8b5cf6; /* Purple - secondary */
            --accent-success: #10b981; /* Green */
            --accent-danger: #ef4444; /* Red - lymphoma cells */
            --accent-warning: #f59e0b; /* Amber */
            --text-primary: #f3f4f6;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;
            --border-color: rgba(6, 182, 212, 0.2);
            --glow-cyan: rgba(6, 182, 212, 0.4);
            --glow-purple: rgba(139, 92, 246, 0.4);
        }

        /* ============ STREET FIGHTER MODE ============ */
        body.sf-mode {
            --bg-primary: #0d0d12;
            --bg-secondary: #1a1a24;
            --bg-card: rgba(20, 20, 30, 0.98);
            --accent-primary: #ff8c00; /* Softer orange */
            --accent-secondary: #ffd700; /* Gold */
            --accent-success: #00dd00; /* Slightly softer green */
            --accent-danger: #ff3366; /* Softer red */
            --accent-warning: #ff66ff; /* Softer magenta */
            --border-color: rgba(255, 140, 0, 0.5);
            --glow-cyan: rgba(255, 140, 0, 0.5);
            --glow-purple: rgba(255, 215, 0, 0.5);
            --text-primary: #ffffff;
            --text-secondary: #e0e0e0;
            --text-muted: #a0a0a0;
        }

        body.sf-mode {
            font-family: 'Segoe UI', 'Arial', sans-serif;
            background: linear-gradient(135deg, #0d0d12 0%, #1a1420 50%, #0d1520 100%);
        }

        body.sf-mode::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                repeating-linear-gradient(0deg, transparent, transparent 3px, rgba(0,0,0,0.03) 3px, rgba(0,0,0,0.03) 6px);
            pointer-events: none;
            z-index: 9998;
            opacity: 0.5;
        }

        body.sf-mode .title {
            font-family: 'Impact', 'Arial Black', sans-serif;
            text-transform: uppercase;
            letter-spacing: 4px;
            background: linear-gradient(180deg, #ffd700 0%, #ff8c00 50%, #ff5500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: none;
            filter: drop-shadow(0 0 8px rgba(255, 140, 0, 0.6)) drop-shadow(0 2px 4px rgba(0, 0, 0, 0.8));
            animation: sf-title-pulse 0.5s ease-in-out infinite alternate;
        }

        @keyframes sf-title-pulse {
            from { transform: scale(1); }
            to { transform: scale(1.02); }
        }

        body.sf-mode .subtitle {
            font-family: 'Segoe UI', 'Arial', sans-serif;
            font-weight: 600;
            text-transform: uppercase;
            color: #ffd700;
            letter-spacing: 1px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        }

        body.sf-mode .start-btn,
        body.sf-mode .mode-btn,
        body.sf-mode .difficulty-btn {
            font-family: 'Arial Black', 'Arial', sans-serif;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 3px solid #ffd700;
            background: linear-gradient(180deg, #ff8c00 0%, #cc6600 100%);
            box-shadow: 0 4px 15px rgba(255, 140, 0, 0.4), inset 0 2px 0 rgba(255,255,255,0.2);
            transition: all 0.1s ease;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        body.sf-mode .start-btn:hover,
        body.sf-mode .mode-btn:hover,
        body.sf-mode .difficulty-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 25px rgba(255, 215, 0, 0.6), inset 0 2px 0 rgba(255,255,255,0.2);
        }

        body.sf-mode .start-btn:active {
            transform: scale(0.95);
        }

        body.sf-mode .question-card {
            border: 3px solid #ffd700;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6), 0 0 20px rgba(255, 140, 0, 0.2);
            background: rgba(15, 15, 25, 0.98);
        }

        /* Keep body text readable - no uppercase, normal font */
        body.sf-mode .question-text,
        body.sf-mode .case-presentation,
        body.sf-mode .explanation,
        body.sf-mode .histopath-caption,
        body.sf-mode .lab-value,
        body.sf-mode p {
            font-family: 'Segoe UI', 'Arial', sans-serif;
            text-transform: none;
            letter-spacing: normal;
            line-height: 1.6;
            color: #f0f0f0;
        }

        body.sf-mode .question-text {
            font-size: 1.15em;
            font-weight: 500;
            color: #ffffff;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        body.sf-mode .case-presentation {
            background: rgba(255, 140, 0, 0.08);
            border-left: 4px solid #ff8c00;
        }

        body.sf-mode .option {
            border: 2px solid rgba(255, 140, 0, 0.6);
            font-family: 'Segoe UI', 'Arial', sans-serif;
            font-weight: 500;
            text-transform: none;
            transition: all 0.15s ease;
            background: rgba(30, 30, 45, 0.9);
            color: #f0f0f0;
        }

        body.sf-mode .option-letter {
            font-family: 'Arial Black', sans-serif;
            font-weight: bold;
            color: #ffd700;
        }

        body.sf-mode .option:hover:not(.disabled) {
            border-color: #ffd700;
            background: rgba(255, 140, 0, 0.15);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
            transform: translateX(8px);
        }

        body.sf-mode .option.correct {
            background: linear-gradient(90deg, rgba(0, 200, 0, 0.25) 0%, rgba(0, 150, 0, 0.1) 100%);
            border-color: #00dd00;
            animation: sf-correct-flash 0.2s ease-in-out 3;
        }

        body.sf-mode .option.incorrect {
            background: linear-gradient(90deg, rgba(255, 50, 100, 0.25) 0%, rgba(200, 40, 80, 0.1) 100%);
            border-color: #ff3366;
            animation: sf-shake 0.3s ease-in-out;
        }

        @keyframes sf-correct-flash {
            0%, 100% { box-shadow: 0 0 15px rgba(0, 220, 0, 0.4); }
            50% { box-shadow: 0 0 30px rgba(0, 220, 0, 0.8); }
        }

        @keyframes sf-shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        body.sf-mode .question-type {
            font-family: 'Arial Black', sans-serif;
            font-weight: bold;
            border: 2px solid currentColor;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        body.sf-mode .difficulty-badge {
            font-family: 'Arial Black', sans-serif;
            font-weight: bold;
            border-width: 2px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        body.sf-mode .stats-bar {
            background: linear-gradient(90deg, rgba(20, 20, 30, 0.95) 0%, rgba(30, 20, 40, 0.95) 100%);
            border: 2px solid #ffd700;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }

        body.sf-mode .stat-item {
            font-family: 'Arial', sans-serif;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.85em;
            letter-spacing: 0.5px;
        }

        body.sf-mode .stat-value {
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        body.sf-mode .next-btn {
            font-family: 'Arial Black', 'Arial', sans-serif;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            background: linear-gradient(180deg, #00cc00 0%, #009900 100%);
            border: 3px solid #00ff00;
            box-shadow: 0 4px 20px rgba(0, 255, 0, 0.4);
            color: #fff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        body.sf-mode .next-btn:hover {
            box-shadow: 0 6px 30px rgba(0, 255, 0, 0.6);
        }

        /* SF Mode Health Bar */
        body.sf-mode .progress-bar {
            border: 2px solid #ffd700;
            background: rgba(10, 10, 15, 0.9);
        }

        body.sf-mode .progress-fill {
            background: linear-gradient(90deg, #00dd00 0%, #ffdd00 50%, #ff6600 100%);
            box-shadow: 0 0 8px rgba(0, 220, 0, 0.5);
        }

        /* Explanation box readability */
        body.sf-mode .explanation {
            background: rgba(255, 215, 0, 0.08);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            padding: 16px;
        }

        body.sf-mode .explanation h4 {
            font-family: 'Arial Black', sans-serif;
            color: #ffd700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        body.sf-mode .key-point {
            background: rgba(255, 140, 0, 0.1);
            border-left: 3px solid #ff8c00;
        }

        body.sf-mode .citation {
            color: #a0a0a0;
            font-size: 0.85em;
        }

        /* Lab values readability */
        body.sf-mode .lab-item {
            background: rgba(30, 30, 45, 0.8);
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        body.sf-mode .lab-name {
            color: #ffd700;
            font-weight: 600;
        }

        /* Histopath panels */
        body.sf-mode .histopath-panel {
            background: rgba(20, 20, 30, 0.9);
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        body.sf-mode .histopath-panel-label {
            font-family: 'Arial Black', sans-serif;
            color: #ffd700;
            text-transform: uppercase;
            font-size: 0.75em;
            letter-spacing: 1px;
        }

        /* SF Fight Announcement */
        .sf-announcement {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Impact', 'Arial Black', sans-serif;
            font-size: 5em;
            color: #ffd700;
            text-shadow:
                0 0 20px #ff6b00,
                0 0 40px #ff0040,
                4px 4px 0 #000,
                -4px -4px 0 #000;
            z-index: 10000;
            animation: sf-announce 1s ease-out forwards;
            text-transform: uppercase;
            letter-spacing: 10px;
        }

        @keyframes sf-announce {
            0% { transform: translate(-50%, -50%) scale(3); opacity: 0; }
            30% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            70% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
        }

        /* Combo Counter */
        body.sf-mode .combo-counter {
            position: fixed;
            top: 100px;
            right: 20px;
            font-family: 'Impact', sans-serif;
            font-size: 2em;
            color: #ffd700;
            text-shadow: 2px 2px 0 #000;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 100;
        }

        body.sf-mode .combo-counter.show {
            opacity: 1;
            animation: combo-pop 0.3s ease-out;
        }

        @keyframes combo-pop {
            0% { transform: scale(1.5); }
            100% { transform: scale(1); }
        }

        /* Easter Egg Switch */
        .sf-switch {
            position: fixed;
            bottom: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #333 0%, #111 100%);
            border: 2px solid #444;
            cursor: pointer;
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.3s ease;
            opacity: 0.3;
        }

        .sf-switch:hover {
            opacity: 1;
            transform: scale(1.1);
            border-color: #ff6b00;
            box-shadow: 0 0 15px rgba(255, 107, 0, 0.5);
        }

        body.sf-mode .sf-switch {
            background: linear-gradient(135deg, #ff6b00 0%, #cc5500 100%);
            border-color: #ffd700;
            opacity: 1;
            animation: sf-switch-glow 1s ease-in-out infinite alternate;
        }

        @keyframes sf-switch-glow {
            from { box-shadow: 0 0 10px rgba(255, 107, 0, 0.5); }
            to { box-shadow: 0 0 25px rgba(255, 215, 0, 0.8); }
        }

        /* SF Mode Enhanced Animations */
        .sf-screen-flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            opacity: 0;
        }

        .sf-screen-flash.correct {
            background: radial-gradient(circle, rgba(0,255,0,0.4) 0%, transparent 70%);
            animation: sf-flash-correct 0.3s ease-out;
        }

        .sf-screen-flash.incorrect {
            background: radial-gradient(circle, rgba(255,0,0,0.4) 0%, transparent 70%);
            animation: sf-flash-incorrect 0.4s ease-out;
        }

        .sf-screen-flash.epic {
            background: radial-gradient(circle, rgba(255,215,0,0.6) 0%, rgba(255,107,0,0.3) 50%, transparent 70%);
            animation: sf-flash-epic 0.5s ease-out;
        }

        @keyframes sf-flash-correct {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }

        @keyframes sf-flash-incorrect {
            0%, 20%, 40% { opacity: 1; }
            10%, 30%, 100% { opacity: 0; }
        }

        @keyframes sf-flash-epic {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
            100% { opacity: 0; transform: scale(1.2); }
        }

        /* Hit Sparks */
        .sf-hit-spark {
            position: fixed;
            pointer-events: none;
            z-index: 10001;
            font-size: 3em;
            animation: sf-spark-burst 0.5s ease-out forwards;
        }

        @keyframes sf-spark-burst {
            0% { transform: scale(0) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.5) rotate(180deg); opacity: 1; }
            100% { transform: scale(2) rotate(360deg); opacity: 0; }
        }

        /* Energy Charge Effect */
        body.sf-mode .question-card {
            position: relative;
            overflow: visible;
        }

        body.sf-mode .question-card::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #ff6b00, #ffd700, #ff0040, #ff6b00);
            background-size: 400% 400%;
            border-radius: 14px;
            z-index: -1;
            animation: sf-energy-flow 3s ease infinite;
            opacity: 0.7;
        }

        @keyframes sf-energy-flow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* VS Screen Overlay */
        .sf-vs-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a0a0a 0%, #0a0a1a 100%);
            z-index: 10002;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .sf-vs-screen.show {
            display: flex;
            animation: sf-vs-appear 2s ease-out forwards;
        }

        @keyframes sf-vs-appear {
            0% { opacity: 0; }
            10% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; pointer-events: none; }
        }

        .sf-vs-text {
            font-family: 'Impact', sans-serif;
            font-size: 8em;
            color: #ffd700;
            text-shadow:
                0 0 30px #ff6b00,
                0 0 60px #ff0040,
                6px 6px 0 #000;
            animation: sf-vs-pulse 0.3s ease-in-out infinite alternate;
        }

        @keyframes sf-vs-pulse {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }

        .sf-fighters {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-bottom: 40px;
        }

        .sf-fighter {
            font-size: 4em;
            animation: sf-fighter-enter 0.5s ease-out;
        }

        .sf-fighter.left {
            animation: sf-fighter-left 0.5s ease-out;
        }

        .sf-fighter.right {
            animation: sf-fighter-right 0.5s ease-out;
        }

        @keyframes sf-fighter-left {
            from { transform: translateX(-200px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes sf-fighter-right {
            from { transform: translateX(200px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Health Bar Style Progress */
        body.sf-mode .progress-container {
            position: relative;
        }

        body.sf-mode .progress-container::before {
            content: 'HEALTH';
            position: absolute;
            left: 0;
            top: -20px;
            font-family: 'Impact', sans-serif;
            font-size: 0.8em;
            color: #ffd700;
            letter-spacing: 2px;
        }

        /* Dramatic option selection */
        body.sf-mode .option {
            position: relative;
            overflow: hidden;
        }

        body.sf-mode .option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,215,0,0.3), transparent);
            transition: left 0.3s ease;
        }

        body.sf-mode .option:hover::before {
            left: 100%;
        }

        /* Power meter for streak */
        .sf-power-meter {
            position: fixed;
            bottom: 70px;
            right: 15px;
            width: 30px;
            height: 150px;
            background: #1a0a0a;
            border: 2px solid #ffd700;
            border-radius: 5px;
            overflow: hidden;
            display: none;
            z-index: 100;
        }

        body.sf-mode .sf-power-meter {
            display: block;
        }

        .sf-power-fill {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: linear-gradient(0deg, #00ff00, #ffff00, #ff6b00, #ff0040);
            transition: height 0.3s ease;
            box-shadow: 0 0 10px currentColor;
        }

        .sf-power-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Impact', sans-serif;
            font-size: 0.7em;
            color: #ffd700;
            white-space: nowrap;
        }

        /* Floating damage numbers */
        .sf-damage-number {
            position: fixed;
            font-family: 'Impact', sans-serif;
            font-size: 2em;
            color: #ffd700;
            text-shadow: 2px 2px 0 #000, -2px -2px 0 #000;
            pointer-events: none;
            z-index: 10001;
            animation: sf-damage-float 1s ease-out forwards;
        }

        .sf-damage-number.bonus {
            color: #00ff00;
            font-size: 2.5em;
        }

        @keyframes sf-damage-float {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-100px) scale(1.5); opacity: 0; }
        }

        /* Fireball animation on correct streak */
        .sf-fireball {
            position: fixed;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: radial-gradient(circle, #fff 0%, #ffd700 30%, #ff6b00 60%, transparent 70%);
            box-shadow: 0 0 30px #ff6b00, 0 0 60px #ffd700;
            pointer-events: none;
            z-index: 10001;
            animation: sf-fireball-fly 0.8s ease-out forwards;
        }

        @keyframes sf-fireball-fly {
            0% { transform: translateX(-100vw) scale(0.5); opacity: 1; }
            50% { transform: translateX(0) scale(1); opacity: 1; }
            100% { transform: translateX(100vw) scale(0.5); opacity: 0; }
        }

        /* Button press effect */
        body.sf-mode .option:active {
            transform: scale(0.95);
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }

        /* Intro animation for questions */
        body.sf-mode .question-card {
            animation: sf-card-intro 0.5s ease-out;
        }

        @keyframes sf-card-intro {
            0% { transform: scale(0.8) rotateX(20deg); opacity: 0; }
            100% { transform: scale(1) rotateX(0deg); opacity: 1; }
        }

        /* Stats bar glow */
        body.sf-mode .stats-bar {
            animation: sf-stats-glow 2s ease-in-out infinite alternate;
        }

        @keyframes sf-stats-glow {
            from { box-shadow: 0 0 10px rgba(255, 107, 0, 0.3); }
            to { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
        }

        /* Hide medical drama elements in SF mode */
        body.sf-mode .ekg-container {
            display: none;
        }

        body.sf-mode .music-controls {
            display: none;
        }

        body.sf-mode .dramatic-overlay {
            display: none;
        }

        /* Override medical animations in SF mode */
        body.sf-mode .header {
            animation: none;
        }

        body.sf-mode .stats-bar {
            animation: sf-stats-glow 2s ease-in-out infinite alternate;
        }

        body.sf-mode .key-point {
            animation: none;
            box-shadow: -4px 0 0 #ff8c00;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            overflow-x: hidden;
            color: var(--text-primary);
        }

        /* Animated Cell Background */
        .cell-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        /* Realistic B-Cell with nucleus and membrane */
        .cell {
            position: absolute;
            border-radius: 50%;
            opacity: 0.7;
            animation: float 25s infinite ease-in-out;
        }

        .b-cell {
            background: radial-gradient(ellipse at 35% 35%,
                rgba(6, 182, 212, 0.1) 0%,
                rgba(6, 182, 212, 0.3) 40%,
                rgba(6, 182, 212, 0.5) 70%,
                rgba(6, 182, 212, 0.8) 100%);
            border: 2px solid rgba(6, 182, 212, 0.6);
            box-shadow:
                0 0 20px var(--glow-cyan),
                inset 0 0 20px rgba(6, 182, 212, 0.2);
        }

        /* Nucleus inside B-cell */
        .b-cell::before {
            content: '';
            position: absolute;
            width: 45%;
            height: 45%;
            background: radial-gradient(circle at 40% 40%,
                rgba(139, 92, 246, 0.9) 0%,
                rgba(79, 70, 229, 0.7) 60%,
                rgba(55, 48, 163, 0.5) 100%);
            border-radius: 50%;
            top: 28%;
            left: 28%;
            box-shadow: inset -2px -2px 8px rgba(0,0,0,0.3);
        }

        /* Lymphoma Cell - Reed-Sternberg like with bilobed nucleus */
        .lymphoma-cell {
            background: radial-gradient(ellipse at 35% 35%,
                rgba(239, 68, 68, 0.2) 0%,
                rgba(220, 38, 38, 0.4) 50%,
                rgba(185, 28, 28, 0.7) 100%);
            border: 2px solid rgba(239, 68, 68, 0.7);
            box-shadow:
                0 0 25px rgba(239, 68, 68, 0.5),
                inset 0 0 15px rgba(239, 68, 68, 0.2);
        }

        /* Bilobed nucleus - "owl eye" appearance */
        .lymphoma-cell::before, .lymphoma-cell::after {
            content: '';
            position: absolute;
            width: 28%;
            height: 28%;
            background: radial-gradient(circle at 50% 50%,
                #1f2937 0%,
                #374151 50%,
                #4b5563 100%);
            border-radius: 50%;
            border: 2px solid rgba(239, 68, 68, 0.8);
        }

        .lymphoma-cell::before {
            top: 25%;
            left: 18%;
        }

        .lymphoma-cell::after {
            top: 25%;
            right: 18%;
        }

        /* Y-Shaped Antibody (Rituximab) */
        .antibody {
            width: 30px !important;
            height: 40px !important;
            background: transparent !important;
            border: none !important;
            border-radius: 0 !important;
            box-shadow: none !important;
            position: relative;
        }

        .antibody::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 20px;
            background: linear-gradient(to top, var(--accent-warning), #fbbf24);
            border-radius: 2px;
            box-shadow: 0 0 10px rgba(245, 158, 11, 0.6);
        }

        .antibody::after {
            content: '';
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 24px;
            height: 4px;
            background: linear-gradient(to right, var(--accent-warning), #fbbf24, var(--accent-warning));
            border-radius: 2px;
            box-shadow:
                -8px -12px 0 3px var(--accent-warning),
                8px -12px 0 3px var(--accent-warning),
                0 0 15px rgba(245, 158, 11, 0.5);
        }

        /* CD20 Target on B-cells */
        .cd20-marker {
            position: absolute;
            width: 8px;
            height: 8px;
            background: var(--accent-warning);
            border-radius: 50%;
            box-shadow: 0 0 8px var(--accent-warning);
        }

        /* T-Cell (Helper) - Green with kidney-shaped nucleus */
        .t-cell {
            background: radial-gradient(ellipse at 35% 35%,
                rgba(16, 185, 129, 0.15) 0%,
                rgba(16, 185, 129, 0.35) 40%,
                rgba(16, 185, 129, 0.55) 70%,
                rgba(5, 150, 105, 0.8) 100%);
            border: 2px solid rgba(16, 185, 129, 0.6);
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.4);
        }

        .t-cell::before {
            content: '';
            position: absolute;
            width: 50%;
            height: 35%;
            background: radial-gradient(ellipse at 40% 40%,
                rgba(6, 95, 70, 0.9) 0%,
                rgba(4, 120, 87, 0.7) 100%);
            border-radius: 50% 50% 20% 50%;
            top: 32%;
            left: 25%;
            transform: rotate(-20deg);
        }

        /* Macrophage - Large irregular shape */
        .macrophage {
            background: radial-gradient(ellipse at 40% 40%,
                rgba(217, 119, 6, 0.2) 0%,
                rgba(180, 83, 9, 0.45) 50%,
                rgba(146, 64, 14, 0.7) 100%);
            border: 2px solid rgba(217, 119, 6, 0.6);
            border-radius: 45% 55% 60% 40% / 50% 45% 55% 50%;
            box-shadow: 0 0 18px rgba(217, 119, 6, 0.4);
            animation: float 30s infinite ease-in-out, morph 8s infinite ease-in-out;
        }

        .macrophage::before {
            content: '';
            position: absolute;
            width: 35%;
            height: 35%;
            background: radial-gradient(circle, rgba(120, 53, 15, 0.9), rgba(92, 45, 10, 0.6));
            border-radius: 40% 60% 50% 50%;
            top: 30%;
            left: 32%;
        }

        /* Plasma Cell - Eccentric nucleus, clock-face chromatin */
        .plasma-cell {
            background: radial-gradient(ellipse at 35% 35%,
                rgba(168, 85, 247, 0.15) 0%,
                rgba(139, 92, 246, 0.4) 50%,
                rgba(124, 58, 237, 0.7) 100%);
            border: 2px solid rgba(168, 85, 247, 0.6);
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.4);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
        }

        .plasma-cell::before {
            content: '';
            position: absolute;
            width: 40%;
            height: 40%;
            background: radial-gradient(circle at 30% 30%,
                rgba(76, 29, 149, 0.5) 0%,
                rgba(91, 33, 182, 0.9) 50%,
                rgba(76, 29, 149, 0.5) 100%);
            border-radius: 50%;
            top: 20%;
            left: 15%;
            box-shadow:
                inset 3px 0 0 rgba(255,255,255,0.2),
                inset -3px 0 0 rgba(255,255,255,0.2),
                inset 0 3px 0 rgba(255,255,255,0.2),
                inset 0 -3px 0 rgba(255,255,255,0.2);
        }

        /* Eosinophil - Bilobed nucleus with red granules */
        .eosinophil {
            background: radial-gradient(ellipse at 35% 35%,
                rgba(244, 114, 182, 0.2) 0%,
                rgba(236, 72, 153, 0.4) 50%,
                rgba(219, 39, 119, 0.65) 100%);
            border: 2px solid rgba(244, 114, 182, 0.6);
            box-shadow: 0 0 15px rgba(244, 114, 182, 0.4);
        }

        .eosinophil::before, .eosinophil::after {
            content: '';
            position: absolute;
            width: 30%;
            height: 25%;
            background: rgba(131, 24, 67, 0.9);
            border-radius: 50%;
        }

        .eosinophil::before {
            top: 25%;
            left: 20%;
            transform: rotate(-30deg);
        }

        .eosinophil::after {
            top: 25%;
            right: 20%;
            transform: rotate(30deg);
        }

        /* Neutrophil - Multi-lobed nucleus */
        .neutrophil {
            background: radial-gradient(ellipse at 35% 35%,
                rgba(96, 165, 250, 0.15) 0%,
                rgba(59, 130, 246, 0.35) 50%,
                rgba(37, 99, 235, 0.6) 100%);
            border: 2px solid rgba(96, 165, 250, 0.5);
            box-shadow: 0 0 12px rgba(96, 165, 250, 0.3);
        }

        .neutrophil::before {
            content: '';
            position: absolute;
            width: 70%;
            height: 30%;
            top: 35%;
            left: 15%;
            background:
                radial-gradient(ellipse at 20% 50%, rgba(30, 58, 138, 0.9) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(30, 58, 138, 0.9) 0%, transparent 45%),
                radial-gradient(ellipse at 80% 50%, rgba(30, 58, 138, 0.9) 0%, transparent 50%);
        }

        /* Red Blood Cell */
        .rbc {
            background: radial-gradient(ellipse at 50% 50%,
                rgba(185, 28, 28, 0.3) 0%,
                rgba(220, 38, 38, 0.6) 40%,
                rgba(239, 68, 68, 0.4) 70%,
                rgba(185, 28, 28, 0.7) 100%);
            border: 1px solid rgba(185, 28, 28, 0.5);
            border-radius: 50%;
            box-shadow: inset 0 0 10px rgba(127, 29, 29, 0.5);
        }

        /* Centroblast - Large cell with multiple nucleoli */
        .centroblast {
            background: radial-gradient(ellipse at 35% 35%,
                rgba(6, 182, 212, 0.15) 0%,
                rgba(8, 145, 178, 0.4) 50%,
                rgba(14, 116, 144, 0.7) 100%);
            border: 2px solid rgba(6, 182, 212, 0.7);
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.5);
        }

        .centroblast::before {
            content: '';
            position: absolute;
            width: 55%;
            height: 55%;
            background: radial-gradient(circle at 30% 30%,
                rgba(21, 94, 117, 0.9) 0%,
                rgba(22, 78, 99, 0.7) 100%);
            border-radius: 50%;
            top: 22%;
            left: 22%;
            box-shadow:
                8px 5px 0 3px rgba(255, 255, 255, 0.8),
                -5px 8px 0 2px rgba(255, 255, 255, 0.7),
                3px -6px 0 2px rgba(255, 255, 255, 0.6);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg) scale(1); }
            25% { transform: translateY(-20px) rotate(3deg) scale(1.02); }
            50% { transform: translateY(5px) rotate(-2deg) scale(0.98); }
            75% { transform: translateY(15px) rotate(2deg) scale(1.01); }
        }

        @keyframes float2 {
            0%, 100% { transform: translateX(0) translateY(0) rotate(0deg); }
            33% { transform: translateX(15px) translateY(-25px) rotate(5deg); }
            66% { transform: translateX(-10px) translateY(10px) rotate(-3deg); }
        }

        @keyframes float3 {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-35px) scale(1.05); }
        }

        /* ============ SPACE INVADERS ANIMATION ============ */
        .space-invaders-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .invader-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            position: absolute;
            width: 100%;
            animation: invader-march 8s linear infinite;
        }

        .invader-row:nth-child(1) { top: 5%; animation-delay: 0s; }
        .invader-row:nth-child(2) { top: 12%; animation-delay: 0.5s; }
        .invader-row:nth-child(3) { top: 19%; animation-delay: 1s; }
        .invader-row:nth-child(4) { top: 26%; animation-delay: 1.5s; }
        .invader-row:nth-child(5) { top: 33%; animation-delay: 2s; }

        @keyframes invader-march {
            0% { transform: translateX(-100px); }
            25% { transform: translateX(100px); }
            26% { transform: translateX(100px) translateY(15px); }
            50% { transform: translateX(-100px) translateY(15px); }
            51% { transform: translateX(-100px) translateY(30px); }
            75% { transform: translateX(100px) translateY(30px); }
            76% { transform: translateX(100px) translateY(45px); }
            100% { transform: translateX(-100px) translateY(45px); }
        }

        .invader {
            width: 36px;
            height: 36px;
            position: relative;
            animation: invader-wiggle 0.5s steps(2) infinite;
            image-rendering: pixelated;
            opacity: 0.7;
        }

        @keyframes invader-wiggle {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1) rotate(5deg); }
        }

        /* Pixel art lymphoma cell (Space Invader style) */
        .invader-lymphoma {
            background:
                linear-gradient(90deg, transparent 0%, transparent 12.5%, #ff4444 12.5%, #ff4444 25%, transparent 25%, transparent 37.5%, #ff4444 37.5%, #ff4444 62.5%, transparent 62.5%, transparent 75%, #ff4444 75%, #ff4444 87.5%, transparent 87.5%),
                linear-gradient(90deg, transparent 0%, transparent 25%, #ff4444 25%, #ff4444 75%, transparent 75%),
                linear-gradient(90deg, #ff4444 0%, #ff4444 12.5%, #ff6666 12.5%, #ff6666 25%, #ff4444 25%, #ff4444 75%, #ff6666 75%, #ff6666 87.5%, #ff4444 87.5%),
                linear-gradient(90deg, transparent 12.5%, #ff4444 12.5%, #ff4444 87.5%, transparent 87.5%),
                linear-gradient(90deg, transparent 25%, #ff4444 25%, #ff4444 37.5%, transparent 37.5%, transparent 62.5%, #ff4444 62.5%, #ff4444 75%, transparent 75%);
            background-size: 100% 20%;
            background-position: 0 0, 0 20%, 0 40%, 0 60%, 0 80%;
            background-repeat: no-repeat;
            filter: drop-shadow(0 0 4px rgba(255, 68, 68, 0.6));
        }

        /* Pixel art B-cell (Space Invader style) */
        .invader-bcell {
            background:
                linear-gradient(90deg, transparent 25%, #00aaff 25%, #00aaff 75%, transparent 75%),
                linear-gradient(90deg, transparent 12.5%, #00aaff 12.5%, #00aaff 87.5%, transparent 87.5%),
                linear-gradient(90deg, #00aaff 0%, #00aaff 37.5%, #0088cc 37.5%, #0088cc 62.5%, #00aaff 62.5%),
                linear-gradient(90deg, transparent 12.5%, #00aaff 12.5%, #00aaff 87.5%, transparent 87.5%),
                linear-gradient(90deg, #00aaff 0%, #00aaff 25%, transparent 25%, transparent 75%, #00aaff 75%);
            background-size: 100% 20%;
            background-position: 0 0, 0 20%, 0 40%, 0 60%, 0 80%;
            background-repeat: no-repeat;
            filter: drop-shadow(0 0 4px rgba(0, 170, 255, 0.6));
        }

        /* Pixel art T-cell (Space Invader style) */
        .invader-tcell {
            background:
                linear-gradient(90deg, transparent 37.5%, #44ff44 37.5%, #44ff44 62.5%, transparent 62.5%),
                linear-gradient(90deg, transparent 25%, #44ff44 25%, #44ff44 75%, transparent 75%),
                linear-gradient(90deg, transparent 12.5%, #44ff44 12.5%, #44ff44 87.5%, transparent 87.5%),
                linear-gradient(90deg, #44ff44 0%, #44ff44 25%, #22cc22 25%, #22cc22 75%, #44ff44 75%),
                linear-gradient(90deg, #44ff44 12.5%, #44ff44 37.5%, transparent 37.5%, transparent 62.5%, #44ff44 62.5%, #44ff44 87.5%);
            background-size: 100% 20%;
            background-position: 0 0, 0 20%, 0 40%, 0 60%, 0 80%;
            background-repeat: no-repeat;
            filter: drop-shadow(0 0 4px rgba(68, 255, 68, 0.6));
        }

        /* Reed-Sternberg cell (owl-eye appearance) */
        .invader-rscell {
            background:
                linear-gradient(90deg, transparent 25%, #aa44ff 25%, #aa44ff 75%, transparent 75%),
                linear-gradient(90deg, #aa44ff 12.5%, #ffffff 25%, #ffffff 37.5%, #aa44ff 37.5%, #aa44ff 62.5%, #ffffff 62.5%, #ffffff 75%, #aa44ff 87.5%),
                linear-gradient(90deg, #aa44ff 0%, #aa44ff 37.5%, #8833cc 37.5%, #8833cc 62.5%, #aa44ff 62.5%),
                linear-gradient(90deg, transparent 12.5%, #aa44ff 12.5%, #aa44ff 87.5%, transparent 87.5%),
                linear-gradient(90deg, transparent 25%, #aa44ff 25%, #aa44ff 37.5%, transparent 37.5%, transparent 62.5%, #aa44ff 62.5%, #aa44ff 75%, transparent 75%);
            background-size: 100% 20%;
            background-position: 0 0, 0 20%, 0 40%, 0 60%, 0 80%;
            background-repeat: no-repeat;
            filter: drop-shadow(0 0 4px rgba(170, 68, 255, 0.6));
        }

        /* Macrophage cell */
        .invader-macrophage {
            background:
                linear-gradient(90deg, transparent 12.5%, #ffaa00 12.5%, #ffaa00 87.5%, transparent 87.5%),
                linear-gradient(90deg, #ffaa00 0%, #ffaa00 100%),
                linear-gradient(90deg, #ffaa00 12.5%, #ff8800 12.5%, #ff8800 87.5%, #ffaa00 87.5%),
                linear-gradient(90deg, #ffaa00 0%, #ffaa00 100%),
                linear-gradient(90deg, transparent 12.5%, #ffaa00 12.5%, #ffaa00 37.5%, transparent 37.5%, transparent 62.5%, #ffaa00 62.5%, #ffaa00 87.5%, transparent 87.5%);
            background-size: 100% 20%;
            background-position: 0 0, 0 20%, 0 40%, 0 60%, 0 80%;
            background-repeat: no-repeat;
            filter: drop-shadow(0 0 4px rgba(255, 170, 0, 0.6));
        }

        /* Projectile from player ship */
        .player-ship {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 30px;
            background:
                linear-gradient(90deg, transparent 40%, #00ffff 40%, #00ffff 60%, transparent 60%),
                linear-gradient(90deg, transparent 30%, #00ffff 30%, #00ffff 70%, transparent 70%),
                linear-gradient(90deg, transparent 20%, #00ffff 20%, #00ffff 80%, transparent 80%),
                linear-gradient(90deg, #00ffff 10%, #00dddd 10%, #00dddd 90%, #00ffff 90%),
                linear-gradient(90deg, #00ffff 0%, #00ffff 100%);
            background-size: 100% 20%;
            background-position: 0 0, 0 20%, 0 40%, 0 60%, 0 80%;
            background-repeat: no-repeat;
            filter: drop-shadow(0 0 8px rgba(0, 255, 255, 0.8));
            z-index: 5;
            animation: ship-hover 2s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes ship-hover {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-5px); }
        }

        .laser {
            position: fixed;
            width: 4px;
            height: 20px;
            background: linear-gradient(to top, transparent, #00ffff, #ffffff);
            filter: drop-shadow(0 0 4px #00ffff);
            animation: laser-fire 1s linear infinite;
            pointer-events: none;
        }

        @keyframes laser-fire {
            0% { bottom: 60px; opacity: 1; }
            100% { bottom: 100%; opacity: 0; }
        }

        /* Score explosion effect */
        .score-explosion {
            position: fixed;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 24px;
            color: #ffff00;
            text-shadow: 0 0 10px #ffff00;
            animation: score-pop 1s ease-out forwards;
            pointer-events: none;
            z-index: 100;
        }

        @keyframes score-pop {
            0% { transform: scale(0.5); opacity: 1; }
            50% { transform: scale(1.5); }
            100% { transform: translateY(-50px) scale(1); opacity: 0; }
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.7; transform: scale(1); }
            50% { opacity: 0.9; transform: scale(1.03); }
        }

        @keyframes morph {
            0%, 100% { border-radius: 45% 55% 60% 40% / 50% 45% 55% 50%; }
            25% { border-radius: 55% 45% 50% 50% / 45% 55% 45% 55%; }
            50% { border-radius: 50% 50% 45% 55% / 55% 45% 50% 50%; }
            75% { border-radius: 40% 60% 55% 45% / 50% 50% 45% 55%; }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 15px currentColor; }
            50% { box-shadow: 0 0 25px currentColor, 0 0 35px currentColor; }
        }

        /* ============ MEDICAL DRAMA MODE ANIMATIONS ============ */
        /* EKG Line Animation */
        @keyframes ekg-line {
            0% { stroke-dashoffset: 200; }
            100% { stroke-dashoffset: 0; }
        }

        .ekg-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px;
            pointer-events: none;
            z-index: 0;
            opacity: 0.15;
            overflow: hidden;
        }

        .ekg-line {
            stroke: var(--accent-primary);
            stroke-width: 2;
            fill: none;
            stroke-dasharray: 200;
            animation: ekg-line 2s linear infinite;
        }

        /* Header pulse animation */
        @keyframes header-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(6, 182, 212, 0.1); }
            50% { box-shadow: 0 0 40px rgba(6, 182, 212, 0.25), 0 0 60px rgba(139, 92, 246, 0.15); }
        }

        .header {
            animation: header-glow 4s ease-in-out infinite;
        }

        /* Title dramatic entrance */
        @keyframes title-reveal {
            0% { opacity: 0; transform: translateY(-20px); letter-spacing: 0.2em; }
            60% { opacity: 1; transform: translateY(0); }
            100% { letter-spacing: -0.02em; }
        }

        .title {
            animation: title-reveal 1.5s ease-out;
        }

        /* Question card entrance - dramatic reveal */
        @keyframes card-reveal {
            0% { opacity: 0; transform: translateY(30px) scale(0.95); }
            60% { opacity: 1; transform: translateY(-5px) scale(1.01); }
            100% { transform: translateY(0) scale(1); }
        }

        .question-card {
            animation: card-reveal 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* Diagnostic thinking pulse */
        @keyframes diagnostic-pulse {
            0%, 100% { border-color: var(--border-color); }
            50% { border-color: rgba(6, 182, 212, 0.5); }
        }

        .question-card:not(.answered) {
            animation: card-reveal 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), diagnostic-pulse 3s ease-in-out infinite 0.6s;
        }

        /* Option hover - medical scan effect */
        @keyframes option-scan {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .option {
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(6, 182, 212, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .option:hover:not(.disabled)::before {
            left: 100%;
        }

        .option:hover:not(.disabled) {
            transform: translateX(8px) scale(1.02);
            box-shadow: 0 4px 20px rgba(6, 182, 212, 0.2);
        }

        /* Correct answer - eureka moment */
        @keyframes eureka-flash {
            0% { box-shadow: 0 0 0 rgba(16, 185, 129, 0); }
            30% { box-shadow: 0 0 30px rgba(16, 185, 129, 0.6), inset 0 0 20px rgba(16, 185, 129, 0.1); }
            100% { box-shadow: 0 0 15px rgba(16, 185, 129, 0.3); }
        }

        .option.correct {
            animation: eureka-flash 0.8s ease-out forwards;
            border-color: var(--accent-success) !important;
        }

        /* Incorrect answer - flatline feel */
        @keyframes diagnostic-fail {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-4px); }
            20%, 40%, 60%, 80% { transform: translateX(4px); }
        }

        .option.incorrect {
            animation: diagnostic-fail 0.5s ease-out;
            border-color: var(--accent-danger) !important;
        }

        /* Explanation reveal - dramatic unfold */
        @keyframes explanation-unfold {
            0% { opacity: 0; max-height: 0; transform: translateY(-10px); }
            100% { opacity: 1; max-height: 1000px; transform: translateY(0); }
        }

        .explanation.show {
            animation: explanation-unfold 0.5s ease-out forwards;
        }

        /* Key point highlight pulse */
        @keyframes insight-glow {
            0%, 100% { box-shadow: -4px 0 0 var(--accent-warning); }
            50% { box-shadow: -4px 0 0 var(--accent-warning), 0 0 15px rgba(245, 158, 11, 0.3); }
        }

        .key-point {
            animation: insight-glow 2s ease-in-out infinite;
        }

        /* Stats bar heartbeat */
        @keyframes stats-heartbeat {
            0%, 40%, 100% { transform: scale(1); }
            20% { transform: scale(1.02); }
        }

        .stats-bar {
            animation: stats-heartbeat 2s ease-in-out infinite;
        }

        /* Score update pop */
        @keyframes score-pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); color: var(--accent-success); }
            100% { transform: scale(1); }
        }

        .stat-value.updated {
            animation: score-pop 0.4s ease-out;
        }

        /* Progress bar smooth fill with glow */
        .progress-fill {
            transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 0 10px var(--accent-primary);
        }

        /* Case presentation - patient file feel */
        @keyframes case-slide-in {
            0% { opacity: 0; transform: translateX(-20px); }
            100% { opacity: 1; transform: translateX(0); }
        }

        .case-presentation {
            animation: case-slide-in 0.4s ease-out 0.2s backwards;
        }

        /* Lab values stagger animation */
        .lab-item {
            opacity: 0;
            animation: case-slide-in 0.3s ease-out forwards;
        }

        .lab-item:nth-child(1) { animation-delay: 0.3s; }
        .lab-item:nth-child(2) { animation-delay: 0.4s; }
        .lab-item:nth-child(3) { animation-delay: 0.5s; }
        .lab-item:nth-child(4) { animation-delay: 0.6s; }

        /* Abnormal lab value attention */
        @keyframes abnormal-pulse {
            0%, 100% { background: rgba(239, 68, 68, 0.1); }
            50% { background: rgba(239, 68, 68, 0.2); }
        }

        .lab-item.abnormal {
            animation: case-slide-in 0.3s ease-out forwards, abnormal-pulse 2s ease-in-out infinite 0.6s;
        }

        /* Histopath panel focus effect */
        @keyframes histopath-focus {
            0% { opacity: 0; transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }

        .histopath-panel {
            animation: histopath-focus 0.5s ease-out 0.4s backwards;
        }

        .histopath-panel.schematic {
            animation-delay: 0.6s;
        }

        /* Next button dramatic appearance */
        @keyframes button-emerge {
            0% { opacity: 0; transform: translateY(20px) scale(0.8); }
            60% { transform: translateY(-5px) scale(1.05); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }

        .next-btn.show {
            animation: button-emerge 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        /* Results screen dramatic reveal */
        @keyframes results-dramatic {
            0% { opacity: 0; transform: scale(0.8); }
            50% { transform: scale(1.05); }
            100% { opacity: 1; transform: scale(1); }
        }

        .results-screen {
            animation: results-dramatic 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* Score circle fill animation */
        @keyframes score-circle-fill {
            0% {
                background: conic-gradient(var(--accent-primary) 0%, transparent 0%);
            }
            100% {
                background: conic-gradient(var(--accent-primary) var(--score-percent), rgba(255,255,255,0.1) var(--score-percent));
            }
        }

        .score-circle {
            animation: score-circle-fill 1.5s ease-out forwards;
        }

        /* Grade text reveal */
        @keyframes grade-reveal {
            0% { opacity: 0; letter-spacing: 0.3em; }
            100% { opacity: 1; letter-spacing: 0.1em; }
        }

        .grade {
            animation: grade-reveal 0.8s ease-out 0.5s backwards;
        }

        /* Music control container */
        .music-controls {
            position: fixed;
            bottom: 15px;
            left: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 10000;
        }

        /* Music control button */
        .music-control {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
            border: 2px solid var(--border-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.3s ease;
            opacity: 0.7;
        }

        .music-control:hover {
            opacity: 1;
            transform: scale(1.1);
            border-color: var(--accent-primary);
            box-shadow: 0 0 15px var(--glow-cyan);
        }

        .music-control.playing {
            opacity: 1;
            border-color: var(--accent-primary);
            animation: music-pulse 1s ease-in-out infinite;
        }

        @keyframes music-pulse {
            0%, 100% { box-shadow: 0 0 5px var(--glow-cyan); }
            50% { box-shadow: 0 0 20px var(--glow-cyan), 0 0 30px var(--glow-purple); }
        }

        /* Volume slider container */
        .volume-slider-container {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--bg-card);
            padding: 8px 12px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            opacity: 0;
            transform: translateX(-10px);
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .music-controls:hover .volume-slider-container,
        .music-controls.show-volume .volume-slider-container {
            opacity: 1;
            transform: translateX(0);
            pointer-events: auto;
        }

        .volume-icon {
            font-size: 14px;
            color: var(--text-secondary);
            min-width: 20px;
            text-align: center;
        }

        /* Custom range slider */
        .volume-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 80px;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(to right, var(--accent-primary) 0%, var(--accent-primary) var(--volume-percent, 70%), var(--bg-secondary) var(--volume-percent, 70%), var(--bg-secondary) 100%);
            outline: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .volume-slider:hover {
            height: 8px;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent-primary);
            cursor: pointer;
            box-shadow: 0 0 8px var(--glow-cyan);
            transition: all 0.2s ease;
        }

        .volume-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 12px var(--glow-cyan);
        }

        .volume-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent-primary);
            cursor: pointer;
            border: none;
            box-shadow: 0 0 8px var(--glow-cyan);
        }

        .volume-slider::-moz-range-track {
            height: 6px;
            border-radius: 3px;
            background: var(--bg-secondary);
        }

        .volume-value {
            font-size: 11px;
            color: var(--text-muted);
            min-width: 28px;
            text-align: right;
            font-family: monospace;
        }

        /* Screen overlay for dramatic moments */
        .dramatic-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9997;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .dramatic-overlay.correct {
            background: radial-gradient(circle at center, rgba(16, 185, 129, 0.15) 0%, transparent 70%);
            opacity: 1;
            animation: overlay-fade 1s ease-out forwards;
        }

        .dramatic-overlay.incorrect {
            background: radial-gradient(circle at center, rgba(239, 68, 68, 0.15) 0%, transparent 70%);
            opacity: 1;
            animation: overlay-fade 1s ease-out forwards;
        }

        .dramatic-overlay.revelation {
            background: radial-gradient(circle at center, rgba(6, 182, 212, 0.2) 0%, transparent 70%);
            opacity: 1;
            animation: overlay-fade 0.8s ease-out forwards;
        }

        @keyframes overlay-fade {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* Main Container */
        .game-container {
            position: relative;
            z-index: 1;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 30px 20px;
            background: var(--bg-card);
            border-radius: 16px;
            backdrop-filter: blur(20px);
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .title {
            font-size: 2.8em;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
            letter-spacing: -0.02em;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1em;
            font-weight: 400;
        }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: var(--bg-card);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .stat-label {
            font-size: 0.8em;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .streak-fire { color: var(--accent-warning) !important; }

        /* Question Card */
        .question-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(20px);
        }

        .question-type {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 12px;
        }

        .type-case { background: rgba(239, 68, 68, 0.2); color: #fca5a5; border: 1px solid rgba(239, 68, 68, 0.3); }
        .type-simple { background: rgba(6, 182, 212, 0.2); color: #67e8f9; border: 1px solid rgba(6, 182, 212, 0.3); }
        .type-staging { background: rgba(139, 92, 246, 0.2); color: #c4b5fd; border: 1px solid rgba(139, 92, 246, 0.3); }
        .type-treatment { background: rgba(245, 158, 11, 0.2); color: #fcd34d; border: 1px solid rgba(245, 158, 11, 0.3); }

        /* Difficulty Badge */
        .difficulty-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.7em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-left: 8px;
            margin-bottom: 12px;
        }
        .difficulty-badge.intern { background: rgba(16, 185, 129, 0.2); color: #34d399; border: 1px solid rgba(16, 185, 129, 0.3); }
        .difficulty-badge.resident { background: rgba(6, 182, 212, 0.2); color: #22d3ee; border: 1px solid rgba(6, 182, 212, 0.3); }
        .difficulty-badge.fellow { background: rgba(245, 158, 11, 0.2); color: #fbbf24; border: 1px solid rgba(245, 158, 11, 0.3); }
        .difficulty-badge.attending { background: rgba(239, 68, 68, 0.2); color: #f87171; border: 1px solid rgba(239, 68, 68, 0.3); }

        .question-number {
            color: var(--text-muted);
            font-size: 0.85em;
            margin-bottom: 8px;
        }

        .question-text {
            font-size: 1.15em;
            line-height: 1.7;
            margin-bottom: 20px;
            color: var(--text-primary);
        }

        /* Case Presentation */
        .case-presentation {
            background: rgba(139, 92, 246, 0.08);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 3px solid var(--accent-secondary);
        }

        .case-presentation h4 {
            color: var(--accent-secondary);
            margin-bottom: 10px;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .case-presentation p {
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .lab-values {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 8px;
            margin-top: 15px;
        }

        .lab-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        .lab-item.abnormal {
            border-left: 3px solid var(--accent-danger);
            color: #fca5a5;
        }

        .lab-item strong {
            color: var(--text-primary);
        }

        /* Histopath Image Container */
        .histopath-container {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 12px;
            margin: 15px 0;
            border: 1px solid var(--border-color);
        }

        .histopath-container img {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 6px;
        }

        .histopath-caption {
            font-size: 0.75em;
            color: var(--text-muted);
            margin-top: 8px;
            font-style: italic;
        }

        /* Dual Histopath Display */
        .histopath-dual {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 15px 0;
        }

        .histopath-panel {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 10px;
            border: 1px solid var(--border-color);
        }

        .histopath-panel-label {
            font-size: 0.7em;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .histopath-panel-label::before {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .histopath-panel.he .histopath-panel-label::before {
            background: #ec4899;
        }

        .histopath-panel.schematic .histopath-panel-label::before {
            background: var(--accent-primary);
        }

        .histopath-svg {
            width: 100%;
            height: 130px;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .histopath-svg.he-stain {
            background: linear-gradient(135deg, rgba(255, 245, 250, 0.98) 0%, rgba(250, 235, 245, 0.98) 100%);
        }

        .histopath-svg.schematic {
            background: linear-gradient(135deg, rgba(245, 235, 220, 0.95) 0%, rgba(235, 220, 200, 0.95) 100%);
        }

        .histopath-svg svg {
            width: 100%;
            height: 100%;
        }

        .histopath-caption {
            font-size: 0.75em;
            color: var(--text-muted);
            margin-top: 8px;
            font-style: italic;
            text-align: center;
        }

        /* Difficulty Selector */
        .difficulty-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .difficulty-btn {
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
            background: rgba(255, 255, 255, 0.05);
            text-align: center;
            min-width: 100px;
        }

        .difficulty-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .difficulty-btn.selected {
            border-color: currentColor;
        }

        .difficulty-btn.intern {
            color: #10b981;
        }

        .difficulty-btn.intern.selected {
            background: rgba(16, 185, 129, 0.15);
        }

        .difficulty-btn.resident {
            color: #06b6d4;
        }

        .difficulty-btn.resident.selected {
            background: rgba(6, 182, 212, 0.15);
        }

        .difficulty-btn.fellow {
            color: #f59e0b;
        }

        .difficulty-btn.fellow.selected {
            background: rgba(245, 158, 11, 0.15);
        }

        .difficulty-btn.attending {
            color: #ef4444;
        }

        .difficulty-btn.attending.selected {
            background: rgba(239, 68, 68, 0.15);
        }

        .difficulty-btn span {
            display: block;
            font-size: 0.75em;
            opacity: 0.7;
            margin-top: 2px;
        }

        .difficulty-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.65em;
            font-weight: 600;
            text-transform: uppercase;
            margin-left: 8px;
        }

        .difficulty-badge.intern { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .difficulty-badge.resident { background: rgba(6, 182, 212, 0.2); color: #06b6d4; }
        .difficulty-badge.fellow { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .difficulty-badge.attending { background: rgba(239, 68, 68, 0.2); color: #ef4444; }

        @media (max-width: 500px) {
            .histopath-dual {
                grid-template-columns: 1fr;
            }
        }

        /* Answer Options */
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option {
            background: rgba(255, 255, 255, 0.03);
            padding: 16px 18px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            align-items: flex-start;
        }

        .option:hover {
            background: rgba(6, 182, 212, 0.1);
            border-color: rgba(6, 182, 212, 0.3);
            transform: translateX(4px);
        }

        .option-letter {
            width: 28px;
            height: 28px;
            min-width: 28px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 14px;
            font-weight: 600;
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        .option-text {
            flex: 1;
            line-height: 1.5;
        }

        .option.correct {
            background: rgba(16, 185, 129, 0.15);
            border-color: rgba(16, 185, 129, 0.4);
        }

        .option.correct .option-letter {
            background: var(--accent-success);
            color: white;
        }

        .option.incorrect {
            background: rgba(239, 68, 68, 0.15);
            border-color: rgba(239, 68, 68, 0.4);
        }

        .option.incorrect .option-letter {
            background: var(--accent-danger);
            color: white;
        }

        .option.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        /* Explanation */
        .explanation {
            background: rgba(6, 182, 212, 0.08);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 3px solid var(--accent-primary);
            display: none;
        }

        .explanation.show {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        .explanation h4 {
            color: var(--accent-primary);
            margin-bottom: 10px;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .explanation p {
            line-height: 1.7;
            color: var(--text-secondary);
        }

        .key-point {
            background: rgba(245, 158, 11, 0.1);
            padding: 12px 16px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 3px solid var(--accent-warning);
        }

        .key-point strong {
            color: var(--accent-warning);
            font-size: 0.85em;
            text-transform: uppercase;
        }

        .key-point p {
            margin-top: 6px;
            color: var(--text-secondary);
        }

        .citation {
            background: rgba(139, 92, 246, 0.1);
            padding: 10px 14px;
            border-radius: 6px;
            margin-top: 12px;
            font-size: 0.8em;
            color: var(--text-muted);
        }

        .citation a {
            color: var(--accent-secondary);
            text-decoration: none;
        }

        .citation a:hover {
            text-decoration: underline;
        }

        /* Reference Links */
        .ref-links {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .ref-link {
            display: inline-flex;
            align-items: center;
            padding: 5px 10px;
            background: rgba(139, 92, 246, 0.15);
            border-radius: 4px;
            color: #4fc3f7;
            text-decoration: none;
            font-size: 0.9em;
            transition: all 0.2s;
            border: 1px solid rgba(79, 195, 247, 0.3);
        }

        .ref-link:hover {
            background: rgba(79, 195, 247, 0.3);
            transform: scale(1.05);
            border-color: #4fc3f7;
        }

        /* Next Button */
        .next-btn {
            background: linear-gradient(135deg, var(--accent-primary) 0%, #0891b2 100%);
            color: white;
            border: none;
            padding: 14px 36px;
            font-size: 1em;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.2s ease;
            display: none;
        }

        .next-btn.show {
            display: inline-block;
        }

        .next-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px var(--glow-cyan);
        }

        /* Start Screen */
        .start-screen {
            text-align: center;
            padding: 40px 30px;
        }

        .start-screen h2 {
            font-size: 1.8em;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        .start-screen > p {
            color: var(--text-secondary);
            margin-bottom: 30px;
            max-width: 550px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
        }

        .mode-selector {
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .mode-btn {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border-color);
            padding: 20px 24px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 180px;
            text-align: left;
        }

        .mode-btn:hover, .mode-btn.selected {
            border-color: var(--accent-primary);
            background: rgba(6, 182, 212, 0.1);
        }

        .mode-btn h3 {
            color: var(--accent-primary);
            margin-bottom: 6px;
            font-size: 1em;
        }

        .mode-btn p {
            font-size: 0.85em;
            color: var(--text-muted);
            margin: 0;
        }

        .start-btn {
            background: linear-gradient(135deg, var(--accent-secondary) 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 16px 48px;
            font-size: 1.1em;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px var(--glow-purple);
        }

        /* Cell Legend */
        .cell-legend {
            display: flex;
            justify-content: center;
            gap: 24px;
            flex-wrap: wrap;
            margin-top: 30px;
            padding: 16px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.85em;
            color: var(--text-muted);
        }

        .legend-cell {
            width: 24px;
            height: 24px;
            border-radius: 50%;
        }

        .legend-bcell {
            background: radial-gradient(circle at 35% 35%, rgba(6, 182, 212, 0.3), rgba(6, 182, 212, 0.8));
            border: 2px solid rgba(6, 182, 212, 0.6);
        }

        .legend-lymphoma {
            background: radial-gradient(circle at 35% 35%, rgba(239, 68, 68, 0.3), rgba(185, 28, 28, 0.8));
            border: 2px solid rgba(239, 68, 68, 0.6);
        }

        .legend-antibody {
            width: 20px;
            height: 24px;
            background: transparent;
            position: relative;
        }

        .legend-antibody::before {
            content: 'Y';
            font-size: 1.4em;
            font-weight: bold;
            color: var(--accent-warning);
            text-shadow: 0 0 8px rgba(245, 158, 11, 0.6);
        }

        /* Results Screen */
        .results-screen {
            text-align: center;
            padding: 50px 30px;
            display: none;
        }

        .results-screen h2 {
            font-size: 2.2em;
            margin-bottom: 20px;
        }

        .score-circle {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: conic-gradient(var(--accent-primary) var(--score-percent), rgba(255,255,255,0.1) 0);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 30px auto;
            position: relative;
        }

        .score-circle::before {
            content: '';
            width: 140px;
            height: 140px;
            background: var(--bg-primary);
            border-radius: 50%;
            position: absolute;
        }

        .score-text {
            position: relative;
            z-index: 1;
            font-size: 2.5em;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .grade {
            font-size: 1.4em;
            margin-bottom: 16px;
            font-weight: 600;
        }

        .grade-pass { color: var(--accent-success); }
        .grade-fail { color: var(--accent-danger); }

        .play-again-btn {
            background: linear-gradient(135deg, var(--accent-primary) 0%, #0891b2 100%);
            color: white;
            border: none;
            padding: 14px 36px;
            font-size: 1em;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.2s ease;
        }

        .play-again-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px var(--glow-cyan);
        }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            transition: width 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive - Tablet */
        @media (max-width: 1024px) and (min-width: 601px) {
            .game-container { padding: 15px; }
            .title { font-size: 2.5em; }
        }

        /* Responsive - Mobile */
        @media (max-width: 600px) {
            .title { font-size: 2em; }
            .question-text { font-size: 1em; }
            .stats-bar { flex-wrap: wrap; gap: 12px; }
            .mode-selector { flex-direction: column; align-items: center; }
            .mode-btn { width: 100%; max-width: 280px; }
        }

        /* Responsive - Small Mobile */
        @media (max-width: 400px) {
            .title { font-size: 1.6em; }
            .question-text { font-size: 0.9em; }
        }

        /* Device info badge */
        .device-info {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #00ff00;
            border-radius: 5px;
            padding: 6px 10px;
            font-size: 0.7em;
            color: white;
            z-index: 100;
            opacity: 0.6;
            transition: opacity 0.3s;
        }
        .device-info:hover { opacity: 1; }
        .device-info .device-type { color: #00ff00; text-transform: uppercase; }
        .device-info .resolution { color: #88ff88; margin-left: 8px; }
    </style>
</head>
<body>
    <div class="device-info" id="deviceInfo">
        <span class="device-type" id="deviceType">--</span>
        <span class="resolution" id="resolution">--</span>
    </div>

    <!-- Street Fighter Easter Egg Elements -->
    <div class="sf-switch" onclick="toggleSFMode()" title="???"></div>
    <div class="sf-announcement" id="sfAnnouncement"></div>
    <div class="combo-counter" id="comboCounter"></div>
    <div class="sf-screen-flash" id="sfScreenFlash"></div>
    <div class="sf-vs-screen" id="sfVsScreen">
        <div class="sf-fighters">
            <div class="sf-fighter left"></div>
            <div class="sf-fighter right"></div>
        </div>
        <div class="sf-vs-text">VS</div>
    </div>
    <div class="sf-power-meter">
        <div class="sf-power-fill" id="sfPowerFill"></div>
        <div class="sf-power-label">SUPER</div>
    </div>

    <!-- Medical Drama Mode Elements -->
    <div class="music-controls" id="musicControls">
        <div class="music-control" onclick="toggleMusic()" title="Toggle Music"></div>
        <div class="volume-slider-container">
            <span class="volume-icon" id="volumeIcon"></span>
            <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="70" oninput="setVolume(this.value)">
            <span class="volume-value" id="volumeValue">70%</span>
        </div>
    </div>
    <div class="dramatic-overlay" id="dramaticOverlay"></div>
    <div class="ekg-container" id="ekgContainer">
        <svg width="100%" height="60" preserveAspectRatio="none">
            <path class="ekg-line" id="ekgLine1" d="M0,30 L50,30 L60,30 L65,10 L70,50 L75,20 L80,40 L85,30 L100,30 L150,30 L160,30 L165,10 L170,50 L175,20 L180,40 L185,30 L200,30 L250,30 L260,30 L265,10 L270,50 L275,20 L280,40 L285,30 L300,30 L350,30 L360,30 L365,10 L370,50 L375,20 L380,40 L385,30 L400,30" />
            <path class="ekg-line" id="ekgLine2" d="M400,30 L450,30 L460,30 L465,10 L470,50 L475,20 L480,40 L485,30 L500,30 L550,30 L560,30 L565,10 L570,50 L575,20 L580,40 L585,30 L600,30 L650,30 L660,30 L665,10 L670,50 L675,20 L680,40 L685,30 L700,30 L750,30 L760,30 L765,10 L770,50 L775,20 L780,40 L785,30 L800,30" style="animation-delay: -1s;" />
        </svg>
    </div>

    <!-- Animated Cell Background -->
    <div class="cell-container" id="cellContainer"></div>

    <!-- Space Invaders Animation -->
    <div class="space-invaders-container" id="spaceInvadersContainer"></div>
    <div class="player-ship" id="playerShip"></div>

    <div class="game-container">
        <div class="header">
            <h1 class="title">LymphoInvader</h1>
            <p class="subtitle">Attending Level Lymphoma Challenge | NCCN Guidelines 2025-2026</p>
        </div>

        <!-- Start Screen -->
        <div class="question-card start-screen" id="startScreen">
            <h2>Test Your Lymphoma Expertise</h2>
            <p>Board-style questions with direct citations from NCCN Guidelines, NEJM, and landmark trials. Select your difficulty level and question type.</p>

            <h4 style="color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9em;">DIFFICULTY LEVEL</h4>
            <div class="difficulty-selector">
                <div class="difficulty-btn intern" data-difficulty="intern" onclick="selectDifficulty(this)">
                    <strong>Intern</strong>
                    <span>Basic concepts</span>
                </div>
                <div class="difficulty-btn resident selected" data-difficulty="resident" onclick="selectDifficulty(this)">
                    <strong>Resident</strong>
                    <span>Core knowledge</span>
                </div>
                <div class="difficulty-btn fellow" data-difficulty="fellow" onclick="selectDifficulty(this)">
                    <strong>Fellow</strong>
                    <span>Advanced topics</span>
                </div>
                <div class="difficulty-btn attending" data-difficulty="attending" onclick="selectDifficulty(this)">
                    <strong>Attending</strong>
                    <span>Expert level</span>
                </div>
            </div>

            <h4 style="color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9em;">QUESTION TYPE</h4>
            <div class="mode-selector">
                <div class="mode-btn selected" data-mode="mixed" onclick="selectMode(this)">
                    <h3>Mixed Challenge</h3>
                    <p>Cases + Quick Fire</p>
                </div>
                <div class="mode-btn" data-mode="cases" onclick="selectMode(this)">
                    <h3>Case Studies</h3>
                    <p>Clinical Scenarios</p>
                </div>
                <div class="mode-btn" data-mode="quick" onclick="selectMode(this)">
                    <h3>Quick Fire</h3>
                    <p>Rapid Knowledge Test</p>
                </div>
            </div>

            <button class="start-btn" onclick="startGame()">Begin Challenge</button>

            <div class="cell-legend">
                <div class="legend-item">
                    <div class="legend-cell legend-bcell"></div>
                    <span>B-Cell</span>
                </div>
                <div class="legend-item">
                    <div class="legend-cell legend-lymphoma"></div>
                    <span>Lymphoma</span>
                </div>
                <div class="legend-item">
                    <div class="legend-cell" style="background: radial-gradient(circle at 35% 35%, rgba(16, 185, 129, 0.3), rgba(5, 150, 105, 0.8)); border: 2px solid rgba(16, 185, 129, 0.6);"></div>
                    <span>T-Cell</span>
                </div>
                <div class="legend-item">
                    <div class="legend-cell" style="background: radial-gradient(circle at 35% 35%, rgba(217, 119, 6, 0.3), rgba(146, 64, 14, 0.7)); border: 2px solid rgba(217, 119, 6, 0.6); border-radius: 45% 55% 60% 40%;"></div>
                    <span>Macrophage</span>
                </div>
                <div class="legend-item">
                    <div class="legend-antibody"></div>
                    <span>Anti-CD20</span>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" style="display: none;">
            <div class="stats-bar">
                <div class="stat">
                    <div class="stat-value" id="scoreValue">0</div>
                    <div class="stat-label">Score</div>
                </div>
                <div class="stat">
                    <div class="stat-value streak-fire" id="streakValue">0</div>
                    <div class="stat-label">Streak</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="correctValue">0/0</div>
                    <div class="stat-label">Correct</div>
                </div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>

            <div class="question-card" id="questionCard">
                <!-- Question content loads here -->
            </div>
        </div>

        <!-- Results Screen -->
        <div class="question-card results-screen" id="resultsScreen">
            <h2>Challenge Complete!</h2>
            <div class="score-circle" id="scoreCircle">
                <span class="score-text" id="finalScore">0%</span>
            </div>
            <div class="grade" id="gradeText"></div>
            <p id="resultsMessage"></p>
            <button class="play-again-btn" onclick="restartGame()">Play Again</button>
        </div>
    </div>

    <script>
        // Device Detection System
        const DeviceDetector = {
            getDeviceType: function() {
                const width = window.innerWidth;
                const userAgent = navigator.userAgent.toLowerCase();
                const isMobileUA = /android|webos|iphone|ipod|blackberry|iemobile|opera mini/i.test(userAgent);
                const isTabletUA = /ipad|tablet|playbook|silk/i.test(userAgent) || (isMobileUA && width >= 768);
                if (width <= 480 || (isMobileUA && !isTabletUA && width < 768)) return 'mobile';
                else if (width <= 1024 || isTabletUA) return 'tablet';
                else return 'desktop';
            },
            getResolution: function() { return `${window.innerWidth}x${window.innerHeight}`; },
            updateDisplay: function() {
                document.getElementById('deviceType').textContent = this.getDeviceType();
                document.getElementById('resolution').textContent = this.getResolution();
                document.body.classList.remove('device-mobile', 'device-tablet', 'device-desktop');
                document.body.classList.add('device-' + this.getDeviceType());
            },
            init: function() {
                this.updateDisplay();
                window.addEventListener('resize', () => this.updateDisplay());
                window.addEventListener('orientationchange', () => setTimeout(() => this.updateDisplay(), 100));
            }
        };
        DeviceDetector.init();

        // Reference Links Helper
        function renderReferenceLinks(question) {
            let links = '';
            if (question.pmid) {
                links += `<a href="https://pubmed.ncbi.nlm.nih.gov/${question.pmid}/" target="_blank" rel="noopener" class="ref-link" title="View on PubMed"> PubMed</a>`;
            }
            if (question.doi) {
                links += `<a href="https://doi.org/${question.doi}" target="_blank" rel="noopener" class="ref-link" title="View Full Text"> DOI</a>`;
            }
            if (question.guideline) {
                links += `<a href="${question.guideline.url}" target="_blank" rel="noopener" class="ref-link" title="View Guidelines"> ${question.guideline.name}</a>`;
            }
            return links ? `<div class="ref-links">${links}</div>` : '';
        }

        // Question Bank with Citations
        const questions = [
            // ============ CASE-BASED QUESTIONS ============
            {
                type: "case",
                typeLabel: "Clinical Case",
                difficulty: "fellow",
                case: {
                    presentation: "A 58-year-old man presents with 3-month history of painless cervical lymphadenopathy, night sweats, and 15-pound weight loss. CT shows diffuse lymphadenopathy above and below the diaphragm. Excisional biopsy shows large atypical lymphocytes with prominent nucleoli. IHC: CD20+, CD10+, BCL6+, CD5-, Ki-67 80%.",
                    labs: [
                        { name: "LDH", value: "450 U/L", abnormal: true },
                        { name: "Hgb", value: "11.2 g/dL", abnormal: true },
                        { name: "WBC", value: "8,500/L", abnormal: false },
                        { name: "IPI Score", value: "3 (High-Int)", abnormal: true }
                    ],
                    histopath: {
                        type: "dlbcl",
                        description: "Diffuse sheets of large lymphoid cells with vesicular chromatin and prominent nucleoli",
                        source: "Pathology Outlines"
                    }
                },
                question: "Per NCCN Guidelines (2025), what is the PREFERRED first-line treatment for this patient?",
                options: [
                    "R-CHOP x 6 cycles",
                    "Pola-R-CHP x 6 cycles",
                    "DA-EPOCH-R",
                    "Bendamustine-Rituximab"
                ],
                correct: 1,
                explanation: "This patient has DLBCL with IPI score 2. Per NCCN Guidelines Version 3.2025, Pola-R-CHP (polatuzumab vedotin + rituximab, cyclophosphamide, doxorubicin, prednisone) is Category 1 PREFERRED for previously untreated DLBCL with IPI 2. The POLARIX trial demonstrated 2-year PFS of 76.7% vs 70.2% for R-CHOP (HR 0.73, p<0.02).",
                keyPoint: "Pola-R-CHP is now PREFERRED over R-CHOP for DLBCL with IPI 2. Note vincristine is omitted (R-CHP not R-CHOP) due to overlapping neurotoxicity with polatuzumab.",
                citation: "Tilly H, et al. N Engl J Med. 2022;386:351-363.",
                pmid: "34904799",
                doi: "10.1056/NEJMoa2115304"
            },
            {
                type: "case",
                typeLabel: "Clinical Case",
                difficulty: "resident",
                case: {
                    presentation: "A 32-year-old woman presents with mediastinal mass on CXR during pre-employment physical. Denies B symptoms. CT: 6 cm anterior mediastinal mass with bilateral hilar adenopathy (Stage IIA). Biopsy: Reed-Sternberg cells, CD15+, CD30+, CD20-.",
                    labs: [
                        { name: "ESR", value: "28 mm/hr", abnormal: false },
                        { name: "Hgb", value: "13.5 g/dL", abnormal: false },
                        { name: "Albumin", value: "4.2 g/dL", abnormal: false }
                    ],
                    histopath: {
                        type: "hodgkin",
                        description: "Classic Reed-Sternberg cells with 'owl-eye' bilobed nuclei in mixed inflammatory background",
                        source: "StatPearls - NCBI"
                    }
                },
                question: "This is early-stage favorable classic Hodgkin lymphoma. What is the recommended treatment approach per current guidelines?",
                options: [
                    "6 cycles of ABVD + ISRT",
                    "2 cycles ABVD  interim PET  response-adapted therapy",
                    "R-CHOP x 6 cycles",
                    "Observation with close monitoring"
                ],
                correct: 1,
                explanation: "For early-stage favorable cHL (Stage I-II, no B symptoms, ESR <50, non-bulky, <3 nodal sites), current guidelines recommend response-adapted therapy: 2 cycles ABVD followed by interim PET/CT. Deauville 1-3 allows de-escalation; Deauville 4-5 requires intensification. This reduces long-term toxicity while maintaining outcomes.",
                keyPoint: "Deauville scoring guides response-adapted therapy: 1-2 = CMR, 3 = equivocal (often negative), 4-5 = positive disease requiring treatment modification.",
                citation: "NCCN Guidelines Hodgkin Lymphoma Version 1.2026; Radford J, et al. N Engl J Med. 2015;372:1598-607",
                pmid: "25901426",
                doi: "10.1056/NEJMoa1408648",
                guideline: { name: "NCCN HL", url: "https://www.nccn.org/guidelines/guidelines-detail?category=1&id=1439" }
            },
            {
                type: "case",
                typeLabel: "Clinical Case",
                difficulty: "attending",
                case: {
                    presentation: "A 35-year-old man with Stage IIIB classic Hodgkin lymphoma (bulky mediastinal disease, night sweats, weight loss). ECOG PS 0. No significant comorbidities.",
                    labs: [
                        { name: "Albumin", value: "3.2 g/dL", abnormal: true },
                        { name: "Hgb", value: "10.8 g/dL", abnormal: true },
                        { name: "WBC", value: "12,500/L", abnormal: true },
                        { name: "Lymphocytes", value: "600/L", abnormal: true }
                    ]
                },
                question: "Per NCCN Guidelines (2025-2026), what is the PREFERRED first-line regimen for advanced-stage classic Hodgkin lymphoma?",
                options: [
                    "ABVD x 6 cycles",
                    "Nivolumab-AVD or BrECADD",
                    "Stanford V",
                    "BEACOPP escalated"
                ],
                correct: 1,
                explanation: "Per NCCN Guidelines Version 1.2026, PREFERRED regimens for Stage III-IV cHL are Nivolumab-AVD (Category 1) or BrECADD + G-CSF. The SWOG S1826 trial showed Nivolumab-AVD achieved 2-year PFS of 92% vs 83% for BV-AVD (HR 0.45). ABVD remains an option but is no longer preferred.",
                keyPoint: "NCCN 2025-2026: Nivolumab-AVD and BrECADD are now PREFERRED over ABVD for advanced-stage Hodgkin lymphoma, representing a major paradigm shift.",
                citation: "Herrera AF, et al. N Engl J Med. 2024;391:1379-1389.",
                pmid: "39413375",
                doi: "10.1056/NEJMoa2405888"
            },
            {
                type: "case",
                typeLabel: "Clinical Case",
                difficulty: "resident",
                case: {
                    presentation: "A 67-year-old man with asymptomatic generalized lymphadenopathy found incidentally. Biopsy: follicular architecture with centrocytes and centroblasts. IHC: CD20+, CD10+, BCL2+, BCL6+, CD5-. FISH: t(14;18)+. Stage IV with bone marrow involvement. No B symptoms.",
                    labs: [
                        { name: "LDH", value: "180 U/L", abnormal: false },
                        { name: "Hgb", value: "14.1 g/dL", abnormal: false },
                        { name: "2M", value: "2.8 mg/L", abnormal: false }
                    ],
                    histopath: {
                        type: "follicular",
                        description: "Back-to-back follicles with attenuated mantle zones, monomorphic appearance without tingible body macrophages",
                        source: "Pathology Outlines"
                    }
                },
                question: "What is the most appropriate management for this asymptomatic patient with no GELF criteria?",
                options: [
                    "R-CHOP x 6 cycles",
                    "Watch and wait with regular monitoring",
                    "Involved-site radiation therapy",
                    "Autologous stem cell transplant"
                ],
                correct: 1,
                explanation: "This patient has asymptomatic advanced-stage follicular lymphoma Grade 1-2 without GELF criteria (no mass >7cm, <3 nodes >3cm, no B symptoms, no cytopenias, no compression). Watch and wait is appropriate as multiple trials show no survival benefit to early treatment. Median time to requiring therapy is ~4-5 years.",
                keyPoint: "GELF criteria for FL treatment: mass >7cm, 3 nodes >3cm, B symptoms, splenomegaly, compression, effusions, cytopenias, leukemic phase. Absence of all = watch and wait.",
                citation: "Solal-Cligny P, et al. Blood. 2004;104:1258-1265; NCCN B-Cell Lymphomas Version 3.2025",
                pmid: "15126323",
                doi: "10.1182/blood-2003-12-4434",
                guideline: { name: "NCCN NHL", url: "https://www.nccn.org/guidelines/guidelines-detail?category=1&id=1494" }
            },
            {
                type: "case",
                typeLabel: "Clinical Case",
                difficulty: "fellow",
                case: {
                    presentation: "A 71-year-old man with relapsed MCL after R-CHOP and auto-SCT (2-year remission). Now progressive lymphadenopathy. History of atrial fibrillation on apixaban, moderate CKD.",
                    labs: [
                        { name: "Creatinine", value: "1.8 mg/dL", abnormal: true },
                        { name: "eGFR", value: "38 mL/min", abnormal: true },
                        { name: "LDH", value: "320 U/L", abnormal: true }
                    ]
                },
                question: "Which BTK inhibitor is most appropriate given his atrial fibrillation and anticoagulation?",
                options: [
                    "Ibrutinib 560 mg daily",
                    "Acalabrutinib 100 mg BID or Zanubrutinib 160 mg BID",
                    "Venetoclax monotherapy",
                    "Lenalidomide-rituximab"
                ],
                correct: 1,
                explanation: "Acalabrutinib or zanubrutinib (2nd-generation BTK inhibitors) are preferred over ibrutinib in patients with AFib/anticoagulation. Ibrutinib has significant off-target effects: AFib (5-10%), bleeding (up to 50%) due to inhibition of non-BTK kinases. Second-generation agents have more selective BTK inhibition with better cardiac safety profiles.",
                keyPoint: "BTK inhibitor selection: Ibrutinib has off-target effects (AFib, bleeding). Acalabrutinib/zanubrutinib are more selective with fewer cardiac/bleeding complications - preferred in patients with cardiac history or anticoagulation.",
                citation: "Wang M, et al. N Engl J Med. 2013;369:507-516; Brown JR, et al. Lancet. 2024;403:1163-1175",
                pmid: "23782157",
                doi: "10.1056/NEJMoa1306220"
            },
            {
                type: "case",
                typeLabel: "Clinical Case",
                difficulty: "resident",
                case: {
                    presentation: "A 28-year-old man with rapidly enlarging neck mass over 2 weeks, jaw pain, difficulty swallowing. CT: 10 cm mass involving mandible with lytic lesions. Biopsy: sheets of medium-sized cells with basophilic cytoplasm, lipid vacuoles, starry-sky pattern. Ki-67 >95%. IHC: CD20+, CD10+, BCL6+, BCL2-. FISH: MYC+ (no BCL2/BCL6).",
                    labs: [
                        { name: "LDH", value: "1,850 U/L", abnormal: true },
                        { name: "Uric acid", value: "12.5 mg/dL", abnormal: true },
                        { name: "Creatinine", value: "1.4 mg/dL", abnormal: true },
                        { name: "Phosphorus", value: "5.8 mg/dL", abnormal: true }
                    ],
                    histopath: {
                        type: "burkitt",
                        description: "Starry-sky pattern with tingible body macrophages, monotonous medium-sized cells with basophilic cytoplasm",
                        source: "WHO Classification"
                    }
                },
                question: "What is the diagnosis and critical initial management step?",
                options: [
                    "DLBCL; start R-CHOP immediately",
                    "Burkitt lymphoma; aggressive TLS prophylaxis before chemotherapy",
                    "Mantle cell lymphoma; start ibrutinib",
                    "Double-hit lymphoma; start DA-EPOCH-R"
                ],
                correct: 1,
                explanation: "This is Burkitt lymphoma: Ki-67 >95%, MYC rearrangement (without BCL2/BCL6 = not double-hit), CD10+/BCL6+/BCL2-, starry-sky pattern, extremely rapid doubling time. Elevated LDH, uric acid, creatinine, phosphorus indicate high tumor burden with impending/established TLS. Rasburicase, aggressive hydration, and allopurinol MUST be initiated before chemotherapy.",
                keyPoint: "Burkitt lymphoma = highest TLS risk. MUST initiate TLS prophylaxis (rasburicase > allopurinol, hydration, monitoring) BEFORE chemotherapy. Do not delay prophylaxis.",
                citation: "Cairo MS, Bishop M. Br J Haematol. 2004;127:3-11; NCCN B-Cell Lymphomas Version 3.2025",
                pmid: "15384972",
                doi: "10.1111/j.1365-2141.2004.05094.x",
                guideline: { name: "NCCN NHL", url: "https://www.nccn.org/guidelines/guidelines-detail?category=1&id=1494" }
            },
            {
                type: "case",
                typeLabel: "Clinical Case",
                difficulty: "attending",
                case: {
                    presentation: "A 68-year-old man with newly diagnosed MCL, Stage IV with bone marrow involvement. ECOG PS 1, no cardiac history. Not a candidate for auto-SCT due to age and preference.",
                    labs: [
                        { name: "WBC", value: "45,000/L", abnormal: true },
                        { name: "LDH", value: "380 U/L", abnormal: true },
                        { name: "Hgb", value: "10.8 g/dL", abnormal: true }
                    ]
                },
                question: "Per FDA January 2025 approval, which frontline regimen is now approved for transplant-ineligible MCL?",
                options: [
                    "Ibrutinib monotherapy",
                    "Acalabrutinib + Bendamustine-Rituximab",
                    "Venetoclax-Rituximab",
                    "R-CHOP alternating with R-DHAP"
                ],
                correct: 1,
                explanation: "In January 2025, FDA approved acalabrutinib + bendamustine-rituximab for previously untreated MCL in transplant-ineligible patients. The Phase 3 ECHO trial showed median PFS 66.4 vs 49.6 months (HR 0.73, p=0.016), CR rate 66.6% vs 53.5%, at 45-month median follow-up.",
                keyPoint: "FDA January 2025: Acalabrutinib + BR approved for frontline transplant-ineligible MCL based on ECHO trial - first BTK inhibitor approved in this frontline setting.",
                citation: "Dreyling M, et al. J Clin Oncol. 2025. ECHO Trial; FDA Approval January 16, 2025",
                url: "https://www.fda.gov/drugs/resources-information-approved-drugs/fda-grants-accelerated-approval-acalabrutinib-mantle-cell-lymphoma"
            },
            {
                type: "case",
                typeLabel: "Clinical Case",
                difficulty: "fellow",
                case: {
                    presentation: "A 45-year-old woman with newly diagnosed DLBCL, Stage IIIA. Gene expression profiling: ABC subtype. TP53 mutation detected. Completed 6 cycles R-CHOP. Post-treatment PET: Deauville 2 (CMR).",
                    labs: [
                        { name: "LDH", value: "Normal", abnormal: false },
                        { name: "CBC", value: "Normal", abnormal: false }
                    ]
                },
                question: "Which statement about her prognosis is most accurate?",
                options: [
                    "ABC and GCB subtypes have equivalent outcomes with R-CHOP",
                    "Complete metabolic response eliminates prognostic significance of molecular subtype",
                    "ABC subtype has worse prognosis than GCB despite achieving CMR",
                    "TP53 mutation does not affect DLBCL prognosis"
                ],
                correct: 2,
                explanation: "Despite CMR, ABC subtype carries significantly worse prognosis: 5-year OS 45-56% (ABC) vs 78-80% (GCB). TP53 mutation further worsens outcomes. Molecular subtype retains prognostic significance independent of response. Close surveillance warranted; novel agents targeting ABC/TP53-mutated disease under investigation.",
                keyPoint: "DLBCL molecular subtypes: ABC 5-year OS 45-56% vs GCB 78-80% after R-CHOP. This difference persists even in patients achieving CMR.",
                citation: "Rosenwald A, et al. N Engl J Med. 2002;346:1937-1947; Lenz G, et al. N Engl J Med. 2008;359:2313-2323",
                pmid: "12075054",
                doi: "10.1056/NEJMoa012914"
            },

            // ============ SIMPLE/QUICK FIRE QUESTIONS ============
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "intern",
                question: "What translocation is pathognomonic for follicular lymphoma?",
                options: [
                    "t(8;14) - MYC/IGH",
                    "t(11;14) - CCND1/IGH",
                    "t(14;18) - BCL2/IGH",
                    "t(2;5) - NPM/ALK"
                ],
                correct: 2,
                explanation: "The t(14;18)(q32;q21) translocation juxtaposes BCL2 to IGH, causing BCL2 overexpression and inhibition of apoptosis. Present in ~85% of FL cases. t(8;14) = Burkitt, t(11;14) = MCL, t(2;5) = ALK+ ALCL.",
                keyPoint: "Key translocations: t(14;18) BCL2 = FL | t(11;14) CCND1 = MCL | t(8;14) MYC = Burkitt | t(2;5) ALK = ALCL",
                citation: "Alaggio R, et al. WHO Classification of Haematolymphoid Tumours, 5th ed: Lymphoid Neoplasms. Leukemia. 2022;36:1720-1748",
                pmid: "35732829",
                doi: "10.1038/s41375-022-01620-2"
            },
            {
                type: "simple",
                typeLabel: "Prognosis",
                difficulty: "resident",
                question: "Which factors comprise the International Prognostic Index (IPI)?",
                options: [
                    "Age, LDH, Hemoglobin, Albumin, Stage",
                    "Age, LDH, Performance Status, Extranodal Sites, Stage",
                    "Age, 2-microglobulin, Hemoglobin, Stage, LDH",
                    "Age, B symptoms, Bulk, ESR, Stage"
                ],
                correct: 1,
                explanation: "IPI includes 5 factors (1 point each): Age >60, LDH elevated, ECOG PS 2, >1 extranodal site, Stage III/IV. Risk groups: Low (0-1), Low-Int (2), High-Int (3), High (4-5). NCCN-IPI provides better discrimination in the rituximab era.",
                keyPoint: "IPI = Age >60 + LDH + PS2 + >1 extranodal + Stage III/IV. Each factor = 1 point. Remains most widely used DLBCL prognostic tool.",
                citation: "International NHL Prognostic Factors Project. N Engl J Med. 1993;329:987-994",
                pmid: "8141877",
                doi: "10.1056/NEJM199309303291402",
                pmid: "8141877",
                doi: "10.1056/NEJM199309303291402"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "intern",
                question: "Which toxicity is most specifically associated with bleomycin?",
                options: [
                    "Cardiomyopathy",
                    "Pulmonary fibrosis",
                    "Peripheral neuropathy",
                    "Secondary leukemia"
                ],
                correct: 1,
                explanation: "Bleomycin causes pulmonary toxicity (pneumonitis/fibrosis) in 2-5% of patients. Risk factors: age >70, renal impairment, cumulative dose, G-CSF. In patients 60 years, bleomycin often omitted after 2 cycles. Cardiomyopathy = anthracyclines; neuropathy = vincristine/brentuximab.",
                keyPoint: "Bleomycin pulmonary toxicity: 2-5% incidence. Risk increases with age >70, renal dysfunction, cumulative dose. Consider AVD (omit bleomycin) in elderly.",
                citation: "Martin WG, et al. J Clin Oncol. 2005;23:7614-7620",
                pmid: "16186594",
                doi: "10.1200/JCO.2004.00.9894"
            },
            {
                type: "simple",
                typeLabel: "Response",
                difficulty: "resident",
                question: "What Deauville score indicates complete metabolic response on PET/CT?",
                options: [
                    "Deauville 1-2",
                    "Deauville 3-4",
                    "SUV max reduction >50%",
                    "Any uptake below mediastinal blood pool"
                ],
                correct: 0,
                explanation: "Deauville 5-point scale: 1 = no uptake, 2 = uptake  mediastinum, 3 = uptake > mediastinum but  liver, 4 = uptake moderately > liver, 5 = uptake markedly > liver or new lesions. Scores 1-2 = CMR. Score 3 often grouped as negative in trials.",
                keyPoint: "Deauville: 1-2 = CMR | 3 = equivocal (often negative) | 4-5 = positive. Guides treatment in both HL and aggressive NHL.",
                citation: "Cheson BD, et al. J Clin Oncol. 2014;32:3059-3067 (Lugano Classification)",
                pmid: "25113753",
                doi: "10.1200/JCO.2013.54.8800"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "intern",
                question: "What is rituximab's mechanism of action?",
                options: [
                    "BTK inhibition",
                    "Anti-CD20 monoclonal antibody causing B-cell depletion",
                    "BCL-2 inhibition promoting apoptosis",
                    "PD-1 checkpoint inhibition"
                ],
                correct: 1,
                explanation: "Rituximab is a chimeric anti-CD20 monoclonal antibody that depletes B-cells via CDC (complement-dependent cytotoxicity), ADCC (antibody-dependent cellular cytotoxicity), and direct apoptosis. GELA trial: R-CHOP CR 76% vs CHOP 63% (p=0.005).",
                keyPoint: "Rituximab = anti-CD20 mAb. Works via CDC + ADCC + direct apoptosis. Adding to CHOP improved CR 76% vs 63% and transformed DLBCL outcomes.",
                citation: "Coiffier B, et al. N Engl J Med. 2002;346:235-242 (GELA LNH-98.5)",
                pmid: "11807147",
                doi: "10.1056/NEJMoa011795"
            },
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "intern",
                question: "What immunophenotype distinguishes classic Hodgkin lymphoma Reed-Sternberg cells?",
                options: [
                    "CD20+, CD30-",
                    "CD15+, CD30+, typically CD20-",
                    "CD5+, CD23+",
                    "CD10+, BCL6+"
                ],
                correct: 1,
                explanation: "Classic HL Reed-Sternberg cells: CD15+, CD30+, usually CD20- (weakly positive in minority). This is opposite to B-cell NHL which is CD20+. CD5/CD23 = CLL; CD10/BCL6 = germinal center markers (FL, GCB-DLBCL). NLPHL is CD20+, CD15-, CD30-.",
                keyPoint: "Classic HL: CD15+, CD30+, CD20- | B-NHL: CD20+ | CLL: CD5+, CD23+ | NLPHL: CD20+, CD15-, CD30-",
                citation: "Swerdlow SH, et al. WHO Classification 2017; Kuppers R. Nat Rev Cancer. 2009;9:15-27",
                pmid: "19078975",
                url: "https://publications.iarc.who.int/Book-And-Report-Series/Who-Classification-Of-Tumours/WHO-Classification-Of-Tumours-Of-Haematopoietic-And-Lymphoid-Tissues-2017"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "fellow",
                question: "What is the primary ibrutinib resistance mechanism in MCL?",
                options: [
                    "BCL2 overexpression",
                    "C481S mutation in BTK preventing covalent binding",
                    "Loss of CD20 expression",
                    "TP53 deletion alone"
                ],
                correct: 1,
                explanation: "C481S mutation converts cysteine to serine at position 481, the ibrutinib binding site. This prevents covalent binding. Pirtobrutinib (non-covalent, reversible BTK inhibitor) uses alternative binding mechanism not dependent on C481, effective in ibrutinib-resistant disease.",
                keyPoint: "BTK C481S mutation = key acquired resistance to ibrutinib. Pirtobrutinib (non-covalent BTKi) overcomes this via alternative binding mechanism.",
                citation: "Woyach JA, et al. N Engl J Med. 2014;370:2286-2294; Mato AR, et al. Lancet. 2021;397:892-901",
                pmid: "24869598",
                doi: "10.1056/NEJMoa1400029"
            },
            {
                type: "simple",
                typeLabel: "Staging",
                difficulty: "resident",
                question: "Which follicular lymphoma grade is treated as aggressive lymphoma?",
                options: [
                    "Grade 1",
                    "Grade 2",
                    "Grade 3A",
                    "Grade 3B"
                ],
                correct: 3,
                explanation: "FL grading based on centroblasts/HPF. Grades 1, 2, 3A = indolent, managed similarly. Grade 3B (sheets of centroblasts) = aggressive, treated like DLBCL with R-CHOP or Pola-R-CHP. Always check grade on pathology reports.",
                keyPoint: "FL Grade 1, 2, 3A = indolent (may watch/wait) | Grade 3B = aggressive (treat like DLBCL). Critical distinction for treatment planning.",
                citation: "NCCN B-Cell Lymphomas Version 3.2025; WHO Classification 2017",
                guideline: { name: "NCCN", url: "https://www.nccn.org/guidelines/guidelines-detail?category=1&id=1480" }
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "resident",
                question: "What is true about limited-stage (I-II) follicular lymphoma?",
                options: [
                    "Watch and wait is always preferred",
                    "Involved-site radiation therapy (ISRT) can be curative",
                    "Immediate chemotherapy required",
                    "Auto-SCT is first-line"
                ],
                correct: 1,
                explanation: "Unlike advanced FL, truly limited-stage (Stage I or contiguous Stage II) FL can be cured with involved-site radiation therapy. Long-term DFS 40-50%. Careful staging essential - limited vs advanced FL management differs significantly.",
                keyPoint: "Limited-stage FL: ISRT potentially curative (40-50% long-term DFS) | Advanced FL: generally incurable, watch/wait if asymptomatic.",
                citation: "Lowry L, et al. J Clin Oncol. 2011;29:4170-4176; NCCN Guidelines 2025",
                pmid: "21990394",
                doi: "10.1200/JCO.2011.37.6162"
            },
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "intern",
                question: "Which CD5+ B-cell lymphoma has t(11;14) translocation?",
                options: [
                    "CLL/SLL",
                    "Mantle cell lymphoma",
                    "Marginal zone lymphoma",
                    "Follicular lymphoma"
                ],
                correct: 1,
                explanation: "MCL: CD5+, CD23-, cyclin D1+, t(11;14). CLL: CD5+, CD23+, cyclin D1-. The t(11;14) juxtaposes CCND1 to IGH causing cyclin D1 overexpression. Despite small-medium cells, MCL typically has aggressive course.",
                keyPoint: "CD5+ B-NHL: MCL = CD5+, CD23-, cyclin D1+, t(11;14) | CLL = CD5+, CD23+, cyclin D1-. Both CD5+ but very different biology/treatment.",
                citation: "Jares P, et al. Nat Rev Cancer. 2007;7:750-762",
                pmid: "17891190",
                doi: "10.1038/nrc2230"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "resident",
                question: "What is auto-SCT's role in DLBCL?",
                options: [
                    "First-line consolidation for all patients",
                    "Salvage for chemosensitive relapsed/refractory disease",
                    "Alternative to R-CHOP in elderly",
                    "Preferred over CAR-T in all relapsed cases"
                ],
                correct: 1,
                explanation: "Auto-SCT is NOT first-line. It's standard of care for relapsed/refractory DLBCL achieving at least PR to salvage chemotherapy (chemosensitive disease). Patients failing auto-SCT or not candidates  CAR-T, bispecifics, or clinical trials.",
                keyPoint: "DLBCL algorithm: 1st line = R-CHOP/Pola-R-CHP | Relapse = salvage  auto-SCT if chemosensitive | Post-SCT relapse = CAR-T, bispecifics.",
                citation: "Gisselbrecht C, et al. J Clin Oncol. 2010;28:4184-4190 (CORAL); NCCN Guidelines 2025",
                pmid: "20660832",
                doi: "10.1200/JCO.2010.28.1618"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "resident",
                question: "Which is NOT a GELF criterion for initiating FL treatment?",
                options: [
                    "Any mass >7 cm diameter",
                    "3 nodal sites each >3 cm",
                    "Presence of t(14;18) translocation",
                    "Symptomatic splenomegaly"
                ],
                correct: 2,
                explanation: "GELF criteria: mass >7cm, 3 nodes >3cm, B symptoms, splenomegaly, compression syndrome, effusions, cytopenias (Hgb <10, ANC <1.5, Plt <100), leukemic phase (>5000/L lymphoma cells). t(14;18) is diagnostic marker (~85% FL) but NOT treatment indication.",
                keyPoint: "GELF criteria = mass >7cm | 3 nodes >3cm | B symptoms | splenomegaly | compression | effusions | cytopenias | leukemic phase. Molecular markers  treatment criteria.",
                citation: "Brice P, et al. J Clin Oncol. 1997;15:1110-1117 (GELF criteria)",
                pmid: "9060552",
                doi: "10.1200/JCO.1997.15.3.1110"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "attending",
                question: "Per NCCN January 2025 update, what is ctDNA-MRD testing's role in DLBCL?",
                options: [
                    "Required for diagnosis",
                    "Alternative to biopsy for evaluating end-of-treatment PET-positive results",
                    "Determines CAR-T eligibility",
                    "Mandatory before R-CHOP"
                ],
                correct: 1,
                explanation: "January 2025 NCCN update: ctDNA-MRD testing added as alternative to biopsy for evaluating PET-positive results after first-line therapy. First ctDNA recommendation in NCCN lymphoma guidelines. Provides less invasive option for response assessment.",
                keyPoint: "NCCN January 2025: ctDNA-MRD testing = alternative to biopsy for EOT PET+ evaluation in DLBCL. Landmark update - first ctDNA recommendation in lymphoma guidelines.",
                citation: "NCCN B-Cell Lymphomas Version 1.2025 Update; Kurtz DM, et al. J Clin Oncol. 2023;41:567-579",
                pmid: "36455168",
                guideline: { name: "NCCN", url: "https://www.nccn.org/guidelines/guidelines-detail?category=1&id=1480" }
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "attending",
                question: "What is the POLARIX trial 5-year PFS for Pola-R-CHP vs R-CHOP?",
                options: [
                    "64.2% vs 59.1%",
                    "76.7% vs 70.2%",
                    "82% vs 75%",
                    "55% vs 50%"
                ],
                correct: 0,
                explanation: "POLARIX 5-year follow-up (median 60.9 months): PFS 64.2% vs 59.1% (HR 0.78, 95% CI 0.623-0.980). 5-year OS: 82.2% vs 79.6%. Sustained benefit confirms Pola-R-CHP as standard of care. The 2-year PFS was 76.7% vs 70.2%.",
                keyPoint: "POLARIX 5-year update: PFS 64.2% vs 59.1%, OS 82.2% vs 79.6%. Sustained efficacy supports Pola-R-CHP as frontline standard for IPI 2 DLBCL.",
                citation: "Tilly H, et al. ASH 2024 Abstract; J Clin Oncol. 2025 (5-year outcomes)",
                url: "https://scholar.google.com/scholar?q=POLARIX+5+year+Tilly+DLBCL"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "attending",
                question: "In SWOG S1826, what was the 2-year PFS for Nivolumab-AVD vs BV-AVD in advanced HL?",
                options: [
                    "85% vs 78%",
                    "92% vs 83%",
                    "88% vs 82%",
                    "95% vs 90%"
                ],
                correct: 1,
                explanation: "SWOG S1826: 2-year PFS 92% (N-AVD) vs 83% (BV-AVD), HR 0.45. N-AVD also had better tolerability with less treatment discontinuation (7.6% vs 12%) and fewer deaths during treatment (0.6% vs 1.7%). Led to NCCN PREFERRED status.",
                keyPoint: "SWOG S1826: Nivo-AVD 2-year PFS 92% vs BV-AVD 83% (HR 0.45). Better efficacy AND tolerability led to NCCN PREFERRED designation.",
                citation: "Herrera AF, et al. N Engl J Med. 2024;391:1379-1389",
                pmid: "39413375",
                doi: "10.1056/NEJMoa2405888"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "fellow",
                question: "What is the main advantage of second-generation BTK inhibitors over ibrutinib?",
                options: [
                    "Higher response rates",
                    "More selective BTK inhibition with fewer off-target effects",
                    "Oral bioavailability",
                    "Longer half-life"
                ],
                correct: 1,
                explanation: "Acalabrutinib and zanubrutinib have more selective BTK inhibition than ibrutinib. Ibrutinib's off-target effects include: AFib (5-10% due to PI3K inhibition), bleeding (up to 50% from TEC kinase inhibition), rash/diarrhea (EGFR). Second-gen agents spare these kinases.",
                keyPoint: "Ibrutinib off-targets: AFib (PI3K), bleeding (TEC), rash/diarrhea (EGFR). Acalabrutinib/zanubrutinib spare these = better safety profile.",
                citation: "Byrd JC, et al. N Engl J Med. 2016;374:323-332; Hillmen P, et al. Lancet. 2020;395:1278-1291",
                pmid: "26641137",
                doi: "10.1056/NEJMoa1509981"
            },
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "resident",
                question: "Which feature distinguishes Burkitt from DLBCL?",
                options: [
                    "CD20 expression",
                    "Ki-67 proliferation index >95%",
                    "BCL6 expression",
                    "Presence of MYC rearrangement"
                ],
                correct: 1,
                explanation: "Burkitt has Ki-67 >95% (extremely high proliferation). Both express CD20, BCL6. MYC rearrangement can occur in both (in DLBCL, usually with BCL2/BCL6 = double/triple hit). The near-100% proliferation fraction is characteristic of Burkitt.",
                keyPoint: "Burkitt = Ki-67 >95% + MYC+ + BCL2- + starry-sky. Double-hit lymphoma = MYC + BCL2 and/or BCL6 rearrangement (different entity, worse prognosis).",
                citation: "WHO Classification 2017; Roschewski M, et al. Blood. 2014;124:2596-2604",
                pmid: "25232064",
                url: "https://publications.iarc.who.int/Book-And-Report-Series/Who-Classification-Of-Tumours/WHO-Classification-Of-Tumours-Of-Haematopoietic-And-Lymphoid-Tissues-2017"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "resident",
                question: "What is the complete response rate difference in GELA trial (R-CHOP vs CHOP)?",
                options: [
                    "76% vs 63%",
                    "85% vs 70%",
                    "60% vs 45%",
                    "90% vs 80%"
                ],
                correct: 0,
                explanation: "GELA LNH-98.5: CR rate 76% (R-CHOP) vs 63% (CHOP), p=0.005. This landmark trial in elderly DLBCL patients established rituximab + chemotherapy as standard. Event-free survival also significantly better (68% vs 49%).",
                keyPoint: "GELA trial: R-CHOP CR 76% vs CHOP 63% (p=0.005). Established rituximab as essential component of DLBCL treatment.",
                citation: "Coiffier B, et al. N Engl J Med. 2002;346:235-242",
                pmid: "11807147",
                doi: "10.1056/NEJMoa011795"
            },
            {
                type: "simple",
                typeLabel: "Prognosis",
                difficulty: "fellow",
                question: "What is the 5-year OS for ABC vs GCB DLBCL subtype after R-CHOP?",
                options: [
                    "70% vs 75%",
                    "45-56% vs 78-80%",
                    "60% vs 65%",
                    "80% vs 85%"
                ],
                correct: 1,
                explanation: "ABC subtype: 5-year OS 45-56%. GCB subtype: 5-year OS 78-80%. This significant difference persists in the rituximab era. ABC has chronically active BCR signaling and NF-B activation. Novel targeted agents being developed for ABC subtype.",
                keyPoint: "DLBCL molecular subtypes matter: ABC 5-yr OS 45-56% vs GCB 78-80%. ABC = poor prognosis due to constitutive NF-B activation.",
                citation: "Lenz G, et al. N Engl J Med. 2008;359:2313-2323; Rosenwald A, et al. N Engl J Med. 2002;346:1937-1947",
                pmid: "19038878",
                doi: "10.1056/NEJMoa0802885"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "fellow",
                question: "Why is vincristine omitted when adding polatuzumab vedotin (Pola-R-CHP)?",
                options: [
                    "Drug interaction with rituximab",
                    "Overlapping neurotoxicity risk",
                    "Decreased efficacy when combined",
                    "Renal toxicity concerns"
                ],
                correct: 1,
                explanation: "Both vincristine and polatuzumab vedotin cause peripheral neuropathy. Vincristine is omitted in Pola-R-CHP (not Pola-R-CHOP) to avoid overlapping neurotoxicity while maintaining efficacy. POLARIX trial validated this approach.",
                keyPoint: "Pola-R-CHP: Vincristine omitted due to overlapping neuropathy with polatuzumab. Efficacy maintained per POLARIX trial.",
                citation: "Tilly H, et al. N Engl J Med. 2022;386:351-363",
                pmid: "34904799",
                doi: "10.1056/NEJMoa2115304"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "attending",
                question: "What is pirtobrutinib's mechanism that overcomes BTK C481S resistance?",
                options: [
                    "Higher affinity for BTK",
                    "Non-covalent, reversible binding not dependent on C481",
                    "Dual BTK/PI3K inhibition",
                    "Intracellular accumulation"
                ],
                correct: 1,
                explanation: "Pirtobrutinib is a non-covalent, reversible BTK inhibitor that blocks the ATP binding site independently of C481. This allows activity against C481S-mutant BTK, providing an option for patients who develop resistance to covalent BTK inhibitors.",
                keyPoint: "Pirtobrutinib = non-covalent BTKi, binds ATP site independent of C481. Effective in covalent BTKi-resistant disease including C481S mutations.",
                citation: "Mato AR, et al. Lancet. 2021;397:892-901 (BRUIN study)",
                pmid: "33637086",
                doi: "10.1016/S0140-6736(21)00224-5"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "attending",
                question: "What median PFS improvement did acalabrutinib + BR show vs BR alone in ECHO trial?",
                options: [
                    "66.4 vs 49.6 months",
                    "48.2 vs 36.1 months",
                    "72.0 vs 55.0 months",
                    "54.0 vs 42.0 months"
                ],
                correct: 0,
                explanation: "ECHO trial (45-month follow-up): Median PFS 66.4 months (acalabrutinib + BR) vs 49.6 months (BR), HR 0.73 (p=0.016). CR rate 66.6% vs 53.5%. Risk of progression/death reduced by 27%.",
                keyPoint: "ECHO trial: Acalabrutinib + BR median PFS 66.4 vs 49.6 months (HR 0.73). First BTK inhibitor approved frontline for transplant-ineligible MCL.",
                citation: "Dreyling M, et al. ASH 2024; FDA Approval January 16, 2025",
                url: "https://www.fda.gov/drugs/resources-information-approved-drugs/fda-grants-accelerated-approval-acalabrutinib-mantle-cell-lymphoma"
            },
            {
                type: "simple",
                typeLabel: "Staging",
                difficulty: "intern",
                question: "What defines 'bulky disease' in Hodgkin lymphoma?",
                options: [
                    "Any mass >5 cm",
                    "Mass 10 cm or >1/3 thoracic diameter",
                    "Mass >7 cm",
                    "Multiple involved nodes"
                ],
                correct: 1,
                explanation: "Bulky disease in HL: mass 10 cm OR mediastinal mass ratio >1/3 of thoracic diameter on PA chest X-ray. Bulky disease is an unfavorable prognostic factor in early-stage HL and influences treatment intensity.",
                keyPoint: "HL bulky disease: 10 cm mass OR >1/3 thoracic diameter. Unfavorable factor requiring more intensive treatment.",
                citation: "NCCN Hodgkin Lymphoma Guidelines; Lister TA, et al. Ann Intern Med. 1989;110:258-60 (Cotswolds)",
                pmid: "2913913",
                guideline: { name: "NCCN", url: "https://www.nccn.org/guidelines/guidelines-detail?category=1&id=1439" }
            },
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "fellow",
                question: "Which immunophenotype is characteristic of nodular lymphocyte-predominant Hodgkin lymphoma (NLPHL)?",
                options: [
                    "CD15+, CD30+, CD20-",
                    "CD20+, CD15-, CD30-, BCL6+",
                    "CD10+, BCL2+, BCL6+",
                    "CD5+, CD23+"
                ],
                correct: 1,
                explanation: "NLPHL 'popcorn' cells (LP cells): CD20+, CD15-, CD30- (opposite of classic HL). Also express BCL6, OCT2, and BOB.1. This B-cell immunophenotype means rituximab can be used. NLPHL has different biology and often more indolent course than cHL.",
                keyPoint: "NLPHL: CD20+, CD15-, CD30- | Classic HL: CD15+, CD30+, CD20-. NLPHL responsive to rituximab due to B-cell phenotype.",
                citation: "Swerdlow SH, et al. WHO Classification 2017; Eichenauer DA, et al. Blood. 2018;131:1718-1725",
                pmid: "29572377",
                url: "https://publications.iarc.who.int/Book-And-Report-Series/Who-Classification-Of-Tumours/WHO-Classification-Of-Tumours-Of-Haematopoietic-And-Lymphoid-Tissues-2017"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "resident",
                question: "What is the standard salvage regimen prior to auto-SCT in relapsed DLBCL?",
                options: [
                    "R-CHOP",
                    "R-ICE, R-DHAP, or R-GDP",
                    "Bendamustine-Rituximab",
                    "Obinutuzumab monotherapy"
                ],
                correct: 1,
                explanation: "Platinum-based salvage regimens (R-ICE, R-DHAP, R-GDP) are used to assess chemosensitivity before auto-SCT. CORAL trial showed similar efficacy between R-ICE and R-DHAP. Chemosensitive patients (CR/PR to salvage) proceed to transplant.",
                keyPoint: "Relapsed DLBCL salvage: R-ICE, R-DHAP, or R-GDP  assess response  auto-SCT if chemosensitive. CORAL trial showed R-ICE  R-DHAP.",
                citation: "Gisselbrecht C, et al. J Clin Oncol. 2010;28:4184-4190 (CORAL trial)",
                pmid: "20660832",
                doi: "10.1200/JCO.2010.28.1618"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "intern",
                question: "In the rituximab era, what is the approximate cure rate for DLBCL with R-CHOP?",
                options: [
                    "30-40%",
                    "50-60%",
                    "60-70%",
                    "80-90%"
                ],
                correct: 2,
                explanation: "R-CHOP achieves cure in approximately 60-70% of DLBCL patients overall. However, this varies by IPI and molecular subtype: GCB subtype ~80% cure rate vs ABC ~45-55%. Up to 30-40% will be refractory or relapse.",
                keyPoint: "R-CHOP overall cure rate: 60-70%. Varies by subtype (GCB ~80%, ABC ~50%) and IPI score. 30-40% refractory/relapse.",
                citation: "Coiffier B, et al. Blood. 2010;116:2040-2045 (10-year GELA follow-up)",
                pmid: "20548096",
                doi: "10.1182/blood-2010-03-276246"
            },
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "resident",
                question: "What cytogenetic abnormality defines 'double-hit' lymphoma?",
                options: [
                    "t(14;18) alone",
                    "MYC rearrangement plus BCL2 and/or BCL6 rearrangement",
                    "t(11;14) plus TP53 deletion",
                    "Complex karyotype (3 abnormalities)"
                ],
                correct: 1,
                explanation: "Double-hit lymphoma (high-grade B-cell lymphoma with MYC and BCL2 and/or BCL6 rearrangements): requires MYC rearrangement PLUS BCL2 and/or BCL6 rearrangement. Poor prognosis, often treated with DA-EPOCH-R rather than R-CHOP.",
                keyPoint: "Double-hit = MYC + BCL2 and/or BCL6 rearrangements. Triple-hit = all three. Aggressive biology, often requires intensified therapy (DA-EPOCH-R).",
                citation: "Swerdlow SH, et al. WHO Classification 2017; Petrich AM, et al. Blood. 2014;124:2354-2361",
                pmid: "25161267",
                url: "https://publications.iarc.who.int/Book-And-Report-Series/Who-Classification-Of-Tumours/WHO-Classification-Of-Tumours-Of-Haematopoietic-And-Lymphoid-Tissues-2017"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "fellow",
                question: "What is the recommended G-CSF use with ABVD in Hodgkin lymphoma?",
                options: [
                    "Routine primary prophylaxis for all patients",
                    "Generally avoided due to increased pulmonary toxicity risk",
                    "Required only in elderly patients",
                    "Only with bleomycin-containing cycles"
                ],
                correct: 1,
                explanation: "G-CSF with ABVD is generally avoided due to potential increased bleomycin pulmonary toxicity. If needed for neutropenia management, some recommend avoiding G-CSF specifically during bleomycin-containing cycles or considering AVD without bleomycin.",
                keyPoint: "G-CSF + ABVD: Generally avoided due to  bleomycin pulmonary toxicity risk. BrECADD specifically requires G-CSF per protocol.",
                citation: "Evens AM, et al. Ann Oncol. 2012;23:2879-2890; NCCN HL Guidelines",
                pmid: "22782332",
                guideline: { name: "NCCN", url: "https://www.nccn.org/guidelines/guidelines-detail?category=1&id=1439" }
            },

            // ============ ADDITIONAL INTERN LEVEL QUESTIONS ============
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "intern",
                question: "What are B symptoms in lymphoma?",
                options: [
                    "Bone pain, back pain, and bleeding",
                    "Fever >38C, drenching night sweats, >10% weight loss in 6 months",
                    "Breathlessness, bronchospasm, and bradycardia",
                    "Bruising, bleeding gums, and bilateral edema"
                ],
                correct: 1,
                explanation: "B symptoms in lymphoma are: unexplained fever >38C (100.4F), drenching night sweats requiring change of clothes/bedding, and unintentional weight loss >10% body weight over 6 months. These indicate more aggressive disease and affect staging (e.g., Stage IIB vs IIA).",
                keyPoint: "B symptoms = Fever >38C + Night sweats + >10% weight loss. Indicates worse prognosis and affects staging designation.",
                citation: "Lister TA, et al. Ann Intern Med. 1989;110:258-260 (Cotswolds modification)",
                pmid: "2913913",
                doi: "10.7326/0003-4819-110-4-258"
            },
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "intern",
                question: "What is the most common type of Non-Hodgkin lymphoma in adults?",
                options: [
                    "Follicular lymphoma",
                    "Burkitt lymphoma",
                    "Diffuse large B-cell lymphoma (DLBCL)",
                    "Mantle cell lymphoma"
                ],
                correct: 2,
                explanation: "DLBCL is the most common NHL, accounting for 30-40% of all adult NHL cases. It is an aggressive lymphoma with high cure rates (~60-70%) with R-CHOP therapy. Follicular lymphoma is the second most common (~20%).",
                keyPoint: "DLBCL = most common NHL (30-40%). Follicular = 2nd most common (~20%). DLBCL is aggressive but often curable.",
                citation: "Armitage JO, et al. J Clin Oncol. 2017;35:2495-2504",
                pmid: "28498783",
                doi: "10.1200/JCO.2017.72.7511"
            },
            {
                type: "simple",
                typeLabel: "Staging",
                difficulty: "intern",
                question: "In Ann Arbor staging, what defines Stage III lymphoma?",
                options: [
                    "Single lymph node region involved",
                    "Two or more lymph node regions on the same side of diaphragm",
                    "Lymph node regions on both sides of the diaphragm",
                    "Diffuse extralymphatic organ involvement"
                ],
                correct: 2,
                explanation: "Ann Arbor staging: Stage I = single node region, Stage II = 2 regions same side of diaphragm, Stage III = regions on BOTH sides of diaphragm, Stage IV = diffuse extranodal involvement. The diaphragm is the key anatomical landmark.",
                keyPoint: "Stage I = 1 region | Stage II = 2 regions, same side | Stage III = both sides of diaphragm | Stage IV = diffuse extranodal.",
                citation: "Carbone PP, et al. Cancer Res. 1971;31:1860-1861 (Ann Arbor classification)",
                pmid: "5121694"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "intern",
                question: "What does CHOP stand for in the R-CHOP regimen?",
                options: [
                    "Carboplatin, Hydroxyurea, Oxaliplatin, Prednisone",
                    "Cyclophosphamide, Hydroxydaunorubicin, Oncovin, Prednisone",
                    "Cisplatin, Hydrocortisone, Ondansetron, Paclitaxel",
                    "Cladribine, Histamine, Obinutuzumab, Pembrolizumab"
                ],
                correct: 1,
                explanation: "CHOP = Cyclophosphamide + Hydroxydaunorubicin (doxorubicin) + Oncovin (vincristine) + Prednisone. R-CHOP adds Rituximab. This has been standard of care for DLBCL since the GELA trial demonstrated improved survival.",
                keyPoint: "CHOP = Cyclophosphamide + doxorubicin (Hydroxydaunorubicin) + vincristine (Oncovin) + Prednisone. R = Rituximab.",
                citation: "Coiffier B, et al. N Engl J Med. 2002;346:235-242",
                pmid: "11807147",
                doi: "10.1056/NEJMoa011795"
            },
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "intern",
                question: "Which cell type is the hallmark of Hodgkin lymphoma?",
                options: [
                    "Centroblast",
                    "Reed-Sternberg cell",
                    "Plasma cell",
                    "Hairy cell"
                ],
                correct: 1,
                explanation: "Reed-Sternberg cells are the pathognomonic malignant cells in classic Hodgkin lymphoma. They are large cells with 'owl-eye' bilobed nuclei and prominent eosinophilic nucleoli. They are CD15+, CD30+, and usually CD20-.",
                keyPoint: "Reed-Sternberg cell = hallmark of Hodgkin lymphoma. Large, bilobed 'owl-eye' nucleus. CD15+, CD30+, CD20-.",
                citation: "Kuppers R. Nat Rev Cancer. 2009;9:15-27",
                pmid: "19078975",
                doi: "10.1038/nrc2542"
            },

            // ============ ADDITIONAL RESIDENT LEVEL QUESTIONS ============
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "resident",
                question: "What is the target of venetoclax?",
                options: [
                    "BTK (Bruton's tyrosine kinase)",
                    "BCL-2 (anti-apoptotic protein)",
                    "CD20 surface antigen",
                    "PI3K delta isoform"
                ],
                correct: 1,
                explanation: "Venetoclax is a selective BCL-2 inhibitor that promotes apoptosis by displacing pro-apoptotic proteins from BCL-2. Used in CLL (with obinutuzumab), MCL, and AML. TLS risk requires ramp-up dosing and monitoring.",
                keyPoint: "Venetoclax = BCL-2 inhibitor  restores apoptosis. High TLS risk requires ramp-up. Key drug in CLL, MCL, AML.",
                citation: "Roberts AW, et al. N Engl J Med. 2016;374:311-322",
                pmid: "26639348",
                doi: "10.1056/NEJMoa1513257"
            },
            {
                type: "simple",
                typeLabel: "Prognosis",
                difficulty: "resident",
                question: "What is the FLIPI used to assess?",
                options: [
                    "Risk stratification in DLBCL",
                    "Prognosis in follicular lymphoma",
                    "Response to treatment in Hodgkin lymphoma",
                    "Staging in mantle cell lymphoma"
                ],
                correct: 1,
                explanation: "FLIPI (Follicular Lymphoma International Prognostic Index) assesses FL prognosis. Factors: age >60, Stage III-IV, Hgb <12, LDH elevated, >4 nodal sites. FLIPI-2 adds 2-microglobulin and bone marrow involvement.",
                keyPoint: "FLIPI = FL prognosis. Factors: Age >60, Stage III-IV, Hgb <12, LDH, >4 nodal sites. Each = 1 point.",
                citation: "Solal-Cligny P, et al. Blood. 2004;104:1258-1265",
                pmid: "15126323",
                doi: "10.1182/blood-2003-12-4434"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "resident",
                question: "What is the mechanism of brentuximab vedotin?",
                options: [
                    "Anti-CD30 antibody-drug conjugate",
                    "Bispecific T-cell engager",
                    "CAR-T cell therapy",
                    "PD-1 checkpoint inhibitor"
                ],
                correct: 0,
                explanation: "Brentuximab vedotin is an anti-CD30 antibody-drug conjugate (ADC). The anti-CD30 antibody delivers the cytotoxic payload (monomethyl auristatin E, MMAE) directly to CD30+ cells. Used in Hodgkin lymphoma and ALCL.",
                keyPoint: "Brentuximab = anti-CD30 ADC (antibody + MMAE). Targets CD30+ cells. Used in HL, ALCL, CD30+ CTCL.",
                citation: "Younes A, et al. N Engl J Med. 2010;363:1812-1821",
                pmid: "21047225",
                doi: "10.1056/NEJMoa1002965"
            },
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "resident",
                question: "What is the typical CD marker pattern for CLL/SLL?",
                options: [
                    "CD5+, CD23+, CD20 dim",
                    "CD5-, CD23-, CD20 bright",
                    "CD10+, BCL6+, CD5-",
                    "CD30+, CD15+, CD20-"
                ],
                correct: 0,
                explanation: "CLL/SLL immunophenotype: CD5+, CD23+, CD20 dim (weak), CD43+. This distinguishes it from MCL which is CD5+, CD23-. CD10+/BCL6+ = germinal center (FL). CD30+/CD15+ = Hodgkin.",
                keyPoint: "CLL = CD5+, CD23+, CD20 dim | MCL = CD5+, CD23-, cyclin D1+. Both CD5+ but CD23 distinguishes them.",
                citation: "Hallek M, et al. Blood. 2018;131:2745-2760",
                pmid: "29540348",
                doi: "10.1182/blood-2017-09-806398"
            },

            // ============ ADDITIONAL FELLOW LEVEL QUESTIONS ============
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "fellow",
                question: "Which bispecific antibody is approved for relapsed/refractory DLBCL?",
                options: [
                    "Blinatumomab (CD19xCD3)",
                    "Glofitamab and Epcoritamab (CD20xCD3)",
                    "Tafasitamab (anti-CD19)",
                    "Mosunetuzumab only"
                ],
                correct: 1,
                explanation: "Glofitamab and epcoritamab are CD20xCD3 bispecific antibodies approved for r/r DLBCL after 2 prior lines. They redirect T-cells to CD20+ lymphoma cells. Blinatumomab (CD19xCD3) is approved for ALL. Mosunetuzumab is also approved for r/r FL.",
                keyPoint: "CD20xCD3 bispecifics for DLBCL: Glofitamab, Epcoritamab, Mosunetuzumab. Redirect T-cells to kill CD20+ tumor.",
                citation: "Dickinson MJ, et al. N Engl J Med. 2022;387:2220-2231 (Glofitamab)",
                pmid: "36507690",
                doi: "10.1056/NEJMoa2206913"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "fellow",
                question: "What is the MIPI score used for?",
                options: [
                    "Prognosis in DLBCL",
                    "Risk stratification in mantle cell lymphoma",
                    "Response assessment in Hodgkin lymphoma",
                    "Treatment selection in follicular lymphoma"
                ],
                correct: 1,
                explanation: "MIPI (MCL International Prognostic Index) stratifies MCL patients. Factors: age, ECOG PS, LDH, WBC. Combined biological MIPI (MIPIb) adds Ki-67. Low/Intermediate/High risk groups guide treatment intensity decisions.",
                keyPoint: "MIPI = MCL prognosis (Age, PS, LDH, WBC). MIPIb adds Ki-67. Guides treatment intensity decisions in MCL.",
                citation: "Hoster E, et al. Blood. 2008;111:558-565",
                pmid: "17962512",
                doi: "10.1182/blood-2007-06-095331"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "fellow",
                question: "What distinguishes CAR-T therapy from bispecific antibodies?",
                options: [
                    "CAR-T uses modified patient T-cells; bispecifics are off-the-shelf",
                    "Bispecifics require leukapheresis; CAR-T does not",
                    "CAR-T targets CD20; bispecifics target CD19",
                    "Bispecifics cause more severe CRS than CAR-T"
                ],
                correct: 0,
                explanation: "CAR-T requires leukapheresis to collect patient T-cells, genetic modification ex vivo, and re-infusion (weeks-long process). Bispecifics are manufactured products available 'off-the-shelf' with immediate administration. Both can cause CRS/ICANS.",
                keyPoint: "CAR-T = patient's modified T-cells (personalized, weeks to manufacture) | Bispecifics = off-the-shelf (immediate availability).",
                citation: "Neelapu SS, et al. N Engl J Med. 2017;377:2531-2544 (ZUMA-1)",
                pmid: "29226797",
                doi: "10.1056/NEJMoa1707447"
            },

            // ============ ADDITIONAL ATTENDING LEVEL QUESTIONS ============
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "attending",
                question: "Per 2025 guidelines, what is the preferred regimen for primary CNS lymphoma?",
                options: [
                    "R-CHOP x 6 cycles",
                    "High-dose methotrexate-based regimen",
                    "Whole brain radiation alone",
                    "Temozolomide monotherapy"
                ],
                correct: 1,
                explanation: "Primary CNS lymphoma requires high-dose methotrexate (HD-MTX)-based regimens due to CNS penetration. R-CHOP does not adequately cross the blood-brain barrier. NCCN recommends HD-MTX  rituximab  temozolomide, with consolidation options including auto-SCT or whole brain RT.",
                keyPoint: "PCNSL: High-dose methotrexate-based regimens required for CNS penetration. R-CHOP inadequate. Consolidation with auto-SCT or RT.",
                citation: "NCCN CNS Cancers Guidelines 2025; Ferreri AJ, et al. Lancet Oncol. 2009;10:687-696",
                pmid: "19767089",
                guideline: { name: "NCCN", url: "https://www.nccn.org/guidelines/guidelines-detail?category=1&id=1425" }
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "attending",
                question: "What is the role of MRD testing in follicular lymphoma per 2025 guidelines?",
                options: [
                    "Required before initiating any treatment",
                    "Determines eligibility for watch and wait",
                    "Prognostic after frontline therapy; may guide maintenance decisions",
                    "Mandatory for staging purposes"
                ],
                correct: 2,
                explanation: "MRD negativity after frontline FL treatment is associated with improved PFS. Per NCCN 2025, MRD testing can be considered to assess response depth and may inform maintenance rituximab decisions, though not yet standard. PRIMA and GALLIUM trials showed MRD correlates with outcomes.",
                keyPoint: "FL MRD: Prognostic post-treatment, not required for diagnosis. MRD-negative = better PFS. May guide maintenance decisions.",
                citation: "Pott C, et al. Leukemia. 2010;24:1867-1875; NCCN Guidelines 2025",
                pmid: "20882045",
                guideline: { name: "NCCN", url: "https://www.nccn.org/guidelines/guidelines-detail?category=1&id=1480" }
            },
            {
                type: "case",
                typeLabel: "Clinical Case",
                difficulty: "attending",
                case: {
                    presentation: "A 55-year-old woman with relapsed DLBCL after R-CHOP (relapse at 8 months) is referred for CAR-T evaluation. She received R-ICE salvage with PR but relapsed 3 months after auto-SCT.",
                    labs: [
                        { name: "ECOG PS", value: "1", abnormal: false },
                        { name: "LDH", value: "280 U/L", abnormal: true },
                        { name: "Creatinine", value: "0.9 mg/dL", abnormal: false }
                    ]
                },
                question: "Per current guidelines, what are the CAR-T options for this patient?",
                options: [
                    "No CAR-T options available; proceed to allogeneic transplant",
                    "Axicabtagene ciloleucel, tisagenlecleucel, or lisocabtagene maraleucel",
                    "Only tisagenlecleucel is approved for DLBCL",
                    "CAR-T is contraindicated after auto-SCT failure"
                ],
                correct: 1,
                explanation: "Three CD19-directed CAR-T products are FDA-approved for r/r DLBCL after 2 prior lines: axicabtagene ciloleucel (axi-cel), tisagenlecleucel (tisa-cel), and lisocabtagene maraleucel (liso-cel). Post-auto-SCT relapse is a common indication. Each has different manufacturing and toxicity profiles.",
                keyPoint: "3 CAR-T products for r/r DLBCL: Axi-cel, Tisa-cel, Liso-cel. All approved after 2 prior lines including post-auto-SCT relapse.",
                citation: "NCCN B-Cell Lymphomas 2025; Locke FL, et al. Lancet Oncol. 2019;20:31-42",
                pmid: "30518502",
                guideline: { name: "NCCN", url: "https://www.nccn.org/guidelines/guidelines-detail?category=1&id=1480" }
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "attending",
                question: "What is loncastuximab tesirine's mechanism and indication?",
                options: [
                    "CD20xCD3 bispecific for FL",
                    "Anti-CD19 ADC for r/r DLBCL after 2 prior lines",
                    "BTK inhibitor for MCL",
                    "Anti-CD30 ADC for Hodgkin lymphoma"
                ],
                correct: 1,
                explanation: "Loncastuximab tesirine is an anti-CD19 antibody-drug conjugate (ADC) with a pyrrolobenzodiazepine (PBD) dimer payload. Approved for r/r DLBCL after 2 prior systemic therapies. Notable for peripheral edema and effusions (capillary leak-like syndrome).",
                keyPoint: "Loncastuximab = anti-CD19 ADC with PBD payload. Approved for r/r DLBCL 3rd line. Monitor for edema/effusions.",
                citation: "Caimi PF, et al. Lancet Oncol. 2021;22:790-800 (LOTIS-2)",
                pmid: "33989558",
                doi: "10.1016/S1470-2045(21)00139-X"
            },

            // ============ EXPANDED QUESTION BANK ============

            // --- INTERN LEVEL QUESTIONS ---
            {
                type: "simple",
                typeLabel: "Basics",
                difficulty: "intern",
                question: "What is the most common type of non-Hodgkin lymphoma in adults?",
                options: [
                    "Follicular lymphoma",
                    "Diffuse large B-cell lymphoma",
                    "Mantle cell lymphoma",
                    "Burkitt lymphoma"
                ],
                correct: 1,
                explanation: "DLBCL accounts for approximately 30-35% of all NHL cases, making it the most common subtype. Follicular lymphoma is second most common (~20%). DLBCL is aggressive but potentially curable with chemoimmunotherapy.",
                keyPoint: "DLBCL = most common NHL (~30-35%). Aggressive but curable. FL is second most common (~20%).",
                citation: "NCCN B-Cell Lymphomas Guidelines 2025",
                guideline: { name: "NCCN", url: "https://www.nccn.org/professionals/physician_gls/pdf/b-cell.pdf" }
            },
            {
                type: "simple",
                typeLabel: "Basics",
                difficulty: "intern",
                question: "Which of the following are the 'B symptoms' in lymphoma staging?",
                options: [
                    "Bone pain, bleeding, bruising",
                    "Fever >38C, night sweats, weight loss >10%",
                    "Breathlessness, back pain, bilateral edema",
                    "Fatigue, fever, frequent infections"
                ],
                correct: 1,
                explanation: "B symptoms are: unexplained fever >38C, drenching night sweats, and unintentional weight loss >10% of body weight in 6 months. Their presence upstages disease (e.g., Stage IIA becomes IIB) and indicates worse prognosis.",
                keyPoint: "B symptoms: Fever >38C, drenching night sweats, >10% weight loss in 6 months. Indicates worse prognosis.",
                citation: "NCCN Hodgkin Lymphoma Guidelines 2025",
                guideline: { name: "NCCN", url: "https://www.nccn.org/professionals/physician_gls/pdf/hodgkins.pdf" }
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "intern",
                question: "What is the standard treatment approach for early-stage (I-II) classical Hodgkin lymphoma with favorable features?",
                options: [
                    "Radiation therapy alone",
                    "Combined modality: ABVD x 2-4 cycles + involved-site radiation",
                    "ABVD x 6 cycles without radiation",
                    "High-dose chemotherapy with stem cell transplant"
                ],
                correct: 1,
                explanation: "Early-stage favorable Hodgkin lymphoma is treated with combined modality therapy: 2-4 cycles of ABVD followed by involved-site radiation therapy (ISRT). This approach balances efficacy with minimizing long-term toxicities.",
                keyPoint: "Early favorable HL: ABVD x 2-4 + ISRT. PET-adapted approaches may omit RT if PET-negative after 2 cycles.",
                citation: "NCCN Hodgkin Lymphoma Guidelines 2025",
                guideline: { name: "NCCN", url: "https://www.nccn.org/professionals/physician_gls/pdf/hodgkins.pdf" }
            },
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "intern",
                question: "What imaging modality is preferred for initial staging of lymphoma?",
                options: [
                    "CT scan with contrast",
                    "PET/CT scan",
                    "MRI",
                    "Ultrasound"
                ],
                correct: 1,
                explanation: "PET/CT is the preferred imaging modality for staging most lymphomas (especially DLBCL, HL, FL). It provides both anatomic and metabolic information, detecting disease that may be missed on CT alone. PET is also used for response assessment.",
                keyPoint: "PET/CT = preferred for lymphoma staging and response assessment. More sensitive than CT alone.",
                citation: "NCCN Guidelines 2025; Cheson BD, et al. J Clin Oncol. 2014;32:3059-3068",
                pmid: "25113753",
                guideline: { name: "NCCN", url: "https://www.nccn.org/guidelines/guidelines-detail?category=1&id=1480" }
            },
            {
                type: "simple",
                typeLabel: "Basics",
                difficulty: "intern",
                question: "What is rituximab's mechanism of action?",
                options: [
                    "BTK inhibitor",
                    "Anti-CD20 monoclonal antibody",
                    "Anti-CD30 antibody-drug conjugate",
                    "Proteasome inhibitor"
                ],
                correct: 1,
                explanation: "Rituximab is a chimeric anti-CD20 monoclonal antibody that targets the CD20 antigen on B-cells. It works through antibody-dependent cellular cytotoxicity (ADCC), complement-dependent cytotoxicity (CDC), and direct apoptosis induction.",
                keyPoint: "Rituximab = anti-CD20 mAb. Backbone of B-cell lymphoma treatment. Works via ADCC, CDC, direct apoptosis.",
                citation: "Maloney DG, et al. Blood. 1997;90:2188-2195",
                pmid: "9310469",
                doi: "10.1182/blood.V90.6.2188"
            },
            {
                type: "simple",
                typeLabel: "Basics",
                difficulty: "intern",
                question: "What does 'R-CHOP' stand for?",
                options: [
                    "Rituximab, Cyclophosphamide, Hydroxydaunorubicin, Oncovin, Prednisone",
                    "Rituximab, Carboplatin, Hydroxyurea, Oxaliplatin, Paclitaxel",
                    "Rituximab, Cisplatin, Hydrocortisone, Ondansetron, Pemetrexed",
                    "Rituximab, Cladribine, Herceptin, Ofatumumab, Pembrolizumab"
                ],
                correct: 0,
                explanation: "R-CHOP: Rituximab, Cyclophosphamide, Hydroxydaunorubicin (doxorubicin), Oncovin (vincristine), Prednisone. This is the standard frontline regimen for DLBCL and other aggressive B-cell lymphomas. Given every 21 days for 6 cycles.",
                keyPoint: "R-CHOP = Rituximab + CHOP. Standard for DLBCL. Every 21 days x 6 cycles.",
                citation: "Coiffier B, et al. N Engl J Med. 2002;346:235-242",
                pmid: "11807147",
                doi: "10.1056/NEJMoa011795"
            },
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "intern",
                question: "Which cell is pathognomonic for classical Hodgkin lymphoma?",
                options: [
                    "Szary cell",
                    "Reed-Sternberg cell",
                    "Flame cell",
                    "Hairy cell"
                ],
                correct: 1,
                explanation: "Reed-Sternberg cells are the malignant cells of classical Hodgkin lymphoma. They are large, binucleated cells with prominent nucleoli giving an 'owl eye' appearance. They are CD15+ and CD30+, but typically CD20- and CD45-.",
                keyPoint: "Reed-Sternberg cells = Hodgkin lymphoma. 'Owl eye' nucleoli. CD15+, CD30+, CD20-, CD45-.",
                citation: "Swerdlow SH, et al. WHO Classification of Tumours of Haematopoietic and Lymphoid Tissues. 2017",
                url: "https://publications.iarc.who.int/Book-And-Report-Series/Who-Classification-Of-Tumours/WHO-Classification-Of-Tumours-Of-Haematopoietic-And-Lymphoid-Tissues-2017"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "intern",
                question: "When is 'watch and wait' an appropriate strategy in lymphoma?",
                options: [
                    "Aggressive DLBCL",
                    "Asymptomatic, low tumor burden follicular lymphoma",
                    "Burkitt lymphoma",
                    "Primary mediastinal B-cell lymphoma"
                ],
                correct: 1,
                explanation: "Watch and wait (active surveillance) is appropriate for asymptomatic, low tumor burden indolent lymphomas like follicular lymphoma. There is no survival benefit to early treatment in asymptomatic patients. Treatment is initiated when symptoms develop or tumor burden increases.",
                keyPoint: "Watch and wait for asymptomatic indolent lymphomas (FL, MZL). No survival benefit to early treatment. Treat when symptomatic.",
                citation: "Ardeshna KM, et al. Lancet Oncol. 2014;15:424-435",
                pmid: "24602760",
                doi: "10.1016/S1470-2045(14)70027-0"
            },
            {
                type: "simple",
                typeLabel: "Basics",
                difficulty: "intern",
                question: "What is the Ann Arbor staging system used for?",
                options: [
                    "Grading lymphoma aggressiveness",
                    "Staging lymphoma extent of disease",
                    "Predicting response to chemotherapy",
                    "Determining bone marrow involvement"
                ],
                correct: 1,
                explanation: "Ann Arbor staging classifies lymphoma by anatomic extent: Stage I (single nodal region), Stage II (2 regions same side of diaphragm), Stage III (both sides of diaphragm), Stage IV (extranodal involvement). Modified with A/B for symptoms, E for extranodal extension.",
                keyPoint: "Ann Arbor: I=1 region, II=2 same side, III=both sides diaphragm, IV=extranodal. A=no symptoms, B=symptoms.",
                citation: "Carbone PP, et al. Cancer Res. 1971;31:1860-1861",
                pmid: "5121694"
            },
            {
                type: "simple",
                typeLabel: "Basics",
                difficulty: "intern",
                question: "Which lymphoma subtype is associated with EBV infection?",
                options: [
                    "Follicular lymphoma",
                    "Endemic Burkitt lymphoma",
                    "Mantle cell lymphoma",
                    "Marginal zone lymphoma"
                ],
                correct: 1,
                explanation: "Endemic Burkitt lymphoma (African form) is strongly associated with EBV infection (~95% EBV+). EBV is also associated with some cases of Hodgkin lymphoma, post-transplant lymphoproliferative disorder (PTLD), and NK/T-cell lymphoma.",
                keyPoint: "EBV associated: Endemic Burkitt (~95%), some HL, PTLD, NK/T-cell lymphoma.",
                citation: "Thorley-Lawson DA, Allday MJ. J Natl Cancer Inst. 2008;100:1339-1341",
                pmid: "18812545",
                doi: "10.1093/jnci/djn300"
            },

            // --- RESIDENT LEVEL QUESTIONS ---
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "resident",
                question: "A patient with follicular lymphoma undergoes transformation. What is the most common histologic transformation?",
                options: [
                    "Hodgkin lymphoma",
                    "Diffuse large B-cell lymphoma",
                    "Burkitt lymphoma",
                    "Mantle cell lymphoma"
                ],
                correct: 1,
                explanation: "Histologic transformation of follicular lymphoma most commonly results in DLBCL, occurring in approximately 2-3% of patients per year. Transformed FL has a worse prognosis than de novo DLBCL.",
                keyPoint: "FL transforms to DLBCL most commonly (~2-3%/year). Suspect with rapid growth, B symptoms, rising LDH.",
                citation: "Al-Tourah AJ, et al. J Clin Oncol. 2008;26:5165-5169",
                pmid: "18838711",
                doi: "10.1200/JCO.2008.16.0283"
            },
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "resident",
                question: "What genetic abnormality is characteristic of follicular lymphoma?",
                options: [
                    "t(8;14) - MYC/IGH",
                    "t(14;18) - BCL2/IGH",
                    "t(11;14) - CCND1/IGH",
                    "t(9;22) - BCR/ABL"
                ],
                correct: 1,
                explanation: "The t(14;18) translocation, present in ~85% of FL cases, juxtaposes BCL2 to the IGH locus, causing BCL2 overexpression and resistance to apoptosis. This is the hallmark of FL and can be detected by FISH or PCR.",
                keyPoint: "FL: t(14;18) BCL2/IGH in ~85%. BCL2 overexpression = anti-apoptotic. MCL has t(11;14), Burkitt has t(8;14).",
                citation: "Horsman DE, et al. Genes Chromosomes Cancer. 1995;14:294-300",
                pmid: "8605177",
                doi: "10.1002/gcc.2870140408"
            },
            {
                type: "simple",
                typeLabel: "Prognosis",
                difficulty: "resident",
                question: "What factors are included in the International Prognostic Index (IPI) for DLBCL?",
                options: [
                    "Age, stage, LDH, hemoglobin, albumin",
                    "Age, stage, LDH, ECOG PS, extranodal sites",
                    "Age, B symptoms, bulky disease, histology",
                    "Stage, LDH, beta-2 microglobulin, cytogenetics"
                ],
                correct: 1,
                explanation: "IPI factors (1 point each): Age >60, Stage III-IV, Elevated LDH, ECOG PS 2, >1 extranodal site. Risk groups: Low (0-1), Low-intermediate (2), High-intermediate (3), High (4-5). Guides prognosis and treatment intensity.",
                keyPoint: "IPI = Age >60, Stage III-IV, LDH, ECOG 2, >1 extranodal. Score 0-5. Guides DLBCL prognosis.",
                citation: "International NHL Prognostic Factors Project. N Engl J Med. 1993;329:987-994",
                pmid: "8141877",
                doi: "10.1056/NEJM199309303291402"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "resident",
                question: "What is the role of maintenance rituximab in follicular lymphoma?",
                options: [
                    "Not recommended due to lack of benefit",
                    "Prolongs progression-free survival after induction",
                    "Only used after autologous transplant",
                    "Replaces consolidation radiation"
                ],
                correct: 1,
                explanation: "Maintenance rituximab every 2 months for 2 years after responding to induction significantly prolongs PFS in FL (PRIMA trial). It does not clearly improve OS. It's recommended as an option after R-chemo induction for responding patients.",
                keyPoint: "Maintenance rituximab x 2 years improves PFS in FL (PRIMA). Given q2 months. OS benefit less clear.",
                citation: "Salles G, et al. Lancet. 2011;377:42-51 (PRIMA)",
                pmid: "21176949",
                doi: "10.1016/S0140-6736(10)62175-7"
            },
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "resident",
                question: "What is the characteristic immunophenotype of mantle cell lymphoma?",
                options: [
                    "CD5+, CD10+, CD23+",
                    "CD5+, CD10-, CD23-, Cyclin D1+",
                    "CD5-, CD10+, BCL6+",
                    "CD5-, CD23+, CD43-"
                ],
                correct: 1,
                explanation: "MCL: CD5+, CD10-, CD23- (unlike CLL which is CD23+), Cyclin D1+ (due to t(11;14)), CD20+. The CD5+/CD23-/Cyclin D1+ pattern distinguishes MCL from CLL/SLL. SOX11 positivity helps in Cyclin D1-negative cases.",
                keyPoint: "MCL: CD5+, CD23-, Cyclin D1+, t(11;14). CLL: CD5+, CD23+. Cyclin D1 distinguishes them.",
                citation: "Swerdlow SH, et al. Blood. 2016;127:2375-2390 (WHO Classification)",
                pmid: "26980727",
                doi: "10.1182/blood-2016-01-643569"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "resident",
                question: "What is the treatment of choice for limited-stage gastric MALT lymphoma associated with H. pylori?",
                options: [
                    "R-CHOP chemotherapy",
                    "H. pylori eradication therapy",
                    "Gastrectomy",
                    "Radiation therapy alone"
                ],
                correct: 1,
                explanation: "H. pylori-positive gastric MALT lymphoma is treated with antibiotics for H. pylori eradication (triple or quadruple therapy). Complete remission occurs in 60-80% of localized cases. H. pylori-negative or refractory cases require radiation or chemoimmunotherapy.",
                keyPoint: "H. pylori+ gastric MALT: Antibiotic eradication first. 60-80% CR. RT or chemo for H. pylori-negative or refractory.",
                citation: "Wndisch T, et al. J Clin Oncol. 2005;23:8018-8024",
                pmid: "16204012",
                doi: "10.1200/JCO.2005.02.3903"
            },
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "resident",
                question: "What distinguishes nodular lymphocyte-predominant Hodgkin lymphoma (NLPHL) from classical HL?",
                options: [
                    "Presence of Reed-Sternberg cells",
                    "CD15+/CD30+ immunophenotype",
                    "LP cells that are CD20+/CD45+, CD15-/CD30-",
                    "More aggressive clinical course"
                ],
                correct: 2,
                explanation: "NLPHL has 'popcorn' or LP (lymphocyte-predominant) cells that are CD20+, CD45+, BCL6+, but CD15- and CD30- (opposite of classical HL). NLPHL is more indolent, can be observed if asymptomatic, and may transform to T-cell rich DLBCL.",
                keyPoint: "NLPHL: CD20+, CD45+, CD15-, CD30-. 'Popcorn' cells. More indolent than classical HL. May transform to DLBCL.",
                citation: "Swerdlow SH, et al. Blood. 2016;127:2375-2390 (WHO Classification)",
                pmid: "26980727",
                doi: "10.1182/blood-2016-01-643569"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "resident",
                question: "What is the preferred frontline regimen for young, fit patients with mantle cell lymphoma?",
                options: [
                    "R-CHOP x 6 cycles",
                    "Intensive chemoimmunotherapy followed by autologous stem cell transplant",
                    "Ibrutinib monotherapy",
                    "Bendamustine-rituximab"
                ],
                correct: 1,
                explanation: "Young, fit MCL patients benefit from intensive induction (e.g., R-DHAP/R-CHOP alternating, Nordic regimen, or R-HyperCVAD) followed by ASCT consolidation. This approach achieves durable remissions. Older/unfit patients receive less intensive therapy.",
                keyPoint: "Young fit MCL: Intensive chemo  ASCT consolidation. Older/unfit: BR or VR-CAP. Rituximab maintenance improves outcomes.",
                citation: "Hermine O, et al. Lancet. 2016;388:565-575",
                pmid: "27313086",
                doi: "10.1016/S0140-6736(16)00739-X"
            },
            {
                type: "simple",
                typeLabel: "Complications",
                difficulty: "resident",
                question: "What is the most common cardiac toxicity associated with doxorubicin (used in CHOP)?",
                options: [
                    "Arrhythmias during infusion",
                    "Dose-dependent cardiomyopathy",
                    "Pericarditis",
                    "Coronary artery spasm"
                ],
                correct: 1,
                explanation: "Doxorubicin causes dose-dependent cardiomyopathy. Risk increases significantly above cumulative doses of 400-450 mg/m. Baseline and surveillance echocardiograms are recommended. Liposomal formulations and dexrazoxane may reduce risk.",
                keyPoint: "Doxorubicin: Dose-dependent cardiomyopathy. Risk  above 400-450 mg/m cumulative. Monitor with echo.",
                citation: "Volkova M, Russell R. Curr Cardiol Rep. 2011;13:265-273",
                pmid: "21432662",
                doi: "10.1007/s11886-011-0184-3"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "resident",
                question: "What is the Deauville score used for?",
                options: [
                    "Lymphoma staging at diagnosis",
                    "PET response assessment using 5-point scale",
                    "Predicting transformation risk",
                    "Calculating chemotherapy doses"
                ],
                correct: 1,
                explanation: "Deauville score (1-5) standardizes PET response assessment: 1=no uptake, 2=uptake mediastinum, 3=uptake >mediastinum but liver, 4=uptake moderately >liver, 5=markedly >liver or new lesions. Scores 1-3 typically indicate good response.",
                keyPoint: "Deauville 1-5 for PET response. 1-3 = good response (CMR). 4-5 = residual disease. Uses liver/mediastinum as references.",
                citation: "Meignan M, et al. Leuk Lymphoma. 2014;55:31-37",
                pmid: "23763460",
                doi: "10.3109/10428194.2013.792777"
            },
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "resident",
                question: "Which lymphoma is associated with autoimmune hemolytic anemia (AIHA)?",
                options: [
                    "Hodgkin lymphoma",
                    "CLL/SLL",
                    "Burkitt lymphoma",
                    "Primary mediastinal B-cell lymphoma"
                ],
                correct: 1,
                explanation: "CLL/SLL is strongly associated with autoimmune cytopenias including AIHA (10-25% of patients), immune thrombocytopenia, and pure red cell aplasia. Treatment includes steroids and treating the underlying CLL. Rituximab can sometimes trigger AIHA flares in CLL.",
                keyPoint: "CLL: Associated with AIHA, ITP, PRCA. 10-25% develop autoimmune cytopenias. Treat with steroids  CLL-directed therapy.",
                citation: "Hodgson K, et al. Blood. 2006;108:3122-3127",
                url: "https://scholar.google.com/scholar?q=Hodgson+K+Blood+2006+CLL+autoimmune"
            },

            // --- FELLOW LEVEL QUESTIONS ---
            {
                type: "case",
                typeLabel: "Clinical Case",
                difficulty: "fellow",
                case: {
                    presentation: "A 45-year-old man presents with rapidly enlarging cervical lymphadenopathy, jaw pain, and a 2-week history of night sweats. CT shows bulky adenopathy with areas of necrosis. Biopsy reveals medium-sized cells with basophilic cytoplasm, round nuclei with multiple nucleoli, and numerous mitotic figures. A 'starry sky' pattern is noted. Flow: CD20+, CD10+, BCL6+, BCL2-, Ki-67 >95%.",
                    labs: [
                        { name: "LDH", value: "1,250 U/L", abnormal: true },
                        { name: "Uric acid", value: "12.5 mg/dL", abnormal: true },
                        { name: "Phosphorus", value: "6.2 mg/dL", abnormal: true },
                        { name: "Creatinine", value: "1.8 mg/dL", abnormal: true }
                    ],
                    histopath: {
                        type: "burkitt",
                        description: "Starry sky pattern with medium-sized cells, high mitotic rate, and tingible body macrophages",
                        source: "Pathology Outlines"
                    }
                },
                question: "What is the most critical immediate management step before initiating chemotherapy?",
                options: [
                    "Start R-CHOP immediately",
                    "Aggressive tumor lysis syndrome prophylaxis and hydration",
                    "Bone marrow biopsy before any treatment",
                    "PET scan for complete staging"
                ],
                correct: 1,
                explanation: "This is Burkitt lymphoma. The lab abnormalities indicate impending TLS. Aggressive TLS prophylaxis (hydration, rasburicase, allopurinol) is critical BEFORE chemotherapy. Burkitt requires intensive regimens, not R-CHOP.",
                keyPoint: "Burkitt = TLS emergency. Ki-67 >95%, BCL2-. Requires TLS prophylaxis BEFORE chemo and intensive regimens.",
                citation: "NCCN B-Cell Lymphomas 2025; Cairo MS, Bishop M. Br J Haematol. 2004;127:3-11",
                pmid: "15384972"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "fellow",
                question: "What is the mechanism of action of polatuzumab vedotin?",
                options: [
                    "CD20xCD3 bispecific antibody",
                    "Anti-CD79b antibody-drug conjugate with MMAE payload",
                    "BTK inhibitor",
                    "BCL2 inhibitor"
                ],
                correct: 1,
                explanation: "Polatuzumab vedotin is an anti-CD79b antibody conjugated to MMAE (monomethyl auristatin E), a microtubule-disrupting agent. It's part of Pola-R-CHP, now preferred frontline for IPI 2 DLBCL (POLARIX trial).",
                keyPoint: "Polatuzumab = anti-CD79b ADC with MMAE. Part of Pola-R-CHP for frontline DLBCL with IPI 2.",
                citation: "Tilly H, et al. N Engl J Med. 2022;386:351-363 (POLARIX)",
                pmid: "34904799",
                doi: "10.1056/NEJMoa2115304"
            },
            {
                type: "simple",
                typeLabel: "Complications",
                difficulty: "fellow",
                question: "What is the pathognomonic finding in cytokine release syndrome (CRS) after CAR-T therapy?",
                options: [
                    "Elevated procalcitonin",
                    "Markedly elevated ferritin and IL-6",
                    "Positive blood cultures",
                    "Elevated BNP"
                ],
                correct: 1,
                explanation: "CRS is characterized by massive cytokine release, particularly IL-6, with very high ferritin levels (often >10,000). Other markers include elevated CRP, d-dimer, and hypofibrinogenemia. Tocilizumab (anti-IL-6R) is the treatment for moderate-severe CRS.",
                keyPoint: "CRS: Very high ferritin, elevated IL-6. Treat with tocilizumab (anti-IL-6R). Differentiate from infection (CRS ferritin often >10,000).",
                citation: "Lee DW, et al. Biol Blood Marrow Transplant. 2019;25:625-638",
                pmid: "30592986",
                doi: "10.1016/j.bbmt.2018.12.758"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "fellow",
                question: "What is the target of ibrutinib?",
                options: [
                    "PI3 kinase delta",
                    "Bruton's tyrosine kinase (BTK)",
                    "BCL2",
                    "EZH2"
                ],
                correct: 1,
                explanation: "Ibrutinib is a covalent BTK inhibitor that blocks B-cell receptor signaling. It's approved for CLL, MCL, marginal zone lymphoma, and Waldenstrm's. Notable toxicities include atrial fibrillation, bleeding, and infections.",
                keyPoint: "Ibrutinib = BTK inhibitor. Used in CLL, MCL, MZL, WM. Watch for AFib, bleeding, infections.",
                citation: "Byrd JC, et al. N Engl J Med. 2013;369:32-42",
                pmid: "23782158",
                doi: "10.1056/NEJMoa1215637"
            },
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "fellow",
                question: "What defines 'double-hit' lymphoma?",
                options: [
                    "Relapse within 12 months of initial treatment",
                    "MYC rearrangement plus BCL2 and/or BCL6 rearrangement",
                    "Transformation from two different indolent lymphomas",
                    "Concurrent Hodgkin and non-Hodgkin lymphoma"
                ],
                correct: 1,
                explanation: "Double-hit lymphoma (now called high-grade B-cell lymphoma) has MYC rearrangement PLUS BCL2 and/or BCL6 rearrangement. Triple-hit has all three. These have aggressive behavior and poor prognosis with R-CHOP; often treated with DA-EPOCH-R.",
                keyPoint: "Double-hit: MYC + BCL2/BCL6 rearrangements. Poor prognosis. Treat with DA-EPOCH-R, not R-CHOP.",
                citation: "Petrich AM, et al. Blood. 2014;124:2354-2361",
                pmid: "25161267",
                doi: "10.1182/blood-2014-05-578963"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "fellow",
                question: "What is the role of venetoclax in CLL?",
                options: [
                    "First-line monotherapy for all patients",
                    "BCL2 inhibitor used with obinutuzumab or rituximab",
                    "Reserved only for TP53-mutated disease",
                    "Used only after failure of three prior lines"
                ],
                correct: 1,
                explanation: "Venetoclax is a BCL2 inhibitor used in CLL with obinutuzumab (frontline) or rituximab (relapsed). It enables time-limited therapy with deep MRD-negative responses. Requires tumor lysis prophylaxis and ramp-up dosing.",
                keyPoint: "Venetoclax = BCL2 inhibitor. Time-limited therapy in CLL. Requires TLS prophylaxis and dose ramp-up.",
                citation: "Fischer K, et al. N Engl J Med. 2019;380:2225-2236 (CLL14)",
                pmid: "31166681",
                doi: "10.1056/NEJMoa1815281"
            },
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "fellow",
                question: "What mutation defines hairy cell leukemia?",
                options: [
                    "JAK2 V617F",
                    "BRAF V600E",
                    "CALR mutation",
                    "NPM1 mutation"
                ],
                correct: 1,
                explanation: "BRAF V600E mutation is present in virtually all classical hairy cell leukemia cases (~100%). It can be detected by PCR or IHC. This mutation is the basis for vemurafenib therapy in relapsed/refractory HCL.",
                keyPoint: "Hairy cell leukemia: BRAF V600E in ~100%. CD25+, CD103+, CD11c+, CD123+. Treat with cladribine or pentostatin.",
                citation: "Tiacci E, et al. N Engl J Med. 2011;364:2305-2315",
                pmid: "21663470",
                doi: "10.1056/NEJMoa1014209"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "fellow",
                question: "What is the preferred treatment for relapsed/refractory follicular lymphoma after multiple prior therapies?",
                options: [
                    "R-CHOP",
                    "CAR-T therapy (axicabtagene ciloleucel) or bispecific antibodies",
                    "Radiation therapy alone",
                    "Best supportive care only"
                ],
                correct: 1,
                explanation: "For heavily pretreated r/r FL, options include CAR-T (axi-cel approved after 2 prior lines), bispecifics (mosunetuzumab), PI3K inhibitors, and tazemetostat (EZH2 inhibitor). CAR-T shows high response rates in this setting.",
                keyPoint: "r/r FL after multiple lines: CAR-T, bispecifics, PI3Ki, tazemetostat. Axi-cel approved after 2 prior lines.",
                citation: "Jacobson CA, et al. Lancet Oncol. 2022;23:91-103 (ZUMA-5)",
                pmid: "34895487",
                doi: "10.1016/S1470-2045(21)00591-X"
            },
            {
                type: "simple",
                typeLabel: "Prognosis",
                difficulty: "fellow",
                question: "What is the FLIPI score used for?",
                options: [
                    "Staging primary CNS lymphoma",
                    "Prognostication in follicular lymphoma",
                    "Response assessment in Hodgkin lymphoma",
                    "CAR-T eligibility determination"
                ],
                correct: 1,
                explanation: "FLIPI (Follicular Lymphoma International Prognostic Index) uses: Age >60, Stage III-IV, Hgb <12, LDH elevated, >4 nodal areas. FLIPI-2 adds 2-microglobulin and bone marrow involvement. Guides prognosis but doesn't determine treatment.",
                keyPoint: "FLIPI: Age >60, Stage III-IV, Hgb <12, LDH, >4 nodal areas. Low (0-1), Int (2), High (3-5) risk.",
                citation: "Solal-Cligny P, et al. Blood. 2004;104:1258-1265",
                pmid: "15126323",
                doi: "10.1182/blood-2003-12-4434"
            },
            {
                type: "case",
                typeLabel: "Clinical Case",
                difficulty: "fellow",
                case: {
                    presentation: "A 70-year-old woman with CLL on ibrutinib for 3 years develops sudden onset confusion and right-sided weakness. MRI brain shows multiple ring-enhancing lesions. CSF analysis shows atypical cells. EBV PCR is positive at 50,000 copies/mL.",
                    labs: [
                        { name: "WBC", value: "3,200/L", abnormal: true },
                        { name: "ALC", value: "1,100/L", abnormal: true },
                        { name: "LDH", value: "380 U/L", abnormal: true },
                        { name: "CSF protein", value: "120 mg/dL", abnormal: true }
                    ]
                },
                question: "What is the most likely diagnosis?",
                options: [
                    "Richter transformation to DLBCL",
                    "Progressive multifocal leukoencephalopathy (PML)",
                    "CNS involvement by CLL",
                    "Primary CNS lymphoma or EBV-associated CNS lymphoproliferative disorder"
                ],
                correct: 3,
                explanation: "Ring-enhancing lesions with high EBV viral load in an immunocompromised patient suggests EBV-driven CNS lymphoproliferative disorder or primary CNS lymphoma. BTK inhibitors cause immunosuppression and increase opportunistic infection risk including EBV reactivation.",
                keyPoint: "Ring-enhancing CNS lesions + high EBV in immunocompromised = suspect EBV-driven lymphoma/LPD. BTK inhibitors increase infection risk.",
                citation: "Mato AR, et al. Haematologica. 2018;103:874-879",
                pmid: "29419436",
                doi: "10.3324/haematol.2017.182907"
            },

            // --- ATTENDING LEVEL QUESTIONS ---
            {
                type: "case",
                typeLabel: "Clinical Case",
                difficulty: "attending",
                case: {
                    presentation: "A 62-year-old man with DLBCL achieves CR after Pola-R-CHP. PET at end of treatment shows Deauville 2. Eighteen months later, surveillance labs show rising LDH. Repeat PET shows new FDG-avid inguinal nodes. Biopsy confirms relapsed DLBCL.",
                    labs: [
                        { name: "LDH", value: "340 U/L", abnormal: true },
                        { name: "ECOG PS", value: "0", abnormal: false },
                        { name: "Creatinine", value: "1.0 mg/dL", abnormal: false },
                        { name: "Time from CR", value: "18 months", abnormal: false }
                    ]
                },
                question: "Per 2025 guidelines, what is the recommended treatment approach?",
                options: [
                    "Repeat Pola-R-CHP",
                    "Salvage chemotherapy (R-ICE/R-DHAP) with intent to auto-SCT if chemosensitive",
                    "Best supportive care",
                    "Immediate allogeneic transplant"
                ],
                correct: 1,
                explanation: "For relapsed DLBCL >12 months after initial CR in transplant-eligible patients, salvage chemoimmunotherapy followed by autologous SCT consolidation remains standard. CAR-T is also an option, especially for primary refractory or early relapse. Late relapse (>12 months) has better outcomes with salvage/ASCT.",
                keyPoint: "Relapsed DLBCL, transplant-eligible: Salvage chemo  ASCT (late relapse) or CAR-T. Early relapse (<12mo) = consider CAR-T first.",
                citation: "NCCN B-Cell Lymphomas 2025; Gisselbrecht C, et al. J Clin Oncol. 2010;28:4184-4190",
                pmid: "20660832",
                guideline: { name: "NCCN", url: "https://www.nccn.org/guidelines/guidelines-detail?category=1&id=1480" }
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "attending",
                question: "What is the significance of TP53 mutation in CLL?",
                options: [
                    "Indicates excellent response to FCR",
                    "Predicts resistance to chemoimmunotherapy; prefer novel agents",
                    "Determines eligibility for transplant",
                    "Associated with indolent disease course"
                ],
                correct: 1,
                explanation: "TP53 mutation/deletion (17p-) predicts resistance to chemoimmunotherapy (FCR, BR). These patients should receive BTK inhibitors or venetoclax-based regimens. TP53 testing is mandatory before CLL treatment selection.",
                keyPoint: "TP53 mutation/17p-: Chemo-resistant. Use BTK inhibitors or venetoclax. Test TP53 before all CLL treatment decisions.",
                citation: "Hallek M, et al. Blood. 2018;131:2745-2760",
                pmid: "29540348",
                doi: "10.1182/blood-2017-09-806398"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "attending",
                question: "What bridging therapy considerations exist before CAR-T for DLBCL?",
                options: [
                    "Bridging is contraindicated before CAR-T",
                    "Bridging should reduce tumor bulk but preserve lymphocytes for collection",
                    "High-dose steroids are preferred bridging",
                    "Bridging always improves CAR-T outcomes"
                ],
                correct: 1,
                explanation: "Bridging therapy between leukapheresis and CAR-T infusion may be needed for disease control. Goals: reduce tumor bulk, prevent clinical deterioration, but avoid excessive lymphodepletion. Options include radiation, steroids, or low-intensity chemo. High tumor burden at infusion correlates with worse outcomes.",
                keyPoint: "CAR-T bridging: Control disease, avoid excess lymphodepletion. High tumor burden at infusion = worse outcomes. Options: RT, steroids, low-intensity chemo.",
                citation: "Nastoupil LJ, et al. J Clin Oncol. 2020;38:3119-3128",
                pmid: "32401634",
                doi: "10.1200/JCO.19.02104"
            },
            {
                type: "simple",
                typeLabel: "Complications",
                difficulty: "attending",
                question: "What is ICANS and how is it managed?",
                options: [
                    "Infusion reaction treated with antihistamines",
                    "Immune effector cell-associated neurotoxicity; managed with steroids",
                    "Cardiac toxicity; managed with beta-blockers",
                    "Tumor lysis syndrome; managed with rasburicase"
                ],
                correct: 1,
                explanation: "ICANS (Immune effector Cell-Associated Neurotoxicity Syndrome) occurs after CAR-T or bispecific therapy. Symptoms: confusion, aphasia, tremor, seizures, cerebral edema. Graded 1-4. Management: supportive care (grade 1), dexamethasone (grade 2). Unlike CRS, tocilizumab less effective for ICANS.",
                keyPoint: "ICANS: Neurotoxicity after CAR-T/bispecifics. Confusion, aphasia, seizures. Treat with steroids (dexamethasone). Tocilizumab less effective than for CRS.",
                citation: "Lee DW, et al. Biol Blood Marrow Transplant. 2019;25:625-638",
                pmid: "30592986",
                doi: "10.1016/j.bbmt.2018.12.758"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "attending",
                question: "What is the role of radiation in DLBCL?",
                options: [
                    "Never used in DLBCL treatment",
                    "Consolidation for bulky disease or partial response; limited-stage disease",
                    "First-line treatment replacing chemotherapy",
                    "Only for palliation"
                ],
                correct: 1,
                explanation: "Radiation in DLBCL: consolidation for initially bulky disease (7.5-10 cm), partial response to chemo, or selected limited-stage disease. UNFOLDER trial showed benefit for bulky disease. Also used for localized relapse or palliation.",
                keyPoint: "DLBCL RT: Consolidation for bulky disease (7.5cm), PR after chemo, or limited-stage. Not needed for all patients achieving CMR.",
                citation: "Held G, et al. J Clin Oncol. 2014;32:1112-1118",
                pmid: "24493716",
                doi: "10.1200/JCO.2013.51.4505"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "attending",
                question: "What distinguishes glofitamab from other CD20xCD3 bispecifics?",
                options: [
                    "Subcutaneous administration only",
                    "Novel 2:1 format with two CD20 binding sites; step-up dosing; fixed duration",
                    "Oral formulation available",
                    "No risk of CRS"
                ],
                correct: 1,
                explanation: "Glofitamab has a unique 2:1 structure with two CD20 binding sites and one CD3 site, providing stronger CD20 binding. Given IV with step-up dosing to mitigate CRS. Fixed 12-cycle duration. Obinutuzumab pre-treatment required.",
                keyPoint: "Glofitamab: 2:1 bispecific (2 CD20 sites). Step-up dosing. Fixed 12 cycles. Obinutuzumab pretreatment. IV administration.",
                citation: "Dickinson MJ, et al. N Engl J Med. 2022;387:2220-2231",
                pmid: "36507690",
                doi: "10.1056/NEJMoa2206913"
            },
            {
                type: "simple",
                typeLabel: "Prognosis",
                difficulty: "attending",
                question: "What is the significance of MYC expression by IHC in DLBCL without MYC rearrangement?",
                options: [
                    "No prognostic significance",
                    "MYC protein overexpression (40%) is a poor prognostic factor even without rearrangement",
                    "Indicates better response to R-CHOP",
                    "Requires ASCT in first remission"
                ],
                correct: 1,
                explanation: "MYC protein overexpression (40%) by IHC, with or without BCL2 co-expression ('double expressor'), confers worse prognosis even without gene rearrangement. Double expressors have outcomes between standard DLBCL and double-hit lymphoma. FISH still needed to rule out rearrangement.",
                keyPoint: "Double expressor: MYC 40% + BCL2 50% by IHC without rearrangement. Worse prognosis than standard DLBCL. Still do FISH for rearrangements.",
                citation: "Johnson NA, et al. J Clin Oncol. 2012;30:3452-3459",
                pmid: "22851565",
                doi: "10.1200/JCO.2011.41.0985"
            },
            {
                type: "case",
                typeLabel: "Clinical Case",
                difficulty: "attending",
                case: {
                    presentation: "A 58-year-old woman with relapsed FL (third relapse) is being considered for CAR-T vs. bispecific antibody therapy. She has had R-CHOP, BR, and lenalidomide-rituximab previously. ECOG PS 1. No significant comorbidities.",
                    labs: [
                        { name: "Creatinine", value: "0.9 mg/dL", abnormal: false },
                        { name: "LDH", value: "220 U/L", abnormal: false },
                        { name: "ALC", value: "1,500/L", abnormal: false },
                        { name: "Prior lines", value: "3", abnormal: true }
                    ]
                },
                question: "What factors would favor CAR-T over bispecific antibody in this setting?",
                options: [
                    "Bispecifics are always preferred over CAR-T",
                    "CAR-T offers one-time treatment vs. ongoing bispecific infusions; may prefer if deep remission desired",
                    "CAR-T has no CRS risk unlike bispecifics",
                    "CAR-T is only for DLBCL, not FL"
                ],
                correct: 1,
                explanation: "CAR-T (axi-cel) is approved for FL after 2 prior lines. Advantages: one-time infusion, no ongoing therapy, potential for durable remission. Bispecifics (mosunetuzumab) offer outpatient option, no leukapheresis wait, but require ongoing dosing. Both have CRS/ICANS risk. Choice depends on patient preference, logistics, disease tempo.",
                keyPoint: "CAR-T vs. bispecific in FL: CAR-T = one-time, durable remission potential. Bispecific = outpatient, no manufacturing wait, ongoing therapy. Both effective.",
                citation: "Jacobson CA, et al. Lancet Oncol. 2022;23:91-103 (ZUMA-5); Budde LE, et al. Lancet Oncol. 2022;23:1055-1065",
                pmid: "34895487",
                doi: "10.1016/S1470-2045(21)00591-X"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "attending",
                question: "What is the zanubrutinib advantage over ibrutinib in CLL?",
                options: [
                    "Completely different mechanism of action",
                    "More selective BTK inhibition with fewer off-target effects (less AFib, bleeding)",
                    "Oral vs. IV administration",
                    "Effective in TP53-mutated CLL unlike ibrutinib"
                ],
                correct: 1,
                explanation: "Zanubrutinib is a more selective next-generation BTK inhibitor with less off-target kinase inhibition (especially ITK, EGFR). ALPINE trial showed superior PFS and fewer cardiac events (AFib) and bleeding compared to ibrutinib in r/r CLL.",
                keyPoint: "Zanubrutinib: More selective BTK inhibitor. Less AFib and bleeding than ibrutinib (ALPINE). Both work in TP53-mutated CLL.",
                citation: "Brown JR, et al. N Engl J Med. 2023;388:319-332 (ALPINE)",
                pmid: "36511784",
                doi: "10.1056/NEJMoa2211582"
            },
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "attending",
                question: "What is the cell of origin classification in DLBCL and its significance?",
                options: [
                    "Determines whether patient needs transplant",
                    "GCB vs. ABC subtypes; ABC historically worse prognosis, may benefit from different therapies",
                    "Only relevant for research purposes",
                    "Replaced entirely by IPI score"
                ],
                correct: 1,
                explanation: "DLBCL is classified as germinal center B-cell (GCB) or activated B-cell (ABC/non-GCB) type by gene expression or Hans algorithm (IHC: CD10, BCL6, MUM1). ABC has worse prognosis with R-CHOP. ABC may benefit from BTK inhibitor addition, though ibrutinib+R-CHOP trials were mixed.",
                keyPoint: "DLBCL COO: GCB vs. ABC (Hans algorithm). ABC = worse prognosis with R-CHOP. ABC may benefit from BTK inhibitors (under investigation).",
                citation: "Alizadeh AA, et al. Nature. 2000;403:503-511",
                pmid: "10676951",
                doi: "10.1038/35000501"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "attending",
                question: "When is CNS prophylaxis indicated in DLBCL?",
                options: [
                    "All DLBCL patients",
                    "High CNS-IPI score (4-6), testicular, breast, kidney, adrenal, or double-hit lymphoma",
                    "Only after relapse",
                    "Never indicated as prophylaxis"
                ],
                correct: 1,
                explanation: "CNS prophylaxis (IT or IV MTX) indicated for: High CNS-IPI (4-6), testicular/breast/kidney/adrenal involvement, epidural disease, double/triple-hit lymphoma. CNS-IPI adds kidney/adrenal involvement to IPI factors. Prophylaxis reduces but doesn't eliminate CNS relapse risk.",
                keyPoint: "DLBCL CNS prophylaxis: High CNS-IPI (4-6), testicular, breast, kidney, adrenal, double-hit. IT or IV MTX. Reduces but doesn't eliminate risk.",
                citation: "Schmitz N, et al. J Clin Oncol. 2016;34:3150-3156 (CNS-IPI)",
                pmid: "27382100",
                doi: "10.1200/JCO.2015.65.6520"
            },

            // ADDITIONAL INTERN LEVEL QUESTIONS
            {
                type: "simple",
                typeLabel: "Basics",
                difficulty: "intern",
                question: "What is the difference between Hodgkin and Non-Hodgkin lymphoma?",
                options: [
                    "Location of disease only",
                    "Hodgkin has Reed-Sternberg cells and typically spreads contiguously; NHL is more diverse with various cell types",
                    "NHL only affects children",
                    "They are the same disease with different names"
                ],
                correct: 1,
                explanation: "Hodgkin lymphoma is defined by Reed-Sternberg cells (CD15+/CD30+) and typically spreads contiguously through lymph nodes. NHL encompasses diverse subtypes (B-cell, T-cell, NK-cell) with varied biology and often non-contiguous spread.",
                keyPoint: "HL = Reed-Sternberg cells, contiguous spread. NHL = diverse subtypes, non-contiguous. Both are lymphomas, very different diseases.",
                citation: "WHO Classification of Tumours of Haematopoietic and Lymphoid Tissues, 5th ed. 2022",
                url: "https://tumourclassification.iarc.who.int/chapters/63"
            },
            {
                type: "simple",
                typeLabel: "Epidemiology",
                difficulty: "intern",
                question: "Which lymphoma has a bimodal age distribution with peaks in young adults and older adults?",
                options: [
                    "Follicular lymphoma",
                    "Classic Hodgkin lymphoma",
                    "Mantle cell lymphoma",
                    "Marginal zone lymphoma"
                ],
                correct: 1,
                explanation: "Classic Hodgkin lymphoma has a bimodal age distribution with peaks at 15-35 years and >55 years. Most other lymphomas increase steadily with age. This bimodal pattern may relate to different etiologies (EBV association varies by age).",
                keyPoint: "cHL: bimodal age peak (15-35 and >55). Most NHL increases with age. MCL = older adults typically.",
                citation: "SEER Cancer Statistics Review",
                url: "https://seer.cancer.gov/statfacts/html/nhl.html"
            },
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "intern",
                question: "Why is excisional biopsy preferred over needle biopsy for lymphoma diagnosis?",
                options: [
                    "Needle biopsies are too painful",
                    "Excisional biopsy preserves architecture needed for accurate subtyping",
                    "Needle biopsies cannot obtain DNA",
                    "Insurance only covers excisional biopsies"
                ],
                correct: 1,
                explanation: "Excisional biopsy preserves lymph node architecture essential for distinguishing subtypes (e.g., follicular pattern, diffuse pattern, Reed-Sternberg cells in proper background). Core needle biopsy may be acceptable when excision is not feasible.",
                keyPoint: "Excisional biopsy preferred: preserves architecture for subtyping. Core needle acceptable if excision not possible. Avoid FNA alone.",
                citation: "NCCN Guidelines B-Cell Lymphomas 2025",
                guideline: { name: "NCCN", url: "https://www.nccn.org/guidelines/guidelines-detail?category=1&id=1480" }
            },
            {
                type: "simple",
                typeLabel: "Workup",
                difficulty: "intern",
                question: "What baseline labs are required before starting lymphoma treatment?",
                options: [
                    "CBC only",
                    "CBC, CMP, LDH, uric acid, hepatitis B screening, HIV screening",
                    "Blood type only",
                    "No labs needed before treatment"
                ],
                correct: 1,
                explanation: "Baseline workup includes CBC (cytopenias), CMP (organ function), LDH (prognostic), uric acid (TLS risk), hepatitis B (reactivation risk with rituximab), and HIV (affects management). Cardiac function testing needed for anthracyclines.",
                keyPoint: "Lymphoma labs: CBC, CMP, LDH, uric acid, HBV, HIV. Echo if anthracyclines planned. HBV crucial for rituximab.",
                citation: "NCCN Guidelines B-Cell Lymphomas 2025",
                guideline: { name: "NCCN", url: "https://www.nccn.org/guidelines/guidelines-detail?category=1&id=1480" }
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "intern",
                question: "What does R-CHOP stand for?",
                options: [
                    "Radiation-Chemotherapy-Hormones-Observation-Prevention",
                    "Rituximab, Cyclophosphamide, Hydroxydaunorubicin (doxorubicin), Oncovin (vincristine), Prednisone",
                    "Rituximab, Carboplatin, Hydroxyurea, Oxaliplatin, Paclitaxel",
                    "Rapid-Course Hematology Oncology Protocol"
                ],
                correct: 1,
                explanation: "R-CHOP: Rituximab (anti-CD20), Cyclophosphamide (alkylator), Hydroxydaunorubicin/doxorubicin (anthracycline), Oncovin/vincristine (vinca alkaloid), Prednisone (steroid). Standard regimen for aggressive B-cell lymphomas.",
                keyPoint: "R-CHOP = Rituximab + Cyclophosphamide + Doxorubicin + Vincristine + Prednisone. Every 21 days. Standard for DLBCL.",
                citation: "Coiffier B, et al. N Engl J Med. 2002;346:235-242",
                pmid: "11807147",
                doi: "10.1056/NEJMoa011795"
            },

            // ADDITIONAL RESIDENT LEVEL QUESTIONS
            {
                type: "simple",
                typeLabel: "Genetics",
                difficulty: "resident",
                question: "What characterizes a 'double-expressor' vs 'double-hit' lymphoma?",
                options: [
                    "They are the same thing",
                    "Double-expressor: MYC + BCL2 protein overexpression. Double-hit: MYC + BCL2/BCL6 genetic rearrangements",
                    "Double-hit affects two lymph node sites",
                    "Double-expressor requires transplant; double-hit does not"
                ],
                correct: 1,
                explanation: "Double-expressor (DE): MYC and BCL2 protein overexpression by IHC (40% of DLBCL, worse prognosis). Double-hit (DH): actual chromosomal rearrangements of MYC plus BCL2 and/or BCL6 (5-10%, very poor prognosis). DH is classified as high-grade B-cell lymphoma.",
                keyPoint: "Double-expressor = IHC protein (worse prognosis). Double-hit = genetic rearrangements (much worse, high-grade). Test both.",
                citation: "Rosenwald A, et al. J Clin Oncol. 2019;37:3359-3368",
                pmid: "31498031",
                doi: "10.1200/JCO.19.00743"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "resident",
                question: "When is radiation therapy used in DLBCL?",
                options: [
                    "Always for all stages",
                    "Consolidation for bulky disease or limited-stage, sites of initial bulk after chemo",
                    "Never used in DLBCL",
                    "Only for relapsed disease"
                ],
                correct: 1,
                explanation: "Radiation is used as consolidation for: limited-stage DLBCL after abbreviated chemo (3-4 cycles), bulky disease sites, or residual PET-positive disease. ISRT (involved-site RT) is preferred over older IFRT. Typically 30-36 Gy.",
                keyPoint: "DLBCL radiation: consolidation for limited stage, bulky sites, residual disease. ISRT 30-36 Gy. Not for all patients.",
                citation: "NCCN Guidelines B-Cell Lymphomas 2025",
                guideline: { name: "NCCN", url: "https://www.nccn.org/guidelines/guidelines-detail?category=1&id=1480" }
            },
            {
                type: "case",
                typeLabel: "Clinical Case",
                difficulty: "resident",
                case: {
                    presentation: "A 55-year-old woman with Stage IV follicular lymphoma, Grade 2. Asymptomatic with multiple small nodes (<2 cm each). No B symptoms, normal LDH, normal hemoglobin.",
                    labs: [
                        { name: "LDH", value: "Normal", abnormal: false },
                        { name: "Hgb", value: "13.5 g/dL", abnormal: false },
                        { name: "Nodes", value: "Multiple <2 cm", abnormal: false }
                    ]
                },
                question: "What is the appropriate initial management?",
                options: [
                    "Immediate R-CHOP chemotherapy",
                    "Watch and wait with regular monitoring",
                    "Autologous stem cell transplant",
                    "Radiation to all nodal sites"
                ],
                correct: 1,
                explanation: "Asymptomatic, low-tumor-burden follicular lymphoma (no GELF criteria) is managed with watch and wait. No survival benefit to early treatment. Monitor every 3-6 months. Treat when symptoms or GELF criteria develop.",
                keyPoint: "Asymptomatic FL without GELF criteria: watch and wait. No survival benefit to early treatment. Follow closely.",
                citation: "Ardeshna KM, et al. Lancet Oncol. 2014;15:424-435",
                pmid: "24602760",
                doi: "10.1016/S1470-2045(14)70027-0"
            },
            {
                type: "simple",
                typeLabel: "Complications",
                difficulty: "resident",
                question: "What is the transformation risk in follicular lymphoma?",
                options: [
                    "Transformation never occurs",
                    "Approximately 2-3% per year cumulative risk of transformation to DLBCL",
                    "100% of FL transforms within 5 years",
                    "Only Grade 3 FL transforms"
                ],
                correct: 1,
                explanation: "Follicular lymphoma has ~2-3% per year cumulative risk of histologic transformation, usually to DLBCL. Transformation is associated with poor prognosis but can still respond to aggressive therapy. Suspect if rapid growth, new B symptoms, or rising LDH.",
                keyPoint: "FL transformation: 2-3%/year cumulative. Usually to DLBCL. Suspect with rapid growth, B symptoms, LDH rise.",
                citation: "Link BK, et al. J Clin Oncol. 2019;37:1129-1138",
                url: "https://scholar.google.com/scholar?q=Link+BK+follicular+lymphoma+JCO+2019"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "resident",
                question: "What is the recommended regimen for limited-stage classic Hodgkin lymphoma (favorable)?",
                options: [
                    "ABVD x 6 cycles + ISRT",
                    "2 cycles ABVD followed by interim PET and response-adapted therapy",
                    "BEACOPP escalated x 6",
                    "Observation only"
                ],
                correct: 1,
                explanation: "Early-stage favorable cHL: 2 cycles ABVD  interim PET  if Deauville 1-3: 2 more cycles ABVD  ISRT. Response-adapted approach reduces toxicity while maintaining excellent outcomes. RAPID trial showed PET-guided approach is safe.",
                keyPoint: "Early favorable cHL: 2 ABVD  PET  response-adapted. Deauville guides further therapy. Excellent outcomes.",
                citation: "Radford J, et al. N Engl J Med. 2015;372:1598-1607",
                pmid: "25901426",
                doi: "10.1056/NEJMoa1408648"
            },

            // ADDITIONAL FELLOW LEVEL QUESTIONS
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "fellow",
                question: "What is the role of CAR-T therapy in DLBCL?",
                options: [
                    "First-line treatment for all DLBCL",
                    "Approved for relapsed/refractory DLBCL after 2+ prior therapies; some now for early relapse",
                    "Only for elderly patients",
                    "Not approved for any lymphoma"
                ],
                correct: 1,
                explanation: "CD19-directed CAR-T (axi-cel, liso-cel, tisa-cel) is approved for R/R DLBCL after 2 prior therapies. ZUMA-7 and TRANSFORM showed benefit in early relapse (after 1 prior line). Main toxicities: CRS and ICANS.",
                keyPoint: "CAR-T in DLBCL: 3rd line standard, 2nd line for early relapse (ZUMA-7). CD19-directed. Watch for CRS/ICANS.",
                citation: "Locke FL, et al. N Engl J Med. 2022;386:640-654",
                pmid: "34891224",
                doi: "10.1056/NEJMoa2116133"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "fellow",
                question: "What are CD20xCD3 bispecific antibodies used for in lymphoma?",
                options: [
                    "First-line treatment only",
                    "R/R B-cell NHL; redirect T-cells to kill CD20+ lymphoma cells",
                    "Only for Hodgkin lymphoma",
                    "Prevention of lymphoma"
                ],
                correct: 1,
                explanation: "Bispecific antibodies (glofitamab, epcoritamab, mosunetuzumab) bind CD20 on lymphoma cells and CD3 on T-cells, creating immunologic synapses. Approved for R/R DLBCL and FL. CRS risk requires step-up dosing. Off-the-shelf (no manufacturing delay).",
                keyPoint: "CD20xCD3 bispecifics: T-cell redirectors for R/R B-NHL. Off-the-shelf advantage. Step-up dosing for CRS mitigation.",
                citation: "Dickinson MJ, et al. N Engl J Med. 2022;387:2220-2231",
                pmid: "36507690",
                doi: "10.1056/NEJMoa2206913"
            },
            {
                type: "case",
                typeLabel: "Clinical Case",
                difficulty: "fellow",
                case: {
                    presentation: "A 42-year-old man with mantle cell lymphoma completing R-CHOP x 6 cycles. Now in CR. Transplant-eligible. Ki-67 was 40%, MIPI score intermediate.",
                    labs: [
                        { name: "Response", value: "Complete remission", abnormal: false },
                        { name: "Ki-67", value: "40%", abnormal: true },
                        { name: "MIPI", value: "Intermediate", abnormal: true }
                    ]
                },
                question: "What is the recommended consolidation strategy?",
                options: [
                    "No further therapy needed",
                    "High-dose therapy with autologous stem cell transplant consolidation",
                    "Allogeneic transplant immediately",
                    "Switch to watch and wait"
                ],
                correct: 1,
                explanation: "Transplant-eligible MCL patients should receive ASCT consolidation in CR1 followed by rituximab maintenance. This improves PFS and OS compared to observation. R-DHAP or cytarabine-containing induction is preferred; R-CHOP followed by ASCT is also effective.",
                keyPoint: "MCL consolidation: ASCT in CR1 if eligible  rituximab maintenance. Improves PFS/OS. Cytarabine-based induction preferred.",
                citation: "Hermine O, et al. Lancet. 2016;388:565-575",
                pmid: "27313086",
                doi: "10.1016/S0140-6736(16)00739-X"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "fellow",
                question: "What is the rationale for BrECADD in advanced Hodgkin lymphoma?",
                options: [
                    "Replaces radiation entirely",
                    "Brentuximab-based regimen reducing cumulative anthracycline/bleomycin toxicity while maintaining efficacy",
                    "Only for elderly patients",
                    "Second-line therapy only"
                ],
                correct: 1,
                explanation: "BrECADD (brentuximab vedotin, etoposide, cyclophosphamide, doxorubicin, dacarbazine, dexamethasone) replaces bleomycin and vincristine with brentuximab. Reduces pulmonary toxicity risk while maintaining high efficacy. NCCN preferred for advanced HL along with N-AVD.",
                keyPoint: "BrECADD: brentuximab-based, no bleomycin/vincristine. Less pulmonary toxicity. NCCN preferred for advanced cHL.",
                citation: "NCCN Guidelines Hodgkin Lymphoma 2026",
                guideline: { name: "NCCN", url: "https://www.nccn.org/guidelines/guidelines-detail?category=1&id=1439" }
            },
            {
                type: "simple",
                typeLabel: "Prognosis",
                difficulty: "fellow",
                question: "What molecular subtype of DLBCL has the worst prognosis?",
                options: [
                    "GCB (germinal center B-cell)",
                    "ABC (activated B-cell) subtype",
                    "Both have identical prognosis",
                    "Unclassifiable subtype"
                ],
                correct: 1,
                explanation: "ABC subtype has significantly worse prognosis than GCB (5-year OS 45-56% vs 78-80% with R-CHOP). ABC has constitutively active NF-B signaling. Novel agents targeting this pathway are being studied. GCB more often associated with BCL2 rearrangements.",
                keyPoint: "ABC DLBCL: worse prognosis than GCB. NF-B pathway activated. 5-yr OS 45-56% vs 78-80% for GCB.",
                citation: "Lenz G, et al. N Engl J Med. 2008;359:2313-2323",
                pmid: "19038878",
                doi: "10.1056/NEJMoa0802885"
            },

            // ADDITIONAL ATTENDING LEVEL QUESTIONS
            {
                type: "case",
                typeLabel: "Complex Case",
                difficulty: "attending",
                case: {
                    presentation: "A 65-year-old man with relapsed DLBCL after R-CHOP (relapse at 8 months). Good PS, no significant comorbidities. PET shows multiple nodal sites. No CNS involvement.",
                    labs: [
                        { name: "Time to relapse", value: "8 months", abnormal: true },
                        { name: "ECOG PS", value: "1", abnormal: false },
                        { name: "LDH", value: "Elevated", abnormal: true }
                    ]
                },
                question: "Per NCCN 2025-2026, what is the optimal second-line approach?",
                options: [
                    "R-ICE salvage followed by auto-SCT",
                    "CAR-T (axi-cel or liso-cel) is preferred for early relapse (<12 months)",
                    "Palliative care only",
                    "Re-challenge with R-CHOP"
                ],
                correct: 1,
                explanation: "For early relapse DLBCL (<12 months), CAR-T therapy is now preferred over traditional salvage-ASCT based on ZUMA-7 and TRANSFORM trials showing superior EFS. Patients with relapse >12 months may be considered for either approach.",
                keyPoint: "DLBCL early relapse (<12 mo): CAR-T preferred (ZUMA-7, TRANSFORM). Late relapse (>12 mo): CAR-T or salvage-ASCT both options.",
                citation: "Westin JR, et al. N Engl J Med. 2023;389:148-157",
                pmid: "37272527",
                doi: "10.1056/NEJMoa2301665"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "attending",
                question: "What is the role of lenalidomide in DLBCL?",
                options: [
                    "First-line therapy in all patients",
                    "R2 (lenalidomide + rituximab) for relapsed DLBCL, especially non-GCB/ABC subtype",
                    "Contraindicated in lymphoma",
                    "Only for maintenance after transplant"
                ],
                correct: 1,
                explanation: "Lenalidomide + rituximab (R2) shows activity in relapsed DLBCL, particularly non-GCB/ABC subtype given lenalidomide's effect on NF-B pathway. Can be a bridge to CAR-T or for patients not candidates for intensive therapy.",
                keyPoint: "Lenalidomide-Rituximab: R/R DLBCL option, better in ABC/non-GCB. Bridge to definitive therapy or for unfit patients.",
                citation: "Leonard JP, et al. J Clin Oncol. 2019;37:1188-1199",
                pmid: "30897038",
                doi: "10.1200/JCO.19.00010"
            },
            {
                type: "simple",
                typeLabel: "Novel Therapy",
                difficulty: "attending",
                question: "What is loncastuximab tesirine and its indication?",
                options: [
                    "Anti-CD20 antibody for first-line FL",
                    "Anti-CD19 antibody-drug conjugate for R/R DLBCL",
                    "CAR-T product",
                    "Bispecific antibody"
                ],
                correct: 1,
                explanation: "Loncastuximab tesirine is a CD19-directed antibody-drug conjugate (ADC) carrying a pyrrolobenzodiazepine dimer payload. FDA-approved for R/R DLBCL after 2+ prior lines. Key toxicities include cytopenias, elevated GGT, and effusions.",
                keyPoint: "Loncastuximab tesirine: CD19 ADC for R/R DLBCL. Watch for cytopenias, GGT elevation, effusions. Different target than CD20.",
                citation: "Caimi PF, et al. Lancet Oncol. 2021;22:790-800",
                pmid: "33989558",
                doi: "10.1016/S1470-2045(21)00139-X"
            },
            {
                type: "simple",
                typeLabel: "Specialized Care",
                difficulty: "attending",
                question: "How should hepatitis B reactivation be prevented in lymphoma patients receiving rituximab?",
                options: [
                    "No prevention needed",
                    "Screen all patients; give antiviral prophylaxis to HBsAg+ or anti-HBc+ patients",
                    "Avoid rituximab in anyone with any HBV exposure",
                    "Only monitor if symptomatic"
                ],
                correct: 1,
                explanation: "All patients should be screened for HBsAg and anti-HBc before rituximab. HBsAg+ patients need antiviral prophylaxis (entecavir preferred). Anti-HBc+ (HBsAg-) patients need monitoring  prophylaxis. Reactivation can be fatal.",
                keyPoint: "HBV + rituximab: Screen all (HBsAg, anti-HBc). HBsAg+ = antiviral prophylaxis. Anti-HBc+ = close monitoring  prophylaxis.",
                citation: "Loomba R, Liang TJ. Gastroenterology. 2017;152:1297-1309",
                pmid: "28219691",
                doi: "10.1053/j.gastro.2017.01.004"
            },

            // ============ H&E HISTOPATHOLOGY QUESTIONS ============
            {
                type: "case",
                typeLabel: "Histopathology",
                difficulty: "intern",
                case: {
                    presentation: "A 25-year-old with cervical lymphadenopathy. Excisional biopsy shows the cells pictured in a mixed inflammatory background.",
                    labs: [
                        { name: "ESR", value: "45 mm/hr", abnormal: true },
                        { name: "LDH", value: "Normal", abnormal: false },
                        { name: "Albumin", value: "3.9 g/dL", abnormal: false }
                    ],
                    histopath: {
                        type: "hodgkin",
                        description: "Classic Reed-Sternberg (RS) cells: large cells with bilobed or binucleated nuclei, each lobe containing a prominent eosinophilic nucleolus creating the classic 'owl-eye' appearance. Background shows mixed inflammatory infiltrate."
                    }
                },
                question: "What is this hallmark cell, and what is the diagnosis?",
                options: [
                    "Plasma cells - multiple myeloma",
                    "Reed-Sternberg cells - classic Hodgkin lymphoma (CD15+/CD30+)",
                    "Centroblasts - DLBCL",
                    "LP cells - NLPHL"
                ],
                correct: 1,
                explanation: "Reed-Sternberg (RS) cells are the malignant cells of classic Hodgkin lymphoma. They are large cells with bilobed or binucleated nuclei, each lobe containing a prominent eosinophilic nucleolus creating the classic 'owl-eye' appearance. They are CD15+, CD30+, usually CD20-.",
                keyPoint: "Reed-Sternberg cells: binucleated, owl-eye nucleoli, CD15+/CD30+, usually CD20-. Pathognomonic for cHL.",
                citation: "Swerdlow SH, et al. Blood. 2016;127:2375-2390 (WHO Classification)",
                pmid: "26980727",
                doi: "10.1182/blood-2016-01-643569"
            },
            {
                type: "simple",
                typeLabel: "Histopathology",
                difficulty: "intern",
                question: "What is the characteristic growth pattern of follicular lymphoma on lymph node biopsy?",
                options: [
                    "Diffuse replacement of node",
                    "Nodular (follicular) pattern with back-to-back follicles lacking mantle zones",
                    "Paracortical expansion only",
                    "Sinus pattern"
                ],
                correct: 1,
                explanation: "Follicular lymphoma shows a nodular (follicular) growth pattern with numerous closely packed follicles replacing normal architecture. The neoplastic follicles lack normal mantle zones, lack polarization (no distinct dark/light zones), and are composed of centrocytes and centroblasts.",
                keyPoint: "FL: nodular/follicular pattern, back-to-back follicles, no mantle zones, no polarization. t(14;18) BCL2+.",
                citation: "Swerdlow SH, et al. Blood. 2016;127:2375-2390 (WHO Classification)",
                pmid: "26980727",
                doi: "10.1182/blood-2016-01-643569"
            },
            {
                type: "case",
                typeLabel: "Histopathology",
                difficulty: "resident",
                case: {
                    presentation: "A 12-year-old with rapidly enlarging abdominal mass. Biopsy shows the pattern pictured. Ki-67 is nearly 100%.",
                    labs: [
                        { name: "LDH", value: "1,850 U/L", abnormal: true },
                        { name: "Uric acid", value: "12.5 mg/dL", abnormal: true },
                        { name: "Ki-67", value: "~100%", abnormal: true },
                        { name: "Phosphorus", value: "6.2 mg/dL", abnormal: true }
                    ],
                    histopath: {
                        type: "burkitt",
                        description: "Classic 'starry sky' pattern: tingible-body macrophages (pale 'stars') scattered among sheets of monomorphic medium-sized blue lymphoma cells (dark 'sky'). The macrophages are phagocytosing apoptotic tumor cells due to extremely high proliferation/turnover."
                    }
                },
                question: "What is this histologic pattern, and what diagnosis does it suggest?",
                options: [
                    "Hodgkin lymphoma with RS cells in inflammatory background",
                    "Burkitt lymphoma with 'starry sky' pattern from tingible-body macrophages",
                    "Follicular lymphoma with nodular pattern",
                    "DLBCL with large cells"
                ],
                correct: 1,
                explanation: "The 'starry sky' appearance in Burkitt lymphoma results from tingible-body macrophages (pale 'stars') scattered among sheets of monomorphic medium-sized blue lymphoma cells (dark 'sky'). The macrophages are phagocytosing apoptotic tumor cells due to extremely high proliferation/turnover.",
                keyPoint: "Starry sky = Burkitt lymphoma. Tingible-body macrophages (stars) in monotonous blue cells (sky). Ki-67 ~100%.",
                citation: "Swerdlow SH, et al. Blood. 2016;127:2375-2390 (WHO Classification)",
                pmid: "26980727",
                doi: "10.1182/blood-2016-01-643569"
            },
            {
                type: "simple",
                typeLabel: "Histopathology",
                difficulty: "resident",
                question: "How do you grade follicular lymphoma on histopathology?",
                options: [
                    "By size of lymph node",
                    "By counting centroblasts per high-power field: Grade 1 (0-5), Grade 2 (6-15), Grade 3 (>15)",
                    "By percentage of follicular pattern",
                    "By BCL2 expression level"
                ],
                correct: 1,
                explanation: "FL is graded by centroblast count per HPF: Grade 1 (0-5 centroblasts), Grade 2 (6-15), Grade 3A (>15 but centrocytes present), Grade 3B (solid sheets of centroblasts). Grades 1-2 and 3A are indolent; Grade 3B is treated as aggressive lymphoma.",
                keyPoint: "FL grading by centroblasts/HPF: 1 (0-5), 2 (6-15), 3A (>15 with centrocytes), 3B (sheets). 3B = aggressive.",
                citation: "WHO Classification of Tumours of Haematopoietic and Lymphoid Tissues, 5th ed. 2022",
                url: "https://tumourclassification.iarc.who.int/chapters/63"
            },
            {
                type: "simple",
                typeLabel: "Histopathology",
                difficulty: "resident",
                question: "What is the morphologic hallmark of mantle cell lymphoma?",
                options: [
                    "Large cells with vesicular nuclei",
                    "Monomorphic small-to-medium lymphocytes with irregular nuclear contours (indented, cleaved)",
                    "Reed-Sternberg cells",
                    "Plasmacytoid differentiation"
                ],
                correct: 1,
                explanation: "MCL shows monomorphic small-to-medium lymphoid cells with irregular, indented, or cleaved nuclear contours and dispersed chromatin. Classic pattern is diffuse or nodular. Blastoid and pleomorphic variants are more aggressive. Cyclin D1+ (due to t(11;14)).",
                keyPoint: "MCL: monomorphic small-medium cells, irregular/cleaved nuclei, cyclin D1+. Blastoid variant = aggressive.",
                citation: "Swerdlow SH, et al. Blood. 2016;127:2375-2390 (WHO Classification)",
                pmid: "26980727",
                doi: "10.1182/blood-2016-01-643569"
            },
            {
                type: "simple",
                typeLabel: "Histopathology",
                difficulty: "fellow",
                question: "What histopathologic finding distinguishes nodular lymphocyte-predominant Hodgkin lymphoma (NLPHL) from classic HL?",
                options: [
                    "Identical RS cells",
                    "LP cells ('popcorn cells'): large cells with multilobated nuclei, smaller nucleoli; CD20+/CD15-/CD30-",
                    "More inflammatory background",
                    "Fibrosis bands"
                ],
                correct: 1,
                explanation: "NLPHL has LP cells (lymphocyte-predominant, 'popcorn' or 'L&H' cells): large cells with multilobated vesicular nuclei and small nucleoli, unlike RS cells' owl-eye appearance. Critically different immunophenotype: LP cells are CD20+, CD15-, CD30- (opposite of RS cells).",
                keyPoint: "NLPHL: LP/popcorn cells, multilobated nuclei. CD20+/CD15-/CD30- (opposite of classic HL RS cells).",
                citation: "Swerdlow SH, et al. Blood. 2016;127:2375-2390 (WHO Classification)",
                pmid: "26980727",
                doi: "10.1182/blood-2016-01-643569"
            },
            {
                type: "simple",
                typeLabel: "Histopathology",
                difficulty: "fellow",
                question: "What is the characteristic histopathology of MALT lymphoma (extranodal marginal zone lymphoma)?",
                options: [
                    "Sheets of large cells",
                    "Small B-cells with centrocyte-like or monocytoid morphology; lymphoepithelial lesions",
                    "Starry sky pattern",
                    "Reed-Sternberg cells in fibrotic bands"
                ],
                correct: 1,
                explanation: "MALT lymphoma shows small B-cells with centrocyte-like (cleaved) or monocytoid (pale cytoplasm) morphology surrounding reactive follicles (marginal zone pattern). Lymphoepithelial lesions (lymphoma cells invading epithelial structures) are characteristic, especially in gastric MALT.",
                keyPoint: "MALT: marginal zone cells, lymphoepithelial lesions (invasion into glands). Associated with H. pylori in stomach.",
                citation: "Swerdlow SH, et al. Blood. 2016;127:2375-2390 (WHO Classification)",
                pmid: "26980727",
                doi: "10.1182/blood-2016-01-643569"
            },
            {
                type: "simple",
                typeLabel: "Histopathology",
                difficulty: "fellow",
                question: "What defines high-grade B-cell lymphoma with MYC and BCL2 rearrangements (double-hit lymphoma)?",
                options: [
                    "Protein overexpression only",
                    "Chromosomal rearrangements (translocations) of MYC plus BCL2 and/or BCL6 confirmed by FISH",
                    "Morphology alone",
                    "High Ki-67 index only"
                ],
                correct: 1,
                explanation: "Double-hit lymphoma (now 'high-grade B-cell lymphoma with MYC and BCL2/BCL6 rearrangements') requires FISH-confirmed translocations, not just protein expression. Morphology may be DLBCL-like or Burkitt-like or intermediate. Extremely aggressive; needs intensified therapy.",
                keyPoint: "Double-hit = FISH-confirmed MYC + BCL2/BCL6 translocations. Not just IHC. Very aggressive. Need DA-EPOCH-R.",
                citation: "Rosenwald A, et al. J Clin Oncol. 2019;37:3359-3368",
                pmid: "31498031",
                doi: "10.1200/JCO.19.00743"
            },
            {
                type: "simple",
                typeLabel: "Histopathology",
                difficulty: "attending",
                question: "What is the nodular sclerosis subtype of classic Hodgkin lymphoma characterized by?",
                options: [
                    "No fibrosis",
                    "Broad bands of collagen dividing tumor into nodules; lacunar cells (RS variant with retracted cytoplasm)",
                    "Lymphocyte depletion",
                    "Mixed inflammatory infiltrate without bands"
                ],
                correct: 1,
                explanation: "Nodular sclerosis cHL (most common subtype): broad bands of birefringent collagen dividing tumor into nodules, and lacunar cells (RS variant where cytoplasm retracts in formalin fixation creating 'lacunae'). Common in young adults, mediastinal involvement frequent.",
                keyPoint: "NS cHL: collagen bands + lacunar cells. Most common subtype. Young adults, mediastinal mass.",
                citation: "Swerdlow SH, et al. Blood. 2016;127:2375-2390 (WHO Classification)",
                pmid: "26980727",
                doi: "10.1182/blood-2016-01-643569"
            },
            {
                type: "simple",
                typeLabel: "Histopathology",
                difficulty: "attending",
                question: "What histopathologic features suggest primary mediastinal large B-cell lymphoma (PMBCL)?",
                options: [
                    "Identical to nodal DLBCL",
                    "Large cells with clear cytoplasm, compartmentalizing fibrosis; thymic origin",
                    "Small cells with mantle zone pattern",
                    "Plasmacytoid differentiation"
                ],
                correct: 1,
                explanation: "PMBCL shows large cells often with clear cytoplasm (due to glycogen), delicate compartmentalizing fibrosis, and arises in the thymus (anterior mediastinum). More common in young women. Gene expression similar to classic HL. CD30 variably positive.",
                keyPoint: "PMBCL: large cells, clear cytoplasm, compartmentalizing fibrosis, thymic origin. Young women, mediastinal mass.",
                citation: "Swerdlow SH, et al. Blood. 2016;127:2375-2390 (WHO Classification)",
                pmid: "26980727",
                doi: "10.1182/blood-2016-01-643569"
            },
            {
                type: "simple",
                typeLabel: "Histopathology",
                difficulty: "attending",
                question: "What is anaplastic large cell lymphoma (ALCL) and how is it identified?",
                options: [
                    "Small cell lymphoma",
                    "Large pleomorphic cells ('hallmark cells') with horseshoe/embryo-shaped nuclei; CD30+, ALK+ or ALK-",
                    "B-cell lymphoma with CD20 expression",
                    "Plasma cell neoplasm"
                ],
                correct: 1,
                explanation: "ALCL shows large pleomorphic cells with characteristic 'hallmark cells': eccentric, horseshoe/embryo-shaped nuclei with eosinophilic Golgi region. Always CD30+. ALK+ (usually t(2;5)) has better prognosis than ALK-. T-cell/null cell lineage.",
                keyPoint: "ALCL: hallmark cells (horseshoe nuclei), CD30+. ALK+ = better prognosis. T/null lineage.",
                citation: "Swerdlow SH, et al. Blood. 2016;127:2375-2390 (WHO Classification)",
                pmid: "26980727",
                doi: "10.1182/blood-2016-01-643569"
            },

            // ============ ADDITIONAL QUESTIONS ============
            {
                type: "simple",
                typeLabel: "Staging",
                difficulty: "intern",
                question: "What staging system is used for lymphoma?",
                options: [
                    "TNM staging",
                    "Lugano classification (modified Ann Arbor staging)",
                    "FIGO staging",
                    "Dukes staging"
                ],
                correct: 1,
                explanation: "Lymphoma uses Lugano classification (2014), which modified Ann Arbor staging. Stages I-II are limited; III-IV are advanced. Uses PET/CT for staging. 'E' denotes extranodal extension; 'X' for bulk (10cm or >1/3 thorax).",
                keyPoint: "Lugano staging: I-II limited, III-IV advanced. Based on Ann Arbor. PET-based assessment.",
                citation: "Cheson BD, et al. J Clin Oncol. 2014;32:3059-3068",
                pmid: "25113753",
                doi: "10.1200/JCO.2013.54.8800"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "intern",
                question: "What does ABVD stand for in Hodgkin lymphoma treatment?",
                options: [
                    "Aspirin, Bleomycin, Vincristine, Doxorubicin",
                    "Adriamycin (doxorubicin), Bleomycin, Vinblastine, Dacarbazine",
                    "Alemtuzumab, Bortezomib, Velcade, Dexamethasone",
                    "Azacitidine, Bendamustine, Venetoclax, Dexamethasone"
                ],
                correct: 1,
                explanation: "ABVD: Adriamycin (doxorubicin), Bleomycin, Vinblastine, Dacarbazine. Standard frontline regimen for classic Hodgkin lymphoma. Given on days 1 and 15 of 28-day cycles. Key toxicities: pulmonary (bleomycin), cardiac (doxorubicin).",
                keyPoint: "ABVD = doxorubicin, bleomycin, vinblastine, dacarbazine. Days 1+15 of 28-day cycle. Watch bleomycin lung toxicity.",
                citation: "NCCN Guidelines Hodgkin Lymphoma 2025",
                guideline: { name: "NCCN", url: "https://www.nccn.org/guidelines/guidelines-detail?category=1&id=1439" }
            },
            {
                type: "simple",
                typeLabel: "Prognosis",
                difficulty: "resident",
                question: "What is the IPI (International Prognostic Index) for DLBCL?",
                options: [
                    "Based on genetics only",
                    "Age >60, stage III-IV, >1 extranodal site, elevated LDH, ECOG 2 (1 point each)",
                    "Based on tumor size only",
                    "Based on B symptoms only"
                ],
                correct: 1,
                explanation: "IPI factors (1 point each): Age >60, Stage III-IV, >1 extranodal site, Elevated LDH, ECOG PS 2. Score 0-1: low risk, 2: low-intermediate, 3: high-intermediate, 4-5: high risk. Predicts survival in DLBCL.",
                keyPoint: "IPI for DLBCL: Age, Stage, LDH, PS, extranodal sites. 0-1 low, 2 low-int, 3 high-int, 4-5 high risk.",
                citation: "Shipp MA, et al. N Engl J Med. 1993;329:987-994",
                pmid: "8141877",
                doi: "10.1056/NEJM199309303291402"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "resident",
                question: "What is the role of PET/CT in lymphoma?",
                options: [
                    "Only for initial staging",
                    "Staging, interim response assessment (Deauville score), end-of-treatment response, and surveillance in some settings",
                    "Only for detecting relapse",
                    "Not used in lymphoma"
                ],
                correct: 1,
                explanation: "PET/CT is used for: initial staging (Lugano), interim assessment during treatment (Deauville score guides therapy in HL, some DLBCL), end-of-treatment response, and surveillance (controversial, mainly for aggressive lymphoma). Deauville 1-3 = good response.",
                keyPoint: "PET/CT: staging, interim assessment (Deauville 1-5), end of treatment. Deauville 1-3 good, 4-5 bad.",
                citation: "Barrington SF, et al. J Clin Oncol. 2014;32:3048-3058",
                pmid: "25113771",
                doi: "10.1200/JCO.2013.53.5229"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "fellow",
                question: "What is polatuzumab vedotin and its indication?",
                options: [
                    "Anti-CD20 antibody",
                    "CD79b-directed antibody-drug conjugate; approved with BR for R/R DLBCL and with R-CHP frontline",
                    "Bispecific antibody",
                    "CAR-T product"
                ],
                correct: 1,
                explanation: "Polatuzumab vedotin is a CD79b-directed ADC (MMAE payload). Approved with bendamustine-rituximab for R/R DLBCL. POLARIX trial led to approval of Pola-R-CHP as frontline for DLBCL (replacing vincristine with polatuzumab). Improved PFS over R-CHOP.",
                keyPoint: "Polatuzumab: CD79b ADC. Pola-R-CHP frontline for DLBCL (POLARIX). Pola-BR for R/R DLBCL.",
                citation: "Tilly H, et al. N Engl J Med. 2022;386:351-363",
                pmid: "34904799",
                doi: "10.1056/NEJMoa2115304"
            },
            {
                type: "case",
                typeLabel: "Clinical Case",
                difficulty: "fellow",
                case: {
                    presentation: "A 35-year-old woman with new anterior mediastinal mass (15 cm), SVC syndrome symptoms. Biopsy shows large B-cells with clear cytoplasm, compartmentalizing fibrosis. CD20+, CD30+, CD23+.",
                    labs: [
                        { name: "Location", value: "Anterior mediastinum", abnormal: true },
                        { name: "Size", value: "15 cm", abnormal: true },
                        { name: "CD20", value: "Positive", abnormal: false },
                        { name: "CD30", value: "Positive", abnormal: true }
                    ]
                },
                question: "What is the most likely diagnosis and appropriate treatment?",
                options: [
                    "Nodal DLBCL; R-CHOP x 6",
                    "Primary mediastinal large B-cell lymphoma; DA-EPOCH-R preferred",
                    "Hodgkin lymphoma; ABVD",
                    "Thymoma; surgery"
                ],
                correct: 1,
                explanation: "PMBCL: young woman, large anterior mediastinal mass, clear cytoplasm, fibrosis, CD20+/CD30+. DA-EPOCH-R is preferred over R-CHOP based on NCI data showing improved outcomes and reduced need for radiation. PET-guided approach to avoid mediastinal radiation.",
                keyPoint: "PMBCL: DA-EPOCH-R preferred (NCI regimen). PET-adapted to avoid radiation if possible. Young women, mediastinal mass.",
                citation: "Dunleavy K, et al. N Engl J Med. 2013;368:1408-1416",
                pmid: "23574119",
                doi: "10.1056/NEJMoa1214561"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "attending",
                question: "What is the significance of EBV in lymphoma?",
                options: [
                    "No association",
                    "Associated with multiple lymphomas: endemic Burkitt, some DLBCL, HL (especially in immunosuppressed), PTLD",
                    "Only in T-cell lymphomas",
                    "Only in indolent lymphomas"
                ],
                correct: 1,
                explanation: "EBV is associated with: endemic Burkitt lymphoma (~100%), some DLBCL (EBV+ DLBCL, worse prognosis), classic HL (~40%, higher in immunosuppressed), PTLD (post-transplant), and some T/NK lymphomas. EBER in-situ hybridization detects EBV.",
                keyPoint: "EBV associated: endemic Burkitt, some DLBCL/HL, PTLD, NK/T lymphomas. EBER detects it. May guide therapy.",
                citation: "Shannon-Lowe C, et al. Philos Trans R Soc B. 2017;372:20160271",
                pmid: "28893938",
                doi: "10.1098/rstb.2016.0271"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "attending",
                question: "What is the role of ibrutinib in lymphoma?",
                options: [
                    "Only for CLL",
                    "BTK inhibitor approved for MCL, marginal zone lymphoma, and Waldenstrom macroglobulinemia",
                    "First-line for all DLBCL",
                    "Only post-transplant"
                ],
                correct: 1,
                explanation: "Ibrutinib (BTK inhibitor) is approved for: relapsed MCL, marginal zone lymphoma, Waldenstrom macroglobulinemia (with rituximab), and CLL. Active in B-cell malignancies dependent on BCR signaling. Key toxicities: bleeding, atrial fibrillation, infections.",
                keyPoint: "Ibrutinib: BTK inhibitor for MCL, MZL, WM, CLL. Watch for afib, bleeding, infections. Avoid with anticoagulants.",
                citation: "Wang ML, et al. N Engl J Med. 2013;369:507-516",
                pmid: "23782157",
                doi: "10.1056/NEJMoa1306220"
            },
            // ============ ROUND 2: ADDITIONAL CLINICAL QUESTIONS ============
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "fellow",
                question: "Which CAR-T products are FDA-approved for relapsed/refractory DLBCL after 2 or more lines of therapy?",
                options: [
                    "Tisagenlecleucel (Kymriah) only",
                    "Axicabtagene ciloleucel (Yescarta), tisagenlecleucel (Kymriah), and lisocabtagene maraleucel (Breyanzi)",
                    "Only brexucabtagene autoleucel (Tecartus)",
                    "All CAR-T products are only approved for ALL"
                ],
                correct: 1,
                explanation: "Three anti-CD19 CAR-T products are FDA-approved for R/R DLBCL after 2 prior therapies: axi-cel (ZUMA-1), tisa-cel (JULIET), and liso-cel (TRANSCEND). Each has different toxicity profiles. ZUMA-7 and TRANSFORM trials showed benefit in 2nd line for high-risk patients.",
                keyPoint: "Three CAR-T for DLBCL: axi-cel, tisa-cel, liso-cel. Different CRS/ICANS profiles. 2nd line for high-risk (ZUMA-7, TRANSFORM).",
                citation: "Neelapu SS, et al. N Engl J Med. 2017;377:2531-2544",
                pmid: "29226797",
                doi: "10.1056/NEJMoa1707447"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "fellow",
                question: "What is the mechanism of bispecific antibodies like mosunetuzumab and glofitamab?",
                options: [
                    "Block PD-1/PD-L1 interaction",
                    "Bridge CD3 on T-cells to CD20 on lymphoma cells, inducing T-cell mediated killing",
                    "Deliver cytotoxic payload to CD79b",
                    "Inhibit BTK signaling"
                ],
                correct: 1,
                explanation: "CD20xCD3 bispecific antibodies (mosunetuzumab, glofitamab, epcoritamab) bridge T-cells to lymphoma cells by binding CD3 on T-cells and CD20 on tumor. This induces T-cell activation and tumor killing. Off-the-shelf, no manufacturing delay unlike CAR-T.",
                keyPoint: "CD20xCD3 bispecifics: bridge T-cells to lymphoma via CD20. Off-the-shelf. CRS occurs but usually lower grade than CAR-T.",
                citation: "Budde LE, et al. Lancet Oncol. 2022;23:1055-1065",
                pmid: "35803286",
                doi: "10.1016/S1470-2045(22)00335-7"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "resident",
                question: "What is the role of maintenance rituximab in follicular lymphoma?",
                options: [
                    "No proven benefit",
                    "Improves progression-free survival after induction, typically given every 2-3 months for 2 years",
                    "Only used after transplant",
                    "Given weekly indefinitely"
                ],
                correct: 1,
                explanation: "PRIMA trial showed rituximab maintenance (every 2 months x 2 years) after R-chemo induction improves PFS in FL. Standard of care after first-line immunochemotherapy. OS benefit debated. Alternative: observation with retreatment at progression.",
                keyPoint: "FL maintenance rituximab: q2 months x 2 years after induction. Improves PFS. PRIMA trial. Consider vs observation.",
                citation: "Salles G, et al. Lancet. 2011;377:42-51",
                pmid: "21176949",
                doi: "10.1016/S0140-6736(10)62175-7"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "fellow",
                question: "What regimen is preferred for relapsed MCL and why is zanubrutinib often preferred over ibrutinib?",
                options: [
                    "R-CHOP is preferred for all relapses",
                    "BTK inhibitors; zanubrutinib has fewer off-target effects (less afib, bleeding) than ibrutinib",
                    "Lenalidomide monotherapy only",
                    "CAR-T is first option for all relapsed MCL"
                ],
                correct: 1,
                explanation: "BTK inhibitors are highly active in MCL. Zanubrutinib is more selective for BTK with fewer off-target kinase effects, resulting in less atrial fibrillation and bleeding compared to ibrutinib (ALPINE trial in CLL, similar in MCL). Brexu-cel (CAR-T) for BTKi failures.",
                keyPoint: "MCL: BTK inhibitors (ibrutinib, zanubrutinib, acalabrutinib). Zanubrutinib: more selective, less afib/bleeding. CAR-T after BTKi failure.",
                citation: "Wang M, et al. Blood. 2020;136:1382-1390",
                pmid: "32603411",
                doi: "10.1182/blood.2020006373"
            },
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "fellow",
                question: "Which lymphomas require CNS prophylaxis and what regimens are used?",
                options: [
                    "All DLBCL requires prophylaxis",
                    "High-risk DLBCL (high CNS-IPI, testicular, breast, kidney involvement); IT methotrexate or high-dose systemic MTX",
                    "Only Burkitt lymphoma",
                    "CNS prophylaxis is never indicated"
                ],
                correct: 1,
                explanation: "CNS prophylaxis for high-risk DLBCL: CNS-IPI 4, testicular, breast, kidney, adrenal involvement, double-hit lymphoma. Options: IT methotrexate (4-6 doses) or high-dose IV methotrexate (3-3.5 g/m). Burkitt always gets prophylaxis.",
                keyPoint: "CNS prophylaxis: high CNS-IPI, testicular/breast/kidney DLBCL, double-hit, Burkitt. IT MTX or HD-MTX.",
                citation: "Schmitz N, et al. J Clin Oncol. 2016;34:3150-3156",
                pmid: "27382100",
                doi: "10.1200/JCO.2015.65.6520"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "attending",
                question: "What is polatuzumab vedotin and when is it used?",
                options: [
                    "Anti-CD30 ADC for Hodgkin lymphoma",
                    "Anti-CD79b ADC; approved with BR for R/R DLBCL and with R-CHP for first-line DLBCL",
                    "Anti-CD19 naked antibody",
                    "Anti-CD22 ADC for ALL only"
                ],
                correct: 1,
                explanation: "Polatuzumab vedotin is an anti-CD79b antibody-drug conjugate (MMAE payload). POLARIX trial showed pola-R-CHP superior to R-CHOP for first-line DLBCL (PFS benefit). Also approved with BR for R/R DLBCL. Main toxicity: peripheral neuropathy.",
                keyPoint: "Pola-vedotin: anti-CD79b ADC. POLARIX: pola-R-CHP > R-CHOP for DLBCL. Watch for neuropathy.",
                citation: "Tilly H, et al. N Engl J Med. 2022;386:351-363",
                pmid: "34904799",
                doi: "10.1056/NEJMoa2115304"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "resident",
                question: "What is the R-squared (R) regimen and when is it used?",
                options: [
                    "Rituximab + radiation",
                    "Rituximab + lenalidomide; used in relapsed follicular lymphoma and marginal zone lymphoma",
                    "Rituximab + romidepsin",
                    "R-CHOP given twice"
                ],
                correct: 1,
                explanation: "R (rituximab + lenalidomide) is an effective chemo-free regimen for FL and MZL. AUGMENT trial showed R superior to rituximab alone in relapsed FL. Can also be used first-line in FL for patients wanting to avoid chemotherapy (RELEVANCE trial).",
                keyPoint: "R: rituximab + lenalidomide. AUGMENT trial. Chemo-free option for FL/MZL.",
                citation: "Leonard JP, et al. N Engl J Med. 2019;381:716-727",
                pmid: "31433920",
                doi: "10.1056/NEJMoa1904664"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "attending",
                question: "What is the significance of MYC/BCL2 double-hit lymphoma and how is it treated?",
                options: [
                    "Better prognosis than standard DLBCL",
                    "Poor prognosis; requires more intensive therapy (DA-EPOCH-R preferred) and CNS prophylaxis",
                    "Treated same as indolent lymphoma",
                    "Only occurs in T-cell lymphomas"
                ],
                correct: 1,
                explanation: "High-grade B-cell lymphoma with MYC and BCL2 rearrangements (double-hit) has poor prognosis. Often GCB subtype. DA-EPOCH-R may be superior to R-CHOP. CNS prophylaxis recommended. Consider CAR-T or transplant consolidation in first remission for fit patients.",
                keyPoint: "Double-hit: MYC + BCL2 rearranged. Poor prognosis. DA-EPOCH-R, CNS prophylaxis, consider consolidation.",
                citation: "Petrich AM, et al. Blood. 2014;124:2354-2361",
                pmid: "25161267",
                doi: "10.1182/blood-2014-05-578963"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "intern",
                question: "What is the preferred first-line treatment for limited-stage Hodgkin lymphoma?",
                options: [
                    "ABVD x 6 cycles alone",
                    "Combined modality: ABVD x 2-4 cycles followed by involved-site radiation (20-30 Gy)",
                    "Radiation alone (40 Gy)",
                    "BV-AVD always required"
                ],
                correct: 1,
                explanation: "Limited-stage (I-II) favorable HL: ABVD x 2 cycles + 20 Gy ISRT (German HD10). Unfavorable: ABVD x 4 + 30 Gy. PET-adapted approaches (RAPID, EORTC H10) allow radiation omission if PET-negative. BV-AVD for advanced stage.",
                keyPoint: "Limited HL: ABVD 2-4 cycles + ISRT (20-30 Gy). PET-adapted to omit RT if negative. Combined modality standard.",
                citation: "Engert A, et al. N Engl J Med. 2010;363:640-652",
                pmid: "20818855",
                doi: "10.1056/NEJMoa1000067"
            },
            // ============ ROUND 3: ADDITIONAL CLINICAL QUESTIONS ============
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "fellow",
                question: "What is the first-line treatment for peripheral T-cell lymphoma (PTCL-NOS)?",
                options: [
                    "R-CHOP",
                    "CHOP or CHOEP (with etoposide); adding brentuximab if CD30+ PTCL; consolidation with auto-HCT in CR1",
                    "Observation",
                    "Rituximab monotherapy"
                ],
                correct: 1,
                explanation: "PTCL-NOS treated with CHOP or CHOEP (etoposide improves outcomes in younger patients). Brentuximab vedotin added for CD30+ cases (ECHELON-2: BV-CHP > CHOP). Consolidation with auto-HCT in CR1 improves outcomes. Rituximab has no role (T-cell lymphoma). Novel agents for relapse.",
                keyPoint: "PTCL: CHOP/CHOEP, add BV if CD30+. Auto-HCT consolidation in CR1. No rituximab for T-cell.",
                citation: "Horwitz S, et al. Lancet. 2019;393:229-240",
                pmid: "30522922",
                doi: "10.1016/S0140-6736(18)32984-2"
            },
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "fellow",
                question: "What is Waldenstrom macroglobulinemia and its characteristic mutation?",
                options: [
                    "IgA-secreting myeloma",
                    "Lymphoplasmacytic lymphoma with IgM paraprotein; MYD88 L265P mutation in >90% of cases",
                    "DLBCL with paraprotein",
                    "CLL with IgM"
                ],
                correct: 1,
                explanation: "Waldenstrom macroglobulinemia is LPL with bone marrow involvement and IgM monoclonal gammopathy. MYD88 L265P mutation present in >90%, helps distinguish from IgM myeloma (rare, MYD88 negative). Treatment: ibrutinib-rituximab, BR, DRC. Watch for hyperviscosity syndrome.",
                keyPoint: "WM: LPL + IgM paraprotein. MYD88 L265P in >90%. BTK inhibitor + rituximab. Watch for hyperviscosity.",
                citation: "Treon SP, et al. N Engl J Med. 2015;372:1430-1440",
                pmid: "25853747",
                doi: "10.1056/NEJMoa1501548"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "attending",
                question: "What are the treatment options for primary CNS lymphoma (PCNSL)?",
                options: [
                    "R-CHOP standard",
                    "High-dose methotrexate-based regimens  rituximab; consolidation with auto-HCT or whole-brain RT in fit patients",
                    "Standard CHOP",
                    "Observation if asymptomatic"
                ],
                correct: 1,
                explanation: "PCNSL requires CNS-penetrating therapy. High-dose methotrexate (3 g/m) is backbone, often with rituximab, cytarabine, thiotepa. Consolidation: auto-HCT with thiotepa-based conditioning (preferred in fit) or reduced-dose WBRT. Avoid WBRT alone in elderly (neurotoxicity). Ibrutinib shows activity.",
                keyPoint: "PCNSL: HD-MTX based regimens. Consolidation: auto-HCT (preferred) or reduced WBRT. Avoid WBRT alone in elderly.",
                citation: "Ferreri AJ, et al. Lancet Haematol. 2017;4:e510-e523",
                pmid: "29054815",
                doi: "10.1016/S2352-3026(17)30174-6"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "resident",
                question: "What is hairy cell leukemia and its treatment?",
                options: [
                    "Aggressive lymphoma requiring R-CHOP",
                    "Indolent B-cell neoplasm with hairy cytoplasmic projections; highly responsive to purine analogs (cladribine, pentostatin)",
                    "T-cell leukemia",
                    "Always requires transplant"
                ],
                correct: 1,
                explanation: "HCL is indolent B-cell neoplasm with characteristic 'hairy' projections, CD20+/CD25+/CD103+/CD123+, and BRAF V600E mutation (>95%). Purine analogs (cladribine single 7-day course) achieve CR in >80% with long remissions. Vemurafenib for relapsed (BRAF-targeted). Rituximab added to improve CR rates.",
                keyPoint: "HCL: hairy projections, BRAF V600E. Cladribine highly effective. Vemurafenib for relapsed. Excellent prognosis.",
                citation: "Grever MR, et al. Blood. 2017;129:550-556",
                pmid: "27903528",
                doi: "10.1182/blood-2016-01-689422"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "attending",
                question: "What is the role of checkpoint inhibitors in lymphoma?",
                options: [
                    "First-line for all lymphomas",
                    "Pembrolizumab/nivolumab (anti-PD-1) approved for R/R classic HL; limited activity in most NHL except PMBCL",
                    "Only for T-cell lymphomas",
                    "Contraindicated in lymphoma"
                ],
                correct: 1,
                explanation: "PD-1 inhibitors (pembrolizumab, nivolumab) highly active in R/R classic HL (CheckMate-205, KEYNOTE-087) due to 9p24.1 amplification with PD-L1/L2 overexpression. Also active in PMBCL (similar biology). Limited activity in other NHL. Risk of flares in auto-immune conditions and prior allo-HCT.",
                keyPoint: "Anti-PD-1: approved for R/R cHL. Also PMBCL. 9p24.1 amplification predicts response. Limited in most other NHL.",
                citation: "Ansell SM, et al. N Engl J Med. 2015;372:311-319",
                pmid: "25482239",
                doi: "10.1056/NEJMoa1411087"
            },
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "fellow",
                question: "What is histologic transformation in follicular lymphoma and its implications?",
                options: [
                    "Spontaneous remission",
                    "Transformation to aggressive lymphoma (usually DLBCL); occurs at ~3%/year; poor prognosis; treat as de novo DLBCL, consider CAR-T",
                    "Conversion to Hodgkin lymphoma",
                    "Always leads to cure"
                ],
                correct: 1,
                explanation: "FL transforms to aggressive lymphoma (usually DLBCL, rarely Burkitt) at ~2-3%/year. Suspect if rapid growth, rising LDH, new symptoms. Biopsy required. Worse prognosis than de novo DLBCL. Treat with R-CHOP or similar, then consolidate with auto-HCT in CR. CAR-T approved for transformed FL.",
                keyPoint: "FL transformation: ~3%/year to DLBCL. Biopsy if suspected. Worse prognosis. R-CHOP then auto-HCT or CAR-T.",
                citation: "Casulo C, et al. J Clin Oncol. 2015;33:2516-2522",
                pmid: "26124482",
                doi: "10.1200/JCO.2014.59.7534"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "resident",
                question: "What is the role of autologous stem cell transplant in lymphoma?",
                options: [
                    "First-line for all lymphomas",
                    "Consolidation in relapsed/chemo-sensitive DLBCL and HL; upfront consolidation in MCL and PTCL in CR1",
                    "Never used in lymphoma",
                    "Only for elderly patients"
                ],
                correct: 1,
                explanation: "Auto-HCT is standard for: 1) relapsed chemo-sensitive DLBCL (vs CAR-T after ZUMA-7/TRANSFORM for high-risk), 2) relapsed HL, 3) MCL consolidation in CR1, 4) PTCL consolidation in CR1, 5) transformed FL. Uses high-dose chemotherapy (BEAM typically) with stem cell rescue.",
                keyPoint: "Auto-HCT: relapsed DLBCL/HL if chemo-sensitive; MCL and PTCL consolidation in CR1. BEAM conditioning typical.",
                citation: "Philip T, et al. N Engl J Med. 1995;333:1540-1545",
                pmid: "7477169",
                doi: "10.1056/NEJM199512073332305"
            },
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "attending",
                question: "What is post-transplant lymphoproliferative disorder (PTLD)?",
                options: [
                    "Rejection of transplant",
                    "EBV-driven lymphoproliferation in immunosuppressed transplant recipients; spectrum from polyclonal to monoclonal lymphoma",
                    "Normal immune reconstitution",
                    "Only occurs after auto-HCT"
                ],
                correct: 1,
                explanation: "PTLD occurs in solid organ and allo-HCT recipients due to immunosuppression. Usually EBV-driven (EBER+). Spectrum from polyclonal hyperplasia to monomorphic DLBCL-like. Treatment: reduce immunosuppression, rituximab  chemotherapy. Monitor EBV DNA in high-risk. Early PTLD may resolve with IS reduction alone.",
                keyPoint: "PTLD: EBV-driven in transplant recipients. Reduce immunosuppression first. Rituximab  chemo. Monitor EBV DNA.",
                citation: "Dierickx D, et al. Blood. 2018;131:1624-1632",
                pmid: "29414277",
                doi: "10.1056/NEJMra1702693"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "intern",
                question: "What is the significance of PET-adapted therapy in lymphoma?",
                options: [
                    "PET is never used during treatment",
                    "Interim PET (iPET) results guide treatment intensity: deescalation if PET-negative, escalation if PET-positive",
                    "Only used at diagnosis",
                    "PET has no prognostic value"
                ],
                correct: 1,
                explanation: "Interim PET after 2-3 cycles predicts outcomes and guides therapy. In HL: PET-negative allows omitting RT (RAPID) or bleomycin (RATHL). In DLBCL: iPET-positive identifies high-risk patients needing intensification. Deauville score 1-3 typically considered negative, 4-5 positive.",
                keyPoint: "iPET: guides therapy. Deauville 1-3 = negative, 4-5 = positive. Deescalate if negative, escalate if positive.",
                citation: "Johnson P, et al. N Engl J Med. 2016;374:2419-2429",
                pmid: "27332902",
                doi: "10.1056/NEJMoa1510093"
            },
            // ============ ROUND 4: ADDITIONAL CLINICAL QUESTIONS ============
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "fellow",
                question: "What is Richter transformation and its prognosis?",
                options: [
                    "Normal progression of CLL",
                    "Transformation of CLL to aggressive lymphoma (usually DLBCL); poor prognosis (median OS ~6-12 months); treat as DLBCL, consider transplant",
                    "Cure of CLL",
                    "Only occurs with treatment"
                ],
                correct: 1,
                explanation: "Richter transformation occurs in ~5-10% of CLL patients, usually to DLBCL (rarely HL). Present with rapid adenopathy growth, B-symptoms, rising LDH. Clonally related transformations have worse prognosis than clonally unrelated. Treat with R-CHOP or intensive regimens, then allo-HCT if feasible. Novel agents being studied.",
                keyPoint: "Richter: CLLDLBCL usually. Poor prognosis 6-12mo. R-CHOP then allo-HCT if possible. Clonally related worse.",
                citation: "Parikh SA, et al. Blood. 2014;123:2308-2314",
                pmid: "24421328",
                doi: "10.1182/blood-2013-09-527150"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "attending",
                question: "What is the treatment approach for mycosis fungoides and Szary syndrome?",
                options: [
                    "R-CHOP first-line",
                    "Stage-directed: early stages with skin-directed therapies (topical steroids, phototherapy, nitrogen mustard); advanced with systemic therapy (bexarotene, HDAC inhibitors, mogamulizumab)",
                    "Immediate transplant",
                    "No treatment needed"
                ],
                correct: 1,
                explanation: "MF/SS are cutaneous T-cell lymphomas. Early stage: skin-directed therapies (topical steroids, NB-UVB, PUVA, topical nitrogen mustard, retinoids). Advanced stage: systemic (bexarotene, romidepsin, vorinostat, mogamulizumab, brentuximab if CD30+). Allo-HCT for refractory. Avoid aggressive chemo in early disease.",
                keyPoint: "MF/SS: skin-directed early (phototherapy, topicals). Systemic for advanced (bexarotene, HDAC-i, mogamulizumab).",
                citation: "Trautinger F, et al. Eur J Cancer. 2017;77:57-74",
                pmid: "28365528",
                doi: "10.1016/j.ejca.2017.02.027"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "fellow",
                question: "How is extranodal NK/T-cell lymphoma treated?",
                options: [
                    "R-CHOP standard",
                    "Asparaginase-based regimens (SMILE, AspaMetDex) due to MDR1 overexpression making anthracyclines ineffective; radiation important for localized disease",
                    "Rituximab monotherapy",
                    "Observation"
                ],
                correct: 1,
                explanation: "ENKTL is aggressive, EBV-associated, with MDR1/P-glycoprotein overexpression making anthracyclines ineffective. Treatment: asparaginase-based regimens (SMILE, DDGP, AspaMetDex)  radiation. Localized: RT with concurrent/sequential chemo. Advanced: SMILE regimen. PD-1 inhibitors showing promise in relapsed disease.",
                keyPoint: "ENKTL: asparaginase-based (SMILE) not anthracyclines (MDR1). EBV-associated. Radiation for localized. PD-1 for relapsed.",
                citation: "Yamaguchi M, et al. J Clin Oncol. 2011;29:4410-4416",
                pmid: "21990393",
                doi: "10.1200/JCO.2011.35.6287"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "resident",
                question: "What is the treatment for Burkitt lymphoma?",
                options: [
                    "R-CHOP standard",
                    "Intensive short-course chemo (CODOX-M/IVAC, hyper-CVAD, DA-EPOCH-R) with CNS prophylaxis; highly curable if treated urgently",
                    "Observation",
                    "Radiation alone"
                ],
                correct: 1,
                explanation: "Burkitt lymphoma requires urgent, intensive treatment with short-cycle, dose-dense regimens: CODOX-M/IVAC, hyper-CVAD, or DA-EPOCH-R. CNS prophylaxis mandatory (IT chemotherapy). High tumor lysis risk - start rasburicase, hydration. With modern treatment, >80% cure rate even in adults.",
                keyPoint: "Burkitt: intensive regimen (CODOX-M/IVAC, hyper-CVAD). CNS prophylaxis always. TLS precautions. >80% curable.",
                citation: "Dunleavy K, et al. Blood. 2017;129:3251-3260",
                url: "https://scholar.google.com/scholar?q=Dunleavy+Burkitt+lymphoma+DA-EPOCH-R"
            },
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "resident",
                question: "What is the FLIPI score and what does it predict?",
                options: [
                    "Hodgkin lymphoma staging",
                    "Follicular Lymphoma International Prognostic Index; uses age, stage, hemoglobin, LDH, nodal sites to predict prognosis",
                    "Treatment response",
                    "Transformation risk only"
                ],
                correct: 1,
                explanation: "FLIPI (Follicular Lymphoma International Prognostic Index) uses 5 factors: age >60, stage III-IV, Hgb <12, elevated LDH, >4 nodal sites. Risk groups: low (0-1), intermediate (2), high (3-5). FLIPI2 adds 2-microglobulin and bone marrow involvement. Helps estimate prognosis, less so treatment selection.",
                keyPoint: "FLIPI: age, stage, Hgb, LDH, nodal sites. Low/intermediate/high risk. Prognostic, less treatment-guiding.",
                citation: "Solal-Cligny P, et al. Blood. 2004;104:1258-1265",
                pmid: "15126323",
                doi: "10.1182/blood-2003-12-4434"
            },
            {
                type: "simple",
                typeLabel: "Complications",
                difficulty: "intern",
                question: "What is tumor lysis syndrome and which lymphomas are highest risk?",
                options: [
                    "Only occurs with solid tumors",
                    "Metabolic emergency (K, uric acid, phosphate, calcium) from rapid cell death; highest risk in Burkitt, lymphoblastic lymphoma, high-bulk DLBCL",
                    "No prevention possible",
                    "Only occurs post-transplant"
                ],
                correct: 1,
                explanation: "TLS occurs from rapid cell lysis releasing intracellular contents. Labs: hyperkalemia, hyperuricemia, hyperphosphatemia, hypocalcemia. Can cause renal failure, arrhythmias, seizures. Highest risk: Burkitt, lymphoblastic, bulky DLBCL. Prevention: hydration, allopurinol or rasburicase (if high risk/existing uric acid).",
                keyPoint: "TLS: K, uric acid, phos, Ca. Highest risk: Burkitt, lymphoblastic. Prevent with hydration, rasburicase.",
                citation: "Cairo MS, et al. Br J Haematol. 2010;149:578-586",
                pmid: "20331465",
                doi: "10.1111/j.1365-2141.2010.08143.x"
            },
            {
                type: "simple",
                typeLabel: "Complications",
                difficulty: "fellow",
                question: "What is the hepatitis B reactivation risk with rituximab and how is it managed?",
                options: [
                    "No risk with rituximab",
                    "High risk; screen all patients for HBsAg and anti-HBc before rituximab; prophylaxis with entecavir/tenofovir if positive; continue 12-18 months after last dose",
                    "Only with steroids",
                    "Treat only if reactivation occurs"
                ],
                correct: 1,
                explanation: "Rituximab (and other anti-CD20 antibodies) confers high HBV reactivation risk in HBsAg+ patients (>50% without prophylaxis). Screen all patients for HBsAg, anti-HBc, anti-HBs before treatment. Prophylaxis with entecavir or tenofovir if positive. Continue 12-18 months after last rituximab. Even anti-HBc+ only (resolved HBV) has reactivation risk.",
                keyPoint: "HBV reactivation: screen before rituximab. Prophylaxis with entecavir/tenofovir. Continue 12-18mo post-treatment.",
                citation: "Loomba R, et al. Ann Intern Med. 2008;148:519-528",
                pmid: "18378948",
                doi: "10.7326/0003-4819-148-7-200804010-00008"
            },
            {
                type: "simple",
                typeLabel: "Treatment",
                difficulty: "attending",
                question: "What is the role of allogeneic transplant in lymphoma?",
                options: [
                    "First-line for all lymphomas",
                    "Reserved for relapsed/refractory disease after auto-HCT failure; provides graft-vs-lymphoma effect; reduced-intensity conditioning expands eligibility",
                    "Never used in lymphoma",
                    "Only for Hodgkin lymphoma"
                ],
                correct: 1,
                explanation: "Allo-HCT provides graft-vs-lymphoma effect for relapsed/refractory disease, typically after auto-HCT failure. Reduced-intensity conditioning (RIC) allows older/comorbid patients. Best outcomes in chemosensitive disease. Graft-vs-host disease provides antitumor effect. Consider for: relapsed after auto, MCL, T-cell lymphomas.",
                keyPoint: "Allo-HCT: for relapsed after auto failure. GVL effect. RIC expands eligibility. Chemosensitive disease preferred.",
                citation: "Robinson SP, et al. J Clin Oncol. 2013;31:2912-2919",
                url: "https://scholar.google.com/scholar?q=Robinson+SP+allogeneic+transplant+T-cell+lymphoma+EBMT"
            },
            {
                type: "simple",
                typeLabel: "Diagnosis",
                difficulty: "fellow",
                question: "What genetic testing is essential in CLL at diagnosis?",
                options: [
                    "No genetics needed",
                    "FISH for del(17p), del(11q), trisomy 12, del(13q); TP53 mutation; IGHV mutation status for prognosis and treatment selection",
                    "Only karyotype",
                    "NGS panel only"
                ],
                correct: 1,
                explanation: "CLL requires: FISH (del17p - worst prognosis, del11q - adverse, trisomy 12 - intermediate, del13q alone - favorable), TP53 mutation testing, and IGHV mutation status (unmutated - worse prognosis, mutated - better). del17p/TP53 mutation: avoid chemoimmunotherapy, use BTK inhibitors or venetoclax.",
                keyPoint: "CLL genetics: FISH (del17p, 11q, +12, 13q), TP53 mutation, IGHV status. del17p/TP53mut  BTKi or venetoclax.",
                citation: "Hallek M, et al. Blood. 2018;131:2745-2760",
                pmid: "29540348",
                doi: "10.1182/blood-2017-09-806398"
            }
        ];

        // Game State
        let gameState = {
            mode: 'mixed',
            difficulty: 'resident',
            currentQuestion: 0,
            score: 0,
            streak: 0,
            correct: 0,
            answered: false,
            questions: []
        };

        // Select difficulty level
        function selectDifficulty(btn) {
            document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            gameState.difficulty = btn.dataset.difficulty;
        }

        // ASH Image Bank URLs for actual H&E histopathology images
        const histopathImages = {
            dlbcl: {
                url: "https://imagebank.hematology.org/getimagebyid/2076?size=3",
                source: "ASH Image Bank #2076",
                author: "Marshall Kadin, MD"
            },
            hodgkin: {
                url: "https://imagebank.hematology.org/getimagebyid/60569?size=3",
                source: "ASH Image Bank #60569",
                author: "ASH Image Bank"
            },
            follicular: {
                url: "https://imagebank.hematology.org/getimagebyid/63988?size=3",
                source: "ASH Image Bank #63988",
                author: "ASH Image Bank"
            },
            burkitt: {
                url: "https://imagebank.hematology.org/getimagebyid/61346?size=3",
                source: "ASH Image Bank #61346",
                author: "Timothy C Carll, MD"
            },
            mcl: {
                url: "https://imagebank.hematology.org/getimagebyid/60458?size=3",
                source: "ASH Image Bank #60458",
                author: "Joo Y. Song, MD"
            }
        };

        // SVG Histopathology Schematics (cartoon versions)
        const histopathSVGs = {
            dlbcl: `<svg viewBox="0 0 400 150" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <filter id="blur1"><feGaussianBlur stdDeviation="0.5"/></filter>
                </defs>
                <!-- Background stroma -->
                <rect fill="rgba(245, 235, 220, 1)" width="400" height="150"/>
                <!-- Large atypical lymphoid cells - DLBCL pattern -->
                ${Array.from({length: 35}, (_, i) => {
                    const x = 15 + (i % 7) * 55 + Math.random() * 20;
                    const y = 15 + Math.floor(i / 7) * 30 + Math.random() * 10;
                    const size = 18 + Math.random() * 8;
                    return `<g transform="translate(${x},${y})">
                        <circle r="${size}" fill="rgba(180, 200, 230, 0.7)" stroke="rgba(80, 100, 150, 0.5)" stroke-width="0.8"/>
                        <circle r="${size * 0.6}" fill="rgba(60, 40, 100, 0.85)" cy="-2"/>
                        <circle r="${size * 0.15}" fill="rgba(200, 150, 180, 0.9)" cx="${size * 0.2}" cy="-${size * 0.15}"/>
                        <circle r="${size * 0.1}" fill="rgba(200, 150, 180, 0.8)" cx="-${size * 0.15}" cy="${size * 0.1}"/>
                    </g>`;
                }).join('')}
                <!-- Small reactive lymphocytes -->
                ${Array.from({length: 20}, () => `<circle cx="${Math.random() * 380 + 10}" cy="${Math.random() * 130 + 10}" r="${4 + Math.random() * 2}" fill="rgba(120, 100, 150, 0.6)"/>`).join('')}
            </svg>`,

            hodgkin: `<svg viewBox="0 0 400 150" xmlns="http://www.w3.org/2000/svg">
                <rect fill="rgba(245, 235, 220, 1)" width="400" height="150"/>
                <!-- Mixed inflammatory background -->
                ${Array.from({length: 60}, () => {
                    const x = Math.random() * 380 + 10;
                    const y = Math.random() * 130 + 10;
                    const type = Math.random();
                    if (type < 0.5) return `<circle cx="${x}" cy="${y}" r="${3 + Math.random() * 2}" fill="rgba(150, 130, 180, 0.6)"/>`;
                    if (type < 0.7) return `<circle cx="${x}" cy="${y}" r="${4 + Math.random() * 2}" fill="rgba(255, 180, 180, 0.7)"/>`;
                    return `<circle cx="${x}" cy="${y}" r="${5 + Math.random() * 2}" fill="rgba(200, 180, 160, 0.5)"/>`;
                }).join('')}
                <!-- Reed-Sternberg cells with owl-eye nuclei -->
                <g transform="translate(120, 75)">
                    <ellipse rx="28" ry="24" fill="rgba(220, 190, 210, 0.8)" stroke="rgba(150, 100, 130, 0.6)" stroke-width="1.5"/>
                    <circle cx="-8" cy="-3" r="9" fill="rgba(50, 30, 70, 0.9)"/>
                    <circle cx="8" cy="-3" r="9" fill="rgba(50, 30, 70, 0.9)"/>
                    <circle cx="-8" cy="-3" r="3" fill="rgba(200, 150, 180, 0.95)"/>
                    <circle cx="8" cy="-3" r="3" fill="rgba(200, 150, 180, 0.95)"/>
                </g>
                <g transform="translate(280, 60)">
                    <ellipse rx="25" ry="22" fill="rgba(220, 190, 210, 0.8)" stroke="rgba(150, 100, 130, 0.6)" stroke-width="1.5"/>
                    <circle cx="-7" cy="-2" r="8" fill="rgba(50, 30, 70, 0.9)"/>
                    <circle cx="7" cy="-2" r="8" fill="rgba(50, 30, 70, 0.9)"/>
                    <circle cx="-7" cy="-2" r="2.5" fill="rgba(200, 150, 180, 0.95)"/>
                    <circle cx="7" cy="-2" r="2.5" fill="rgba(200, 150, 180, 0.95)"/>
                </g>
            </svg>`,

            follicular: `<svg viewBox="0 0 400 150" xmlns="http://www.w3.org/2000/svg">
                <rect fill="rgba(245, 235, 220, 1)" width="400" height="150"/>
                <!-- Follicular pattern - back-to-back follicles -->
                <ellipse cx="80" cy="75" rx="55" ry="50" fill="rgba(180, 200, 220, 0.4)" stroke="rgba(100, 120, 150, 0.4)" stroke-width="1"/>
                <ellipse cx="200" cy="75" rx="60" ry="52" fill="rgba(180, 200, 220, 0.4)" stroke="rgba(100, 120, 150, 0.4)" stroke-width="1"/>
                <ellipse cx="320" cy="75" rx="55" ry="50" fill="rgba(180, 200, 220, 0.4)" stroke="rgba(100, 120, 150, 0.4)" stroke-width="1"/>
                <!-- Centrocytes (cleaved) and centroblasts inside follicles -->
                ${Array.from({length: 40}, (_, i) => {
                    const follicle = i % 3;
                    const cx = follicle === 0 ? 80 : follicle === 1 ? 200 : 320;
                    const x = cx + (Math.random() - 0.5) * 80;
                    const y = 75 + (Math.random() - 0.5) * 70;
                    const isLarge = Math.random() > 0.7;
                    const size = isLarge ? 8 + Math.random() * 4 : 5 + Math.random() * 3;
                    return `<circle cx="${x}" cy="${y}" r="${size}" fill="rgba(${isLarge ? '100, 130, 180' : '140, 120, 170'}, 0.6)"/>`;
                }).join('')}
                <!-- Attenuated mantle zones -->
                <ellipse cx="80" cy="75" rx="58" ry="53" fill="none" stroke="rgba(80, 100, 130, 0.3)" stroke-width="3" stroke-dasharray="2,2"/>
                <ellipse cx="200" cy="75" rx="63" ry="55" fill="none" stroke="rgba(80, 100, 130, 0.3)" stroke-width="3" stroke-dasharray="2,2"/>
                <ellipse cx="320" cy="75" rx="58" ry="53" fill="none" stroke="rgba(80, 100, 130, 0.3)" stroke-width="3" stroke-dasharray="2,2"/>
            </svg>`,

            burkitt: `<svg viewBox="0 0 400 150" xmlns="http://www.w3.org/2000/svg">
                <rect fill="rgba(245, 235, 220, 1)" width="400" height="150"/>
                <!-- Monotonous medium-sized cells -->
                ${Array.from({length: 80}, (_, i) => {
                    const x = 12 + (i % 14) * 28 + Math.random() * 8;
                    const y = 12 + Math.floor(i / 14) * 25 + Math.random() * 6;
                    return `<g transform="translate(${x},${y})">
                        <circle r="10" fill="rgba(160, 180, 220, 0.7)" stroke="rgba(80, 100, 140, 0.4)" stroke-width="0.5"/>
                        <circle r="6" fill="rgba(50, 40, 90, 0.85)" cy="-1"/>
                    </g>`;
                }).join('')}
                <!-- Starry-sky macrophages (tingible body) -->
                ${[{x: 60, y: 40}, {x: 150, y: 80}, {x: 250, y: 45}, {x: 340, y: 90}, {x: 100, y: 110}, {x: 300, y: 120}].map(pos =>
                    `<circle cx="${pos.x}" cy="${pos.y}" r="14" fill="rgba(255, 250, 235, 0.9)" stroke="rgba(200, 180, 150, 0.4)" stroke-width="1"/>
                     <circle cx="${pos.x}" cy="${pos.y}" r="6" fill="rgba(180, 140, 100, 0.6)"/>`
                ).join('')}
            </svg>`,

            mcl: `<svg viewBox="0 0 400 150" xmlns="http://www.w3.org/2000/svg">
                <rect fill="rgba(245, 235, 220, 1)" width="400" height="150"/>
                <!-- Small to medium monotonous cells with irregular nuclei -->
                ${Array.from({length: 90}, (_, i) => {
                    const x = 10 + (i % 15) * 26 + Math.random() * 8;
                    const y = 10 + Math.floor(i / 15) * 24 + Math.random() * 6;
                    return `<g transform="translate(${x},${y})">
                        <circle r="9" fill="rgba(190, 180, 210, 0.6)" stroke="rgba(100, 90, 130, 0.4)" stroke-width="0.5"/>
                        <ellipse rx="5" ry="4" fill="rgba(60, 45, 100, 0.85)" transform="rotate(${Math.random() * 60 - 30})"/>
                    </g>`;
                }).join('')}
            </svg>`
        };

        // Get histopath SVG by type
        function getHistopathSVG(histoType) {
            return histopathSVGs[histoType] || histopathSVGs.dlbcl;
        }

        // Initialize floating cells with improved visuals and more types
        function createCells() {
            const container = document.getElementById('cellContainer');
            const cellConfigs = [
                { type: 'b-cell', weight: 5, animation: 'float', sizeRange: [30, 50] },
                { type: 'lymphoma-cell', weight: 4, animation: 'float', sizeRange: [35, 55] },
                { type: 't-cell', weight: 3, animation: 'float2', sizeRange: [25, 40] },
                { type: 'macrophage', weight: 2, animation: 'morph', sizeRange: [45, 65] },
                { type: 'plasma-cell', weight: 2, animation: 'float3', sizeRange: [28, 42] },
                { type: 'antibody', weight: 3, animation: 'float', sizeRange: [30, 30] },
                { type: 'neutrophil', weight: 2, animation: 'float2', sizeRange: [30, 45] },
                { type: 'eosinophil', weight: 1, animation: 'float3', sizeRange: [28, 38] },
                { type: 'centroblast', weight: 2, animation: 'float', sizeRange: [35, 50] },
                { type: 'rbc', weight: 3, animation: 'float2', sizeRange: [18, 25] }
            ];

            // Build weighted array
            const weightedTypes = [];
            cellConfigs.forEach(config => {
                for (let i = 0; i < config.weight; i++) {
                    weightedTypes.push(config);
                }
            });

            for (let i = 0; i < 45; i++) {
                const config = weightedTypes[Math.floor(Math.random() * weightedTypes.length)];
                const cell = document.createElement('div');
                cell.className = `cell ${config.type}`;

                const size = config.type === 'antibody' ? 30 :
                    config.sizeRange[0] + Math.random() * (config.sizeRange[1] - config.sizeRange[0]);

                cell.style.width = `${size}px`;
                cell.style.height = config.type === 'antibody' ? '40px' : `${size}px`;
                cell.style.left = `${Math.random() * 100}%`;
                cell.style.top = `${Math.random() * 100}%`;

                const delay = Math.random() * 25;
                const duration = 18 + Math.random() * 15;

                if (config.type === 'macrophage') {
                    cell.style.animation = `float ${duration}s ${delay}s infinite ease-in-out, morph 8s ${delay}s infinite ease-in-out`;
                } else {
                    cell.style.animationName = config.animation;
                    cell.style.animationDelay = `${delay}s`;
                    cell.style.animationDuration = `${duration}s`;
                    cell.style.animationIterationCount = 'infinite';
                    cell.style.animationTimingFunction = 'ease-in-out';
                }

                // Add slight opacity variation
                cell.style.opacity = 0.5 + Math.random() * 0.35;

                container.appendChild(cell);
            }
        }

        // Create Space Invaders animation
        function createSpaceInvaders() {
            const container = document.getElementById('spaceInvadersContainer');
            if (!container) return;

            const invaderTypes = ['invader-lymphoma', 'invader-bcell', 'invader-tcell', 'invader-rscell', 'invader-macrophage'];
            const rowConfigs = [
                { type: 'invader-lymphoma', count: 8 },  // Top row - lymphoma cells
                { type: 'invader-rscell', count: 7 },    // Reed-Sternberg cells
                { type: 'invader-bcell', count: 8 },     // B-cells
                { type: 'invader-tcell', count: 7 },     // T-cells
                { type: 'invader-macrophage', count: 6 } // Bottom row - macrophages
            ];

            rowConfigs.forEach((config, rowIndex) => {
                const row = document.createElement('div');
                row.className = 'invader-row';
                row.style.animationDelay = `${rowIndex * 0.3}s`;

                for (let i = 0; i < config.count; i++) {
                    const invader = document.createElement('div');
                    invader.className = `invader ${config.type}`;
                    invader.style.animationDelay = `${Math.random() * 0.5}s`;
                    row.appendChild(invader);
                }

                container.appendChild(row);
            });
        }

        // Fire laser animation on correct answer
        function fireLaser() {
            const ship = document.getElementById('playerShip');
            if (!ship) return;

            const laser = document.createElement('div');
            laser.className = 'laser';
            laser.style.left = 'calc(50% - 2px)';
            document.body.appendChild(laser);

            setTimeout(() => laser.remove(), 1000);
        }

        // Show score explosion animation
        function showScoreExplosion(points, x, y) {
            const explosion = document.createElement('div');
            explosion.className = 'score-explosion';
            explosion.textContent = `+${points}`;
            explosion.style.left = `${x}px`;
            explosion.style.top = `${y}px`;
            document.body.appendChild(explosion);

            setTimeout(() => explosion.remove(), 1000);
        }

        function selectMode(btn) {
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            gameState.mode = btn.dataset.mode;
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function startGame() {
            // Difficulty levels hierarchy: intern < resident < fellow < attending
            const difficultyLevels = {
                'intern': ['intern'],
                'resident': ['intern', 'resident'],
                'fellow': ['intern', 'resident', 'fellow'],
                'attending': ['intern', 'resident', 'fellow', 'attending']
            };

            let filteredQuestions = questions;

            // Filter by difficulty - show questions at or below selected level
            const allowedDifficulties = difficultyLevels[gameState.difficulty] || difficultyLevels['resident'];
            filteredQuestions = filteredQuestions.filter(q => allowedDifficulties.includes(q.difficulty));

            // Then filter by mode (cases/quick/mixed)
            if (gameState.mode === 'cases') {
                filteredQuestions = filteredQuestions.filter(q => q.type === 'case');
            } else if (gameState.mode === 'quick') {
                filteredQuestions = filteredQuestions.filter(q => q.type === 'simple');
            }

            // Determine number of questions based on difficulty
            const questionCounts = { 'intern': 10, 'resident': 12, 'fellow': 15, 'attending': 18 };
            const numQuestions = Math.min(questionCounts[gameState.difficulty] || 15, filteredQuestions.length);

            gameState.questions = shuffleArray(filteredQuestions).slice(0, numQuestions);
            gameState.currentQuestion = 0;
            gameState.score = 0;
            gameState.streak = 0;
            gameState.correct = 0;

            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            document.getElementById('resultsScreen').style.display = 'none';

            displayQuestion();
            updateStats();
        }

        function displayQuestion() {
            const q = gameState.questions[gameState.currentQuestion];
            const card = document.getElementById('questionCard');
            gameState.answered = false;

            const typeClass = q.type === 'case' ? 'type-case' :
                             q.typeLabel === 'Treatment' ? 'type-treatment' :
                             q.typeLabel === 'Staging' || q.typeLabel === 'Diagnosis' ? 'type-staging' : 'type-simple';

            let html = `
                <span class="question-type ${typeClass}">${q.typeLabel}</span>
                <span class="difficulty-badge ${q.difficulty}">${q.difficulty}</span>
                <div class="question-number">Question ${gameState.currentQuestion + 1} of ${gameState.questions.length}</div>
            `;

            if (q.case) {
                html += `
                    <div class="case-presentation">
                        <h4>Clinical Presentation</h4>
                        <p>${q.case.presentation}</p>
                        ${q.case.labs ? `
                            <div class="lab-values">
                                ${q.case.labs.map(lab => `
                                    <div class="lab-item ${lab.abnormal ? 'abnormal' : ''}">
                                        <strong>${lab.name}:</strong> ${lab.value}
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        ${q.case.histopath ? `
                            <div class="histopath-dual">
                                <div class="histopath-panel he">
                                    <div class="histopath-panel-label">H&E Stain (Actual)</div>
                                    <div class="histopath-svg he-stain">
                                        <img src="${histopathImages[q.case.histopath.type]?.url || ''}"
                                             alt="${q.case.histopath.description}"
                                             style="width:100%; height:100%; object-fit:cover; border-radius:4px;"
                                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                        <div style="display:none; align-items:center; justify-content:center; height:100%; color:var(--text-muted); font-size:0.8em;">
                                            Image from ASH Image Bank
                                        </div>
                                    </div>
                                    <div class="histopath-caption">${histopathImages[q.case.histopath.type]?.source || 'ASH Image Bank'}</div>
                                </div>
                                <div class="histopath-panel schematic">
                                    <div class="histopath-panel-label">Schematic Diagram</div>
                                    <div class="histopath-svg schematic">
                                        ${getHistopathSVG(q.case.histopath.type || 'dlbcl')}
                                    </div>
                                    <div class="histopath-caption">${q.case.histopath.description}</div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            html += `<div class="question-text">${q.question}</div>`;

            html += `<div class="options">`;
            const letters = ['A', 'B', 'C', 'D'];
            q.options.forEach((opt, i) => {
                html += `
                    <div class="option" onclick="selectAnswer(${i})" data-index="${i}">
                        <span class="option-letter">${letters[i]}</span>
                        <span class="option-text">${opt}</span>
                    </div>
                `;
            });
            html += `</div>`;

            html += `
                <div class="explanation" id="explanation">
                    <h4>Explanation</h4>
                    <p>${q.explanation}</p>
                    ${q.keyPoint ? `
                        <div class="key-point">
                            <strong>High-Yield Point</strong>
                            <p>${q.keyPoint}</p>
                        </div>
                    ` : ''}
                    ${q.citation ? `
                        <div class="citation">
                            <strong> Citation:</strong> ${q.citation}
                            ${renderReferenceLinks(q)}
                        </div>
                    ` : ''}
                </div>
                <button class="next-btn" id="nextBtn" onclick="nextQuestion()">
                    ${gameState.currentQuestion < gameState.questions.length - 1 ? 'Next Question' : 'See Results'}
                </button>
            `;

            card.innerHTML = html;

            const progress = ((gameState.currentQuestion) / gameState.questions.length) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        function selectAnswer(index) {
            if (gameState.answered) return;
            gameState.answered = true;

            const q = gameState.questions[gameState.currentQuestion];
            const options = document.querySelectorAll('.option');

            options.forEach((opt, i) => {
                opt.classList.add('disabled');
                if (i === q.correct) {
                    opt.classList.add('correct');
                } else if (i === index && index !== q.correct) {
                    opt.classList.add('incorrect');
                }
            });

            if (index === q.correct) {
                gameState.correct++;
                gameState.streak++;
                const points = 100 + (gameState.streak * 10);
                gameState.score += points;
                // Fire laser and show score explosion on correct answer
                fireLaser();
                const rect = options[index].getBoundingClientRect();
                showScoreExplosion(points, rect.left + rect.width / 2, rect.top);
            } else {
                gameState.streak = 0;
            }

            updateStats();
            document.getElementById('explanation').classList.add('show');
            document.getElementById('nextBtn').classList.add('show');
        }

        function nextQuestion() {
            gameState.currentQuestion++;

            if (gameState.currentQuestion >= gameState.questions.length) {
                showResults();
            } else {
                displayQuestion();
            }
        }

        function updateStats() {
            document.getElementById('scoreValue').textContent = gameState.score;
            document.getElementById('streakValue').textContent = gameState.streak;
            document.getElementById('correctValue').textContent =
                `${gameState.correct}/${gameState.currentQuestion + (gameState.answered ? 1 : 0)}`;
        }

        function showResults() {
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('resultsScreen').style.display = 'block';

            const percentage = Math.round((gameState.correct / gameState.questions.length) * 100);

            document.getElementById('scoreCircle').style.setProperty('--score-percent', `${percentage}%`);
            document.getElementById('finalScore').textContent = `${percentage}%`;

            const gradeText = document.getElementById('gradeText');
            const resultsMessage = document.getElementById('resultsMessage');

            // Check if SF mode is active
            const isSF = document.body.classList.contains('sf-mode');

            if (percentage >= 80) {
                gradeText.textContent = isSF ? 'PERFECT VICTORY!' : 'Attending Level Performance';
                gradeText.className = 'grade grade-pass';
                resultsMessage.textContent = isSF ? 'YOU WIN! FLAWLESS TECHNIQUE!' : 'Excellent command of lymphoma management principles.';
                if (isSF) showSFAnnouncement('PERFECT!');
            } else if (percentage >= 60) {
                gradeText.textContent = isSF ? 'YOU WIN!' : 'Fellow Level Performance';
                gradeText.className = 'grade grade-pass';
                resultsMessage.textContent = isSF ? 'GOOD FIGHT! TRAIN HARDER!' : 'Solid foundation. Review missed questions to strengthen knowledge.';
                if (isSF) showSFAnnouncement('YOU WIN!');
            } else {
                gradeText.textContent = isSF ? 'K.O.!' : 'Keep Studying';
                gradeText.className = 'grade grade-fail';
                resultsMessage.textContent = isSF ? 'CONTINUE? INSERT COIN TO TRY AGAIN!' : 'Review lymphoma classifications, staging, and treatment algorithms.';
                if (isSF) showSFAnnouncement('GAME OVER');
            }
        }

        function restartGame() {
            document.getElementById('resultsScreen').style.display = 'none';
            document.getElementById('startScreen').style.display = 'block';
        }

        // ============ STREET FIGHTER MODE ============
        let sfMode = false;
        let audioCtx = null;

        const sfAnnouncements = {
            start: ['FIGHT!', 'ROUND 1!', 'READY?', 'K.O. THOSE QUESTIONS!', 'PERFECT!'],
            correct: ['PERFECT!', 'EXCELLENT!', 'GREAT!', 'COMBO!', 'SUPER!', 'HADOUKEN!', 'SHORYUKEN!'],
            incorrect: ['K.O.!', 'YOU LOSE!', 'TRY AGAIN!', 'BLOCKED!'],
            combo: ['2 HIT COMBO!', '3 HIT COMBO!', '4 HIT COMBO!', '5 HIT COMBO!', 'SUPER COMBO!', 'ULTRA COMBO!', 'LEGENDARY!']
        };

        // ===== WEB AUDIO API SOUND EFFECTS =====
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            return audioCtx;
        }

        function playSFSound(type) {
            if (!sfMode) return;
            try {
                const ctx = initAudio();
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);

                switch(type) {
                    case 'select': // Menu select blip
                        oscillator.type = 'square';
                        oscillator.frequency.setValueAtTime(800, ctx.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(1200, ctx.currentTime + 0.1);
                        gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                        oscillator.start(ctx.currentTime);
                        oscillator.stop(ctx.currentTime + 0.1);
                        break;

                    case 'correct': // Hit/success sound
                        oscillator.type = 'sawtooth';
                        oscillator.frequency.setValueAtTime(400, ctx.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(800, ctx.currentTime + 0.05);
                        oscillator.frequency.exponentialRampToValueAtTime(1200, ctx.currentTime + 0.1);
                        gainNode.gain.setValueAtTime(0.4, ctx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.15);
                        oscillator.start(ctx.currentTime);
                        oscillator.stop(ctx.currentTime + 0.15);
                        break;

                    case 'incorrect': // Block/fail sound
                        oscillator.type = 'sawtooth';
                        oscillator.frequency.setValueAtTime(200, ctx.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(80, ctx.currentTime + 0.2);
                        gainNode.gain.setValueAtTime(0.4, ctx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                        oscillator.start(ctx.currentTime);
                        oscillator.stop(ctx.currentTime + 0.3);
                        break;

                    case 'combo': // Combo sound
                        oscillator.type = 'square';
                        oscillator.frequency.setValueAtTime(600, ctx.currentTime);
                        oscillator.frequency.setValueAtTime(800, ctx.currentTime + 0.05);
                        oscillator.frequency.setValueAtTime(1000, ctx.currentTime + 0.1);
                        oscillator.frequency.setValueAtTime(1200, ctx.currentTime + 0.15);
                        gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);
                        oscillator.start(ctx.currentTime);
                        oscillator.stop(ctx.currentTime + 0.2);
                        break;

                    case 'hadouken': // Special move sound
                        oscillator.type = 'sawtooth';
                        oscillator.frequency.setValueAtTime(150, ctx.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(400, ctx.currentTime + 0.1);
                        oscillator.frequency.exponentialRampToValueAtTime(100, ctx.currentTime + 0.3);
                        gainNode.gain.setValueAtTime(0.5, ctx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.4);
                        oscillator.start(ctx.currentTime);
                        oscillator.stop(ctx.currentTime + 0.4);
                        break;

                    case 'fight': // FIGHT announcement
                        oscillator.type = 'square';
                        oscillator.frequency.setValueAtTime(300, ctx.currentTime);
                        oscillator.frequency.setValueAtTime(450, ctx.currentTime + 0.1);
                        oscillator.frequency.setValueAtTime(600, ctx.currentTime + 0.2);
                        gainNode.gain.setValueAtTime(0.4, ctx.currentTime);
                        gainNode.gain.setValueAtTime(0.4, ctx.currentTime + 0.2);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.4);
                        oscillator.start(ctx.currentTime);
                        oscillator.stop(ctx.currentTime + 0.4);
                        break;

                    case 'ko': // K.O. sound
                        oscillator.type = 'sawtooth';
                        oscillator.frequency.setValueAtTime(500, ctx.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(50, ctx.currentTime + 0.5);
                        gainNode.gain.setValueAtTime(0.5, ctx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.6);
                        oscillator.start(ctx.currentTime);
                        oscillator.stop(ctx.currentTime + 0.6);
                        break;

                    case 'perfect': // Perfect victory
                        for (let i = 0; i < 5; i++) {
                            const osc = ctx.createOscillator();
                            const gain = ctx.createGain();
                            osc.connect(gain);
                            gain.connect(ctx.destination);
                            osc.type = 'square';
                            osc.frequency.setValueAtTime(400 + (i * 200), ctx.currentTime + (i * 0.1));
                            gain.gain.setValueAtTime(0.2, ctx.currentTime + (i * 0.1));
                            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + (i * 0.1) + 0.1);
                            osc.start(ctx.currentTime + (i * 0.1));
                            osc.stop(ctx.currentTime + (i * 0.1) + 0.15);
                        }
                        break;

                    case 'activate': // Mode activation
                        for (let i = 0; i < 3; i++) {
                            const osc = ctx.createOscillator();
                            const gain = ctx.createGain();
                            osc.connect(gain);
                            gain.connect(ctx.destination);
                            osc.type = 'square';
                            osc.frequency.setValueAtTime(600 + (i * 300), ctx.currentTime + (i * 0.08));
                            gain.gain.setValueAtTime(0.3, ctx.currentTime + (i * 0.08));
                            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + (i * 0.08) + 0.1);
                            osc.start(ctx.currentTime + (i * 0.08));
                            osc.stop(ctx.currentTime + (i * 0.08) + 0.12);
                        }
                        break;
                }
            } catch(e) { console.log('Audio not supported'); }
        }

        // ===== VISUAL EFFECTS =====
        function showScreenFlash(type) {
            const flash = document.getElementById('sfScreenFlash');
            flash.className = 'sf-screen-flash ' + type;
            flash.style.animation = 'none';
            flash.offsetHeight;
            flash.style.animation = '';
        }

        function createHitSpark(x, y, emoji = '') {
            const spark = document.createElement('div');
            spark.className = 'sf-hit-spark';
            spark.textContent = emoji;
            spark.style.left = x + 'px';
            spark.style.top = y + 'px';
            document.body.appendChild(spark);
            setTimeout(() => spark.remove(), 500);
        }

        function createDamageNumber(x, y, text, isBonus = false) {
            const num = document.createElement('div');
            num.className = 'sf-damage-number' + (isBonus ? ' bonus' : '');
            num.textContent = text;
            num.style.left = x + 'px';
            num.style.top = y + 'px';
            document.body.appendChild(num);
            setTimeout(() => num.remove(), 1000);
        }

        function createFireball() {
            const fireball = document.createElement('div');
            fireball.className = 'sf-fireball';
            fireball.style.top = (Math.random() * 60 + 20) + '%';
            document.body.appendChild(fireball);
            playSFSound('hadouken');
            setTimeout(() => fireball.remove(), 800);
        }

        function showVsScreen() {
            const vsScreen = document.getElementById('sfVsScreen');
            vsScreen.classList.add('show');
            playSFSound('fight');
            setTimeout(() => {
                vsScreen.classList.remove('show');
            }, 2000);
        }

        function updatePowerMeter() {
            const fill = document.getElementById('sfPowerFill');
            const power = Math.min(gameState.streak * 15, 100);
            fill.style.height = power + '%';

            // Super move at max power
            if (gameState.streak >= 7 && sfMode) {
                fill.style.boxShadow = '0 0 20px #ff0040, 0 0 40px #ffd700';
            } else {
                fill.style.boxShadow = '0 0 10px currentColor';
            }
        }

        function toggleSFMode() {
            sfMode = !sfMode;
            document.body.classList.toggle('sf-mode', sfMode);

            if (sfMode) {
                playSFSound('activate');
                setTimeout(() => {
                    showSFAnnouncement(sfAnnouncements.start[Math.floor(Math.random() * sfAnnouncements.start.length)]);
                }, 300);
                if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
            }

            localStorage.setItem('lymphoinvader-sf-mode', sfMode);
        }

        function showSFAnnouncement(text) {
            const announcement = document.getElementById('sfAnnouncement');
            announcement.textContent = text;
            announcement.style.display = 'block';

            // Play appropriate sound
            if (text.includes('FIGHT')) playSFSound('fight');
            else if (text.includes('K.O.') || text.includes('GAME OVER')) playSFSound('ko');
            else if (text.includes('PERFECT')) playSFSound('perfect');
            else if (text.includes('HADOUKEN') || text.includes('SHORYUKEN')) playSFSound('hadouken');
            else if (text.includes('COMBO')) playSFSound('combo');

            announcement.style.animation = 'none';
            announcement.offsetHeight;
            announcement.style.animation = 'sf-announce 1s ease-out forwards';

            setTimeout(() => {
                announcement.style.display = 'none';
            }, 1000);
        }

        function updateComboCounter() {
            if (!sfMode) return;

            const counter = document.getElementById('comboCounter');
            if (gameState.streak >= 2) {
                let comboText = '';
                if (gameState.streak >= 7) comboText = 'LEGENDARY COMBO! x' + gameState.streak;
                else if (gameState.streak >= 5) comboText = 'ULTRA COMBO! x' + gameState.streak;
                else if (gameState.streak >= 3) comboText = 'SUPER COMBO! x' + gameState.streak;
                else comboText = gameState.streak + ' HIT COMBO!';

                counter.textContent = comboText;
                counter.classList.add('show');
                playSFSound('combo');

                if (gameState.streak === 3 || gameState.streak === 5 || gameState.streak === 7) {
                    showSFAnnouncement(comboText);
                    showScreenFlash('epic');
                    if (gameState.streak >= 5) createFireball();
                }
            } else {
                counter.classList.remove('show');
            }

            updatePowerMeter();
        }

        // Override selectAnswer for SF mode effects
        const originalSelectAnswer = selectAnswer;
        selectAnswer = function(index) {
            const wasStreak = gameState.streak;
            originalSelectAnswer(index);

            if (sfMode) {
                const q = gameState.questions[gameState.currentQuestion];
                const options = document.querySelectorAll('.option');
                const selectedOption = options[index];
                const rect = selectedOption.getBoundingClientRect();

                if (index === q.correct) {
                    // Correct answer effects
                    playSFSound('correct');
                    showScreenFlash('correct');
                    createHitSpark(rect.left + rect.width/2, rect.top, '');

                    // Score popup
                    const scoreBonus = 100 + (gameState.streak * 10);
                    createDamageNumber(rect.right - 50, rect.top, '+' + scoreBonus, gameState.streak > 1);

                    if (gameState.streak === 1) {
                        showSFAnnouncement(sfAnnouncements.correct[Math.floor(Math.random() * sfAnnouncements.correct.length)]);
                    }
                    updateComboCounter();
                } else {
                    // Incorrect answer effects
                    playSFSound('incorrect');
                    showScreenFlash('incorrect');
                    createHitSpark(rect.left + rect.width/2, rect.top, '');
                    showSFAnnouncement(sfAnnouncements.incorrect[Math.floor(Math.random() * sfAnnouncements.incorrect.length)]);
                    document.getElementById('comboCounter').classList.remove('show');
                    document.getElementById('sfPowerFill').style.height = '0%';

                    // Shake the screen
                    document.body.style.animation = 'sf-shake 0.3s ease-in-out';
                    setTimeout(() => document.body.style.animation = '', 300);
                }
            }
        };

        // Override startGame for SF mode
        const originalStartGame = startGame;
        startGame = function() {
            if (sfMode) {
                showVsScreen();
                setTimeout(() => {
                    originalStartGame();
                    document.getElementById('sfPowerFill').style.height = '0%';
                }, 2000);
            } else {
                originalStartGame();
            }
        };

        // Add hover sound to options in SF mode
        document.addEventListener('mouseover', function(e) {
            if (sfMode && e.target.classList.contains('option') && !e.target.classList.contains('disabled')) {
                playSFSound('select');
            }
        });

        // Check for saved SF mode preference
        if (localStorage.getItem('lymphoinvader-sf-mode') === 'true') {
            sfMode = true;
            document.body.classList.add('sf-mode');
        }

        // ============ THE KNICK STYLE ELECTRONIC AMBIENT MUSIC ============
        // Inspired by Cliff Martinez's minimalist synth score
        let musicPlaying = false;
        let musicAudioCtx = null;
        let masterGain = null;
        let musicVolume = 0.7; // Default 70%
        let activeSynths = [];
        let musicInterval = null;
        let pulseInterval = null;
        let ambienceNodes = [];

        // Initialize music audio context with master gain
        function initMusicAudio() {
            if (!musicAudioCtx) {
                musicAudioCtx = new (window.AudioContext || window.webkitAudioContext)();
                // Create master gain node for volume control
                masterGain = musicAudioCtx.createGain();
                masterGain.gain.setValueAtTime(musicVolume, musicAudioCtx.currentTime);
                masterGain.connect(musicAudioCtx.destination);
            }
            return musicAudioCtx;
        }

        // Get the output node (master gain or destination)
        function getMusicOutput() {
            initMusicAudio();
            return masterGain || musicAudioCtx.destination;
        }

        // Set volume (0-100)
        function setVolume(value) {
            musicVolume = value / 100;

            // Update master gain if it exists
            if (masterGain && musicAudioCtx) {
                masterGain.gain.setValueAtTime(musicVolume, musicAudioCtx.currentTime);
            }

            // Update UI
            const slider = document.getElementById('volumeSlider');
            const valueDisplay = document.getElementById('volumeValue');
            const icon = document.getElementById('volumeIcon');

            if (slider) {
                slider.style.setProperty('--volume-percent', value + '%');
            }
            if (valueDisplay) {
                valueDisplay.textContent = value + '%';
            }
            if (icon) {
                if (value == 0) icon.textContent = '';
                else if (value < 33) icon.textContent = '';
                else if (value < 66) icon.textContent = '';
                else icon.textContent = '';
            }

            // Save preference
            localStorage.setItem('lymphoinvader-volume', value);
        }

        // Create a pulsing synth bass - Cliff Martinez style
        function createPulsingBass(ctx, freq, duration, volume = 0.15) {
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            const filter = ctx.createBiquadFilter();
            const output = getMusicOutput();

            // Warm sawtooth for that analog feel
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(freq, ctx.currentTime);

            // Low-pass filter for warmth
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(400, ctx.currentTime);
            filter.Q.setValueAtTime(2, ctx.currentTime);

            // Pulsing envelope
            const now = ctx.currentTime;
            gain.gain.setValueAtTime(0, now);
            gain.gain.linearRampToValueAtTime(volume, now + 0.05);
            gain.gain.linearRampToValueAtTime(volume * 0.6, now + duration * 0.3);
            gain.gain.linearRampToValueAtTime(volume * 0.8, now + duration * 0.5);
            gain.gain.exponentialRampToValueAtTime(0.001, now + duration);

            osc.connect(filter);
            filter.connect(gain);
            gain.connect(output);

            osc.start(now);
            osc.stop(now + duration);

            return { osc, gain, filter };
        }

        // Create ambient drone pad with slow modulation
        function createAmbientPad(ctx, freq, duration, volume = 0.08) {
            const oscillators = [];
            const gains = [];
            const now = ctx.currentTime;
            const output = getMusicOutput();

            // Multiple detuned oscillators for thick pad sound
            const detunes = [-12, -5, 0, 5, 12, 7];
            detunes.forEach((detune, i) => {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();

                osc.type = i % 2 === 0 ? 'sine' : 'triangle';
                osc.frequency.setValueAtTime(freq, now);
                osc.detune.setValueAtTime(detune, now);

                // Slow LFO-like frequency drift
                const driftAmount = 3 + Math.random() * 4;
                const driftSpeed = 0.5 + Math.random() * 1.5;
                osc.frequency.linearRampToValueAtTime(freq + driftAmount, now + driftSpeed);
                osc.frequency.linearRampToValueAtTime(freq - driftAmount, now + driftSpeed * 2);
                osc.frequency.linearRampToValueAtTime(freq, now + driftSpeed * 3);

                // Slow swell envelope
                const individualVol = volume / detunes.length;
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(individualVol, now + duration * 0.3);
                gain.gain.setValueAtTime(individualVol, now + duration * 0.7);
                gain.gain.exponentialRampToValueAtTime(0.001, now + duration);

                osc.connect(gain);
                gain.connect(output);

                osc.start(now);
                osc.stop(now + duration + 0.1);

                oscillators.push(osc);
                gains.push(gain);
            });

            return { oscillators, gains };
        }

        // Create shimmering high synth texture
        function createShimmer(ctx, baseFreq, duration, volume = 0.04) {
            const now = ctx.currentTime;
            const nodes = [];
            const output = getMusicOutput();

            // High ethereal tones
            [1, 1.5, 2, 2.5, 3].forEach((mult, i) => {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                const filter = ctx.createBiquadFilter();

                osc.type = 'sine';
                osc.frequency.setValueAtTime(baseFreq * mult, now);

                // Subtle pitch wobble
                osc.frequency.linearRampToValueAtTime(baseFreq * mult * 1.01, now + 1);
                osc.frequency.linearRampToValueAtTime(baseFreq * mult * 0.99, now + 2);
                osc.frequency.linearRampToValueAtTime(baseFreq * mult, now + 3);

                filter.type = 'highpass';
                filter.frequency.setValueAtTime(800, now);

                const vol = volume * (1 - i * 0.15);
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(vol, now + duration * 0.4);
                gain.gain.exponentialRampToValueAtTime(0.001, now + duration);

                osc.connect(filter);
                filter.connect(gain);
                gain.connect(output);

                osc.start(now + i * 0.2);
                osc.stop(now + duration);

                nodes.push({ osc, gain, filter });
            });

            return nodes;
        }

        // Create rhythmic pulse sequence (Kraftwerk-inspired)
        function createPulseSequence(ctx, baseFreq, volume = 0.12) {
            const now = ctx.currentTime;
            const pulseLength = 0.15;
            const notes = [1, 1, 1.25, 1, 1.5, 1, 1.25, 1.125]; // Rhythmic pattern
            const output = getMusicOutput();

            notes.forEach((mult, i) => {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                const filter = ctx.createBiquadFilter();

                osc.type = 'square';
                osc.frequency.setValueAtTime(baseFreq * mult, now + i * 0.25);

                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(1200, now);
                filter.frequency.exponentialRampToValueAtTime(300, now + i * 0.25 + pulseLength);

                gain.gain.setValueAtTime(0, now + i * 0.25);
                gain.gain.linearRampToValueAtTime(volume, now + i * 0.25 + 0.01);
                gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.25 + pulseLength);

                osc.connect(filter);
                filter.connect(gain);
                gain.connect(output);

                osc.start(now + i * 0.25);
                osc.stop(now + i * 0.25 + pulseLength + 0.05);
            });
        }

        // Create deep sub-bass drone
        function createSubDrone(ctx, freq, duration, volume = 0.1) {
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            const filter = ctx.createBiquadFilter();
            const now = ctx.currentTime;
            const output = getMusicOutput();

            osc.type = 'sine';
            osc.frequency.setValueAtTime(freq, now);

            // Very slow pitch drift
            osc.frequency.linearRampToValueAtTime(freq * 1.02, now + duration * 0.5);
            osc.frequency.linearRampToValueAtTime(freq, now + duration);

            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(150, now);

            gain.gain.setValueAtTime(0, now);
            gain.gain.linearRampToValueAtTime(volume, now + 2);
            gain.gain.setValueAtTime(volume, now + duration - 2);
            gain.gain.exponentialRampToValueAtTime(0.001, now + duration);

            osc.connect(filter);
            filter.connect(gain);
            gain.connect(output);

            osc.start(now);
            osc.stop(now + duration + 0.1);

            return { osc, gain, filter };
        }

        // Create warbling arpeggio texture
        function createArpTexture(ctx, baseFreq, duration, volume = 0.06) {
            const now = ctx.currentTime;
            const pattern = [1, 1.25, 1.5, 2, 1.5, 1.25, 1, 0.75];
            const noteLen = duration / (pattern.length * 3);
            const output = getMusicOutput();

            for (let rep = 0; rep < 3; rep++) {
                pattern.forEach((mult, i) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    const startTime = now + (rep * pattern.length + i) * noteLen;

                    osc.type = 'triangle';
                    osc.frequency.setValueAtTime(baseFreq * mult, startTime);

                    gain.gain.setValueAtTime(0, startTime);
                    gain.gain.linearRampToValueAtTime(volume * (1 - rep * 0.2), startTime + 0.02);
                    gain.gain.exponentialRampToValueAtTime(0.001, startTime + noteLen * 0.9);

                    osc.connect(gain);
                    gain.connect(output);

                    osc.start(startTime);
                    osc.stop(startTime + noteLen);
                });
            }
        }

        // Main ambient music loop - The Knick style
        function playMusicLoop() {
            if (!musicPlaying || sfMode) return;

            const ctx = initMusicAudio();

            // Base frequencies (E minor / atmospheric)
            const baseFreqs = [82.41, 110, 123.47, 146.83]; // E2, A2, B2, D3
            const padFreqs = [164.81, 196, 246.94, 329.63]; // E3, G3, B3, E4
            const highFreqs = [659.25, 783.99, 987.77]; // E5, G5, B5

            // Choose variation
            const variation = Math.floor(Math.random() * 4);

            // Always have sub-bass drone
            const subFreq = baseFreqs[Math.floor(Math.random() * baseFreqs.length)];
            createSubDrone(ctx, subFreq, 15, 0.08);

            // Layer 1: Ambient pad (always)
            const padFreq = padFreqs[Math.floor(Math.random() * padFreqs.length)];
            createAmbientPad(ctx, padFreq, 12, 0.06);

            // Layer 2: Variation-based additions
            if (variation === 0) {
                // Pulsing bass sequence
                setTimeout(() => {
                    if (musicPlaying && !sfMode) {
                        [0, 0.5, 1, 1.5, 2, 2.5, 3, 3.5].forEach((t, i) => {
                            setTimeout(() => {
                                if (musicPlaying && !sfMode) {
                                    const freq = baseFreqs[i % baseFreqs.length];
                                    createPulsingBass(ctx, freq, 0.4, 0.1);
                                }
                            }, t * 500);
                        });
                    }
                }, 2000);
            } else if (variation === 1) {
                // Shimmering high texture
                setTimeout(() => {
                    if (musicPlaying && !sfMode) {
                        const shimmerFreq = highFreqs[Math.floor(Math.random() * highFreqs.length)];
                        createShimmer(ctx, shimmerFreq, 8, 0.03);
                    }
                }, 3000);
            } else if (variation === 2) {
                // Rhythmic pulse pattern
                setTimeout(() => {
                    if (musicPlaying && !sfMode) {
                        createPulseSequence(ctx, 164.81, 0.08);
                    }
                }, 4000);
                setTimeout(() => {
                    if (musicPlaying && !sfMode) {
                        createPulseSequence(ctx, 196, 0.06);
                    }
                }, 6500);
            } else {
                // Warbling arpeggio
                setTimeout(() => {
                    if (musicPlaying && !sfMode) {
                        createArpTexture(ctx, 329.63, 6, 0.05);
                    }
                }, 2500);
            }

            // Occasional second pad layer
            if (Math.random() > 0.5) {
                setTimeout(() => {
                    if (musicPlaying && !sfMode) {
                        const secondPad = padFreqs[(padFreqs.indexOf(padFreq) + 2) % padFreqs.length];
                        createAmbientPad(ctx, secondPad, 8, 0.04);
                    }
                }, 5000);
            }

            // Schedule next loop
            const loopDuration = 14000 + Math.random() * 4000;
            musicInterval = setTimeout(playMusicLoop, loopDuration);
        }

        // Start/stop background music
        function toggleMusic() {
            const btn = document.querySelector('.music-control');

            if (musicPlaying) {
                // Stop music
                musicPlaying = false;
                if (musicInterval) clearTimeout(musicInterval);
                btn.classList.remove('playing');
                btn.textContent = '';
            } else {
                // Start music
                musicPlaying = true;
                btn.classList.add('playing');
                btn.textContent = '';
                playMusicLoop();
            }

            localStorage.setItem('lymphoinvader-music', musicPlaying);
        }

        // Create electronic revelation stab
        function createRevelationStab(ctx, isCorrect, volume = 0.15) {
            const now = ctx.currentTime;
            const output = getMusicOutput();

            if (isCorrect) {
                // Bright ascending synth swell - success
                const freqs = [329.63, 392, 493.88, 659.25]; // E4, G4, B4, E5
                freqs.forEach((freq, i) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    const filter = ctx.createBiquadFilter();

                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(freq, now + i * 0.08);
                    osc.frequency.linearRampToValueAtTime(freq * 1.02, now + i * 0.08 + 0.3);

                    filter.type = 'lowpass';
                    filter.frequency.setValueAtTime(2000, now);
                    filter.frequency.linearRampToValueAtTime(4000, now + 0.2);
                    filter.frequency.linearRampToValueAtTime(1500, now + 0.8);

                    gain.gain.setValueAtTime(0, now + i * 0.08);
                    gain.gain.linearRampToValueAtTime(volume * (1 - i * 0.15), now + i * 0.08 + 0.05);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + 1.2);

                    osc.connect(filter);
                    filter.connect(gain);
                    gain.connect(output);

                    osc.start(now + i * 0.08);
                    osc.stop(now + 1.5);
                });

                // Add shimmery pad
                setTimeout(() => createAmbientPad(ctx, 329.63, 2, 0.05), 200);
            } else {
                // Dark descending pulse - failure
                const freqs = [220, 196, 174.61, 146.83]; // A3, G3, F3, D3
                freqs.forEach((freq, i) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    const filter = ctx.createBiquadFilter();

                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(freq, now + i * 0.12);
                    osc.frequency.linearRampToValueAtTime(freq * 0.95, now + i * 0.12 + 0.3);

                    filter.type = 'lowpass';
                    filter.frequency.setValueAtTime(800, now);
                    filter.frequency.exponentialRampToValueAtTime(200, now + 0.8);

                    gain.gain.setValueAtTime(0, now + i * 0.12);
                    gain.gain.linearRampToValueAtTime(volume, now + i * 0.12 + 0.02);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + 1);

                    osc.connect(filter);
                    filter.connect(gain);
                    gain.connect(output);

                    osc.start(now + i * 0.12);
                    osc.stop(now + 1.2);
                });

                // Low ominous drone
                createSubDrone(ctx, 73.42, 1.5, 0.06); // D2
            }
        }

        // Play revelation sound when answer is revealed
        function playRevelationSound(isCorrect) {
            if (sfMode) return;

            const ctx = initMusicAudio();

            // Show dramatic overlay
            const overlay = document.getElementById('dramaticOverlay');
            overlay.className = 'dramatic-overlay ' + (isCorrect ? 'correct' : 'incorrect');
            setTimeout(() => overlay.className = 'dramatic-overlay', 1000);

            createRevelationStab(ctx, isCorrect, 0.12);
        }

        // Play question transition sound - electronic whoosh
        function playQuestionSound() {
            if (sfMode) return;
            const ctx = initMusicAudio();
            const now = ctx.currentTime;
            const output = getMusicOutput();

            // Filtered sweep
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            const filter = ctx.createBiquadFilter();

            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, now);
            osc.frequency.exponentialRampToValueAtTime(600, now + 0.15);
            osc.frequency.exponentialRampToValueAtTime(300, now + 0.3);

            filter.type = 'bandpass';
            filter.frequency.setValueAtTime(400, now);
            filter.frequency.linearRampToValueAtTime(1200, now + 0.15);
            filter.frequency.linearRampToValueAtTime(600, now + 0.3);
            filter.Q.setValueAtTime(5, now);

            gain.gain.setValueAtTime(0, now);
            gain.gain.linearRampToValueAtTime(0.08, now + 0.05);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.35);

            osc.connect(filter);
            filter.connect(gain);
            gain.connect(output);

            osc.start(now);
            osc.stop(now + 0.4);

            // Quick blip
            const blip = ctx.createOscillator();
            const blipGain = ctx.createGain();
            blip.type = 'sine';
            blip.frequency.setValueAtTime(880, now + 0.1);
            blipGain.gain.setValueAtTime(0.05, now + 0.1);
            blipGain.gain.exponentialRampToValueAtTime(0.001, now + 0.2);
            blip.connect(blipGain);
            blipGain.connect(output);
            blip.start(now + 0.1);
            blip.stop(now + 0.25);
        }

        // Play game start fanfare - electronic swell
        function playStartSound() {
            if (sfMode) return;
            const ctx = initMusicAudio();
            const now = ctx.currentTime;

            // Rising pad swell
            createAmbientPad(ctx, 164.81, 3, 0.08); // E3
            setTimeout(() => createAmbientPad(ctx, 246.94, 2.5, 0.06), 300); // B3
            setTimeout(() => createShimmer(ctx, 659.25, 2, 0.04), 600); // E5

            // Pulsing bass intro
            [0, 0.3, 0.6, 0.9].forEach((t, i) => {
                setTimeout(() => {
                    createPulsingBass(ctx, 82.41 * (i % 2 === 0 ? 1 : 1.5), 0.25, 0.1);
                }, t * 1000);
            });
        }

        // Play results sound - electronic fanfare or somber drone
        function playResultsSound(percentage) {
            if (sfMode) return;
            const ctx = initMusicAudio();
            const now = ctx.currentTime;
            const output = getMusicOutput();

            if (percentage >= 80) {
                // Triumphant electronic swell
                createAmbientPad(ctx, 261.63, 4, 0.1); // C4
                createAmbientPad(ctx, 329.63, 4, 0.08); // E4
                createAmbientPad(ctx, 392, 4, 0.06); // G4
                setTimeout(() => createShimmer(ctx, 1046.5, 3, 0.05), 500); // C6
                setTimeout(() => createArpTexture(ctx, 523.25, 3, 0.06), 800);

                // Victory pulse
                [0, 0.2, 0.4, 0.6].forEach((t, i) => {
                    setTimeout(() => {
                        const osc = ctx.createOscillator();
                        const gain = ctx.createGain();
                        osc.type = 'square';
                        osc.frequency.setValueAtTime(261.63 * Math.pow(1.26, i), ctx.currentTime);
                        gain.gain.setValueAtTime(0.08, ctx.currentTime);
                        gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.15);
                        osc.connect(gain);
                        gain.connect(getMusicOutput());
                        osc.start(ctx.currentTime);
                        osc.stop(ctx.currentTime + 0.2);
                    }, (t + 1) * 1000);
                });
            } else if (percentage >= 60) {
                // Moderate - gentle pad
                createAmbientPad(ctx, 196, 3, 0.08);
                createAmbientPad(ctx, 293.66, 3, 0.06);
                setTimeout(() => createShimmer(ctx, 587.33, 2, 0.03), 500);
            } else {
                // Somber - low drone
                createSubDrone(ctx, 73.42, 4, 0.1); // D2
                createAmbientPad(ctx, 146.83, 3, 0.06); // D3
                setTimeout(() => {
                    // Slow descending tone
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    const filter = ctx.createBiquadFilter();
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(220, ctx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(110, ctx.currentTime + 2);
                    filter.type = 'lowpass';
                    filter.frequency.setValueAtTime(500, ctx.currentTime);
                    filter.frequency.exponentialRampToValueAtTime(150, ctx.currentTime + 2);
                    gain.gain.setValueAtTime(0.06, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 2.5);
                    osc.connect(filter);
                    filter.connect(gain);
                    gain.connect(getMusicOutput());
                    osc.start(ctx.currentTime);
                    osc.stop(ctx.currentTime + 3);
                }, 500);
            }
        }

        // Override selectAnswer to add medical drama sounds
        const medicalSelectAnswer = selectAnswer;
        selectAnswer = function(index) {
            const wasCorrect = gameState.questions[gameState.currentQuestion].correct === index;
            medicalSelectAnswer(index);

            // Play revelation sound (only in medical mode, not SF)
            if (!sfMode) {
                playRevelationSound(wasCorrect);
            }
        };

        // Override startGame to add medical drama intro
        const medicalStartGame = startGame;
        startGame = function() {
            if (!sfMode) {
                playStartSound();
            }
            medicalStartGame();
        };

        // Override nextQuestion to add transition sound
        const originalNextQuestion = nextQuestion;
        nextQuestion = function() {
            if (!sfMode && gameState.currentQuestion < gameState.questions.length - 1) {
                playQuestionSound();
            }
            originalNextQuestion();
        };

        // Override showResults to add results music
        const originalShowResults = showResults;
        showResults = function() {
            originalShowResults();
            if (!sfMode) {
                const percentage = Math.round((gameState.correct / gameState.questions.length) * 100);
                playResultsSound(percentage);
            }
        };

        // Check for saved volume preference
        const savedVolume = localStorage.getItem('lymphoinvader-volume');
        if (savedVolume !== null) {
            const vol = parseInt(savedVolume);
            musicVolume = vol / 100;
            const slider = document.getElementById('volumeSlider');
            if (slider) {
                slider.value = vol;
                slider.style.setProperty('--volume-percent', vol + '%');
            }
            const valueDisplay = document.getElementById('volumeValue');
            if (valueDisplay) valueDisplay.textContent = vol + '%';
            const icon = document.getElementById('volumeIcon');
            if (icon) {
                if (vol == 0) icon.textContent = '';
                else if (vol < 33) icon.textContent = '';
                else if (vol < 66) icon.textContent = '';
                else icon.textContent = '';
            }
        }

        // Check for saved music preference
        if (localStorage.getItem('lymphoinvader-music') === 'true' && !sfMode) {
            setTimeout(() => {
                musicPlaying = true;
                document.querySelector('.music-control').classList.add('playing');
                document.querySelector('.music-control').textContent = '';
                playMusicLoop();
            }, 1000);
        }

        // Initialize
        createCells();
        createSpaceInvaders();
    </script>
</body>
</html>
