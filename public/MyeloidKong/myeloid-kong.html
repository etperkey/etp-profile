<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Myeloid Kong: The Clonal Climb</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --kong-purple: #8B008B;
            --kong-purple-light: #9932CC;
            --kong-purple-dark: #4B0082;
            --kong-violet: #9400D3;
            --kong-magenta: #FF00FF;
            --kong-pink: #FF69B4;
            --ladder-brown: #8B4513;
            --barrel-red: #B22222;
            --platform-steel: #4A4A6A;
            --gold: #FFD700;
            --bone-marrow: #FFE4C4;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Press Start 2P', cursive;
            background: linear-gradient(180deg, #1a0a2e 0%, #0d0015 100%);
            min-height: 100vh;
            overflow-x: hidden;
            color: white;
        }

        /* Animated background */
        .game-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            overflow: hidden;
        }

        .chromosome {
            position: absolute;
            font-size: 20px;
            opacity: 0.1;
            animation: float-chromosome 15s linear infinite;
        }

        @keyframes float-chromosome {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.1; }
            90% { opacity: 0.1; }
            100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }

        .game-container {
            position: relative;
            z-index: 10;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Title Screen */
        .title-screen {
            text-align: center;
            padding: 40px 20px;
        }

        .game-logo {
            margin-bottom: 30px;
        }

        .logo-text {
            font-size: 2.5em;
            color: var(--kong-magenta);
            text-shadow:
                4px 4px 0 var(--kong-purple),
                8px 8px 0 var(--kong-purple-dark);
            letter-spacing: 4px;
            animation: logo-pulse 2s ease-in-out infinite;
        }

        .logo-subtitle {
            font-size: 0.8em;
            color: var(--kong-pink);
            margin-top: 15px;
            text-shadow: 2px 2px 0 var(--kong-purple-dark);
        }

        @keyframes logo-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        /* Kong Character Preview - Classic DK Style */
        .kong-preview {
            position: relative;
            width: 200px;
            height: 220px;
            margin: 30px auto;
        }

        /* Kong's Head */
        .kong-head {
            width: 90px;
            height: 75px;
            background: linear-gradient(180deg, var(--kong-purple-light) 0%, var(--kong-purple) 100%);
            border-radius: 45px 45px 35px 35px;
            position: absolute;
            top: 0;
            left: 55px;
            border: 4px solid var(--kong-violet);
            z-index: 10;
        }

        /* Brow Ridge */
        .kong-brow {
            width: 80px;
            height: 20px;
            background: var(--kong-purple-dark);
            border-radius: 40px 40px 0 0;
            position: absolute;
            top: 8px;
            left: 5px;
        }

        /* Eyes */
        .kong-eye {
            width: 16px;
            height: 20px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 22px;
        }

        .kong-eye.left { left: 18px; }
        .kong-eye.right { right: 18px; }

        .kong-pupil {
            width: 10px;
            height: 10px;
            background: black;
            border-radius: 50%;
            position: absolute;
            bottom: 3px;
            left: 3px;
            animation: look-around 3s ease-in-out infinite;
        }

        @keyframes look-around {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        /* Snout/Muzzle */
        .kong-snout {
            width: 50px;
            height: 30px;
            background: linear-gradient(180deg, #D4A574 0%, #C4956A 100%);
            border-radius: 25px;
            position: absolute;
            bottom: 5px;
            left: 20px;
            border: 2px solid #A67B5B;
        }

        /* Nostrils */
        .kong-nostril {
            width: 8px;
            height: 6px;
            background: #5D3A1A;
            border-radius: 50%;
            position: absolute;
            top: 8px;
        }

        .kong-nostril.left { left: 12px; }
        .kong-nostril.right { right: 12px; }

        /* Mouth */
        .kong-mouth {
            width: 30px;
            height: 8px;
            background: #3D1A0A;
            border-radius: 0 0 15px 15px;
            position: absolute;
            bottom: 5px;
            left: 10px;
        }

        /* Body/Torso */
        .kong-body {
            width: 120px;
            height: 100px;
            background: linear-gradient(180deg, var(--kong-purple) 0%, var(--kong-purple-dark) 100%);
            border-radius: 60px 60px 40px 40px;
            position: absolute;
            top: 65px;
            left: 40px;
            border: 4px solid var(--kong-violet);
            z-index: 5;
        }

        /* Chest/Belly */
        .kong-chest {
            width: 70px;
            height: 60px;
            background: linear-gradient(180deg, #D4A574 0%, #C4956A 100%);
            border-radius: 35px 35px 30px 30px;
            position: absolute;
            top: 15px;
            left: 25px;
            border: 2px solid #A67B5B;
        }

        /* Arms */
        .kong-arm {
            width: 35px;
            height: 70px;
            background: linear-gradient(90deg, var(--kong-purple-dark) 0%, var(--kong-purple) 50%, var(--kong-purple-dark) 100%);
            border-radius: 18px;
            position: absolute;
            top: 75px;
            border: 3px solid var(--kong-violet);
            z-index: 15;
        }

        .kong-arm.left {
            left: 10px;
            transform-origin: top center;
            animation: arm-pound-left 1.5s ease-in-out infinite;
        }

        .kong-arm.right {
            right: 10px;
            transform-origin: top center;
            animation: arm-pound-right 1.5s ease-in-out infinite;
            animation-delay: 0.75s;
        }

        @keyframes arm-pound-left {
            0%, 100% { transform: rotate(-15deg) translateY(0); }
            50% { transform: rotate(-5deg) translateY(5px); }
        }

        @keyframes arm-pound-right {
            0%, 100% { transform: rotate(15deg) translateY(0); }
            50% { transform: rotate(5deg) translateY(5px); }
        }

        /* Hands/Fists */
        .kong-fist {
            width: 30px;
            height: 28px;
            background: var(--kong-purple);
            border-radius: 50%;
            position: absolute;
            bottom: -5px;
            left: 2px;
            border: 2px solid var(--kong-violet);
        }

        /* Legs */
        .kong-leg {
            width: 30px;
            height: 45px;
            background: var(--kong-purple-dark);
            border-radius: 15px 15px 10px 10px;
            position: absolute;
            top: 155px;
            border: 3px solid var(--kong-violet);
            z-index: 3;
        }

        .kong-leg.left { left: 55px; }
        .kong-leg.right { right: 55px; }

        /* Feet */
        .kong-foot {
            width: 35px;
            height: 15px;
            background: var(--kong-purple-dark);
            border-radius: 10px 10px 5px 5px;
            position: absolute;
            bottom: -8px;
            left: -5px;
            border: 2px solid var(--kong-violet);
        }

        /* Barrel Stack - Kong holds barrels */
        .barrel-stack {
            position: absolute;
            top: -35px;
            left: 70px;
            z-index: 20;
        }

        .held-barrel {
            width: 60px;
            height: 45px;
            background: linear-gradient(90deg, #6B3410 0%, #8B4513 20%, #D2691E 50%, #8B4513 80%, #6B3410 100%);
            border-radius: 8px;
            position: relative;
            border: 3px solid #5D3A1A;
            animation: barrel-shake 0.5s ease-in-out infinite;
        }

        .held-barrel::before, .held-barrel::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 10px;
            background: linear-gradient(90deg, #4D2A0A 0%, #5D3A1A 50%, #4D2A0A 100%);
            border-radius: 4px;
        }

        .held-barrel::before { top: 6px; }
        .held-barrel::after { bottom: 6px; }

        @keyframes barrel-shake {
            0%, 100% { transform: rotate(-2deg); }
            50% { transform: rotate(2deg); }
        }

        /* Game Info Barrels - Below Kong */
        .barrel-preview {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 20px 0 30px 0;
        }

        .barrel-info {
            text-align: center;
        }

        .mini-barrel {
            width: 45px;
            height: 35px;
            background: linear-gradient(90deg, #6B3410 0%, #8B4513 20%, #D2691E 50%, #8B4513 80%, #6B3410 100%);
            border-radius: 6px;
            position: relative;
            margin: 0 auto;
            border: 2px solid #5D3A1A;
        }

        .mini-barrel::before, .mini-barrel::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 7px;
            background: #5D3A1A;
            border-radius: 3px;
        }

        .mini-barrel::before { top: 5px; }
        .mini-barrel::after { bottom: 5px; }

        .barrel-label {
            font-size: 0.4em;
            color: var(--gold);
            text-align: center;
            margin-top: 10px;
            line-height: 1.6;
        }

        /* Disease Labels */
        .disease-labels {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .disease-tag {
            padding: 8px 15px;
            background: var(--kong-purple-dark);
            border: 2px solid var(--kong-violet);
            border-radius: 5px;
            font-size: 0.5em;
            color: var(--kong-magenta);
        }

        /* Difficulty Section */
        .difficulty-section {
            margin: 40px 0;
        }

        .section-title {
            font-size: 1em;
            color: var(--kong-magenta);
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 0 10px var(--kong-purple);
        }

        .difficulty-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            max-width: 700px;
            margin: 0 auto;
        }

        .difficulty-btn {
            font-family: 'Press Start 2P', cursive;
            font-size: 0.6em;
            padding: 15px 10px;
            border: 3px solid;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .difficulty-btn.chip {
            background: linear-gradient(180deg, #9370DB 0%, #7B68EE 100%);
            border-color: #6A5ACD;
            color: white;
        }

        .difficulty-btn.ccus {
            background: linear-gradient(180deg, #8B008B 0%, #800080 100%);
            border-color: #9400D3;
            color: #FFD700;
        }

        .difficulty-btn.mds {
            background: linear-gradient(180deg, #4B0082 0%, #2E0854 100%);
            border-color: #8B008B;
            color: #FF69B4;
        }

        .difficulty-btn.mds-aml {
            background: linear-gradient(180deg, #1a0a2e 0%, #0d0015 100%);
            border-color: #FF00FF;
            color: #FF00FF;
            animation: danger-pulse 1.5s ease-in-out infinite;
        }

        @keyframes danger-pulse {
            0%, 100% { box-shadow: 0 0 10px var(--kong-magenta); }
            50% { box-shadow: 0 0 25px var(--kong-magenta), 0 0 40px var(--kong-purple); }
        }

        .difficulty-btn:hover {
            transform: scale(1.05);
        }

        .difficulty-btn.selected {
            transform: scale(1.1);
            box-shadow: 0 0 20px var(--kong-magenta);
        }

        .difficulty-desc {
            font-size: 0.4em;
            margin-top: 5px;
            opacity: 0.8;
        }

        .start-btn {
            display: block;
            margin: 30px auto;
            font-family: 'Press Start 2P', cursive;
            font-size: 1.2em;
            padding: 20px 40px;
            background: linear-gradient(180deg, var(--kong-purple) 0%, var(--kong-purple-dark) 100%);
            color: var(--kong-magenta);
            border: 4px solid var(--kong-violet);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .start-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px var(--kong-magenta);
        }

        /* Game Screen */
        .game-screen {
            display: none;
        }

        .game-screen.active {
            display: block;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
            padding: 10px;
            background: rgba(75, 0, 130, 0.3);
            border-radius: 10px;
            border: 2px solid var(--kong-purple);
        }

        .score-display {
            font-size: 0.7em;
        }

        .score-display span {
            color: var(--gold);
        }

        .level-display {
            font-size: 0.6em;
            color: var(--kong-pink);
        }

        .lives-display {
            display: flex;
            gap: 8px;
        }

        .life-icon {
            width: 25px;
            height: 25px;
            background: var(--kong-purple);
            border-radius: 50%;
            border: 2px solid var(--kong-magenta);
        }

        .life-icon.lost {
            background: #333;
            border-color: #555;
        }

        /* Platform Game Area */
        .platform-area {
            position: relative;
            background: linear-gradient(180deg, #1a0a2e 0%, #0a0015 100%);
            border: 4px solid var(--kong-purple);
            border-radius: 10px;
            min-height: 400px;
            overflow: hidden;
        }

        /* Platforms */
        .platform {
            position: absolute;
            height: 15px;
            background: linear-gradient(180deg, var(--platform-steel) 0%, #2A2A4A 100%);
            border-radius: 3px;
        }

        .platform-1 { width: 90%; bottom: 10%; left: 5%; }
        .platform-2 { width: 85%; bottom: 30%; left: 10%; }
        .platform-3 { width: 80%; bottom: 50%; left: 5%; }
        .platform-4 { width: 75%; bottom: 70%; left: 15%; }
        .platform-5 { width: 50%; bottom: 88%; left: 25%; }

        /* Ladders */
        .ladder {
            position: absolute;
            width: 30px;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 8px,
                var(--ladder-brown) 8px,
                var(--ladder-brown) 12px
            );
            border-left: 4px solid var(--ladder-brown);
            border-right: 4px solid var(--ladder-brown);
        }

        .ladder-1 { height: 80px; bottom: 10%; left: 20%; }
        .ladder-2 { height: 80px; bottom: 30%; right: 25%; }
        .ladder-3 { height: 80px; bottom: 50%; left: 30%; }
        .ladder-4 { height: 70px; bottom: 70%; right: 35%; }

        /* Game Character */
        .player {
            position: absolute;
            width: 40px;
            height: 50px;
            bottom: 12%;
            left: 10%;
            z-index: 20;
            transition: all 0.3s ease-out;
        }

        .player-body {
            width: 30px;
            height: 35px;
            background: linear-gradient(180deg, #FFE4B5 0%, #DEB887 100%);
            border-radius: 15px 15px 10px 10px;
            position: absolute;
            top: 15px;
            left: 5px;
        }

        .player-head {
            width: 25px;
            height: 25px;
            background: linear-gradient(180deg, #FFE4B5 0%, #FFDAB9 100%);
            border-radius: 50%;
            position: absolute;
            top: 0;
            left: 8px;
        }

        .player-hat {
            width: 30px;
            height: 12px;
            background: var(--kong-purple);
            border-radius: 5px 5px 0 0;
            position: absolute;
            top: -5px;
            left: -3px;
        }

        /* Rolling Barrels */
        .game-barrel {
            position: absolute;
            width: 35px;
            height: 28px;
            background: linear-gradient(90deg, #8B4513 0%, #D2691E 50%, #8B4513 100%);
            border-radius: 4px;
            z-index: 15;
            animation: game-barrel-roll 0.5s linear infinite;
        }

        .game-barrel::before, .game-barrel::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 6px;
            background: #5D3A1A;
            border-radius: 2px;
        }

        .game-barrel::before { top: 3px; }
        .game-barrel::after { bottom: 3px; }

        @keyframes game-barrel-roll {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Kong at top */
        .kong-top {
            position: absolute;
            top: 2%;
            left: 10%;
            width: 80px;
            height: 70px;
            z-index: 25;
        }

        .kong-top .kong-mini-body {
            width: 60px;
            height: 45px;
            background: linear-gradient(180deg, var(--kong-purple) 0%, var(--kong-purple-dark) 100%);
            border-radius: 30px 30px 20px 20px;
            position: absolute;
            bottom: 0;
            left: 10px;
            border: 3px solid var(--kong-violet);
        }

        .kong-top .kong-mini-head {
            width: 40px;
            height: 35px;
            background: linear-gradient(180deg, var(--kong-purple-light) 0%, var(--kong-purple) 100%);
            border-radius: 50%;
            position: absolute;
            top: 0;
            left: 20px;
            border: 2px solid var(--kong-violet);
        }

        /* Princess/Goal */
        .goal {
            position: absolute;
            top: 5%;
            right: 15%;
            text-align: center;
        }

        .goal-icon {
            font-size: 2em;
            animation: goal-float 2s ease-in-out infinite;
        }

        @keyframes goal-float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .goal-label {
            font-size: 0.4em;
            color: var(--gold);
            margin-top: 5px;
        }

        /* Question Modal */
        .question-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }

        .question-modal.active {
            display: flex;
        }

        .question-box {
            background: linear-gradient(180deg, #2a1a4e 0%, #1a0a2e 100%);
            border: 4px solid var(--kong-purple);
            border-radius: 15px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 0 50px var(--kong-purple);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .question-category {
            font-size: 0.6em;
            color: var(--kong-pink);
            padding: 5px 15px;
            background: var(--kong-purple-dark);
            border-radius: 5px;
        }

        .question-timer {
            font-size: 0.8em;
            color: var(--gold);
        }

        .question-text {
            font-size: 0.7em;
            line-height: 1.8;
            margin-bottom: 25px;
            color: white;
        }

        .answers-grid {
            display: grid;
            gap: 15px;
        }

        .answer-btn {
            font-family: 'Press Start 2P', cursive;
            font-size: 0.55em;
            padding: 15px;
            background: var(--kong-purple-dark);
            border: 3px solid var(--kong-purple);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            line-height: 1.6;
        }

        .answer-btn:hover {
            background: var(--kong-purple);
            border-color: var(--kong-magenta);
            transform: translateX(5px);
        }

        .answer-btn.correct {
            background: #228B22;
            border-color: #32CD32;
        }

        .answer-btn.incorrect {
            background: #8B0000;
            border-color: #FF0000;
        }

        .answer-btn.disabled {
            pointer-events: none;
            opacity: 0.6;
        }

        /* Explanation Box */
        .explanation-box {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid var(--kong-violet);
            border-radius: 10px;
        }

        .explanation-box.show {
            display: block;
        }

        .explanation-title {
            font-size: 0.7em;
            color: var(--gold);
            margin-bottom: 10px;
        }

        .explanation-text {
            font-size: 0.5em;
            line-height: 1.8;
            color: #ccc;
            margin-bottom: 15px;
        }

        .citation {
            font-size: 0.45em;
            color: var(--kong-pink);
            font-style: italic;
            padding: 10px;
            background: rgba(139, 0, 139, 0.2);
            border-radius: 5px;
            border-left: 3px solid var(--kong-magenta);
        }

        /* Reference Links */
        .ref-links {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.2);
        }

        .ref-link {
            display: inline-flex;
            align-items: center;
            padding: 8px 16px;
            background: linear-gradient(180deg, rgba(79, 195, 247, 0.3) 0%, rgba(79, 195, 247, 0.15) 100%);
            border-radius: 6px;
            color: #4fc3f7;
            text-decoration: none;
            font-size: 1.1em;
            font-style: normal;
            font-weight: bold;
            transition: all 0.2s;
            border: 2px solid rgba(79, 195, 247, 0.5);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .ref-link:hover {
            background: linear-gradient(180deg, rgba(79, 195, 247, 0.5) 0%, rgba(79, 195, 247, 0.3) 100%);
            transform: scale(1.08);
            border-color: #4fc3f7;
            box-shadow: 0 0 15px rgba(79, 195, 247, 0.5);
        }

        .continue-btn {
            display: block;
            margin: 20px auto 0;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.7em;
            padding: 15px 30px;
            background: var(--kong-purple);
            color: white;
            border: 3px solid var(--kong-magenta);
            border-radius: 8px;
            cursor: pointer;
        }

        .continue-btn:hover {
            background: var(--kong-purple-light);
        }

        /* Results Screen */
        .results-screen {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .results-screen.active {
            display: block;
        }

        .results-title {
            font-size: 2em;
            color: var(--kong-magenta);
            margin-bottom: 30px;
            text-shadow: 0 0 20px var(--kong-purple);
        }

        .results-stats {
            display: grid;
            gap: 20px;
            max-width: 400px;
            margin: 0 auto 30px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: var(--kong-purple-dark);
            border-radius: 8px;
            border: 2px solid var(--kong-purple);
        }

        .stat-label {
            font-size: 0.6em;
            color: #aaa;
        }

        .stat-value {
            font-size: 0.8em;
            color: var(--gold);
        }

        .play-again-btn {
            font-family: 'Press Start 2P', cursive;
            font-size: 1em;
            padding: 20px 40px;
            background: var(--kong-purple);
            color: var(--kong-magenta);
            border: 4px solid var(--kong-violet);
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
        }

        .play-again-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px var(--kong-magenta);
        }

        .home-btn {
            font-family: 'Press Start 2P', cursive;
            font-size: 0.7em;
            padding: 15px 30px;
            background: transparent;
            color: var(--kong-pink);
            border: 2px solid var(--kong-pink);
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
        }

        .home-btn:hover {
            background: var(--kong-purple-dark);
        }

        /* Volume Toggle */
        .volume-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(139, 0, 139, 0.3);
            border: 2px solid var(--kong-purple);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            transition: all 0.3s;
        }

        .volume-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px var(--kong-purple);
        }

        .volume-toggle.muted {
            background: rgba(100, 100, 100, 0.3);
            border-color: #666;
        }

        /* Back button */
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.6em;
            padding: 10px 20px;
            background: var(--kong-purple-dark);
            color: var(--kong-pink);
            border: 2px solid var(--kong-purple);
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
        }

        .back-btn:hover {
            background: var(--kong-purple);
        }

        /* Progress bar */
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #1a0a2e;
            border: 2px solid var(--kong-purple);
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--kong-purple) 0%, var(--kong-magenta) 100%);
            transition: width 0.5s ease-out;
            border-radius: 8px;
        }

        .progress-text {
            font-size: 0.5em;
            color: var(--kong-pink);
            text-align: center;
            margin-top: 5px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .logo-text { font-size: 1.5em; }
            .question-text { font-size: 0.6em; }
            .answer-btn { font-size: 0.5em; padding: 12px; }
            .platform-area { min-height: 300px; }
            .game-header { font-size: 0.8em; }
        }

        @media (max-width: 480px) {
            .logo-text { font-size: 1.2em; }
            .difficulty-btn { font-size: 0.5em; padding: 12px 8px; }
            .question-box { padding: 15px; }
            .answer-btn { font-size: 0.45em; }
        }
    </style>
</head>
<body>
    <div class="game-bg" id="gameBg"></div>

    <a href="../HematologyArcade/index.html" class="back-btn">< ARCADE</a>

    <button class="volume-toggle" id="volumeToggle" onclick="toggleVolume()">
        <span id="volumeIcon">&#128266;</span>
    </button>

    <div class="game-container">
        <!-- Title Screen -->
        <div class="title-screen" id="titleScreen">
            <div class="game-logo">
                <h1 class="logo-text">MYELOID KONG</h1>
                <p class="logo-subtitle">The Clonal Climb</p>
            </div>

            <div class="kong-preview">
                <!-- Barrel held above head -->
                <div class="barrel-stack">
                    <div class="held-barrel"></div>
                </div>

                <!-- Head with facial features -->
                <div class="kong-head">
                    <div class="kong-brow"></div>
                    <div class="kong-eye left"><div class="kong-pupil"></div></div>
                    <div class="kong-eye right"><div class="kong-pupil"></div></div>
                    <div class="kong-snout">
                        <div class="kong-nostril left"></div>
                        <div class="kong-nostril right"></div>
                        <div class="kong-mouth"></div>
                    </div>
                </div>

                <!-- Body with chest -->
                <div class="kong-body">
                    <div class="kong-chest"></div>
                </div>

                <!-- Arms with fists -->
                <div class="kong-arm left">
                    <div class="kong-fist"></div>
                </div>
                <div class="kong-arm right">
                    <div class="kong-fist"></div>
                </div>

                <!-- Legs with feet -->
                <div class="kong-leg left">
                    <div class="kong-foot"></div>
                </div>
                <div class="kong-leg right">
                    <div class="kong-foot"></div>
                </div>
            </div>

            <div class="disease-labels">
                <span class="disease-tag">CML</span>
                <span class="disease-tag">CMML</span>
                <span class="disease-tag">MPN</span>
                <span class="disease-tag">MDS</span>
            </div>

            <div class="barrel-preview">
                <div class="barrel-info">
                    <div class="mini-barrel"></div>
                    <p class="barrel-label">ANSWER<br>QUESTIONS</p>
                </div>
                <div class="barrel-info">
                    <div class="mini-barrel"></div>
                    <p class="barrel-label">AVOID<br>MISTAKES</p>
                </div>
                <div class="barrel-info">
                    <div class="mini-barrel"></div>
                    <p class="barrel-label">CLIMB TO<br>MASTERY</p>
                </div>
            </div>

            <div class="difficulty-section">
                <h2 class="section-title">SELECT DIFFICULTY</h2>
                <div class="difficulty-grid">
                    <button class="difficulty-btn chip" onclick="selectDifficulty('chip')">
                        CHIP
                        <div class="difficulty-desc">Clonal Hematopoiesis</div>
                    </button>
                    <button class="difficulty-btn ccus" onclick="selectDifficulty('ccus')">
                        CCUS
                        <div class="difficulty-desc">Clonal Cytopenia</div>
                    </button>
                    <button class="difficulty-btn mds" onclick="selectDifficulty('mds')">
                        MDS
                        <div class="difficulty-desc">Myelodysplastic</div>
                    </button>
                    <button class="difficulty-btn mds-aml" onclick="selectDifficulty('mds-aml')">
                        MDS-AML
                        <div class="difficulty-desc">Transformation</div>
                    </button>
                </div>
            </div>

            <button class="start-btn" onclick="startGame()">START CLIMB</button>

            <p style="font-size: 0.5em; color: #666; margin-top: 20px;">
                Test your knowledge of myeloid neoplasms!<br>
                Questions based on ASH, ELN, NCCN, and WHO guidelines
            </p>
        </div>

        <!-- Game Screen -->
        <div class="game-screen" id="gameScreen">
            <div class="game-header">
                <div class="score-display">SCORE: <span id="scoreValue">0</span></div>
                <div class="level-display" id="levelDisplay">LEVEL 1</div>
                <div class="lives-display" id="livesDisplay">
                    <div class="life-icon"></div>
                    <div class="life-icon"></div>
                    <div class="life-icon"></div>
                </div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <p class="progress-text" id="progressText">Question 1 of 10</p>

            <div class="platform-area" id="platformArea">
                <!-- Platforms -->
                <div class="platform platform-1"></div>
                <div class="platform platform-2"></div>
                <div class="platform platform-3"></div>
                <div class="platform platform-4"></div>
                <div class="platform platform-5"></div>

                <!-- Ladders -->
                <div class="ladder ladder-1"></div>
                <div class="ladder ladder-2"></div>
                <div class="ladder ladder-3"></div>
                <div class="ladder ladder-4"></div>

                <!-- Kong at top -->
                <div class="kong-top">
                    <div class="kong-mini-head"></div>
                    <div class="kong-mini-body"></div>
                </div>

                <!-- Goal -->
                <div class="goal">
                    <div class="goal-icon">&#127942;</div>
                    <div class="goal-label">MASTERY!</div>
                </div>

                <!-- Player -->
                <div class="player" id="player">
                    <div class="player-hat"></div>
                    <div class="player-head"></div>
                    <div class="player-body"></div>
                </div>

                <!-- Barrels will be added dynamically -->
            </div>
        </div>

        <!-- Results Screen -->
        <div class="results-screen" id="resultsScreen">
            <h1 class="results-title" id="resultsTitle">LEVEL COMPLETE!</h1>
            <div class="results-stats">
                <div class="stat-row">
                    <span class="stat-label">FINAL SCORE</span>
                    <span class="stat-value" id="finalScore">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">CORRECT ANSWERS</span>
                    <span class="stat-value" id="correctAnswers">0/10</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">ACCURACY</span>
                    <span class="stat-value" id="accuracy">0%</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">DIFFICULTY</span>
                    <span class="stat-value" id="difficultyPlayed">CHIP</span>
                </div>
            </div>
            <button class="play-again-btn" onclick="restartGame()">PLAY AGAIN</button>
            <button class="home-btn" onclick="goHome()">BACK TO ARCADE</button>
        </div>
    </div>

    <!-- Question Modal -->
    <div class="question-modal" id="questionModal">
        <div class="question-box">
            <div class="question-header">
                <span class="question-category" id="questionCategory">CML</span>
                <span class="question-timer" id="questionTimer">30</span>
            </div>
            <p class="question-text" id="questionText">Loading question...</p>
            <div class="answers-grid" id="answersGrid">
                <!-- Answers will be populated dynamically -->
            </div>
            <div class="explanation-box" id="explanationBox">
                <h3 class="explanation-title">EXPLANATION</h3>
                <p class="explanation-text" id="explanationText"></p>
                <p class="citation" id="citationText"></p>
            </div>
            <button class="continue-btn" id="continueBtn" onclick="continueGame()" style="display: none;">CONTINUE CLIMB</button>
        </div>
    </div>

    <script>
        // Reference Links Helper
        function renderReferenceLinks(question) {
            let links = '';
            if (question.pmid) {
                links += `<a href="https://pubmed.ncbi.nlm.nih.gov/${question.pmid}/" target="_blank" rel="noopener" class="ref-link" title="View on PubMed">üìÑ PubMed</a>`;
            }
            if (question.doi) {
                links += `<a href="https://doi.org/${question.doi}" target="_blank" rel="noopener" class="ref-link" title="View Full Text">üîó Full Text</a>`;
            }
            if (question.guideline) {
                links += `<a href="${question.guideline.url}" target="_blank" rel="noopener" class="ref-link" title="View Guidelines">üìã ${question.guideline.name}</a>`;
            }
            // Direct URL fallback for citations without PMID/DOI
            if (question.url && !question.pmid && !question.doi) {
                links += `<a href="${question.url}" target="_blank" rel="noopener" class="ref-link" title="View Source">üìñ View Source</a>`;
            }
            return links ? `<div class="ref-links">${links}</div>` : '';
        }

        // Question Bank - Organized by difficulty and disease
        const questionBank = {
            chip: [
                {
                    category: "CHIP",
                    question: "What is the minimum variant allele frequency (VAF) required for defining CHIP according to the WHO 5th edition classification?",
                    answers: ["‚â•2%", "‚â•5%", "‚â•10%", "‚â•1%"],
                    correct: 0,
                    explanation: "According to the WHO 5th edition classification, CHIP is formally defined by the presence of a myeloid-associated somatic mutation with a variant allele frequency (VAF) of ‚â•2% in individuals without a myeloid neoplasm diagnosis or unexplained cytopenia.",
                    citation: "WHO Classification of Haematolymphoid Tumors, 5th Edition (2022). Blood. 2022;140(11):1200-1228.",
                    pmid: "35767897",
                    doi: "10.1182/blood.2022015850"
                },
                {
                    category: "CHIP",
                    question: "Which three genes account for approximately 70% of mutations found in CHIP patients?",
                    answers: ["DNMT3A, TET2, ASXL1", "JAK2, CALR, MPL", "TP53, RUNX1, EZH2", "NPM1, FLT3, IDH1"],
                    correct: 0,
                    explanation: "Mutations in DNMT3A, TET2, and ASXL1 (collectively known as 'DTA' mutations) are found in approximately 70% of CHIP patients. These are the most common driver mutations in clonal hematopoiesis.",
                    citation: "Jaiswal S, et al. N Engl J Med. 2014;371(26):2488-2498.",
                    pmid: "25426837",
                    doi: "10.1056/NEJMoa1408617"
                },
                {
                    category: "CHIP",
                    question: "What is the annual risk of progression from CHIP to a myeloid malignancy?",
                    answers: ["0.5-1%", "5-10%", "10-15%", "15-20%"],
                    correct: 0,
                    explanation: "CHIP is recognized as an early precursor state for hematologic malignancy with a low absolute risk of myeloid neoplasm transformation, occurring in approximately 0.5%-1% of cases annually.",
                    citation: "Steensma DP, et al. Blood. 2015;126(1):9-16.",
                    pmid: "25670621",
                    doi: "10.1182/blood-2015-03-631747"
                },
                {
                    category: "CML",
                    question: "Which translocation defines chronic myeloid leukemia (CML)?",
                    answers: ["t(9;22)(q34;q11.2) - Philadelphia chromosome", "t(15;17)(q24;q21)", "t(8;21)(q22;q22)", "inv(16)(p13.1q22)"],
                    correct: 0,
                    explanation: "CML is defined by the Philadelphia chromosome, resulting from the reciprocal translocation t(9;22)(q34;q11.2), which creates the BCR-ABL1 fusion gene. This is the pathognomonic finding in CML.",
                    citation: "Jabbour E, Kantarjian H. Am J Hematol. 2024;99(11):2191-2212. (2025 CML Update)",
                    pmid: "39093014",
                    doi: "10.1002/ajh.27443",
                    guideline: { name: "NCCN CML", url: "https://www.nccn.org/guidelines/guidelines-detail?category=1&id=1427" }
                },
                {
                    category: "MPN",
                    question: "What is the platelet threshold for diagnosing Essential Thrombocythemia (ET) according to WHO criteria?",
                    answers: ["‚â•450 x 10‚Åπ/L", "‚â•400 x 10‚Åπ/L", "‚â•500 x 10‚Åπ/L", "‚â•350 x 10‚Åπ/L"],
                    correct: 0,
                    explanation: "According to WHO diagnostic criteria, thrombocytosis with platelets ‚â•450 x 10‚Åπ/L is required for the diagnosis of Essential Thrombocythemia, along with exclusion of other myeloid neoplasms.",
                    citation: "Tefferi A, Barbui T. Am J Hematol. 2024;99(3):457-469. (ET 2024 Update)",
                    pmid: "38088464",
                    doi: "10.1002/ajh.27161",
                    guideline: { name: "NCCN MPN", url: "https://www.nccn.org/guidelines/guidelines-detail?category=1&id=1502" }
                },
                {
                    category: "MPN",
                    question: "What percentage of Essential Thrombocythemia patients are 'triple-negative' (lacking JAK2, CALR, and MPL mutations)?",
                    answers: ["Up to 20%", "Up to 5%", "Up to 50%", "Up to 35%"],
                    correct: 0,
                    explanation: "While detection of JAK2V617F, CALR, or MPL mutations confirms an underlying MPN, their absence does not rule out ET since up to 20% of patients may be triple-negative.",
                    citation: "Tefferi A, Barbui T. Am J Hematol. 2024;99(3):457-469.",
                    pmid: "38269572",
                    doi: "10.1002/ajh.27216"
                },
                {
                    category: "MDS",
                    question: "According to IPSS-R, which category has the longest median survival?",
                    answers: ["Very Low risk (8.8 years)", "Low risk (5.3 years)", "Intermediate risk (3 years)", "High risk (1.6 years)"],
                    correct: 0,
                    explanation: "IPSS-R very low risk patients have the best prognosis with a median survival of 8.8 years. Low risk is 5.3 years, intermediate is 3 years, high is 1.6 years, and very high is 0.8 years.",
                    citation: "Greenberg PL, et al. Blood. 2012;120(12):2454-2465.",
                    pmid: "22740453",
                    doi: "10.1182/blood-2012-03-420489"
                },
                {
                    category: "CMML",
                    question: "What is the minimum absolute monocyte count required for CMML diagnosis?",
                    answers: ["‚â•0.5 x 10‚Åπ/L", "‚â•1.0 x 10‚Åπ/L", "‚â•0.3 x 10‚Åπ/L", "‚â•2.0 x 10‚Åπ/L"],
                    correct: 0,
                    explanation: "CMML diagnostic criteria include sustained (>3 months) peripheral blood monocytosis ‚â•0.5 x 10‚Åπ/L with monocytes comprising ‚â•10% of the leukocyte count.",
                    citation: "Patnaik MM, Tefferi A. Am J Hematol. 2024;99(6):1055-1078. (CMML 2024 Update)",
                    pmid: "38450850",
                    doi: "10.1002/ajh.27271"
                },
                {
                    category: "CML",
                    question: "Which TKI was the first approved for CML treatment?",
                    answers: ["Imatinib", "Dasatinib", "Nilotinib", "Bosutinib"],
                    correct: 0,
                    explanation: "Imatinib (Gleevec) was the first tyrosine kinase inhibitor approved for CML in 2001, revolutionizing treatment and transforming CML from a fatal disease to a chronic, manageable condition.",
                    citation: "Druker BJ, et al. N Engl J Med. 2001;344(14):1031-1037.",
                    pmid: "11287972",
                    doi: "10.1056/NEJM200104053441401"
                },
                {
                    category: "MPN",
                    question: "What hematocrit target is recommended for Polycythemia Vera management?",
                    answers: ["<45%", "<50%", "<55%", "<40%"],
                    correct: 0,
                    explanation: "The CYTO-PV trial demonstrated that maintaining hematocrit <45% significantly reduces cardiovascular events and thrombosis compared to less stringent control.",
                    citation: "Marchioli R, et al. N Engl J Med. 2013;368(1):22-33.",
                    pmid: "23216616",
                    doi: "10.1056/NEJMoa1208500"
                }
            ],
            ccus: [
                {
                    category: "CCUS",
                    question: "How much higher is the risk of progression to myeloid neoplasm in CCUS compared to CHIP?",
                    answers: ["10-fold higher", "2-fold higher", "5-fold higher", "20-fold higher"],
                    correct: 0,
                    explanation: "CCUS (Clonal Cytopenia of Undetermined Significance) presents a 10-fold higher likelihood of progressing to myeloid neoplasm compared to CHIP, highlighting the importance of cytopenia as a risk factor.",
                    citation: "Malcovati L, et al. Blood. 2017;129(25):3371-3378.",
                    pmid: "28424163",
                    doi: "10.1182/blood-2017-02-768986"
                },
                {
                    category: "CCUS",
                    question: "What dysplasia threshold distinguishes CCUS from MDS?",
                    answers: ["<10% dysplasia", "<5% dysplasia", "<15% dysplasia", "<20% dysplasia"],
                    correct: 0,
                    explanation: "CCUS is defined by the presence of unexplained cytopenia with no or only mild (<10%) dysplasia and blast cells <5%, not meeting diagnostic criteria for MDS.",
                    citation: "WHO Classification of Haematolymphoid Tumors, 5th Edition (2022).",
                    pmid: "35732831",
                    doi: "10.1038/s41375-022-01613-1"
                },
                {
                    category: "CML",
                    question: "According to ELN 2025 recommendations, what BCR-ABL1 transcript level defines optimal response at 12 months?",
                    answers: ["‚â§0.1% (MMR)", "‚â§1%", "‚â§10%", "‚â§0.01%"],
                    correct: 0,
                    explanation: "The ELN 2025 guidelines define optimal response at 12 months as achieving Major Molecular Response (MMR), which is BCR-ABL1 ‚â§0.1% on the International Scale.",
                    citation: "Hochhaus A, et al. Leukemia. 2020;34(4):966-984. (ELN 2020 CML Recommendations)",
                    pmid: "32127639",
                    doi: "10.1038/s41375-020-0776-2"
                },
                {
                    category: "CMML",
                    question: "What is the percentage of CMML patients who harbor somatic mutations?",
                    answers: [">95%", "~70%", "~50%", "~80%"],
                    correct: 0,
                    explanation: "While cytogenetic abnormalities occur in ~30% of CMML patients, >95% harbor somatic mutations, making molecular testing essential for diagnosis and prognosis.",
                    citation: "Patnaik MM, Tefferi A. Am J Hematol. 2024;99(6):1055-1078.",
                    pmid: "38450850",
                    doi: "10.1002/ajh.27271"
                },
                {
                    category: "CMML",
                    question: "What is the most commonly mutated gene in CMML?",
                    answers: ["TET2 (~60%)", "SRSF2 (~50%)", "ASXL1 (~40%)", "RAS pathway (~30%)"],
                    correct: 0,
                    explanation: "TET2 is the most commonly mutated gene in CMML, occurring in approximately 60% of patients. SRSF2 (~50%), ASXL1 (~40%), and RAS pathway mutations (~30%) are also frequently observed.",
                    citation: "Patnaik MM, Tefferi A. Am J Hematol. 2024;99(6):1055-1078.",
                    pmid: "38450850",
                    doi: "10.1002/ajh.27271"
                },
                {
                    category: "MDS",
                    question: "What IPSS-R score cutoff distinguishes lower-risk from higher-risk MDS?",
                    answers: ["3.5 points", "2.5 points", "4.5 points", "5.0 points"],
                    correct: 0,
                    explanation: "Investigations have proposed a cut-off of 3.5 points according to the IPSS-R to distinguish low-risk MDS from high-risk MDS for treatment decisions.",
                    citation: "Greenberg PL, et al. Blood. 2012;120(12):2454-2465.",
                    pmid: "22740453",
                    doi: "10.1182/blood-2012-03-420489",
                    guideline: { name: "NCCN MDS", url: "https://www.nccn.org/guidelines/guidelines-detail?category=1&id=1446" }
                },
                {
                    category: "MPN",
                    question: "Which mutation is associated with the poorest prognosis in myelofibrosis?",
                    answers: ["ASXL1", "CALR type 1", "JAK2V617F", "MPL"],
                    correct: 0,
                    explanation: "ASXL1 mutations are associated with poor prognosis in myelofibrosis and are included in multiple prognostic scoring systems. CALR type 1 mutations are associated with better outcomes.",
                    citation: "Tefferi A. Am J Hematol. 2023;98(5):801-821.",
                    pmid: "36680511",
                    doi: "10.1002/ajh.26857"
                },
                {
                    category: "CML",
                    question: "Which mutation causes resistance to all TKIs except ponatinib, asciminib, and olverembatinib?",
                    answers: ["T315I", "E255K", "Y253H", "F317L"],
                    correct: 0,
                    explanation: "The T315I 'gatekeeper' mutation causes resistance to imatinib, dasatinib, nilotinib, and bosutinib. Only ponatinib, asciminib, and olverembatinib retain activity against this mutation.",
                    citation: "Hochhaus A, et al. Leukemia. 2020;34(4):966-984.",
                    pmid: "32127639",
                    doi: "10.1038/s41375-020-0776-2"
                },
                {
                    category: "CCUS",
                    question: "According to the CCRS (Clonal Cytopenia Risk Score), which factor carries the highest point value?",
                    answers: ["‚â•2 mutations (3 points)", "Splicing factor mutation (2 points)", "Low platelets <100 (2.5 points)", "VAF ‚â•20% (1 point)"],
                    correct: 0,
                    explanation: "The CCRS assigns the highest weight to having ‚â•2 mutations (3 points), followed by low platelet count <100 √ó 10‚Åπ/L (2.5 points) and splicing factor mutations (2 points).",
                    citation: "Malcovati L, et al. Blood. 2017;129(25):3371-3378.",
                    pmid: "28424163",
                    doi: "10.1182/blood-2017-02-768986"
                },
                {
                    category: "MDS",
                    question: "What is the only treatment modality that can cure MDS?",
                    answers: ["Allogeneic stem cell transplant", "Hypomethylating agents", "Lenalidomide", "Luspatercept"],
                    correct: 0,
                    explanation: "Allogeneic stem cell transplant (ASCT) remains the only potentially curative treatment for MDS. Other treatments like HMAs can improve outcomes but are not curative.",
                    citation: "NCCN Guidelines: MDS Version 2.2025.",
                    guideline: { name: "NCCN MDS", url: "https://www.nccn.org/guidelines/guidelines-detail?category=1&id=1446" }
                }
            ],
            mds: [
                {
                    category: "MDS",
                    question: "Which new molecular prognostic system was introduced to complement IPSS-R?",
                    answers: ["IPSS-M (Molecular)", "IPSS-G (Genetic)", "MDS-CI", "WPSS-M"],
                    correct: 0,
                    explanation: "The IPSS-M (Molecular International Prognostic Scoring System) was introduced to account for the importance of molecular genetics in MDS prognosis, providing superior prognostic information compared to IPSS-R alone.",
                    citation: "Bernard E, et al. NEJM Evid. 2022;1(7):EVIDoa2200008.",
                    pmid: "38319256",
                    doi: "10.1056/EVIDoa2200008"
                },
                {
                    category: "CML",
                    question: "Which TKI was recently approved as category-1 preferred first-line treatment for newly diagnosed CML-CP?",
                    answers: ["Asciminib", "Ponatinib", "Bosutinib", "Radotinib"],
                    correct: 0,
                    explanation: "The NCCN updated guidelines to recommend asciminib as a category-1 preferred treatment for adults with newly diagnosed Ph+ CML in chronic phase based on the ASC4FIRST trial results.",
                    citation: "NCCN Clinical Practice Guidelines: CML Version 1.2025.",
                    guideline: { name: "NCCN CML", url: "https://www.nccn.org/guidelines/guidelines-detail?category=1&id=1427" }
                },
                {
                    category: "CMML",
                    question: "According to WHO 5th edition, how is CMML now subclassified based on leukocyte count?",
                    answers: ["MD-CMML (<13) and MP-CMML (‚â•13 x10‚Åπ/L)", "CMML-0 and CMML-1", "CMML-D and CMML-P", "Low-CMML and High-CMML"],
                    correct: 0,
                    explanation: "WHO 5th edition classifies CMML based on leukocyte count into myelodysplastic CMML (MD-CMML) with <13x10‚Åπ/L leukocytes and myeloproliferative CMML (MP-CMML) with ‚â•13x10‚Åπ/L.",
                    citation: "Khoury JD, et al. Leukemia. 2022;36(7):1703-1719.",
                    pmid: "35732831",
                    doi: "10.1038/s41375-022-01613-1"
                },
                {
                    category: "MPN",
                    question: "Which JAK inhibitor is approved for intermediate or high-risk myelofibrosis?",
                    answers: ["Ruxolitinib", "Tofacitinib", "Baricitinib", "Upadacitinib"],
                    correct: 0,
                    explanation: "Ruxolitinib, a JAK1/JAK2 inhibitor, was the first JAK inhibitor approved for myelofibrosis and remains a mainstay of treatment for intermediate or high-risk disease based on the COMFORT trials.",
                    citation: "Verstovsek S, et al. N Engl J Med. 2012;366(9):799-807.",
                    pmid: "22375971",
                    doi: "10.1056/NEJMoa1110557"
                },
                {
                    category: "MDS",
                    question: "Which cytogenetic abnormality in MDS is associated with response to lenalidomide?",
                    answers: ["del(5q)", "del(7q)", "del(20q)", "trisomy 8"],
                    correct: 0,
                    explanation: "Lenalidomide is specifically effective in lower-risk MDS with isolated del(5q), achieving transfusion independence in approximately 67% of patients.",
                    citation: "List A, et al. N Engl J Med. 2006;355(14):1456-1465.",
                    pmid: "17021321",
                    doi: "10.1056/NEJMoa061292"
                },
                {
                    category: "CMML",
                    question: "What is the risk of leukemic transformation in CMML over 3-5 years?",
                    answers: ["15-20%", "5-10%", "30-40%", "50-60%"],
                    correct: 0,
                    explanation: "CMML has an inherent risk for leukemic transformation of approximately 15-20% over 3-5 years, making monitoring and risk stratification essential.",
                    citation: "Patnaik MM, Tefferi A. Am J Hematol. 2024;99(6):1055-1078.",
                    pmid: "38450850",
                    doi: "10.1002/ajh.27271"
                },
                {
                    category: "CML",
                    question: "What is treatment-free remission (TFR) in CML?",
                    answers: ["Sustained DMR after TKI discontinuation", "Complete cytogenetic response", "Major molecular response", "Blast crisis remission"],
                    correct: 0,
                    explanation: "Treatment-free remission (TFR) refers to the ability to maintain deep molecular response after discontinuing TKI therapy, a goal for eligible patients with sustained deep molecular responses.",
                    citation: "Hochhaus A, et al. Leukemia. 2020;34(4):966-984.",
                    pmid: "32127639",
                    doi: "10.1038/s41375-020-0776-2"
                },
                {
                    category: "MPN",
                    question: "What is the preferred first-line cytoreductive therapy for high-risk Polycythemia Vera?",
                    answers: ["Hydroxyurea", "Interferon-alpha", "Ruxolitinib", "Anagrelide"],
                    correct: 0,
                    explanation: "Hydroxyurea remains the preferred first-line cytoreductive therapy for high-risk PV. Interferon-alpha (including pegylated forms) is an alternative, particularly in younger patients.",
                    citation: "NCCN Guidelines: MPN Version 2.2025.",
                    guideline: { name: "NCCN MPN", url: "https://www.nccn.org/guidelines/guidelines-detail?category=1&id=1502" }
                },
                {
                    category: "MDS",
                    question: "Which IDH1 inhibitor was recently added as a treatment option for MDS?",
                    answers: ["Olutasidenib", "Enasidenib", "Vorasidenib", "Ivosidenib"],
                    correct: 0,
                    explanation: "In 2024, the NCCN panel voted to add olutasidenib as an alternative to ivosidenib for IDH1-mutated MDS in multiple settings, acknowledging its FDA approval for relapsed/refractory AML.",
                    citation: "NCCN Guidelines Insights: MDS Version 2.2025.",
                    guideline: { name: "NCCN MDS", url: "https://www.nccn.org/guidelines/guidelines-detail?category=1&id=1446" }
                },
                {
                    category: "CMML",
                    question: "Which genotype is considered favorable in CMML?",
                    answers: ["ASXL1WT/TET2MT", "ASXL1MT/TET2WT", "ASXL1MT/TET2MT", "DNMT3AMT/TET2WT"],
                    correct: 0,
                    explanation: "The ASXL1 wild-type/TET2 mutant (ASXL1WT/TET2MT) genotype is considered favorable in CMML. The presence of ASXL1 mutations negatively impacts overall survival.",
                    citation: "Patnaik MM, Tefferi A. Am J Hematol. 2024;99(6):1055-1078.",
                    pmid: "38450850",
                    doi: "10.1002/ajh.27271"
                }
            ],
            'mds-aml': [
                {
                    category: "MDS-AML",
                    question: "According to WHO 5th edition and ICC 2022, what blast threshold now defines AML with myelodysplasia-related changes?",
                    answers: ["10% with qualifying criteria", "20%", "30%", "5%"],
                    correct: 0,
                    explanation: "The WHO 5th edition and ICC 2022 introduced the category of MDS/AML, allowing AML diagnosis at ‚â•10% blasts when specific genetic abnormalities or MDS-related features are present.",
                    citation: "Khoury JD, et al. Leukemia. 2022;36(7):1703-1719.",
                    pmid: "35732831",
                    doi: "10.1038/s41375-022-01613-1"
                },
                {
                    category: "CML",
                    question: "What defines CML blast crisis?",
                    answers: ["‚â•20% blasts in blood or BM, or extramedullary blast proliferation", "‚â•30% blasts", "‚â•10% blasts", "Loss of molecular response"],
                    correct: 0,
                    explanation: "CML blast crisis is defined by ‚â•20% blasts in peripheral blood or bone marrow, or the presence of extramedullary blast proliferation. This represents transformation to acute leukemia.",
                    citation: "Hochhaus A, et al. Leukemia. 2020;34(4):966-984.",
                    pmid: "32127639",
                    doi: "10.1038/s41375-020-0776-2"
                },
                {
                    category: "MPN",
                    question: "What is the risk of transformation to acute leukemia in primary myelofibrosis at 10 years?",
                    answers: ["10-20%", "5-10%", "30-40%", "1-5%"],
                    correct: 0,
                    explanation: "Primary myelofibrosis carries a 10-20% risk of transformation to acute myeloid leukemia at 10 years, with higher-risk disease and certain mutations associated with increased risk.",
                    citation: "Tefferi A. Am J Hematol. 2023;98(5):801-821.",
                    pmid: "36680511",
                    doi: "10.1002/ajh.26857"
                },
                {
                    category: "MDS",
                    question: "Which TP53 abnormality pattern defines MDS with biallelic TP53 inactivation?",
                    answers: ["2+ mutations, 1 mutation + LOH, or 1 mutation + VAF>50%", "Any single TP53 mutation", "TP53 deletion alone", "Only complex karyotype with TP53"],
                    correct: 0,
                    explanation: "MDS with biallelic TP53 inactivation is defined by: two or more distinct TP53 mutations, one mutation with loss of heterozygosity (LOH), or one mutation with VAF >50%. This carries very poor prognosis.",
                    citation: "Bernard E, et al. Nat Med. 2020;26(10):1549-1556.",
                    pmid: "32747829",
                    doi: "10.1038/s41591-020-1008-z"
                },
                {
                    category: "CMML",
                    question: "What defines CMML-2 according to updated WHO classification?",
                    answers: ["5-19% PB blasts or 10-19% BM blasts or Auer rods", "2-4% PB blasts or 5-9% BM blasts", ">20% blasts", "<5% PB and <10% BM blasts"],
                    correct: 0,
                    explanation: "CMML-2 is defined by 5%‚Äì19% peripheral blood blasts (including promonocytes), 10%‚Äì19% bone marrow blasts, or the presence of any Auer rods. CMML-0 was removed in WHO 5th edition.",
                    citation: "Khoury JD, et al. Leukemia. 2022;36(7):1703-1719.",
                    pmid: "35732831",
                    doi: "10.1038/s41375-022-01613-1"
                },
                {
                    category: "CML",
                    question: "When is allogeneic stem cell transplant indicated in CML?",
                    answers: ["Failure of 2+ TKIs or advanced phase disease", "First-line for all patients", "Only for T315I mutation", "Never indicated in TKI era"],
                    correct: 0,
                    explanation: "Allogeneic SCT remains appropriate for CML-CP patients with failure (due to resistance) of at least two TKIs and for all patients with advanced-phase disease (accelerated or blast phase).",
                    citation: "Hochhaus A, et al. Leukemia. 2020;34(4):966-984.",
                    pmid: "32127639",
                    doi: "10.1038/s41375-020-0776-2"
                },
                {
                    category: "MPN",
                    question: "Which cytogenetic abnormality is considered highest risk in myelofibrosis?",
                    answers: ["inv(3)/3q21 rearrangement", "del(13q)", "del(20q)", "trisomy 9"],
                    correct: 0,
                    explanation: "Cytogenetic abnormalities involving 3q21/inv(3) are considered very high risk in myelofibrosis. Other high-risk abnormalities include monosomal karyotype and complex karyotype.",
                    citation: "Tefferi A. Am J Hematol. 2023;98(5):801-821.",
                    pmid: "36680511",
                    doi: "10.1002/ajh.26857"
                },
                {
                    category: "MDS",
                    question: "What is the median survival for IPSS-R very high-risk MDS?",
                    answers: ["0.8 years", "1.6 years", "3 years", "5.3 years"],
                    correct: 0,
                    explanation: "Patients with IPSS-R very high risk have the poorest prognosis with median survival of only 0.8 years. High risk is 1.6 years, intermediate is 3 years, low is 5.3 years, and very low is 8.8 years.",
                    citation: "Greenberg PL, et al. Blood. 2012;120(12):2454-2465.",
                    pmid: "22740453",
                    doi: "10.1182/blood-2012-03-420489"
                },
                {
                    category: "CMML",
                    question: "What was the outcome of the DACOTA trial comparing hydroxyurea vs decitabine in high-risk MP-CMML?",
                    answers: ["Similar OS despite higher response with decitabine", "Superior OS with decitabine", "Superior OS with hydroxyurea", "Trial stopped for futility"],
                    correct: 0,
                    explanation: "The DACOTA phase-3 trial showed similar overall survival (23.1 vs 18.4 months) for hydroxyurea vs decitabine in high-risk MP-CMML, despite higher response rates with decitabine (56% vs 31%).",
                    citation: "Patnaik MM, Tefferi A. Am J Hematol. 2024;99(6):1055-1078.",
                    pmid: "38450850",
                    doi: "10.1002/ajh.27271"
                },
                {
                    category: "MDS-AML",
                    question: "Which gene mutations define AML/MDS regardless of blast count according to ICC 2022?",
                    answers: ["NPM1, CEBPA (bZIP), or core binding factor fusions", "Only TP53 mutations", "Any splicing factor mutation", "JAK2 mutations"],
                    correct: 0,
                    explanation: "According to ICC 2022, NPM1 mutation, in-frame CEBPA bZIP mutation, or core binding factor fusions (t(8;21), inv(16)) define AML regardless of blast percentage, recognizing their distinct biology.",
                    citation: "Arber DA, et al. Blood. 2022;140(11):1200-1228. (ICC 2022)",
                    pmid: "35767897",
                    doi: "10.1182/blood.2022015850"
                }
            ]
        };

        // Game State
        let currentDifficulty = 'chip';
        let score = 0;
        let lives = 3;
        let currentQuestion = 0;
        let questionsPerLevel = 10;
        let currentQuestions = [];
        let timerInterval = null;
        let timeLeft = 30;
        let isMuted = false;
        let audioContext = null;
        let playerPosition = 0; // 0-4 representing platform levels

        // Audio System
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            return audioContext;
        }

        function playSound(frequency, duration, type = 'square', volume = 0.1) {
            if (isMuted) return;
            try {
                const ctx = initAudio();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = type;
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.frequency.value = frequency;
                gain.gain.setValueAtTime(volume, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + duration);
                osc.start(ctx.currentTime);
                osc.stop(ctx.currentTime + duration);
            } catch(e) {}
        }

        function playJumpSound() {
            playSound(200, 0.1);
            setTimeout(() => playSound(400, 0.1), 50);
            setTimeout(() => playSound(600, 0.15), 100);
        }

        function playCorrectSound() {
            playSound(523, 0.1);
            setTimeout(() => playSound(659, 0.1), 100);
            setTimeout(() => playSound(784, 0.15), 200);
        }

        function playIncorrectSound() {
            playSound(200, 0.2, 'sawtooth');
            setTimeout(() => playSound(150, 0.3, 'sawtooth'), 100);
        }

        function playBarrelSound() {
            playSound(100, 0.1, 'triangle');
        }

        function playVictoryMusic() {
            if (isMuted) return;
            const melody = [523, 587, 659, 784, 659, 784, 880, 784, 880, 1047];
            melody.forEach((freq, i) => {
                setTimeout(() => playSound(freq, 0.2, 'square', 0.08), i * 150);
            });
        }

        function playGameOverSound() {
            if (isMuted) return;
            const notes = [400, 350, 300, 250, 200];
            notes.forEach((freq, i) => {
                setTimeout(() => playSound(freq, 0.3, 'sawtooth', 0.1), i * 200);
            });
        }

        // Background Music
        let musicInterval = null;
        let musicPlaying = false;
        const kongMelody = [
            392, 392, 0, 392, 0, 311, 392, 0, 523, 0, 0, 0, 261,
            0, 0, 0, 196, 0, 0, 247, 0, 294, 277, 0, 294, 0,
            196, 0, 0, 0, 330, 0, 349, 0, 392, 0, 349, 330, 0
        ];
        let melodyIndex = 0;

        function startMusic() {
            if (musicPlaying || isMuted) return;
            musicPlaying = true;
            musicInterval = setInterval(() => {
                if (!musicPlaying || isMuted) return;
                const note = kongMelody[melodyIndex];
                if (note > 0) {
                    playSound(note, 0.12, 'square', 0.03);
                }
                melodyIndex = (melodyIndex + 1) % kongMelody.length;
            }, 140);
        }

        function stopMusic() {
            musicPlaying = false;
            if (musicInterval) {
                clearInterval(musicInterval);
                musicInterval = null;
            }
        }

        function toggleVolume() {
            isMuted = !isMuted;
            const btn = document.getElementById('volumeToggle');
            const icon = document.getElementById('volumeIcon');
            if (isMuted) {
                btn.classList.add('muted');
                icon.innerHTML = '&#128263;';
                stopMusic();
            } else {
                btn.classList.remove('muted');
                icon.innerHTML = '&#128266;';
                if (document.getElementById('gameScreen').classList.contains('active')) {
                    startMusic();
                }
            }
        }

        // Create floating chromosomes
        function createChromosomes() {
            const container = document.getElementById('gameBg');
            const symbols = ['&#9878;', '&#9879;', '&#8853;', '&#8854;', '&#10683;'];
            for (let i = 0; i < 15; i++) {
                const chrom = document.createElement('div');
                chrom.className = 'chromosome';
                chrom.innerHTML = symbols[Math.floor(Math.random() * symbols.length)];
                chrom.style.left = Math.random() * 100 + '%';
                chrom.style.color = `hsl(${280 + Math.random() * 40}, 70%, 50%)`;
                chrom.style.animationDelay = Math.random() * 15 + 's';
                chrom.style.animationDuration = (12 + Math.random() * 8) + 's';
                container.appendChild(chrom);
            }
        }
        createChromosomes();

        // Difficulty Selection
        function selectDifficulty(diff) {
            currentDifficulty = diff;
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector(`.difficulty-btn.${diff.replace('-', '')}`).classList.add('selected');
            playSound(440, 0.1);
        }

        // Shuffle array
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Start Game
        function startGame() {
            score = 0;
            lives = 3;
            currentQuestion = 0;
            playerPosition = 0;

            // Get questions for selected difficulty
            // Map difficulty to questionBank key (mds-aml uses mds array which contains MDS-AML questions)
            const diffKeyMap = { 'chip': 'chip', 'ccus': 'ccus', 'mds': 'mds', 'mds-aml': 'mds' };
            const diffKey = diffKeyMap[currentDifficulty] || 'mds';
            currentQuestions = shuffleArray(questionBank[diffKey]).slice(0, questionsPerLevel);

            document.getElementById('titleScreen').style.display = 'none';
            document.getElementById('gameScreen').classList.add('active');
            document.getElementById('resultsScreen').classList.remove('active');

            updateUI();
            startMusic();

            // Start first question after short delay
            setTimeout(() => {
                showQuestion();
            }, 1000);
        }

        // Update UI
        function updateUI() {
            document.getElementById('scoreValue').textContent = score;
            document.getElementById('levelDisplay').textContent = currentDifficulty.toUpperCase();

            // Update lives
            const livesContainer = document.getElementById('livesDisplay');
            livesContainer.innerHTML = '';
            for (let i = 0; i < 3; i++) {
                const life = document.createElement('div');
                life.className = 'life-icon' + (i >= lives ? ' lost' : '');
                livesContainer.appendChild(life);
            }

            // Update progress
            const progress = (currentQuestion / questionsPerLevel) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = `Question ${currentQuestion + 1} of ${questionsPerLevel}`;

            // Update player position
            updatePlayerPosition();
        }

        function updatePlayerPosition() {
            const player = document.getElementById('player');
            const positions = [
                { bottom: '12%', left: '10%' },
                { bottom: '32%', left: '70%' },
                { bottom: '52%', left: '15%' },
                { bottom: '72%', left: '65%' },
                { bottom: '89%', left: '40%' }
            ];

            const pos = positions[Math.min(playerPosition, 4)];
            player.style.bottom = pos.bottom;
            player.style.left = pos.left;
        }

        // Show Question
        function showQuestion() {
            if (currentQuestion >= questionsPerLevel || lives <= 0) {
                endGame();
                return;
            }

            const question = currentQuestions[currentQuestion];
            document.getElementById('questionCategory').textContent = question.category;
            document.getElementById('questionText').textContent = question.question;

            // Shuffle answers
            const answerIndices = shuffleArray([0, 1, 2, 3]);
            const correctIndex = answerIndices.indexOf(question.correct);

            const answersGrid = document.getElementById('answersGrid');
            answersGrid.innerHTML = '';

            answerIndices.forEach((ansIdx, displayIdx) => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.textContent = String.fromCharCode(65 + displayIdx) + '. ' + question.answers[ansIdx];
                btn.onclick = () => checkAnswer(displayIdx, correctIndex, question);
                answersGrid.appendChild(btn);
            });

            // Reset and hide explanation
            document.getElementById('explanationBox').classList.remove('show');
            document.getElementById('continueBtn').style.display = 'none';

            // Start timer
            timeLeft = 30;
            document.getElementById('questionTimer').textContent = timeLeft;
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('questionTimer').textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    handleTimeout();
                }
            }, 1000);

            // Show modal
            document.getElementById('questionModal').classList.add('active');
            playBarrelSound();
        }

        // Check Answer
        function checkAnswer(selected, correct, question) {
            clearInterval(timerInterval);

            const buttons = document.querySelectorAll('.answer-btn');
            buttons.forEach((btn, i) => {
                btn.classList.add('disabled');
                if (i === correct) {
                    btn.classList.add('correct');
                } else if (i === selected && i !== correct) {
                    btn.classList.add('incorrect');
                }
            });

            if (selected === correct) {
                // Correct answer
                playCorrectSound();
                const timeBonus = Math.floor(timeLeft * 10);
                const difficultyMultiplier = { chip: 1, ccus: 1.5, mds: 2, 'mds-aml': 3 };
                const points = Math.floor((100 + timeBonus) * difficultyMultiplier[currentDifficulty]);
                score += points;

                // Move player up
                playerPosition = Math.min(playerPosition + 1, 4);
                playJumpSound();
            } else {
                // Incorrect answer
                playIncorrectSound();
                lives--;
            }

            // Show explanation
            document.getElementById('explanationText').textContent = question.explanation;
            document.getElementById('citationText').innerHTML = 'üìö ' + question.citation + renderReferenceLinks(question);
            document.getElementById('explanationBox').classList.add('show');
            document.getElementById('continueBtn').style.display = 'block';

            updateUI();
        }

        // Handle Timeout
        function handleTimeout() {
            const buttons = document.querySelectorAll('.answer-btn');
            buttons.forEach(btn => btn.classList.add('disabled'));
            playIncorrectSound();
            lives--;

            const question = currentQuestions[currentQuestion];
            document.getElementById('explanationText').textContent = 'Time\'s up! ' + question.explanation;
            document.getElementById('citationText').innerHTML = 'üìö ' + question.citation + renderReferenceLinks(question);
            document.getElementById('explanationBox').classList.add('show');
            document.getElementById('continueBtn').style.display = 'block';

            updateUI();
        }

        // Continue Game
        function continueGame() {
            document.getElementById('questionModal').classList.remove('active');
            currentQuestion++;

            if (lives <= 0) {
                endGame();
            } else if (currentQuestion >= questionsPerLevel) {
                endGame();
            } else {
                setTimeout(() => {
                    showQuestion();
                }, 500);
            }
        }

        // End Game
        function endGame() {
            stopMusic();
            document.getElementById('questionModal').classList.remove('active');
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('resultsScreen').classList.add('active');

            const won = lives > 0 && currentQuestion >= questionsPerLevel;
            document.getElementById('resultsTitle').textContent = won ? 'LEVEL COMPLETE!' : 'GAME OVER';

            if (won) {
                playVictoryMusic();
            } else {
                playGameOverSound();
            }

            document.getElementById('finalScore').textContent = score;
            const correctCount = currentQuestion - (3 - lives);
            document.getElementById('correctAnswers').textContent = `${Math.max(0, correctCount)}/${questionsPerLevel}`;
            document.getElementById('accuracy').textContent = Math.round((Math.max(0, correctCount) / questionsPerLevel) * 100) + '%';
            document.getElementById('difficultyPlayed').textContent = currentDifficulty.toUpperCase();

            // Save high score
            const highScoreKey = 'myeloidKongHighScore_' + currentDifficulty;
            const existingScore = localStorage.getItem(highScoreKey) || 0;
            if (score > existingScore) {
                localStorage.setItem(highScoreKey, score);
                localStorage.setItem('myeloidKongHighScore', Math.max(score, localStorage.getItem('myeloidKongHighScore') || 0));
            }
        }

        // Restart Game
        function restartGame() {
            document.getElementById('resultsScreen').classList.remove('active');
            document.getElementById('titleScreen').style.display = 'block';
        }

        // Go Home
        function goHome() {
            window.location.href = '../HematologyArcade/index.html';
        }

        // Initialize on first click
        document.addEventListener('click', function init() {
            initAudio();
            document.removeEventListener('click', init);
        });

        // Select default difficulty
        selectDifficulty('chip');
    </script>
</body>
</html>
