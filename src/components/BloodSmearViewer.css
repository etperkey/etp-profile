.blood-smear-viewer {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: linear-gradient(135deg, #fdf6f0 0%, #fef9f5 50%, #fff5ee 100%);
  overflow: hidden;
  font-family: 'Rajdhani', sans-serif;
}

.blood-smear-viewer .blood-smear-background {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  /* Smooth transform for continuous scrolling at 10x */
  transition: transform 0.12s ease-out;
  will-change: transform;
}

/* Zoom container */
.blood-smear-zoom-container {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  transition: transform 0.2s ease-out;
  will-change: transform;
}

/* Zone transition cross-fade */
.zone-transition {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

.zone-fade-out {
  animation: fadeOut 0.25s ease-in-out forwards;
  pointer-events: none;
}

.zone-fade-in {
  animation: fadeIn 0.25s ease-in-out forwards;
}

@keyframes fadeOut {
  from { opacity: 1; }
  to { opacity: 0; }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Panning state */
.blood-smear-viewer.panning .blood-smear-zoom-container {
  transition: none;
}

.blood-smear-viewer.zoomed {
  cursor: grab;
}

.blood-smear-viewer.panning {
  cursor: grabbing;
}

/* 10x slide navigation cursor (desktop only) */
@media (min-width: 769px) {
  .blood-smear-viewer:not(.zoomed) {
    cursor: grab;
  }

  .blood-smear-viewer.dragging-slide {
    cursor: grabbing;
  }

  /* Disable transition during active dragging for immediate feedback */
  .blood-smear-viewer.dragging-slide .blood-smear-background {
    transition: none;
  }
}

/* Navigation buttons container */
.viewer-nav-buttons {
  position: fixed;
  top: 20px;
  left: 20px;
  display: flex;
  gap: 10px;
  z-index: 100;
}

/* Back link */
.viewer-back-link {
  padding: 10px 20px;
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(10px);
  border-radius: 8px;
  color: #333;
  text-decoration: none;
  font-weight: 500;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  transition: all 0.2s;
}

.viewer-back-link:hover {
  background: #fff;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  transform: translateY(-1px);
}

/* Morphology Guide link */
.viewer-morphology-link {
  padding: 10px 20px;
  background: linear-gradient(135deg, rgba(139, 41, 66, 0.9), rgba(196, 68, 68, 0.9));
  backdrop-filter: blur(10px);
  border-radius: 8px;
  color: white;
  text-decoration: none;
  font-weight: 500;
  box-shadow: 0 2px 10px rgba(139, 41, 66, 0.3);
  transition: all 0.2s;
}

.viewer-morphology-link:hover {
  background: linear-gradient(135deg, rgba(139, 41, 66, 1), rgba(196, 68, 68, 1));
  box-shadow: 0 4px 20px rgba(139, 41, 66, 0.4);
  transform: translateY(-1px);
}

/* Slide minimap - shows position on the larger conceptual slide */
.slide-minimap-container {
  position: fixed;
  right: 20px;
  bottom: 20px;
  z-index: 100;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  padding: 14px;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
}

.slide-minimap-header {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-bottom: 10px;
  text-align: center;
}

.minimap-title {
  font-size: 0.95rem;
  font-weight: 600;
  color: #4b5563;
}

.zone-indicator {
  font-size: 0.8rem;
  font-weight: 500;
  padding: 3px 10px;
  border-radius: 10px;
  transition: all 0.2s;
}

.zone-indicator.head {
  background: #e5e7eb;
  color: #4b5563;
}

.zone-indicator.body {
  background: #fef3c7;
  color: #d97706;
}

.zone-indicator.monolayer {
  background: #d1fae5;
  color: #059669;
}

.zone-indicator.edge {
  background: #fee2e2;
  color: #dc2626;
}

.slide-minimap {
  width: 120px;
  height: 160px;
  background: linear-gradient(to bottom,
    #fecaca 0%,      /* Feathered Edge - large cells/clumps here */
    #fecaca 15%,
    #d1fae5 15%,     /* Monolayer - optimal reading zone */
    #d1fae5 35%,
    #fef3c7 35%,     /* Body - middle section */
    #fef3c7 70%,
    #d1d5db 70%,     /* Head - thick, cells stacked */
    #d1d5db 100%
  );
  border-radius: 8px;
  position: relative;
  cursor: crosshair;
  box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.1);
  border: 2px solid #9ca3af;
}

/* Zone overlays for visual clarity */
.slide-zone {
  position: absolute;
  left: 0;
  right: 0;
  pointer-events: none;
}

.slide-zone-edge {
  top: 0;
  height: 15%;
  border-bottom: 1px dashed rgba(220, 38, 38, 0.4);
}

.slide-zone-monolayer {
  top: 15%;
  height: 20%;
  border-bottom: 1px dashed rgba(16, 185, 129, 0.4);
}

.slide-zone-body {
  top: 35%;
  height: 35%;
  border-bottom: 1px dashed rgba(217, 119, 6, 0.3);
}

.slide-zone-head {
  bottom: 0;
  height: 30%;
}

/* Zone labels */
.zone-label {
  position: absolute;
  right: 6px;
  font-size: 0.7rem;
  font-weight: 600;
  pointer-events: none;
  text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
}

.zone-label-edge {
  top: 2%;
  color: #dc2626;
}

.zone-label-monolayer {
  top: 20%;
  color: #059669;
}

.zone-label-body {
  top: 48%;
  color: #d97706;
}

.zone-label-head {
  bottom: 8%;
  color: #4b5563;
}

/* Viewport indicator - represents the current view */
.minimap-viewport {
  position: absolute;
  width: 30%;
  height: 20%;
  background: rgba(139, 41, 66, 0.2);
  border: 2px solid #8b2942;
  border-radius: 4px;
  transform: translate(-50%, 50%);
  /* No transition - instant updates for responsive dragging */
  box-shadow: 0 2px 8px rgba(139, 41, 66, 0.3);
  pointer-events: none;
}

.minimap-hint {
  margin-top: 8px;
  font-size: 0.75rem;
  color: #9ca3af;
  text-align: center;
}

/* Microscope panel - always visible, top center */
.microscope-panel {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(15px);
  border-radius: 12px;
  padding: 12px 20px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  z-index: 100;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
}

.microscope-controls {
  display: flex;
  align-items: center;
  gap: 12px;
}

.control-btn {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: 2px solid #e5e7eb;
  background: #f9fafb;
  font-size: 1.1rem;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.control-btn:hover {
  background: #f3f4f6;
  border-color: #d1d5db;
}

.pause-btn.paused {
  background: #dcfce7;
  border-color: #86efac;
  color: #16a34a;
}

.objective-selector {
  display: flex;
  gap: 4px;
  background: #f3f4f6;
  padding: 4px;
  border-radius: 8px;
}

.objective-btn {
  padding: 8px 14px;
  border: 2px solid transparent;
  border-radius: 6px;
  background: transparent;
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  color: #4b5563;
}

.objective-btn:hover {
  background: rgba(255, 255, 255, 0.8);
}

.objective-btn.active {
  background: white;
  border-color: var(--obj-color, #3182ce);
  color: var(--obj-color, #3182ce);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.objective-desc {
  margin: 0;
  font-size: 0.75rem;
  color: #6b7280;
}

.pan-hint {
  margin: 0;
  font-size: 0.7rem;
  color: #9ca3af;
  font-style: italic;
}

/* Pause animation state */
.blood-smear-viewer.paused .floating-cell {
  animation-play-state: paused !important;
}

/* Stationary cells at the cutoff line - no animation */
.floating-cell.stationary {
  animation: none !important;
  transform: translate(-50%, -50%);
}

/* Cell shadows - performance dependent */
/* Only applied when .with-shadows class is on parent (high/medium performance) */
.blood-smear-background.with-shadows .floating-cell {
  filter: drop-shadow(1.5px 1.5px 2px rgba(0, 0, 0, 0.25));
}

/* WBCs get more prominent shadows (larger cells) */
.blood-smear-background.with-shadows .floating-cell.neutrophil,
.blood-smear-background.with-shadows .floating-cell.neutrophil-3lobe,
.blood-smear-background.with-shadows .floating-cell.band-neutrophil,
.blood-smear-background.with-shadows .floating-cell.lymphocyte,
.blood-smear-background.with-shadows .floating-cell.monocyte,
.blood-smear-background.with-shadows .floating-cell.eosinophil,
.blood-smear-background.with-shadows .floating-cell.eosinophil-3lobe,
.blood-smear-background.with-shadows .floating-cell.basophil,
.blood-smear-background.with-shadows .floating-cell.blast,
.blood-smear-background.with-shadows .floating-cell.auer-rod,
.blood-smear-background.with-shadows .floating-cell.myelocyte,
.blood-smear-background.with-shadows .floating-cell.metamyelocyte,
.blood-smear-background.with-shadows .floating-cell.atypical-lymph {
  filter: drop-shadow(2px 2px 3px rgba(0, 0, 0, 0.3));
}

/* Stationary cells at cutoff get strongest shadows for depth */
.blood-smear-background.with-shadows .floating-cell.stationary {
  filter: drop-shadow(3px 3px 4px rgba(0, 0, 0, 0.35));
}

/* Cell Types panel - collapsible, right side */
.cell-types-panel {
  position: fixed;
  top: 80px;
  right: 20px;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(15px);
  border-radius: 12px;
  padding: 6px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  z-index: 100;
  max-width: 260px;
}

.cell-types-panel.expanded {
  padding: 6px 12px 12px 12px;
}

.cell-types-panel .panel-toggle {
  width: 100%;
  display: flex;
  align-items: center;
  gap: 8px;
  background: none;
  border: none;
  padding: 8px;
  cursor: pointer;
  font-size: 0.85rem;
  font-weight: 600;
  color: #1a1a2e;
  border-radius: 6px;
  transition: background 0.2s;
}

.cell-types-panel .panel-toggle:hover {
  background: rgba(0, 0, 0, 0.05);
}

.cell-types-panel .panel-content {
  padding-top: 8px;
}

.cell-types-panel h3 {
  margin: 0 0 12px 0;
  font-size: 1rem;
  color: #1a1a2e;
  font-weight: 600;
}

/* Hemoglobin Summary at top of Cell Types panel */
.hgb-summary {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 10px;
  background: linear-gradient(135deg, #fef2f2 0%, #fff5f5 100%);
  border-radius: 8px;
  margin-bottom: 12px;
  border: 1px solid #fecaca;
}

.hgb-label {
  font-size: 0.8rem;
  font-weight: 600;
  color: #991b1b;
}

.hgb-value {
  font-size: 1.1rem;
  font-weight: 700;
  font-family: 'Monaco', 'Consolas', monospace;
}

.hgb-status {
  font-size: 0.7rem;
  font-weight: 600;
  margin-left: auto;
}

.cell-types-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.cell-type-item {
  display: flex;
  align-items: center;
  gap: 10px;
}

.cell-type-info {
  display: flex;
  flex-direction: column;
  gap: 1px;
}

.cell-type-name {
  font-size: 0.85rem;
  color: #1a1a2e;
  font-weight: 500;
}

.cell-type-percent {
  font-size: 0.75rem;
  color: #6b7280;
}

.cell-type-desc {
  color: #9ca3af;
  font-style: italic;
}

.cell-type-percent.dynamic .dynamic-value {
  font-weight: 700;
  color: #8b2942;
}

/* Absolute count display */
.cell-type-absolute {
  font-size: 0.7rem;
  color: #059669;
  font-weight: 600;
  font-family: 'Monaco', 'Consolas', monospace;
}

/* WBC Header Row */
.wbc-header-row {
  margin-top: 8px;
  padding-top: 8px;
  border-top: 1px dashed #d1d5db;
}

.wbc-header-icon {
  width: 12px;
  flex-shrink: 0;
  color: #6b7280;
  font-size: 0.9rem;
  line-height: 1;
}

.header-name {
  font-weight: 600;
  color: #4b5563;
}

/* =================================================================
   COLLAPSIBLE PANEL STYLES (shared between RBC and WBC panels)
   ================================================================= */
.panel-toggle {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 100%;
  padding: 0;
  background: transparent;
  border: none;
  cursor: pointer;
  font-size: 1rem;
  font-weight: 600;
  text-align: left;
  color: #1a1a2e;
}

.panel-toggle:hover {
  opacity: 0.8;
}

.panel-toggle .toggle-icon {
  font-size: 0.7rem;
  color: #6b7280;
  width: 12px;
}

.panel-summary {
  margin-left: auto;
  font-size: 0.85rem;
  font-weight: 700;
}

.panel-content {
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid #e5e7eb;
}

.panel-status {
  display: block;
  font-size: 0.7rem;
  font-weight: 600;
  margin-bottom: 8px;
}

/* =================================================================
   INDICES PANELS CONTAINER - stacked vertically in top left
   ================================================================= */
.indices-panels-container {
  position: fixed;
  top: 80px;
  left: 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  z-index: 100;
  max-height: calc(100vh - 100px);
  overflow-y: auto;
  overflow-x: hidden;
  padding-right: 8px;
  padding-bottom: 20px;
}

/* Custom scrollbar for indices container */
.indices-panels-container::-webkit-scrollbar {
  width: 6px;
}

.indices-panels-container::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.05);
  border-radius: 3px;
}

.indices-panels-container::-webkit-scrollbar-thumb {
  background: rgba(0, 0, 0, 0.2);
  border-radius: 3px;
}

.indices-panels-container::-webkit-scrollbar-thumb:hover {
  background: rgba(0, 0, 0, 0.3);
}

/* RBC Indices Control panel */
.rbc-control-panel {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(15px);
  border-radius: 12px;
  padding: 14px 18px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  width: 270px;
  transition: all 0.2s ease;
}

.rbc-control-panel.collapsed {
  width: 200px;
}

.rbc-control-panel .panel-toggle {
  color: #c44444;
}

.anemia-presets {
  display: flex;
  flex-wrap: wrap;
  gap: 2px;
  margin-bottom: 5px;
}

.anemia-preset-btn {
  padding: 2px 4px;
  font-size: 0.5rem;
  background: #f3f4f6;
  border: 1px solid transparent;
  border-radius: 2px;
  cursor: pointer;
  transition: all 0.2s;
  color: #4b5563;
}

.anemia-preset-btn:hover {
  background: #fee2e2;
}

.anemia-preset-btn.active {
  background: linear-gradient(135deg, #c44444, #e88a8a);
  color: white;
}

.rbc-index-row {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 4px;
}

.rbc-index-label {
  font-size: 0.65rem;
  font-weight: 600;
  color: #c44444;
  min-width: 28px;
  line-height: 1;
}

.rbc-slider {
  flex: 1;
  max-width: 55px;
  height: 3px;
  border-radius: 1.5px;
  background: #fecaca;
  outline: none;
  -webkit-appearance: none;
}

.rbc-index-value {
  font-size: 0.65rem;
  font-weight: 700;
  color: #1a1a2e;
  line-height: 1;
  min-width: 38px;
}

.rbc-index-value .unit {
  font-size: 0.5rem;
  font-weight: 500;
  color: #6b7280;
  margin-left: 1px;
}

.rbc-index-status {
  font-size: 0.55rem;
  font-weight: 600;
  line-height: 1;
}

.rbc-index-absolute {
  font-size: 0.5rem;
  color: #059669;
  font-family: 'Monaco', 'Consolas', monospace;
}

.rbc-index-header {
  display: none;
}

.rbc-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: linear-gradient(135deg, #c44444, #e88a8a);
  cursor: pointer;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
}

.rbc-slider::-moz-range-thumb {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: linear-gradient(135deg, #c44444, #e88a8a);
  cursor: pointer;
  border: none;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
}

.mcv-slider {
  background: linear-gradient(to right, #fde68a 0%, #fecaca 50%, #e9d5ff 100%);
}

.rdw-slider {
  background: linear-gradient(to right, #d1fae5, #fecaca);
}

/* Platelet slider - red to green to yellow */
.plt-slider {
  background: linear-gradient(to right, #fca5a5 0%, #fecaca 20%, #d1fae5 40%, #d1fae5 60%, #fde68a 100%);
}

.plt-row {
  padding-top: 8px;
  margin-top: 4px;
  border-top: 1px dashed #e5e7eb;
}

.plt-label {
  color: #0891b2 !important;
}

/* nRBC slider - green to red (none to many) */
.nrbc-slider {
  background: linear-gradient(to right, #d1fae5 0%, #fecaca 50%, #fca5a5 100%);
}

.nrbc-row {
  padding-top: 2px;
  margin-top: 1px;
  border-top: 1px dashed #e5e7eb;
}

/* Calculated values (Hgb, Hct) - read-only display */
.calculated-row {
  margin-bottom: 3px;
  margin-left: 12px;
  opacity: 0.75;
}

.calculated-row .rbc-index-label {
  color: #9ca3af;
  font-weight: 500;
  font-size: 0.55rem;
  font-style: italic;
}

.calculated-row .rbc-index-value {
  font-size: 0.55rem;
  color: #6b7280;
}

.calculated-row .rbc-index-status {
  font-size: 0.5rem;
}

.calculated-bar {
  flex: 1;
  max-width: 80px;
  height: 3px;
  background: #f3f4f6;
  border-radius: 1.5px;
  overflow: hidden;
}

.calculated-fill {
  height: 100%;
  border-radius: 3px;
  transition: width 0.3s ease;
}

.hgb-fill {
  background: linear-gradient(90deg, #ef4444 0%, #f97316 30%, #10b981 60%, #10b981 100%);
}

.hct-fill {
  background: linear-gradient(90deg, #ef4444 0%, #f97316 30%, #10b981 60%, #8b5cf6 100%);
}

.nrbc-label {
  color: #7c3aed !important;
}

.rbc-reference {
  margin: 2px 0 0 0;
  font-size: 0.5rem;
  color: #9ca3af;
  text-align: center;
}

/* PLT Control panel */
.plt-control-panel {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(15px);
  border-radius: 12px;
  padding: 14px 18px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  width: 270px;
  transition: all 0.2s ease;
}

.plt-control-panel.collapsed {
  width: 200px;
}

.plt-control-panel .panel-toggle {
  color: #0891b2;
}

.plt-current {
  display: flex;
  flex-direction: column;
  gap: 4px;
  margin-bottom: 12px;
}

.plt-value {
  font-size: 1.4rem;
  font-weight: 700;
  color: #1a1a2e;
}

.plt-status {
  font-size: 0.85rem;
  font-weight: 600;
}

.plt-control-panel .plt-slider {
  width: 100%;
  height: 5px;
  border-radius: 3px;
  background: linear-gradient(to right, #fca5a5 0%, #fecaca 20%, #d1fae5 40%, #d1fae5 60%, #fde68a 100%);
  outline: none;
  -webkit-appearance: none;
}

.plt-control-panel .plt-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: linear-gradient(135deg, #0891b2, #22d3ee);
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}

.plt-control-panel .plt-slider::-moz-range-thumb {
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: linear-gradient(135deg, #0891b2, #22d3ee);
  cursor: pointer;
  border: none;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}

.plt-presets {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  margin-top: 10px;
}

.plt-preset-btn {
  padding: 4px 8px;
  font-size: 0.7rem;
  background: #f3f4f6;
  border: 1px solid transparent;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s;
  color: #4b5563;
}

.plt-preset-btn:hover {
  background: #cffafe;
}

.plt-preset-btn.active {
  background: linear-gradient(135deg, #0891b2, #22d3ee);
  color: white;
}

.plt-reference {
  font-size: 0.7rem;
  color: #9ca3af;
  margin-top: 8px;
  text-align: center;
}

/* WBC Control panel */
.wbc-control-panel {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(15px);
  border-radius: 12px;
  padding: 14px 18px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  width: 270px;
  transition: all 0.2s ease;
}

.wbc-control-panel.collapsed {
  width: 200px;
}

.wbc-control-panel .panel-toggle {
  color: #8b2942;
}

.wbc-current {
  display: flex;
  flex-direction: column;
  gap: 4px;
  margin-bottom: 12px;
}

.wbc-value {
  font-size: 1.4rem;
  font-weight: 700;
  color: #1a1a2e;
}

.wbc-status {
  font-size: 0.85rem;
  font-weight: 600;
}

.wbc-slider {
  width: 100%;
  height: 6px;
  border-radius: 3px;
  background: #e5e7eb;
  outline: none;
  -webkit-appearance: none;
  margin-bottom: 12px;
}

.wbc-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: linear-gradient(135deg, #8b2942, #a13553);
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}

.wbc-slider::-moz-range-thumb {
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: linear-gradient(135deg, #8b2942, #a13553);
  cursor: pointer;
  border: none;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}

.wbc-presets {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-bottom: 10px;
}

.wbc-preset-btn {
  padding: 4px 8px;
  font-size: 0.7rem;
  background: #f3f4f6;
  border: 1px solid transparent;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s;
  color: #4b5563;
}

.wbc-preset-btn:hover {
  background: #e5e7eb;
}

.wbc-preset-btn.active {
  background: linear-gradient(135deg, #8b2942, #a13553);
  color: white;
}

.wbc-reference {
  margin: 0 0 16px 0;
  font-size: 0.7rem;
  color: #9ca3af;
  text-align: center;
}

/* WBC Differential Section */
.differential-section {
  border-top: 1px solid #e5e7eb;
  padding-top: 12px;
}

.differential-section h4 {
  margin: 0 0 10px 0;
  font-size: 0.85rem;
  color: #4b5563;
  font-weight: 600;
}

.differential-presets {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  margin-bottom: 12px;
}

.diff-preset-btn {
  padding: 3px 6px;
  font-size: 0.65rem;
  background: #f3f4f6;
  border: 1px solid transparent;
  border-radius: 3px;
  cursor: pointer;
  transition: all 0.2s;
  color: #4b5563;
}

.diff-preset-btn:hover {
  background: #e5e7eb;
}

.diff-preset-btn.active {
  background: linear-gradient(135deg, #8b2942, #a13553);
  color: white;
}

.differential-sliders {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.diff-slider-row {
  display: flex;
  align-items: center;
  gap: 4px;
}

.diff-label {
  font-size: 0.7rem;
  font-weight: 600;
  width: 32px;
  flex-shrink: 0;
}

.diff-slider {
  flex: 1;
  max-width: 45px;
  height: 4px;
  border-radius: 2px;
  background: #e5e7eb;
  outline: none;
  -webkit-appearance: none;
}

.diff-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: currentColor;
  cursor: pointer;
}

.diff-slider::-moz-range-thumb {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: currentColor;
  cursor: pointer;
  border: none;
}

.diff-percent {
  font-size: 0.65rem;
  font-weight: 600;
  color: #1a1a2e;
  width: 24px;
  text-align: right;
  flex-shrink: 0;
}

.diff-absolute {
  font-size: 0.55rem;
  font-weight: 500;
  color: #6b7280;
  width: 28px;
  text-align: right;
  flex-shrink: 0;
  font-family: 'Monaco', 'Consolas', monospace;
}

/* Performance Stats panel - collapsible, bottom right */
.perf-stats-panel {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(15px);
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  z-index: 100;
  overflow: hidden;
  transition: all 0.3s ease;
}

.perf-stats-toggle {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 100%;
  padding: 12px 16px;
  background: transparent;
  border: none;
  cursor: pointer;
  font-size: 0.9rem;
  color: #1a1a2e;
  font-weight: 500;
  text-align: left;
}

.perf-stats-toggle:hover {
  background: rgba(0, 0, 0, 0.03);
}

.toggle-icon {
  font-size: 0.7rem;
  color: #6b7280;
}

.fps-badge {
  margin-left: auto;
  font-weight: 600;
  font-size: 0.85rem;
}

.perf-stats-content {
  padding: 0 16px 16px;
  border-top: 1px solid #e5e7eb;
}

.perf-stats-panel.expanded {
  width: 280px;
}

.perf-stats-panel.collapsed {
  width: auto;
}

.stat-section {
  margin-bottom: 18px;
}

.stat-section h4 {
  margin: 0 0 10px 0;
  font-size: 0.85rem;
  color: #6b7280;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.stat-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 0;
}

.stat-label {
  color: #6b7280;
  font-size: 0.9rem;
}

.stat-value {
  font-weight: 600;
  color: #1a1a2e;
  font-size: 0.9rem;
}

.density-value {
  text-transform: capitalize;
  background: linear-gradient(135deg, #8b2942, #a13553);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.gpu-row {
  flex-direction: column;
  align-items: flex-start;
  gap: 4px;
}

.gpu-value {
  font-size: 0.75rem;
  word-break: break-word;
  line-height: 1.3;
}

/* Density controls */
.density-controls {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-bottom: 12px;
}

.density-btn {
  padding: 8px 12px;
  background: #f3f4f6;
  border: 2px solid transparent;
  border-radius: 6px;
  color: #4b5563;
  font-size: 0.85rem;
  cursor: pointer;
  transition: all 0.2s;
  text-align: left;
}

.density-btn:hover {
  background: #e5e7eb;
}

.density-btn.active {
  background: linear-gradient(135deg, #8b2942, #a13553);
  color: white;
  border-color: #8b2942;
}

/* Shadow controls */
.shadow-controls {
  display: flex;
  gap: 6px;
  margin-bottom: 10px;
}

.shadow-btn {
  flex: 1;
  padding: 6px 10px;
  background: #f3f4f6;
  border: 2px solid transparent;
  border-radius: 6px;
  color: #4b5563;
  font-size: 0.8rem;
  cursor: pointer;
  transition: all 0.2s;
  text-align: center;
}

.shadow-btn:hover {
  background: #e5e7eb;
}

.shadow-btn.active {
  background: linear-gradient(135deg, #8b2942, #a13553);
  color: white;
  border-color: #8b2942;
}

/* Zoom controls */
.zoom-controls {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 10px;
}

.zoom-btn {
  width: 36px;
  height: 36px;
  background: #f3f4f6;
  border: 2px solid transparent;
  border-radius: 8px;
  color: #4b5563;
  font-size: 1.2rem;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.zoom-btn:hover:not(:disabled) {
  background: #e5e7eb;
  border-color: #d1d5db;
}

.zoom-btn:active:not(:disabled) {
  transform: scale(0.95);
}

.zoom-btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.zoom-btn.reset-btn {
  width: auto;
  padding: 0 12px;
  font-size: 0.8rem;
  font-weight: 500;
}

.zoom-level {
  min-width: 45px;
  text-align: center;
  font-weight: 600;
  color: #1a1a2e;
  font-size: 0.95rem;
}

.zoom-hint {
  margin: 0;
  font-size: 0.75rem;
  color: #9ca3af;
  font-style: italic;
}

/* Cell legend */
.cell-legend {
  border-top: 1px solid #e5e7eb;
  padding-top: 15px;
  margin-top: 15px;
}

.legend-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 0.85rem;
  color: #4b5563;
}

.legend-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  flex-shrink: 0;
}

.legend-dot.rbc {
  background: radial-gradient(circle at 30% 30%, #e88a8a, #c44444);
}

.legend-dot.platelet {
  background: radial-gradient(circle at 30% 30%, #d4b4e8, #9b6bc4);
}

.legend-dot.neutrophil {
  background: radial-gradient(circle at 30% 30%, #b8d4e8, #6a9fc4);
}

.legend-dot.lymphocyte {
  background: radial-gradient(circle at 30% 30%, #a8c8e8, #5a8ac4);
}

.legend-dot.monocyte {
  background: radial-gradient(circle at 30% 30%, #c8d4e8, #8a9fc4);
}

.legend-dot.eosinophil {
  background: radial-gradient(circle at 30% 30%, #f4c4a8, #e88a5a);
}

.legend-dot.basophil {
  background: radial-gradient(circle at 30% 30%, #c4a8d4, #8a5aa4);
}

/* Title overlay */
.viewer-title {
  position: fixed;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%);
  text-align: center;
  z-index: 50;
}

.viewer-title h1 {
  margin: 0;
  font-size: 2rem;
  color: #1a1a2e;
  text-shadow: 0 2px 10px rgba(255, 255, 255, 0.8);
}

.viewer-title p {
  margin: 8px 0 0 0;
  font-size: 1rem;
  color: #6b7280;
  text-shadow: 0 1px 5px rgba(255, 255, 255, 0.8);
}

/* =================================================================
   MOBILE INFO BUTTON
   ================================================================= */

.mobile-info-button {
  display: none; /* Hidden on desktop */
  position: fixed;
  top: calc(env(safe-area-inset-top, 0px) + 6px);
  left: 50%;
  transform: translateX(-50%);
  z-index: 100;
  flex-direction: column;
  align-items: center;
  background: rgba(255, 255, 255, 0.92);
  backdrop-filter: blur(10px);
  border-radius: 10px;
  padding: 6px 12px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
  cursor: pointer;
  transition: all 0.2s ease;
}

.mobile-info-button:active {
  transform: translateX(-50%) scale(0.98);
}

.mobile-info-title {
  font-family: 'Rajdhani', sans-serif;
  font-size: 0.75rem;
  font-weight: 600;
  color: #b91c1c;
  letter-spacing: 0.5px;
  text-transform: uppercase;
  white-space: nowrap;
}

.mobile-info-content {
  margin-top: 6px;
  padding-top: 6px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  text-align: center;
}

.mobile-info-content p {
  margin: 2px 0;
  font-size: 0.5rem;
  color: #6b7280;
  line-height: 1.3;
}

.mobile-info-content p:first-child {
  font-weight: 500;
  color: #4b5563;
}

.mobile-info-hint {
  margin-top: 4px !important;
  font-style: italic;
  opacity: 0.7;
}

/* Mobile adjustments */
@media (max-width: 768px) {
  /* Enable touch scrolling on smear container */
  .blood-smear-viewer {
    touch-action: pan-x pan-y;
    -webkit-overflow-scrolling: touch;
    /* Account for iPhone notch/dynamic island */
    padding-top: env(safe-area-inset-top, 0);
  }

  /* Nav buttons - compact row at top with safe area */
  .viewer-nav-buttons {
    top: calc(env(safe-area-inset-top, 0px) + 8px);
    left: 8px;
    right: 8px;
    flex-direction: row;
    justify-content: space-between;
  }

  .viewer-back-link,
  .viewer-morphology-link {
    padding: 5px 8px;
    font-size: 0.6rem;
  }

  /* Microscope panel - compact, below nav */
  .microscope-panel {
    top: calc(env(safe-area-inset-top, 0px) + 42px);
    padding: 4px 8px;
    gap: 4px;
  }

  .control-btn {
    width: 24px;
    height: 24px;
    font-size: 0.7rem;
  }

  .objective-btn {
    padding: 3px 5px;
    font-size: 0.55rem;
  }

  .objective-desc {
    display: none;
  }

  .pan-hint {
    display: none;
  }

  /* Indices panels - horizontal at bottom */
  .indices-panels-container {
    position: fixed;
    top: auto;
    bottom: calc(env(safe-area-inset-bottom, 0px) + 10px);
    left: 8px;
    right: 8px;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: center;
    gap: 6px;
    padding: 0;
    max-height: none;
    overflow: visible;
    background: transparent;
  }

  .indices-panels-container::-webkit-scrollbar {
    display: none;
  }

  /* Control panels for mobile - compact cards at bottom */
  .rbc-control-panel,
  .wbc-control-panel,
  .plt-control-panel,
  .morphology-control-panel {
    min-width: auto;
    max-width: none;
    width: auto;
    min-height: auto;
    padding: 0;
    flex-shrink: 0;
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    align-items: stretch;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.18);
  }

  /* Collapsed state - compact toggle */
  .rbc-control-panel.collapsed,
  .wbc-control-panel.collapsed,
  .plt-control-panel.collapsed {
    width: 70px;
  }

  .morphology-control-panel.collapsed {
    width: 55px;
  }

  /* Expanded state - show presets and controls */
  .rbc-control-panel.expanded {
    width: 160px;
    max-height: 220px;
    overflow-y: auto;
  }

  .wbc-control-panel.expanded,
  .plt-control-panel.expanded {
    width: 130px;
    max-height: 180px;
    overflow-y: auto;
  }

  .morphology-control-panel.expanded {
    width: 110px;
    max-height: 180px;
    overflow-y: auto;
  }

  /* Panel toggle button on mobile */
  .panel-toggle {
    padding: 8px 10px;
    font-size: 0.7rem;
    gap: 4px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .panel-toggle .toggle-icon {
    font-size: 0.6rem;
    width: 10px;
  }

  .panel-summary {
    font-size: 0.65rem;
    margin-left: 0;
    display: block;
    width: 100%;
    text-align: center;
  }

  .panel-content {
    margin-top: 6px;
    padding: 6px;
    padding-top: 6px;
    border-top: 1px solid rgba(0,0,0,0.1);
  }

  .rbc-control-panel h3,
  .wbc-control-panel h3,
  .plt-control-panel h3,
  .morphology-control-panel h3 {
    font-size: 0.65rem;
    margin-bottom: 0;
    letter-spacing: -0.2px;
    text-align: center;
    display: none;
  }

  /* Compact presets - grid layout */
  .anemia-presets,
  .wbc-presets,
  .plt-presets,
  .morph-presets {
    gap: 3px;
    flex-wrap: wrap;
    justify-content: center;
    flex-direction: row;
    align-items: stretch;
    width: 100%;
    padding: 4px;
  }

  .anemia-preset-btn,
  .wbc-preset-btn,
  .plt-preset-btn,
  .morph-preset-btn {
    padding: 4px 6px;
    font-size: 0.55rem;
    border-radius: 4px;
    letter-spacing: -0.1px;
    text-align: center;
    flex: 1 1 45%;
    min-width: 0;
  }

  /* Hide some detailed controls on mobile - but keep RBC sliders */
  .rbc-indices-grid,
  .differential-section,
  .plt-slider-section,
  .morph-sliders,
  .nrbc-section,
  .rbc-slider-section,
  .wbc-slider-section,
  .plt-current,
  .wbc-current,
  .morph-section {
    display: none;
  }

  /* Hide value displays on mobile to save space */
  .rbc-value,
  .wbc-value,
  .plt-value,
  .rbc-reference,
  .wbc-reference,
  .plt-reference {
    display: none;
  }

  /* Show RBC sliders when panel is expanded */
  .rbc-control-panel.expanded .rbc-index-row {
    display: block;
    margin-bottom: 8px;
  }

  .rbc-control-panel.expanded .rbc-index-row.calculated-row,
  .rbc-control-panel.expanded .rbc-index-row.nrbc-row {
    display: none;
  }

  .rbc-control-panel.expanded .rbc-index-header {
    flex-wrap: wrap;
    gap: 2px;
  }

  .rbc-control-panel.expanded .rbc-index-label {
    font-size: 0.6rem;
    min-width: 28px;
  }

  .rbc-control-panel.expanded .rbc-index-value {
    font-size: 0.7rem;
  }

  .rbc-control-panel.expanded .rbc-index-status {
    font-size: 0.5rem;
  }

  .rbc-control-panel.expanded .rbc-slider {
    height: 4px;
  }

  .rbc-control-panel.expanded .rbc-slider::-webkit-slider-thumb {
    width: 12px;
    height: 12px;
  }

  .rbc-control-panel.expanded .rbc-slider::-moz-range-thumb {
    width: 12px;
    height: 12px;
  }

  /* Cell types panel - hide on mobile, too crowded */
  .cell-types-panel {
    display: none;
  }

  /* Hide performance stats on mobile */
  .perf-stats-panel {
    display: none;
  }

  /* Hide title on mobile - replaced by mobile info button */
  .viewer-title {
    display: none;
  }

  /* Hide desktop copyright on mobile */
  .viewer-copyright.desktop-only {
    display: none;
  }

  /* Mobile info button - top center */
  .mobile-info-button {
    display: flex;
  }
}

/* Copyright notice - bottom left */
.viewer-copyright {
  position: fixed;
  bottom: 20px;
  left: 20px;
  z-index: 50;
  text-align: left;
}

.viewer-copyright p {
  margin: 0;
  font-size: 0.75rem;
  color: #6b7280;
  text-shadow: 0 1px 3px rgba(255, 255, 255, 0.8);
}

.viewer-copyright p:first-child {
  font-weight: 500;
  color: #4b5563;
}

/* =================================================================
   MORPHOLOGY PANEL
   ================================================================= */

.morph-control-panel {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  border-radius: 8px;
  box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
  overflow: hidden;
  transition: all 0.2s ease;
}

.morph-control-panel.expanded {
  width: 280px;
  max-height: none;
  overflow-y: visible;
}

.morph-control-panel.collapsed {
  width: 200px;
}

.morph-toggle {
  background: linear-gradient(135deg, #4f46e5, #7c3aed);
  color: #ffffff !important;
  justify-content: center;
  padding: 10px 14px;
  border-radius: 8px;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.morph-toggle .toggle-icon {
  color: rgba(255, 255, 255, 0.9) !important;
}

.morph-toggle span {
  color: #ffffff;
}

.morph-summary {
  color: #8b5cf6 !important;
  font-size: 1.1rem;
}

.morph-panel-content {
  max-height: none;
  overflow-y: visible;
}

.morph-presets {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  padding: 8px 0;
  border-bottom: 1px solid #e5e7eb;
  margin-bottom: 10px;
}

.morph-preset-btn {
  padding: 4px 8px;
  font-size: 0.7rem;
  border: 1px solid #d1d5db;
  border-radius: 4px;
  background: white;
  color: #4b5563;
  cursor: pointer;
  transition: all 0.15s;
}

.morph-preset-btn:hover {
  background: #f3f4f6;
  border-color: #9ca3af;
}

.morph-preset-btn.active {
  background: linear-gradient(135deg, #6366f1, #8b5cf6);
  color: white;
  border-color: transparent;
}

.morph-section {
  margin-bottom: 12px;
}

.morph-section-title {
  font-size: 0.75rem;
  font-weight: 600;
  margin: 8px 0 6px 0;
  padding: 4px 8px;
  border-radius: 4px;
}

.rbc-morph-title {
  background: linear-gradient(135deg, rgba(196, 68, 68, 0.1), rgba(232, 138, 138, 0.1));
  color: #c44444;
}

.wbc-morph-title {
  background: linear-gradient(135deg, rgba(139, 41, 66, 0.1), rgba(196, 68, 68, 0.1));
  color: #8b2942;
}

.morph-sliders {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.morph-slider-row {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 2px 0;
}

.morph-label {
  font-size: 0.65rem;
  color: #4b5563;
  width: 70px;
  flex-shrink: 0;
}

.morph-slider {
  flex: 1;
  max-width: 45px;
  height: 4px;
  -webkit-appearance: none;
  appearance: none;
  background: #e5e7eb;
  border-radius: 2px;
  cursor: pointer;
}

.morph-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: #6366f1;
  cursor: pointer;
}

.rbc-morph-slider::-webkit-slider-thumb {
  background: #c44444;
}

.wbc-morph-slider::-webkit-slider-thumb {
  background: #8b2942;
}

.morph-percent {
  font-size: 0.6rem;
  color: #6b7280;
  width: 24px;
  text-align: right;
  font-family: monospace;
}

/* =================================================================
   RBC MORPHOLOGY CELL STYLES (floating cells in smear)
   ================================================================= */

/* Override contain property for cells that need overflow or use clip-path */
.floating-cell.rouleaux,
.floating-cell.smudge-cell,
.floating-cell.sickle-cell,
.floating-cell.stomatocyte,
.floating-cell.howell-jolly,
.floating-cell.neutrophil,
.floating-cell.neutrophil-3lobe,
.floating-cell.band-neutrophil,
.floating-cell.hypersegmented,
.floating-cell.toxic-granulation,
.floating-cell.dohle-bodies,
.floating-cell.eosinophil,
.floating-cell.eosinophil-3lobe,
.floating-cell.basophil,
.floating-cell.atypical-lymph,
.floating-cell.blast,
.floating-cell.auer-rod,
.floating-cell.myelocyte,
.floating-cell.metamyelocyte,
.floating-cell.elliptocyte,
.floating-cell.bite-cell,
.floating-cell.burr-cell,
.floating-cell.acanthocyte,
.floating-cell.schistocyte {
  contain: none !important;
  overflow: visible !important;
}

/* Spherocyte - small, dense, no central pallor */
.floating-cell.spherocyte {
  background: radial-gradient(
    ellipse at 30% 30%,
    rgba(200, 100, 100, 0.95) 0%,
    rgba(180, 70, 70, 0.95) 50%,
    rgba(160, 50, 50, 0.9) 100%
  ) !important;
  box-shadow: inset 0 0 3px rgba(0, 0, 0, 0.2), 1px 2px 4px rgba(0, 0, 0, 0.15) !important;
}

/* Target cell - bull's eye with gradual transitions between zones */
.floating-cell.target-cell {
  background: radial-gradient(
    circle,
    /* Central hemoglobin - bull's eye */
    rgba(195, 85, 85, 0.95) 0%,
    rgba(200, 90, 90, 0.9) 12%,
    /* Transition to central pallor */
    rgba(235, 170, 160, 0.8) 18%,
    rgba(255, 215, 200, 0.7) 25%,
    rgba(255, 220, 205, 0.65) 35%,
    /* Transition to peripheral hemoglobin */
    rgba(235, 165, 155, 0.8) 42%,
    rgba(200, 90, 90, 0.92) 50%,
    rgba(185, 75, 75, 0.95) 70%,
    rgba(175, 65, 65, 0.9) 100%
  ) !important;
}

/* Schistocyte - helmet cell with jagged/irregular edges
   Fragmented RBC torn through fibrin strands */
.floating-cell.schistocyte {
  background: radial-gradient(
    ellipse at 50% 60%,
    rgba(255, 200, 200, 0.8) 0%,
    rgba(210, 95, 90, 0.95) 30%,
    rgba(180, 70, 70, 0.9) 100%
  ) !important;
  /* Jagged helmet shape - irregular torn edges */
  clip-path: polygon(
    3% 50%,
    8% 35%,
    12% 40%,
    18% 20%,
    30% 12%,
    38% 18%,
    50% 5%,
    62% 15%,
    72% 8%,
    82% 22%,
    88% 35%,
    95% 48%,
    88% 58%,
    75% 52%,
    60% 60%,
    45% 55%,
    30% 62%,
    18% 55%,
    8% 58%
  ) !important;
  border-radius: 0 !important;
  transform: rotate(var(--cell-rotation, 0deg)) !important;
  animation: none !important;
}

/* Sickle cell - crescent shape */
.floating-cell.sickle-cell {
  background: transparent !important;
  position: relative;
  transform: rotate(var(--cell-rotation, 0deg)) !important;
  animation: none !important;
}

.floating-cell.sickle-cell::before {
  content: '';
  position: absolute;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, rgba(180, 70, 70, 0.95), rgba(140, 40, 40, 0.95));
  border-radius: 50%;
  top: 0;
  left: 0;
}

.floating-cell.sickle-cell::after {
  content: '';
  position: absolute;
  width: 90%;
  height: 90%;
  background: linear-gradient(135deg, #fdf6f0 0%, #fef9f5 100%);
  border-radius: 50%;
  top: -15%;
  left: 20%;
}

/* Teardrop - dacrocyte */
.floating-cell.teardrop {
  background: radial-gradient(
    ellipse at 50% 70%,
    rgba(240, 160, 160, 0.9) 0%,
    rgba(200, 90, 90, 0.95) 40%,
    rgba(180, 70, 70, 0.9) 100%
  ) !important;
  border-radius: 50% 50% 50% 50% / 30% 30% 70% 70% !important;
  transform: rotate(var(--cell-rotation, 0deg)) !important;
  animation: none !important;
}

/* Elliptocyte - oval/elongated RBC */
.floating-cell.elliptocyte {
  background: radial-gradient(
    ellipse at 40% 40%,
    rgba(255, 200, 200, 0.9) 0%,
    rgba(220, 100, 100, 0.95) 25%,
    rgba(180, 60, 60, 0.7) 45%,
    rgba(200, 80, 80, 0.95) 65%,
    rgba(180, 60, 60, 0.9) 100%
  ) !important;
  border-radius: 50% !important;
  transform: rotate(var(--cell-rotation, 0deg)) scaleX(1.5) scaleY(0.7) !important;
  animation: none !important;
}

/* Bite cell - large semicircular bite removed by splenic macrophages */
.floating-cell.bite-cell {
  background: radial-gradient(
    ellipse at 45% 50%,
    rgba(255, 200, 200, 0.9) 0%,
    rgba(200, 90, 90, 0.95) 40%,
    rgba(180, 70, 70, 0.9) 100%
  ) !important;
  border-radius: 50% !important;
  clip-path: polygon(
    0% 0%, 100% 0%, 100% 100%, 0% 100%,
    0% 75%,
    20% 68%,
    40% 58%,
    50% 50%,
    40% 42%,
    20% 32%,
    0% 25%
  ) !important;
  transform: rotate(var(--cell-rotation, 0deg)) !important;
  animation: none !important;
}

/* Burr cell - echinocyte with evenly spaced spicules, slightly rounded tips */
.floating-cell.burr-cell {
  background: radial-gradient(
    ellipse at 50% 50%,
    rgba(255, 210, 200, 0.75) 0%,
    rgba(220, 100, 100, 0.95) 30%,
    rgba(190, 70, 70, 0.95) 60%,
    rgba(180, 60, 60, 0.9) 100%
  ) !important;
  /* 12 spicules with rounded tips */
  clip-path: polygon(
    46% 5%, 50% 2%, 54% 5%, 58% 25%,
    70% 8%, 75% 6%, 78% 10%, 72% 28%,
    90% 22%, 95% 25%, 93% 30%, 75% 42%,
    95% 46%, 98% 50%, 95% 54%, 75% 58%,
    93% 70%, 95% 75%, 90% 78%, 72% 72%,
    78% 90%, 75% 94%, 70% 92%, 58% 75%,
    54% 95%, 50% 98%, 46% 95%, 42% 75%,
    30% 92%, 25% 94%, 22% 90%, 28% 72%,
    10% 78%, 5% 75%, 7% 70%, 25% 58%,
    5% 54%, 2% 50%, 5% 46%, 25% 42%,
    7% 30%, 5% 25%, 10% 22%, 28% 28%,
    22% 10%, 25% 6%, 30% 8%, 42% 25%
  ) !important;
  border-radius: 0 !important;
  transform: rotate(var(--cell-rotation, 0deg)) !important;
  animation: none !important;
}

/* Acanthocyte - spur cell with irregular spicules
   Fewer spicules than burr, varying lengths, some areas smooth */
.floating-cell.acanthocyte {
  background: radial-gradient(
    ellipse at 50% 50%,
    rgba(255, 210, 200, 0.75) 0%,
    rgba(220, 100, 100, 0.95) 30%,
    rgba(190, 70, 70, 0.95) 60%,
    rgba(180, 60, 60, 0.9) 100%
  ) !important;
  /* Only 5 spicules - irregular lengths, big gaps between */
  clip-path: polygon(
    /* Long spike top */
    45% 0%, 55% 18%,
    /* Smooth curve - no spike */
    62% 15%, 72% 12%, 80% 18%,
    /* Medium spike right */
    97% 35%, 78% 40%,
    /* Smooth curve - no spike */
    82% 55%, 85% 70%,
    /* Short spike bottom-right */
    92% 88%, 72% 78%,
    /* Smooth curve - no spike */
    60% 82%, 50% 85%, 40% 82%,
    /* Long spike bottom-left */
    12% 95%, 32% 70%,
    /* Smooth curve - no spike */
    25% 55%, 20% 42%,
    /* Medium spike left */
    3% 28%, 25% 30%,
    /* Smooth curve back to top */
    28% 20%, 35% 12%
  ) !important;
  border-radius: 0 !important;
  transform: rotate(var(--cell-rotation, 0deg)) !important;
  animation: none !important;
}

/* Stomatocyte - mouth-shaped pallor */
.floating-cell.stomatocyte {
  background: radial-gradient(
    ellipse at 30% 30%,
    rgba(200, 90, 90, 0.95) 0%,
    rgba(180, 70, 70, 0.9) 100%
  ) !important;
  position: relative;
}

.floating-cell.stomatocyte::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 40%;
  height: 15%;
  background: rgba(255, 220, 200, 0.8);
  border-radius: 50%;
}

/* Rouleaux - RBCs stacked like coins with minimal overlap */
.floating-cell.rouleaux {
  background: transparent !important;
  border-radius: 0 !important;
  box-shadow: none !important;
  transform: rotate(var(--cell-rotation, 0deg)) !important;
  overflow: visible !important;
  position: relative !important;
  animation: none !important;
}

/* Individual cells in rouleaux stack - each with biconcave disc appearance */
.rouleaux-cell {
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  /* Biconcave disc gradient with central pallor */
  background: radial-gradient(
    ellipse at center,
    rgba(255, 210, 200, 0.75) 0%,
    rgba(245, 180, 170, 0.8) 15%,
    rgba(220, 100, 90, 0.92) 30%,
    rgba(190, 65, 60, 0.98) 50%,
    rgba(175, 55, 55, 0.95) 65%,
    rgba(195, 75, 70, 0.9) 85%,
    rgba(210, 90, 85, 0.85) 100%
  );
  /* Position each cell based on stack index - percentage-based for proper scaling */
  left: calc(var(--stack-index) * 35%);
  top: calc(var(--stack-index) * 8%);
  /* Cells in back are slightly dimmer */
  opacity: calc(1 - (var(--stack-index) * 0.06));
  /* Stack order - first cell on top */
  z-index: calc(10 - var(--stack-index));
  box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.15);
}

/* Howell-Jolly body - RBC with dark purple nuclear remnant */
.floating-cell.howell-jolly {
  background: radial-gradient(
    ellipse at 30% 30%,
    rgba(255, 200, 200, 0.9) 0%,
    rgba(220, 100, 100, 0.95) 25%,
    rgba(180, 60, 60, 0.7) 45%,
    rgba(200, 80, 80, 0.95) 65%,
    rgba(180, 60, 60, 0.9) 100%
  ) !important;
  position: relative;
}

.floating-cell.howell-jolly::after {
  content: '';
  position: absolute;
  top: 20%;
  right: 20%;
  width: 25%;
  height: 25%;
  background: #4a1a6b;
  border-radius: 50%;
  box-shadow: 0 0 2px rgba(0, 0, 0, 0.3);
}

/* Basophilic stippling */
.floating-cell.basophilic-stippling {
  background:
    radial-gradient(circle at 25% 35%, #4a5568 1.5px, transparent 1.5px),
    radial-gradient(circle at 55% 45%, #4a5568 1px, transparent 1px),
    radial-gradient(circle at 40% 65%, #4a5568 1.5px, transparent 1.5px),
    radial-gradient(circle at 70% 30%, #4a5568 1px, transparent 1px),
    radial-gradient(
      ellipse at 30% 30%,
      rgba(255, 200, 200, 0.9) 0%,
      rgba(220, 100, 100, 0.95) 25%,
      rgba(180, 60, 60, 0.7) 45%,
      rgba(200, 80, 80, 0.95) 65%,
      rgba(180, 60, 60, 0.9) 100%
    ) !important;
}

/* Polychromasia - bluish tint */
.floating-cell.polychromasia {
  background: radial-gradient(
    ellipse at 30% 30%,
    rgba(200, 180, 210, 0.9) 0%,
    rgba(180, 140, 180, 0.95) 40%,
    rgba(160, 120, 160, 0.9) 100%
  ) !important;
}

/* =================================================================
   WBC MORPHOLOGY CELL STYLES (floating cells in smear)
   ================================================================= */

/* Normal segmented neutrophil - 4-5 lobes with realistic folded nucleus */
.floating-cell.neutrophil {
  background:
    /* Fine pink/lilac granules scattered throughout cytoplasm */
    radial-gradient(circle at 5% 8%, rgba(70, 40, 100, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 15% 10%, rgba(75, 45, 105, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 10% 22%, rgba(65, 35, 95, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 8% 85%, rgba(70, 40, 100, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 18% 78%, rgba(75, 45, 105, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 85% 8%, rgba(70, 40, 100, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 92% 18%, rgba(65, 35, 95, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 88% 82%, rgba(75, 45, 105, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 78% 88%, rgba(70, 40, 100, 0.5) 1px, transparent 1.5px),
    /* Base cytoplasm - pale pink */
    radial-gradient(
      ellipse at 50% 50%,
      rgba(250, 240, 245, 0.95) 0%,
      rgba(245, 230, 235, 0.9) 70%,
      rgba(235, 215, 225, 0.85) 100%
    ) !important;
  position: relative;
  box-shadow: inset 0 0 4px rgba(180, 140, 160, 0.3);
}

/* Hide the App.css ::before nucleus (uses non-scaling pixel values) */
.floating-cell.neutrophil::before,
.floating-cell.neutrophil-3lobe::before {
  display: none;
}

/* 3-4 lobed segmented nucleus - covers full cell, clip-path defines shape */
.floating-cell.neutrophil::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(60, 30, 90, 0.9);
  /* 3 distinct lobes - coordinates are % of full cell */
  clip-path: polygon(
    /* Lobe 1 - left */
    8% 58%, 5% 42%, 10% 28%, 22% 25%, 32% 35%, 30% 50%, 28% 60%,
    /* Thin bridge */
    30% 52%, 34% 48%, 38% 52%,
    /* Lobe 2 - center */
    42% 38%, 46% 22%, 54% 20%, 62% 26%, 65% 42%, 62% 55%,
    /* Thin bridge */
    64% 52%, 68% 48%, 72% 52%,
    /* Lobe 3 - right */
    76% 38%, 82% 28%, 92% 32%, 95% 48%, 90% 62%, 78% 68%, 70% 60%,
    /* Close bottom */
    62% 65%, 52% 72%, 48% 74%, 38% 70%, 28% 65%
  );
}

/* 3-lobed neutrophil variant */
.floating-cell.neutrophil-3lobe {
  background:
    /* Fine pink/lilac granules scattered throughout cytoplasm */
    radial-gradient(circle at 5% 8%, rgba(70, 40, 100, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 15% 10%, rgba(75, 45, 105, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 10% 22%, rgba(65, 35, 95, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 8% 85%, rgba(70, 40, 100, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 18% 78%, rgba(75, 45, 105, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 85% 8%, rgba(70, 40, 100, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 92% 18%, rgba(65, 35, 95, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 88% 82%, rgba(75, 45, 105, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 78% 88%, rgba(70, 40, 100, 0.5) 1px, transparent 1.5px),
    /* Base cytoplasm - pale pink */
    radial-gradient(
      ellipse at 50% 50%,
      rgba(250, 240, 245, 0.95) 0%,
      rgba(245, 230, 235, 0.9) 70%,
      rgba(235, 215, 225, 0.85) 100%
    ) !important;
  position: relative;
  box-shadow: inset 0 0 4px rgba(180, 140, 160, 0.3);
}

/* 3-lobed segmented nucleus - covers full cell, clip-path defines shape */
.floating-cell.neutrophil-3lobe::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(60, 30, 90, 0.9);
  /* 3 lobes arranged in curved line */
  clip-path: polygon(
    /* Lobe 1 - left */
    10% 55%, 5% 38%, 12% 22%, 28% 20%, 38% 32%, 35% 48%,
    /* Thin bridge */
    38% 46%, 42% 42%, 46% 46%,
    /* Lobe 2 - center-right */
    52% 34%, 60% 22%, 75% 24%, 85% 38%, 82% 55%, 72% 62%,
    /* Thin bridge down */
    70% 64%, 66% 68%, 62% 72%,
    /* Lobe 3 - bottom */
    58% 78%, 46% 88%, 32% 85%, 26% 72%, 35% 62%,
    /* Close back */
    32% 58%, 26% 55%, 20% 55%
  );
}

/* Band neutrophil - horseshoe nucleus with fine granules */
.floating-cell.band-neutrophil {
  background:
    /* Fine pink/lilac granules */
    radial-gradient(circle at 8% 12%, rgba(70, 40, 100, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 18% 8%, rgba(75, 45, 105, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 12% 25%, rgba(65, 35, 95, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 8% 45%, rgba(70, 40, 100, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 15% 75%, rgba(70, 40, 100, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 85% 15%, rgba(75, 45, 105, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 90% 40%, rgba(65, 35, 95, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 88% 75%, rgba(70, 40, 100, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 45% 88%, rgba(75, 45, 105, 0.5) 1px, transparent 1.5px),
    /* Base cytoplasm - pale pink */
    radial-gradient(
      ellipse at 50% 50%,
      rgba(250, 240, 245, 0.95) 0%,
      rgba(245, 230, 235, 0.9) 70%,
      rgba(235, 215, 225, 0.85) 100%
    ) !important;
  position: relative;
  box-shadow: inset 0 0 4px rgba(180, 140, 160, 0.3);
}

/* Band-shaped (horseshoe/C-shaped) nucleus - not segmented yet */
.floating-cell.band-neutrophil::after {
  content: '';
  position: absolute;
  top: 28%;
  left: 23%;
  width: 54%;
  height: 35%;
  background: radial-gradient(
    ellipse at 50% 30%,
    rgba(75, 55, 115, 0.88) 0%,
    rgba(55, 30, 90, 0.95) 100%
  );
  border-radius: 40%;
  clip-path: polygon(0% 100%, 0% 40%, 15% 0%, 85% 0%, 100% 40%, 100% 100%, 80% 100%, 80% 60%, 70% 30%, 30% 30%, 20% 60%, 20% 100%);
}

/* Hypersegmented neutrophil - 6+ nuclear lobes with realistic clip-path */
.floating-cell.hypersegmented {
  background:
    /* Fine pink/lilac granules */
    radial-gradient(circle at 5% 8%, rgba(70, 40, 100, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 15% 10%, rgba(75, 45, 105, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 8% 85%, rgba(70, 40, 100, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 18% 78%, rgba(75, 45, 105, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 85% 8%, rgba(70, 40, 100, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 92% 18%, rgba(65, 35, 95, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 88% 82%, rgba(75, 45, 105, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 78% 88%, rgba(70, 40, 100, 0.5) 1px, transparent 1.5px),
    /* Base cytoplasm - pale pink */
    radial-gradient(
      ellipse at 50% 50%,
      rgba(250, 240, 245, 0.95) 0%,
      rgba(245, 230, 235, 0.9) 70%,
      rgba(235, 215, 225, 0.85) 100%
    ) !important;
  position: relative;
  box-shadow: inset 0 0 4px rgba(180, 140, 160, 0.3);
}

/* 6+ lobed nucleus - stretched out with many segments */
.floating-cell.hypersegmented::after {
  content: '';
  position: absolute;
  top: 15%;
  left: 8%;
  width: 85%;
  height: 70%;
  background: radial-gradient(
    ellipse at 50% 40%,
    rgba(75, 55, 115, 0.85) 0%,
    rgba(60, 30, 90, 0.95) 100%
  );
  /* Realistic 6-lobed nucleus with thin connecting filaments */
  clip-path: polygon(
    /* Lobe 1 - far left */
    3% 35%, 0% 25%, 4% 12%, 12% 10%, 18% 18%, 16% 32%,
    /* Filament to lobe 2 */
    17% 36%, 19% 38%, 21% 36%,
    /* Lobe 2 */
    24% 28%, 28% 15%, 38% 10%, 45% 18%, 42% 32%,
    /* Filament to lobe 3 */
    43% 36%, 46% 38%, 49% 35%,
    /* Lobe 3 */
    52% 25%, 58% 12%, 68% 10%, 74% 20%, 70% 35%,
    /* Filament to lobe 4 */
    71% 40%, 74% 42%, 77% 38%,
    /* Lobe 4 - far right top */
    80% 28%, 88% 18%, 97% 22%, 98% 38%, 92% 48%,
    /* Filament down to lobe 5 */
    88% 52%, 86% 55%, 88% 58%,
    /* Lobe 5 - right bottom */
    92% 65%, 96% 78%, 90% 90%, 78% 88%, 72% 75%,
    /* Filament to lobe 6 */
    68% 72%, 64% 74%, 60% 72%,
    /* Lobe 6 - bottom center */
    55% 78%, 45% 92%, 32% 90%, 28% 78%, 35% 68%,
    /* Filament back up to lobe 1 area */
    32% 62%, 28% 58%, 24% 60%,
    /* Connect back through bottom */
    18% 68%, 8% 72%, 2% 60%, 5% 48%,
    /* Close to lobe 1 */
    6% 42%
  );
}

/* Toxic granulation - coarse dark granules indicating infection/inflammation */
.floating-cell.toxic-granulation {
  background:
    /* Coarse dark toxic granules - larger and darker */
    radial-gradient(circle at 10% 18%, rgba(45, 27, 78, 0.95) 2px, transparent 2.5px),
    radial-gradient(circle at 22% 12%, rgba(40, 22, 70, 0.95) 1.5px, transparent 2px),
    radial-gradient(circle at 15% 32%, rgba(50, 30, 85, 0.95) 2px, transparent 2.5px),
    radial-gradient(circle at 10% 60%, rgba(45, 27, 78, 0.95) 2px, transparent 2.5px),
    radial-gradient(circle at 18% 78%, rgba(40, 22, 70, 0.95) 1.5px, transparent 2px),
    radial-gradient(circle at 80% 15%, rgba(50, 30, 85, 0.95) 2px, transparent 2.5px),
    radial-gradient(circle at 88% 35%, rgba(45, 27, 78, 0.95) 1.5px, transparent 2px),
    radial-gradient(circle at 82% 62%, rgba(40, 22, 70, 0.95) 2px, transparent 2.5px),
    radial-gradient(circle at 78% 82%, rgba(50, 30, 85, 0.95) 1.5px, transparent 2px),
    /* Fine pink/lilac granules */
    radial-gradient(circle at 8% 8%, rgba(70, 40, 100, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 90% 12%, rgba(75, 45, 105, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 45% 88%, rgba(70, 40, 100, 0.5) 1px, transparent 1.5px),
    /* Base cytoplasm - pale pink */
    radial-gradient(
      ellipse at 50% 50%,
      rgba(250, 240, 245, 0.95) 0%,
      rgba(245, 230, 235, 0.9) 70%,
      rgba(235, 215, 225, 0.85) 100%
    ) !important;
  position: relative;
  box-shadow: inset 0 0 4px rgba(180, 140, 160, 0.3);
}

/* Multi-lobed nucleus - same as normal neutrophil */
.floating-cell.toxic-granulation::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: radial-gradient(
    ellipse at 50% 40%,
    rgba(75, 55, 115, 0.85) 0%,
    rgba(60, 30, 90, 0.95) 100%
  );
  clip-path: polygon(
    8% 58%, 5% 42%, 10% 28%, 22% 25%, 32% 35%, 30% 50%, 28% 60%,
    30% 52%, 34% 48%, 38% 52%,
    42% 38%, 46% 22%, 54% 20%, 62% 26%, 65% 42%, 62% 55%,
    64% 52%, 68% 48%, 72% 52%,
    76% 38%, 82% 28%, 92% 32%, 95% 48%, 90% 62%, 78% 68%, 70% 60%,
    62% 65%, 52% 72%, 48% 74%, 38% 70%, 28% 65%
  );
}

/* Dhle bodies - pale blue cytoplasmic inclusions */
.floating-cell.dohle-bodies {
  background:
    /* Dhle bodies - pale blue inclusions */
    radial-gradient(ellipse 12% 8% at 82% 78%, rgba(140, 175, 220, 0.9) 0%, rgba(140, 175, 220, 0.9) 60%, transparent 70%),
    radial-gradient(ellipse 10% 6% at 75% 85%, rgba(150, 185, 225, 0.85) 0%, rgba(150, 185, 225, 0.85) 60%, transparent 70%),
    /* Fine pink/lilac granules */
    radial-gradient(circle at 8% 12%, rgba(70, 40, 100, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 18% 8%, rgba(75, 45, 105, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 12% 25%, rgba(65, 35, 95, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 8% 45%, rgba(70, 40, 100, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 15% 75%, rgba(70, 40, 100, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 85% 15%, rgba(75, 45, 105, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 90% 40%, rgba(65, 35, 95, 0.5) 1px, transparent 1.5px),
    radial-gradient(circle at 45% 88%, rgba(75, 45, 105, 0.5) 1px, transparent 1.5px),
    /* Base cytoplasm - pale pink */
    radial-gradient(
      ellipse at 50% 50%,
      rgba(250, 240, 245, 0.95) 0%,
      rgba(245, 230, 235, 0.9) 70%,
      rgba(235, 215, 225, 0.85) 100%
    ) !important;
  position: relative;
  box-shadow: inset 0 0 4px rgba(180, 140, 160, 0.3);
}

/* Multi-lobed nucleus using radial-gradients (scales properly) */
.floating-cell.dohle-bodies::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: radial-gradient(
    ellipse at 50% 40%,
    rgba(75, 55, 115, 0.85) 0%,
    rgba(60, 30, 90, 0.95) 100%
  );
  clip-path: polygon(
    8% 58%, 5% 42%, 10% 28%, 22% 25%, 32% 35%, 30% 50%, 28% 60%,
    30% 52%, 34% 48%, 38% 52%,
    42% 38%, 46% 22%, 54% 20%, 62% 26%, 65% 42%, 62% 55%,
    64% 52%, 68% 48%, 72% 52%,
    76% 38%, 82% 28%, 92% 32%, 95% 48%, 90% 62%, 78% 68%, 70% 60%,
    62% 65%, 52% 72%, 48% 74%, 38% 70%, 28% 65%
  );
}

/* Atypical lymphocyte */
.floating-cell.atypical-lymph {
  border-radius: 45% 55% 50% 50% !important;
  background: radial-gradient(
    ellipse at 40% 40%,
    rgba(130, 160, 200, 0.95) 0%,
    rgba(100, 130, 180, 0.9) 100%
  ) !important;
  position: relative;
}

.floating-cell.atypical-lymph::before {
  content: '';
  position: absolute;
  top: 35%;
  left: 30%;
  width: 40%;
  height: 40%;
  background: radial-gradient(
    ellipse at 45% 40%,
    rgba(85, 55, 120, 0.85) 0%,
    rgba(61, 26, 92, 0.95) 100%
  );
  border-radius: 50%;
}

/* Blast cell - high N:C ratio but with visible cytoplasm rim */
.floating-cell.blast {
  background: radial-gradient(
    ellipse at 40% 40%,
    rgba(160, 180, 220, 0.95) 0%,
    rgba(140, 160, 200, 0.9) 100%
  ) !important;
  /* Irregular amoeboid shape - 75% more irregular */
  border-radius: 64% 36% 59% 41% / 54% 64% 36% 46% !important;
  position: relative;
}

.floating-cell.blast::before {
  content: '';
  position: absolute;
  top: 48%;
  left: 48%;
  transform: translate(-50%, -50%);
  width: 72%;
  height: 68%;
  background: radial-gradient(
    ellipse at 45% 45%,
    rgba(100, 80, 140, 0.85) 0%,
    rgba(74, 26, 107, 0.95) 100%
  );
  /* Irregular nucleus - 75% more irregular */
  border-radius: 59% 41% 46% 54% / 50% 59% 41% 50%;
}

.floating-cell.blast::after {
  content: '';
  position: absolute;
  top: 32%;
  left: 38%;
  width: 12%;
  height: 12%;
  background: rgba(200, 180, 220, 0.95);
  border-radius: 50%;
  box-shadow: 14px 6px 0 -1px rgba(200, 180, 220, 0.9);
}

/* Smudge cell - fragile lymphocyte that ruptured */
.floating-cell.smudge-cell {
  overflow: visible !important;
  background: transparent !important;
  border-radius: 0 !important;
}

.floating-cell.smudge-cell::before {
  content: '';
  position: absolute;
  /* 1.5X bigger - adjusted positioning to center */
  top: -62%;
  left: -70%;
  width: 240%;
  height: 225%;
  background: radial-gradient(
    ellipse 75% 55% at 45% 50%,
    rgba(100, 80, 140, 0.95) 0%,
    rgba(80, 60, 120, 0.75) 25%,
    rgba(74, 26, 107, 0.52) 45%,
    rgba(74, 26, 107, 0.22) 65%,
    transparent 80%
  );
  filter: blur(2px);
  /* Highly irregular amoeboid shape for ruptured cell - 75% more irregular */
  border-radius: 73% 27% 57% 43% / 59% 29% 71% 41%;
}

/* Promyelocyte with Auer rods - dense azurophilic granules */
.floating-cell.auer-rod {
  background:
    /* Dense azurophilic granules - 5x density throughout cytoplasm */
    radial-gradient(circle at 5% 12%, rgba(140, 60, 100, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 8% 8%, rgba(145, 65, 105, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 12% 15%, rgba(135, 55, 95, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 15% 10%, rgba(140, 60, 100, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 18% 18%, rgba(145, 65, 105, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 22% 12%, rgba(135, 55, 95, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 25% 8%, rgba(140, 60, 100, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 28% 15%, rgba(145, 65, 105, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 8% 22%, rgba(135, 55, 95, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 12% 28%, rgba(140, 60, 100, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 5% 32%, rgba(145, 65, 105, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 18% 25%, rgba(135, 55, 95, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 22% 32%, rgba(140, 60, 100, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 28% 28%, rgba(145, 65, 105, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 72% 8%, rgba(135, 55, 95, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 75% 12%, rgba(140, 60, 100, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 78% 8%, rgba(145, 65, 105, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 82% 15%, rgba(135, 55, 95, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 85% 10%, rgba(140, 60, 100, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 88% 18%, rgba(145, 65, 105, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 92% 12%, rgba(135, 55, 95, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 75% 22%, rgba(140, 60, 100, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 78% 28%, rgba(145, 65, 105, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 82% 25%, rgba(135, 55, 95, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 85% 32%, rgba(140, 60, 100, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 88% 28%, rgba(145, 65, 105, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 92% 22%, rgba(135, 55, 95, 0.9) 1px, transparent 1px),
    /* Bottom-center granules - cleared from Auer rod area */
    radial-gradient(circle at 42% 68%, rgba(140, 60, 100, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 45% 72%, rgba(145, 65, 105, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 48% 68%, rgba(135, 55, 95, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 52% 75%, rgba(140, 60, 100, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 55% 70%, rgba(145, 65, 105, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 58% 78%, rgba(135, 55, 95, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 62% 72%, rgba(140, 60, 100, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 65% 68%, rgba(145, 65, 105, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 42% 82%, rgba(135, 55, 95, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 45% 88%, rgba(140, 60, 100, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 48% 92%, rgba(145, 65, 105, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 52% 85%, rgba(135, 55, 95, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 55% 90%, rgba(140, 60, 100, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 58% 85%, rgba(145, 65, 105, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 72% 68%, rgba(135, 55, 95, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 75% 72%, rgba(140, 60, 100, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 78% 68%, rgba(145, 65, 105, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 82% 75%, rgba(135, 55, 95, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 85% 70%, rgba(140, 60, 100, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 88% 78%, rgba(145, 65, 105, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 92% 72%, rgba(135, 55, 95, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 75% 82%, rgba(140, 60, 100, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 78% 88%, rgba(145, 65, 105, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 82% 85%, rgba(135, 55, 95, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 85% 92%, rgba(140, 60, 100, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 88% 88%, rgba(145, 65, 105, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 92% 82%, rgba(135, 55, 95, 0.9) 1px, transparent 1px),
    /* Additional center-edge granules */
    radial-gradient(circle at 32% 12%, rgba(140, 60, 100, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 38% 8%, rgba(145, 65, 105, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 62% 12%, rgba(135, 55, 95, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 68% 8%, rgba(140, 60, 100, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 32% 88%, rgba(145, 65, 105, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 38% 92%, rgba(135, 55, 95, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 62% 88%, rgba(140, 60, 100, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 68% 92%, rgba(145, 65, 105, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 5% 45%, rgba(135, 55, 95, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 8% 52%, rgba(140, 60, 100, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 12% 48%, rgba(145, 65, 105, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 92% 45%, rgba(135, 55, 95, 0.9) 1px, transparent 1px),
    radial-gradient(circle at 88% 52%, rgba(140, 60, 100, 0.9) 0.8px, transparent 0.8px),
    radial-gradient(circle at 85% 48%, rgba(145, 65, 105, 0.9) 1px, transparent 1px),
    radial-gradient(
      ellipse at 40% 40%,
      rgba(150, 170, 210, 0.95) 0%,
      rgba(130, 150, 190, 0.9) 100%
    ) !important;
  /* Irregular amoeboid shape */
  border-radius: 59% 41% 54% 46% / 46% 59% 41% 54% !important;
  position: relative;
  overflow: hidden;
}

.floating-cell.auer-rod::before {
  content: '';
  position: absolute;
  top: 48%;
  left: 48%;
  transform: translate(-50%, -50%);
  width: 60%;
  height: 52%;
  background: radial-gradient(
    ellipse at 45% 45%,
    rgba(90, 70, 130, 0.85) 0%,
    rgba(74, 26, 107, 0.95) 100%
  );
  /* Irregular nucleus */
  border-radius: 54% 46% 59% 41% / 46% 54% 46% 54%;
}

/* Auer rod in cytosol */
.floating-cell.auer-rod::after {
  content: '';
  position: absolute;
  top: 75%;
  left: 12%;
  width: 28%;
  height: 6%;
  background: linear-gradient(90deg, rgba(200, 80, 100, 0.95), rgba(160, 50, 70, 0.9));
  border-radius: 2px;
  transform: rotate(-15deg);
}

/* Myelocyte - round eccentric nucleus, primary granules
   Intermediate between blast and metamyelocyte
   Size: ~18-20m, nucleus ~60% of cell, off-center */
.floating-cell.myelocyte {
  background:
    /* Primary granules - azurophilic, less dense than promyelocyte */
    radial-gradient(circle at 8% 15%, rgba(130, 50, 90, 0.85) 0.8px, transparent 0.8px),
    radial-gradient(circle at 15% 10%, rgba(135, 55, 95, 0.85) 0.8px, transparent 0.8px),
    radial-gradient(circle at 22% 18%, rgba(125, 45, 85, 0.85) 0.8px, transparent 0.8px),
    radial-gradient(circle at 12% 25%, rgba(130, 50, 90, 0.85) 0.8px, transparent 0.8px),
    radial-gradient(circle at 75% 12%, rgba(135, 55, 95, 0.85) 0.8px, transparent 0.8px),
    radial-gradient(circle at 82% 20%, rgba(125, 45, 85, 0.85) 0.8px, transparent 0.8px),
    radial-gradient(circle at 78% 28%, rgba(130, 50, 90, 0.85) 0.8px, transparent 0.8px),
    radial-gradient(circle at 85% 15%, rgba(135, 55, 95, 0.85) 0.8px, transparent 0.8px),
    radial-gradient(circle at 70% 75%, rgba(125, 45, 85, 0.85) 0.8px, transparent 0.8px),
    radial-gradient(circle at 78% 82%, rgba(130, 50, 90, 0.85) 0.8px, transparent 0.8px),
    radial-gradient(circle at 85% 78%, rgba(135, 55, 95, 0.85) 0.8px, transparent 0.8px),
    radial-gradient(circle at 72% 88%, rgba(125, 45, 85, 0.85) 0.8px, transparent 0.8px),
    /* Base cytoplasm - blue-gray */
    radial-gradient(
      ellipse at 40% 40%,
      rgba(175, 190, 215, 0.95) 0%,
      rgba(155, 170, 200, 0.9) 100%
    ) !important;
  border-radius: 52% 48% 55% 45% / 48% 52% 48% 52% !important;
  position: relative;
}

/* Round eccentric nucleus - off-center, still large but condensing */
.floating-cell.myelocyte::before {
  content: '';
  position: absolute;
  top: 22%;
  left: 18%;
  transform: translate(-10%, -5%);
  width: 58%;
  height: 55%;
  background: radial-gradient(
    ellipse at 45% 45%,
    rgba(95, 75, 135, 0.85) 0%,
    rgba(70, 40, 100, 0.95) 100%
  );
  /* Round to slightly oval nucleus */
  border-radius: 55% 45% 48% 52% / 50% 55% 45% 50%;
}

/* Nucleoli - 1-2 visible (smaller than blast) */
.floating-cell.myelocyte::after {
  content: '';
  position: absolute;
  top: 30%;
  left: 28%;
  width: 10%;
  height: 10%;
  background: rgba(200, 180, 220, 0.9);
  border-radius: 50%;
  box-shadow: 10px 5px 0 -1px rgba(200, 180, 220, 0.85);
}

/* Metamyelocyte - kidney/indented nucleus, secondary granules
   Nucleus shows clear indentation (kidney-bean shape)
   Size: ~15-18m, nucleus ~50% of cell */
.floating-cell.metamyelocyte {
  background:
    /* Secondary (specific) granules - finer, pink-tan */
    radial-gradient(circle at 8% 12%, rgba(180, 140, 130, 0.8) 0.6px, transparent 0.6px),
    radial-gradient(circle at 14% 8%, rgba(175, 135, 125, 0.8) 0.6px, transparent 0.6px),
    radial-gradient(circle at 20% 15%, rgba(185, 145, 135, 0.8) 0.6px, transparent 0.6px),
    radial-gradient(circle at 10% 22%, rgba(180, 140, 130, 0.8) 0.6px, transparent 0.6px),
    radial-gradient(circle at 72% 10%, rgba(175, 135, 125, 0.8) 0.6px, transparent 0.6px),
    radial-gradient(circle at 78% 18%, rgba(185, 145, 135, 0.8) 0.6px, transparent 0.6px),
    radial-gradient(circle at 85% 12%, rgba(180, 140, 130, 0.8) 0.6px, transparent 0.6px),
    radial-gradient(circle at 75% 25%, rgba(175, 135, 125, 0.8) 0.6px, transparent 0.6px),
    radial-gradient(circle at 68% 72%, rgba(185, 145, 135, 0.8) 0.6px, transparent 0.6px),
    radial-gradient(circle at 75% 78%, rgba(180, 140, 130, 0.8) 0.6px, transparent 0.6px),
    radial-gradient(circle at 82% 75%, rgba(175, 135, 125, 0.8) 0.6px, transparent 0.6px),
    radial-gradient(circle at 70% 85%, rgba(185, 145, 135, 0.8) 0.6px, transparent 0.6px),
    radial-gradient(circle at 78% 88%, rgba(180, 140, 130, 0.8) 0.6px, transparent 0.6px),
    /* Primary granules (fewer remaining) */
    radial-gradient(circle at 18% 75%, rgba(130, 50, 90, 0.75) 0.7px, transparent 0.7px),
    radial-gradient(circle at 25% 82%, rgba(125, 45, 85, 0.75) 0.7px, transparent 0.7px),
    /* Base cytoplasm - pink-tan */
    radial-gradient(
      ellipse at 40% 40%,
      rgba(215, 200, 195, 0.95) 0%,
      rgba(195, 180, 175, 0.9) 100%
    ) !important;
  border-radius: 50% 50% 52% 48% / 48% 50% 50% 52% !important;
  position: relative;
}

/* Kidney-bean shaped nucleus - key distinguishing feature */
.floating-cell.metamyelocyte::before {
  content: '';
  position: absolute;
  top: 20%;
  left: 15%;
  width: 50%;
  height: 45%;
  border-radius: 65% 35% 35% 65% / 55% 55% 45% 45%;
  background: radial-gradient(
    ellipse at 40% 45%,
    rgba(85, 65, 120, 0.85) 0%,
    rgba(65, 35, 95, 0.95) 100%
  );
  transform: rotate(-10deg);
}

/* Second part of kidney-bean creating indentation */
.floating-cell.metamyelocyte::after {
  content: '';
  position: absolute;
  top: 32%;
  left: 38%;
  width: 35%;
  height: 32%;
  border-radius: 35% 65% 65% 35% / 45% 45% 55% 55%;
  background: radial-gradient(
    ellipse at 60% 45%,
    rgba(85, 65, 120, 0.85) 0%,
    rgba(65, 35, 95, 0.95) 100%
  );
  transform: rotate(-10deg);
}

/* =================================================================
   DEVICE-SPECIFIC BREAKPOINTS FOR SMEAR VIEWER
   ================================================================= */

/* iPhone 14 Pro Max, 13 Pro Max, 12 Pro Max (430px) */
@media (max-width: 430px) {
  .viewer-back-link,
  .viewer-morphology-link {
    padding: 4px 7px;
    font-size: 0.55rem;
  }

  .microscope-panel {
    padding: 3px 6px;
  }

  .objective-btn {
    padding: 2px 4px;
    font-size: 0.5rem;
  }

  .control-btn {
    width: 22px;
    height: 22px;
    font-size: 0.65rem;
  }

  .viewer-title h1 {
    font-size: 0.65rem;
  }

  .viewer-title p {
    font-size: 0.4rem;
  }

  /* Control panels - bottom, horizontal */
  .rbc-control-panel.collapsed,
  .wbc-control-panel.collapsed,
  .plt-control-panel.collapsed {
    width: 65px;
  }

  .morphology-control-panel.collapsed {
    width: 50px;
  }

  .rbc-control-panel.expanded {
    width: 150px;
  }

  .wbc-control-panel.expanded,
  .plt-control-panel.expanded {
    width: 120px;
  }

  .morphology-control-panel.expanded {
    width: 100px;
  }

  .panel-toggle {
    padding: 7px 8px;
    font-size: 0.65rem;
  }

  .panel-summary {
    font-size: 0.6rem;
  }

  .anemia-preset-btn,
  .wbc-preset-btn,
  .plt-preset-btn,
  .morph-preset-btn {
    font-size: 0.5rem;
    padding: 3px 5px;
  }

  /* RBC slider styling for 430px */
  .rbc-control-panel.expanded .rbc-index-label {
    font-size: 0.55rem;
  }

  .rbc-control-panel.expanded .rbc-index-value {
    font-size: 0.65rem;
  }
}

/* iPhone 14/13/12, iPhone 14/13/12 Pro (390-393px) */
@media (max-width: 393px) {
  .viewer-nav-buttons {
    top: calc(env(safe-area-inset-top, 0px) + 6px);
    left: 6px;
    right: 6px;
    gap: 6px;
  }

  .viewer-back-link,
  .viewer-morphology-link {
    padding: 3px 6px;
    font-size: 0.5rem;
  }

  .microscope-panel {
    top: calc(env(safe-area-inset-top, 0px) + 36px);
    padding: 3px 5px;
  }

  .objective-btn {
    padding: 2px 3px;
    font-size: 0.45rem;
  }

  .control-btn {
    width: 20px;
    height: 20px;
    font-size: 0.6rem;
  }

  .viewer-title {
    top: calc(env(safe-area-inset-top, 0px) + 75px);
  }

  .viewer-title h1 {
    font-size: 0.6rem;
  }

  .viewer-title p {
    font-size: 0.38rem;
  }

  /* Control panels - bottom, horizontal */
  .indices-panels-container {
    gap: 5px;
  }

  .rbc-control-panel.collapsed,
  .wbc-control-panel.collapsed,
  .plt-control-panel.collapsed {
    width: 60px;
  }

  .morphology-control-panel.collapsed {
    width: 48px;
  }

  .rbc-control-panel.expanded {
    width: 140px;
  }

  .wbc-control-panel.expanded,
  .plt-control-panel.expanded {
    width: 110px;
  }

  .morphology-control-panel.expanded {
    width: 95px;
  }

  .panel-toggle {
    padding: 6px 7px;
    font-size: 0.6rem;
  }

  .panel-summary {
    font-size: 0.55rem;
  }

  .anemia-preset-btn,
  .wbc-preset-btn,
  .plt-preset-btn,
  .morph-preset-btn {
    font-size: 0.48rem;
    padding: 3px 4px;
  }

  /* RBC slider styling for 393px */
  .rbc-control-panel.expanded .rbc-index-label {
    font-size: 0.5rem;
  }

  .rbc-control-panel.expanded .rbc-index-value {
    font-size: 0.6rem;
  }

}

/* iPhone SE (2nd/3rd gen), iPhone 8, Samsung Galaxy S (375px) */
@media (max-width: 375px) {
  .viewer-nav-buttons {
    top: calc(env(safe-area-inset-top, 0px) + 5px);
    left: 5px;
    right: 5px;
    gap: 5px;
  }

  .viewer-back-link,
  .viewer-morphology-link {
    padding: 3px 5px;
    font-size: 0.45rem;
  }

  .microscope-panel {
    top: calc(env(safe-area-inset-top, 0px) + 32px);
    padding: 2px 4px;
  }

  .objective-btn {
    padding: 2px 3px;
    font-size: 0.42rem;
  }

  .control-btn {
    width: 18px;
    height: 18px;
    font-size: 0.55rem;
  }

  .viewer-title {
    top: calc(env(safe-area-inset-top, 0px) + 65px);
    left: 8px;
    right: 8px;
  }

  .viewer-title h1 {
    font-size: 0.55rem;
  }

  .viewer-title p {
    font-size: 0.35rem;
  }

  /* Control panels - bottom, horizontal */
  .indices-panels-container {
    gap: 4px;
    left: 5px;
    right: 5px;
  }

  .rbc-control-panel.collapsed,
  .wbc-control-panel.collapsed,
  .plt-control-panel.collapsed {
    width: 55px;
  }

  .morphology-control-panel.collapsed {
    width: 44px;
  }

  .rbc-control-panel.expanded {
    width: 130px;
  }

  .wbc-control-panel.expanded,
  .plt-control-panel.expanded {
    width: 100px;
  }

  .morphology-control-panel.expanded {
    width: 85px;
  }

  .panel-toggle {
    padding: 5px 6px;
    font-size: 0.55rem;
  }

  .panel-summary {
    font-size: 0.5rem;
  }

  .anemia-preset-btn,
  .wbc-preset-btn,
  .plt-preset-btn,
  .morph-preset-btn {
    font-size: 0.45rem;
    padding: 3px 3px;
  }

  /* RBC slider styling for 375px */
  .rbc-control-panel.expanded .rbc-index-label {
    font-size: 0.48rem;
  }

  .rbc-control-panel.expanded .rbc-index-value {
    font-size: 0.55rem;
  }
}

/* Small Android phones (360px) */
@media (max-width: 360px) {
  .viewer-nav-buttons {
    top: calc(env(safe-area-inset-top, 0px) + 4px);
    gap: 4px;
  }

  .viewer-back-link,
  .viewer-morphology-link {
    padding: 2px 4px;
    font-size: 0.42rem;
    border-radius: 5px;
  }

  .microscope-panel {
    top: calc(env(safe-area-inset-top, 0px) + 28px);
    padding: 2px 3px;
    border-radius: 8px;
  }

  .objective-btn {
    padding: 1px 2px;
    font-size: 0.4rem;
  }

  .control-btn {
    width: 16px;
    height: 16px;
    font-size: 0.5rem;
  }

  .viewer-title {
    top: calc(env(safe-area-inset-top, 0px) + 58px);
  }

  .viewer-title h1 {
    font-size: 0.5rem;
  }

  .viewer-title p {
    font-size: 0.32rem;
  }

  /* Control panels - bottom, horizontal */
  .indices-panels-container {
    gap: 3px;
    left: 4px;
    right: 4px;
  }

  .rbc-control-panel.collapsed,
  .wbc-control-panel.collapsed,
  .plt-control-panel.collapsed {
    width: 50px;
  }

  .morphology-control-panel.collapsed {
    width: 40px;
  }

  .rbc-control-panel.expanded {
    width: 120px;
  }

  .wbc-control-panel.expanded,
  .plt-control-panel.expanded {
    width: 90px;
  }

  .morphology-control-panel.expanded {
    width: 75px;
  }

  .panel-toggle {
    padding: 5px 5px;
    font-size: 0.5rem;
  }

  .panel-summary {
    font-size: 0.45rem;
  }

  .anemia-preset-btn,
  .wbc-preset-btn,
  .plt-preset-btn,
  .morph-preset-btn {
    font-size: 0.4rem;
    padding: 2px 3px;
  }

  /* RBC slider styling for 360px */
  .rbc-control-panel.expanded .rbc-index-label {
    font-size: 0.45rem;
  }

  .rbc-control-panel.expanded .rbc-index-value {
    font-size: 0.5rem;
  }

  .rbc-control-panel.expanded .rbc-slider::-webkit-slider-thumb {
    width: 10px;
    height: 10px;
  }
}

/* iPhone SE 1st gen, very small screens (320px) */
@media (max-width: 320px) {
  .viewer-nav-buttons {
    top: calc(env(safe-area-inset-top, 0px) + 3px);
    left: 3px;
    right: 3px;
    gap: 3px;
  }

  .viewer-back-link,
  .viewer-morphology-link {
    padding: 2px 3px;
    font-size: 0.38rem;
    border-radius: 4px;
  }

  .microscope-panel {
    top: calc(env(safe-area-inset-top, 0px) + 24px);
    padding: 2px 3px;
    border-radius: 6px;
  }

  .objective-btn {
    padding: 1px 2px;
    font-size: 0.35rem;
  }

  .control-btn {
    width: 14px;
    height: 14px;
    font-size: 0.45rem;
  }

  .viewer-title {
    top: calc(env(safe-area-inset-top, 0px) + 50px);
    left: 5px;
    right: 5px;
  }

  .viewer-title h1 {
    font-size: 0.45rem;
  }

  .viewer-title p {
    font-size: 0.28rem;
  }

  /* Control panels - bottom, horizontal, compact */
  .indices-panels-container {
    gap: 2px;
    left: 3px;
    right: 3px;
    bottom: calc(env(safe-area-inset-bottom, 0px) + 6px);
  }

  .rbc-control-panel.collapsed,
  .wbc-control-panel.collapsed,
  .plt-control-panel.collapsed {
    width: 45px;
  }

  .morphology-control-panel.collapsed {
    width: 36px;
  }

  .rbc-control-panel.expanded {
    width: 110px;
  }

  .wbc-control-panel.expanded,
  .plt-control-panel.expanded {
    width: 80px;
  }

  .morphology-control-panel.expanded {
    width: 65px;
  }

  .panel-toggle {
    padding: 4px 4px;
    font-size: 0.45rem;
  }

  .panel-summary {
    font-size: 0.4rem;
  }

  .anemia-preset-btn,
  .wbc-preset-btn,
  .plt-preset-btn,
  .morph-preset-btn {
    font-size: 0.38rem;
    padding: 2px 2px;
  }

  /* RBC slider styling for 320px */
  .rbc-control-panel.expanded .rbc-index-label {
    font-size: 0.42rem;
  }

  .rbc-control-panel.expanded .rbc-index-value {
    font-size: 0.48rem;
  }

  .rbc-control-panel.expanded .rbc-slider::-webkit-slider-thumb {
    width: 9px;
    height: 9px;
  }
}

/* =================================================================
   LARGE SCREEN RESPONSIVE STYLES
   ================================================================= */

/* 1440p monitors and larger laptops */
@media (min-width: 1440px) {
  .rbc-control-panel,
  .wbc-control-panel,
  .plt-control-panel {
    width: 310px;
    padding: 16px 20px;
    border-radius: 14px;
  }

  .rbc-control-panel.collapsed,
  .wbc-control-panel.collapsed,
  .plt-control-panel.collapsed {
    width: 230px;
  }

  .panel-toggle {
    font-size: 1.15rem;
    gap: 10px;
  }

  .panel-summary {
    font-size: 0.85rem;
  }

  .toggle-icon {
    font-size: 0.9rem;
  }

  /* RBC panel scaling */
  .rbc-index-label {
    font-size: 0.75rem;
    min-width: 32px;
  }

  .rbc-index-value {
    font-size: 0.75rem;
    min-width: 44px;
  }

  .rbc-index-value .unit {
    font-size: 0.6rem;
  }

  .rbc-index-status {
    font-size: 0.65rem;
  }

  .rbc-slider {
    height: 4px;
    max-width: 65px;
  }

  .rbc-slider::-webkit-slider-thumb {
    width: 12px;
    height: 12px;
  }

  .rbc-slider::-moz-range-thumb {
    width: 12px;
    height: 12px;
  }

  .anemia-preset-btn {
    font-size: 0.6rem;
    padding: 3px 5px;
  }

  /* PLT/WBC panel scaling */
  .plt-value,
  .wbc-value {
    font-size: 1.6rem;
  }

  .plt-status,
  .wbc-status {
    font-size: 0.95rem;
  }

  .plt-slider,
  .wbc-slider {
    height: 7px;
  }

  .plt-slider::-webkit-slider-thumb,
  .wbc-slider::-webkit-slider-thumb {
    width: 20px;
    height: 20px;
  }

  .plt-slider::-moz-range-thumb,
  .wbc-slider::-moz-range-thumb {
    width: 20px;
    height: 20px;
  }

  .wbc-preset-btn,
  .plt-preset-btn {
    font-size: 0.8rem;
    padding: 5px 10px;
  }

  .wbc-reference,
  .plt-reference {
    font-size: 0.8rem;
  }

  .differential-section h4 {
    font-size: 0.95rem;
  }

  .diff-cell-name {
    font-size: 0.8rem;
  }

  .diff-cell-value {
    font-size: 0.75rem;
  }

  .diff-abs-value {
    font-size: 0.65rem;
  }

  /* Morphology panel */
  .morphology-control-panel {
    width: 180px;
    padding: 14px 16px;
  }

  .morphology-control-panel.expanded {
    width: 320px;
  }

  .morphology-control-panel.collapsed {
    width: 110px;
  }

  .morph-presets {
    gap: 6px;
  }

  .morph-section-title {
    font-size: 0.8rem;
  }

  .morph-row label {
    font-size: 0.75rem;
  }

  .morph-slider-value {
    font-size: 0.7rem;
  }

  /* Title and microscope panel */
  .viewer-title h1 {
    font-size: 1.3rem;
  }

  .viewer-title .subtitle {
    font-size: 0.9rem;
  }

  .microscope-panel {
    padding: 10px 14px;
    border-radius: 10px;
  }

  .density-label {
    font-size: 0.95rem;
  }

  .density-btn {
    font-size: 0.8rem;
    padding: 6px 10px;
  }

  /* Slide minimap */
  .slide-minimap-container {
    padding: 16px;
  }

  .slide-minimap {
    width: 150px;
    height: 200px;
  }

  .minimap-viewport {
    width: 32%;
    height: 22%;
  }

  .minimap-title {
    font-size: 1.05rem;
  }

  .zone-indicator {
    font-size: 0.9rem;
  }

  .zone-label {
    font-size: 0.8rem;
  }

  .minimap-hint {
    font-size: 0.85rem;
  }

  /* Cell types panel */
  .cell-types-panel {
    max-width: 300px;
    padding: 8px;
  }

  .cell-types-panel .panel-toggle {
    font-size: 0.95rem;
    padding: 10px;
  }

  .count-grid .count-item {
    font-size: 0.85rem;
  }

  .count-grid .count-value {
    font-size: 1.3rem;
  }

  /* RBC panel interior - calculated values */
  .rbc-index-absolute {
    font-size: 0.6rem;
  }

  .rbc-reference {
    font-size: 0.6rem;
  }

  .calculated-row .rbc-index-label {
    font-size: 0.65rem;
  }

  .calculated-row .rbc-index-value {
    font-size: 0.65rem;
  }

  .calculated-row .rbc-index-status {
    font-size: 0.6rem;
  }

  .calculated-bar {
    max-width: 90px;
    height: 4px;
  }

  /* WBC Differential sliders */
  .diff-slider-row {
    gap: 6px;
  }

  .diff-label {
    font-size: 0.8rem;
    width: 38px;
  }

  .diff-slider {
    max-width: 55px;
    height: 5px;
  }

  .diff-slider::-webkit-slider-thumb {
    width: 14px;
    height: 14px;
  }

  .diff-slider::-moz-range-thumb {
    width: 14px;
    height: 14px;
  }

  .diff-percent {
    font-size: 0.75rem;
    width: 28px;
  }

  .diff-absolute {
    font-size: 0.65rem;
    width: 32px;
  }

  .diff-preset-btn {
    font-size: 0.75rem;
    padding: 4px 8px;
  }

  /* Morphology panel interior */
  .morph-toggle {
    font-size: 0.95rem;
  }

  .morph-summary {
    font-size: 0.75rem;
  }

  .morph-slider-row {
    gap: 6px;
  }

  .morph-label {
    font-size: 0.75rem;
    width: 80px;
  }

  .morph-slider {
    max-width: 55px;
    height: 5px;
  }

  .morph-slider::-webkit-slider-thumb {
    width: 14px;
    height: 14px;
  }

  .morph-slider::-moz-range-thumb {
    width: 14px;
    height: 14px;
  }

  .morph-percent {
    font-size: 0.7rem;
    width: 28px;
  }

  .morph-preset-btn {
    font-size: 0.7rem;
    padding: 4px 8px;
  }
}

/* 1920p / Full HD monitors */
@media (min-width: 1920px) {
  .rbc-control-panel,
  .wbc-control-panel,
  .plt-control-panel {
    width: 360px;
    padding: 18px 24px;
    border-radius: 16px;
  }

  .rbc-control-panel.collapsed,
  .wbc-control-panel.collapsed,
  .plt-control-panel.collapsed {
    width: 260px;
  }

  .panel-toggle {
    font-size: 1.3rem;
    gap: 12px;
  }

  .panel-summary {
    font-size: 0.95rem;
  }

  .toggle-icon {
    font-size: 1rem;
  }

  /* RBC panel scaling */
  .rbc-index-label {
    font-size: 0.85rem;
    min-width: 36px;
  }

  .rbc-index-value {
    font-size: 0.85rem;
    min-width: 50px;
  }

  .rbc-index-value .unit {
    font-size: 0.7rem;
  }

  .rbc-index-status {
    font-size: 0.75rem;
  }

  .rbc-index-row {
    gap: 8px;
    margin-bottom: 6px;
  }

  .rbc-slider {
    height: 5px;
    max-width: 75px;
  }

  .rbc-slider::-webkit-slider-thumb {
    width: 14px;
    height: 14px;
  }

  .rbc-slider::-moz-range-thumb {
    width: 14px;
    height: 14px;
  }

  .anemia-preset-btn {
    font-size: 0.7rem;
    padding: 4px 6px;
    border-radius: 3px;
  }

  .anemia-presets {
    gap: 4px;
    margin-bottom: 8px;
  }

  /* PLT/WBC panel scaling */
  .plt-value,
  .wbc-value {
    font-size: 1.8rem;
  }

  .plt-status,
  .wbc-status {
    font-size: 1.05rem;
  }

  .plt-slider,
  .wbc-slider {
    height: 8px;
    margin-bottom: 14px;
  }

  .plt-slider::-webkit-slider-thumb,
  .wbc-slider::-webkit-slider-thumb {
    width: 22px;
    height: 22px;
  }

  .plt-slider::-moz-range-thumb,
  .wbc-slider::-moz-range-thumb {
    width: 22px;
    height: 22px;
  }

  .wbc-preset-btn,
  .plt-preset-btn {
    font-size: 0.9rem;
    padding: 6px 12px;
  }

  .wbc-presets,
  .plt-presets {
    gap: 8px;
    margin-bottom: 12px;
  }

  .wbc-reference,
  .plt-reference {
    font-size: 0.9rem;
  }

  .differential-section h4 {
    font-size: 1.05rem;
  }

  .diff-cell-name {
    font-size: 0.9rem;
  }

  .diff-cell-value {
    font-size: 0.85rem;
  }

  .diff-abs-value {
    font-size: 0.75rem;
  }

  /* Morphology panel */
  .morphology-control-panel {
    width: 210px;
    padding: 16px 18px;
  }

  .morphology-control-panel.expanded {
    width: 380px;
  }

  .morphology-control-panel.collapsed {
    width: 130px;
  }

  .morph-presets {
    gap: 8px;
  }

  .morph-section-title {
    font-size: 0.9rem;
  }

  .morph-row label {
    font-size: 0.85rem;
  }

  .morph-slider-value {
    font-size: 0.8rem;
  }

  /* Title and microscope panel */
  .viewer-title h1 {
    font-size: 1.5rem;
  }

  .viewer-title .subtitle {
    font-size: 1rem;
  }

  .microscope-panel {
    padding: 12px 16px;
    border-radius: 12px;
  }

  .density-label {
    font-size: 1.1rem;
  }

  .density-btn {
    font-size: 0.9rem;
    padding: 8px 12px;
  }

  /* Slide minimap */
  .slide-minimap-container {
    padding: 18px;
  }

  .slide-minimap {
    width: 170px;
    height: 225px;
  }

  .minimap-viewport {
    width: 32%;
    height: 22%;
  }

  .minimap-title {
    font-size: 1.15rem;
  }

  .zone-indicator {
    font-size: 1rem;
  }

  .zone-label {
    font-size: 0.9rem;
  }

  .minimap-hint {
    font-size: 0.95rem;
  }

  /* Cell types panel */
  .cell-types-panel {
    max-width: 340px;
    padding: 10px;
  }

  .cell-types-panel .panel-toggle {
    font-size: 1.05rem;
    padding: 12px;
  }

  .count-grid .count-item {
    font-size: 0.95rem;
  }

  .count-grid .count-value {
    font-size: 1.5rem;
  }

  /* RBC panel interior - calculated values */
  .rbc-index-absolute {
    font-size: 0.7rem;
  }

  .rbc-reference {
    font-size: 0.7rem;
  }

  .calculated-row .rbc-index-label {
    font-size: 0.75rem;
  }

  .calculated-row .rbc-index-value {
    font-size: 0.75rem;
  }

  .calculated-row .rbc-index-status {
    font-size: 0.7rem;
  }

  .calculated-bar {
    max-width: 100px;
    height: 5px;
  }

  /* WBC Differential sliders */
  .diff-slider-row {
    gap: 8px;
  }

  .diff-label {
    font-size: 0.9rem;
    width: 44px;
  }

  .diff-slider {
    max-width: 65px;
    height: 6px;
  }

  .diff-slider::-webkit-slider-thumb {
    width: 16px;
    height: 16px;
  }

  .diff-slider::-moz-range-thumb {
    width: 16px;
    height: 16px;
  }

  .diff-percent {
    font-size: 0.85rem;
    width: 32px;
  }

  .diff-absolute {
    font-size: 0.75rem;
    width: 36px;
  }

  .diff-preset-btn {
    font-size: 0.85rem;
    padding: 5px 10px;
  }

  /* Morphology panel interior */
  .morph-toggle {
    font-size: 1.1rem;
  }

  .morph-summary {
    font-size: 0.85rem;
  }

  .morph-slider-row {
    gap: 8px;
  }

  .morph-label {
    font-size: 0.85rem;
    width: 90px;
  }

  .morph-slider {
    max-width: 65px;
    height: 6px;
  }

  .morph-slider::-webkit-slider-thumb {
    width: 16px;
    height: 16px;
  }

  .morph-slider::-moz-range-thumb {
    width: 16px;
    height: 16px;
  }

  .morph-percent {
    font-size: 0.8rem;
    width: 32px;
  }

  .morph-preset-btn {
    font-size: 0.8rem;
    padding: 5px 10px;
  }
}

/* 2560p / QHD and 4K monitors */
@media (min-width: 2560px) {
  .rbc-control-panel,
  .wbc-control-panel,
  .plt-control-panel {
    width: 420px;
    padding: 22px 28px;
    border-radius: 18px;
  }

  .rbc-control-panel.collapsed,
  .wbc-control-panel.collapsed,
  .plt-control-panel.collapsed {
    width: 300px;
  }

  .panel-toggle {
    font-size: 1.5rem;
    gap: 14px;
  }

  .panel-summary {
    font-size: 1.1rem;
  }

  .toggle-icon {
    font-size: 1.15rem;
  }

  /* RBC panel scaling */
  .rbc-index-label {
    font-size: 1rem;
    min-width: 42px;
  }

  .rbc-index-value {
    font-size: 1rem;
    min-width: 58px;
  }

  .rbc-index-value .unit {
    font-size: 0.8rem;
  }

  .rbc-index-status {
    font-size: 0.9rem;
  }

  .rbc-index-row {
    gap: 10px;
    margin-bottom: 8px;
  }

  .rbc-slider {
    height: 6px;
    max-width: 90px;
  }

  .rbc-slider::-webkit-slider-thumb {
    width: 16px;
    height: 16px;
  }

  .rbc-slider::-moz-range-thumb {
    width: 16px;
    height: 16px;
  }

  .anemia-preset-btn {
    font-size: 0.8rem;
    padding: 5px 8px;
    border-radius: 4px;
  }

  .anemia-presets {
    gap: 5px;
    margin-bottom: 10px;
  }

  /* PLT/WBC panel scaling */
  .plt-value,
  .wbc-value {
    font-size: 2.1rem;
  }

  .plt-status,
  .wbc-status {
    font-size: 1.2rem;
  }

  .plt-slider,
  .wbc-slider {
    height: 10px;
    margin-bottom: 16px;
  }

  .plt-slider::-webkit-slider-thumb,
  .wbc-slider::-webkit-slider-thumb {
    width: 26px;
    height: 26px;
  }

  .plt-slider::-moz-range-thumb,
  .wbc-slider::-moz-range-thumb {
    width: 26px;
    height: 26px;
  }

  .wbc-preset-btn,
  .plt-preset-btn {
    font-size: 1rem;
    padding: 8px 14px;
  }

  .wbc-presets,
  .plt-presets {
    gap: 10px;
    margin-bottom: 14px;
  }

  .wbc-reference,
  .plt-reference {
    font-size: 1rem;
  }

  .differential-section h4 {
    font-size: 1.2rem;
  }

  .diff-cell-name {
    font-size: 1.05rem;
  }

  .diff-cell-value {
    font-size: 1rem;
  }

  .diff-abs-value {
    font-size: 0.9rem;
  }

  /* Morphology panel */
  .morphology-control-panel {
    width: 250px;
    padding: 20px 22px;
  }

  .morphology-control-panel.expanded {
    width: 450px;
  }

  .morphology-control-panel.collapsed {
    width: 150px;
  }

  .morph-presets {
    gap: 10px;
  }

  .morph-section-title {
    font-size: 1.05rem;
  }

  .morph-row label {
    font-size: 1rem;
  }

  .morph-slider-value {
    font-size: 0.95rem;
  }

  /* Title and microscope panel */
  .viewer-title h1 {
    font-size: 1.8rem;
  }

  .viewer-title .subtitle {
    font-size: 1.2rem;
  }

  .microscope-panel {
    padding: 14px 20px;
    border-radius: 14px;
  }

  .density-label {
    font-size: 1.3rem;
  }

  .density-btn {
    font-size: 1.05rem;
    padding: 10px 16px;
  }

  /* Slide minimap */
  .slide-minimap-container {
    padding: 22px;
  }

  .slide-minimap {
    width: 210px;
    height: 280px;
  }

  .minimap-viewport {
    width: 32%;
    height: 22%;
  }

  .minimap-title {
    font-size: 1.3rem;
  }

  .zone-indicator {
    font-size: 1.15rem;
  }

  .zone-label {
    font-size: 1.05rem;
  }

  .minimap-hint {
    font-size: 1.1rem;
  }

  /* Cell types panel */
  .cell-types-panel {
    max-width: 400px;
    padding: 12px;
  }

  .cell-types-panel .panel-toggle {
    font-size: 1.2rem;
    padding: 14px;
  }

  .count-grid .count-item {
    font-size: 1.1rem;
  }

  .count-grid .count-value {
    font-size: 1.8rem;
  }

  /* RBC panel interior - calculated values */
  .rbc-index-absolute {
    font-size: 0.85rem;
  }

  .rbc-reference {
    font-size: 0.85rem;
  }

  .calculated-row .rbc-index-label {
    font-size: 0.9rem;
  }

  .calculated-row .rbc-index-value {
    font-size: 0.9rem;
  }

  .calculated-row .rbc-index-status {
    font-size: 0.85rem;
  }

  .calculated-bar {
    max-width: 120px;
    height: 6px;
  }

  /* WBC Differential sliders */
  .diff-slider-row {
    gap: 10px;
  }

  .diff-label {
    font-size: 1.05rem;
    width: 52px;
  }

  .diff-slider {
    max-width: 80px;
    height: 7px;
  }

  .diff-slider::-webkit-slider-thumb {
    width: 18px;
    height: 18px;
  }

  .diff-slider::-moz-range-thumb {
    width: 18px;
    height: 18px;
  }

  .diff-percent {
    font-size: 1rem;
    width: 38px;
  }

  .diff-absolute {
    font-size: 0.9rem;
    width: 42px;
  }

  .diff-preset-btn {
    font-size: 1rem;
    padding: 6px 12px;
  }

  /* Morphology panel interior */
  .morph-toggle {
    font-size: 1.25rem;
  }

  .morph-summary {
    font-size: 1rem;
  }

  .morph-slider-row {
    gap: 10px;
  }

  .morph-label {
    font-size: 1rem;
    width: 100px;
  }

  .morph-slider {
    max-width: 80px;
    height: 7px;
  }

  .morph-slider::-webkit-slider-thumb {
    width: 18px;
    height: 18px;
  }

  .morph-slider::-moz-range-thumb {
    width: 18px;
    height: 18px;
  }

  .morph-percent {
    font-size: 0.95rem;
    width: 38px;
  }

  .morph-preset-btn {
    font-size: 0.95rem;
    padding: 6px 12px;
  }
}

/* Landscape mode for phones - smear viewer */
@media (max-height: 500px) and (orientation: landscape) {
  .viewer-nav-buttons {
    top: calc(env(safe-area-inset-top, 0px) + 5px);
    flex-direction: row;
  }

  .microscope-panel {
    top: calc(env(safe-area-inset-top, 0px) + 5px);
    left: auto;
    right: 10px;
    transform: none;
  }

  .viewer-title {
    top: auto;
    bottom: 50px;
    left: 10px;
    right: auto;
  }

  /* Control panels - horizontal row in landscape */
  .indices-panels-container {
    top: auto;
    bottom: calc(env(safe-area-inset-bottom, 0px) + 5px);
    left: 5px;
    right: 5px;
    flex-direction: row;
    justify-content: flex-start;
  }

  .rbc-control-panel.collapsed,
  .wbc-control-panel.collapsed,
  .plt-control-panel.collapsed {
    width: 55px;
  }

  .morphology-control-panel.collapsed {
    width: 45px;
  }

  .panel-toggle {
    padding: 5px 6px;
    font-size: 0.55rem;
  }
}
